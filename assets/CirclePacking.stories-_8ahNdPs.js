import{R as xe}from"./index-RYns6xqu.js";import{i as G,a as _,s as ve,L as fe,b as j,c as J,f as ke,d as De,e as q,z as Me,g as Pe,h as Ce,j as Fe,C as Se,r as N,k as be,l as Q,m as X,B as Ae,F as C,n as Re,S,o as we,p as Te,q as Ee,t as Ie,u as Le,D as Z,v as Ne,w as Oe,x as He,y as Ke,A as B,E as ee,G as Ue,H as te,I as ie,J as Ve,K as je,M as qe,N as ze,O as We,P as Ye,Q as $e,R as Ge,T as Je,U as Qe,V as Xe,W as Ze,X as Be}from"./index-BgXXAD_r.js";import"./index-BX6J8nRb.js";import"./index-DcfIKM1A.js";import"./index-CpOIycTO.js";function re(i){if(G(i))return i;const e=+i;return G(e)?e:0}const ge=(i,e=[],t)=>{const a=(t==null?void 0:t.maxDepth)>=0;return i.forEach(r=>{(!a||r.depth<=t.maxDepth)&&(e.push(t!=null&&t.callback?t.callback(r):r),r.children&&(a&&r.depth===t.maxDepth?(r.children=null,r.isLeaf=!0):ge(r.children,e,t)))}),e},ye=(i,e,t=0,a=-1,r,n,l="value")=>{let s=0,o=a??-1,h=t;return i.forEach((g,y)=>{var p,u;const c={flattenIndex:++o,key:n?n(g):`${(p=r==null?void 0:r.key)!==null&&p!==void 0?p:""}-${y}`,maxDepth:-1,depth:t,index:y,value:g[l],isLeaf:!0,datum:r?r.datum.concat(g):[g],parentKey:r==null?void 0:r.key};if(!((u=g.children)===null||u===void 0)&&u.length){c.children=[],c.isLeaf=!1;const d=ye(g.children,c.children,t+1,o,c,n,l);c.value=_(g[l])?d.sum:Math.max(d.sum,re(g[l])),o=d.flattenIndex,h=Math.max(d.maxDepth,h)}else c.isLeaf=!0,c.value=re(g[l]);s+=Math.abs(c.value),e.push(c)}),{sum:s,maxDepth:h,flattenIndex:o}},f=(i,e,t,a)=>{let r=a;return i.forEach((n,l)=>{var s;r=e(n,l,t,r),!((s=n.children)===null||s===void 0)&&s.length&&(r=f(n.children,e,n,r))}),a},O=(i,e,t,a)=>{let r=a;return i.forEach((n,l)=>{var s;!((s=n.children)===null||s===void 0)&&s.length&&(r=O(n.children,e,n,r)),r=e(n,l,t,r)}),r},et=1664525,tt=1013904223,ae=4294967296;function it(i=1){let e=i;return()=>(e=(et*e+tt)%ae)/ae}function rt(i,e){let t=0;const a=ve(Array.from(i),e),r=a.length;let n,l,s=[];for(;t<r;)n=a[t],l&&pe(l,n)?++t:(s=at(s,n),l=nt(s),t=0);return l}function at(i,e){let t,a;if(U(e,i))return[e];for(t=0;t<i.length;++t)if(I(e,i[t])&&U(D(i[t],e),i))return[i[t],e];for(t=0;t<i.length-1;++t)for(a=t+1;a<i.length;++a)if(I(D(i[t],i[a]),e)&&I(D(i[t],e),i[a])&&I(D(i[a],e),i[t])&&U(me(i[t],i[a],e),i))return[i[t],i[a],e];fe.getInstance().error("error when packEncloseRandom")}function I(i,e){const t=i.radius-e.radius,a=e.x-i.x,r=e.y-i.y;return t<0||t*t<a*a+r*r}function pe(i,e){const t=i.radius-e.radius+1e-9*Math.max(i.radius,e.radius,1),a=e.x-i.x,r=e.y-i.y;return t>0&&t*t>a*a+r*r}function U(i,e){for(let t=0;t<e.length;++t)if(!pe(i,e[t]))return!1;return!0}function nt(i){switch(i.length){case 1:return st(i[0]);case 2:return D(i[0],i[1]);case 3:return me(i[0],i[1],i[2])}}function st(i){return{x:i.x,y:i.y,radius:i.radius}}function D(i,e){const t=i.x,a=i.y,r=i.radius,n=e.x,l=e.y,s=e.radius,o=n-t,h=l-a,g=s-r,y=Math.sqrt(o*o+h*h);return{x:(t+n+o/y*g)/2,y:(a+l+h/y*g)/2,radius:(y+r+s)/2}}function me(i,e,t){const a=i.x,r=i.y,n=i.radius,l=e.x,s=e.y,o=e.radius,h=t.x,g=t.y,y=t.radius,p=a-l,u=a-h,c=r-s,d=r-g,k=o-n,m=y-n,z=a*a+r*r-n*n,W=z-l*l-s*s+o*o,Y=z-h*h-g*g+y*y,b=u*c-p*d,A=(c*Y-d*W)/(2*b)-a,R=(d*k-c*m)/b,w=(u*W-p*Y)/(2*b)-r,T=(p*m-u*k)/b,H=R*R+T*T-1,E=2*(n+A*R+w*T),$=A*A+w*w-n*n,K=-(Math.abs(H)>1e-6?(E+Math.sqrt(E*E-4*H*$))/(2*H):$/E);return{x:a+A+R*K,y:r+w+T*K,radius:K}}function ne(i,e,t){const a=i.x-e.x;let r,n;const l=i.y-e.y;let s,o;const h=a*a+l*l;h?(n=e.radius+t.radius,n*=n,o=i.radius+t.radius,o*=o,n>o?(r=(h+o-n)/(2*h),s=Math.sqrt(Math.max(0,o/h-r*r)),t.x=i.x-r*a-s*l,t.y=i.y-r*l+s*a):(r=(h+n-o)/(2*h),s=Math.sqrt(Math.max(0,n/h-r*r)),t.x=e.x+r*a-s*l,t.y=e.y+r*l+s*a)):(t.x=e.x+t.radius,t.y=e.y)}function se(i,e){const t=i.radius+e.radius-1e-6,a=e.x-i.x,r=e.y-i.y;return t>0&&t*t>a*a+r*r}function le(i){const e=i._,t=i.next._,a=e.radius+t.radius,r=(e.x*t.radius+t.x*e.radius)/a,n=(e.y*t.radius+t.y*e.radius)/a;return r*r+n*n}function L(i){return{_:i,next:null,prev:null}}function lt(i,e){const t=(i=j(i)).length;if(!t)return 0;let a=i[0];if(a.x=0,a.y=0,t===1)return a.radius;const r=i[1];if(a.x=-r.radius,r.x=a.radius,r.y=0,t===2)return a.radius+r.radius;let n=i[2];ne(r,a,n);let l,s,o,h,g,y,p,u=L(a),c=L(r),d=L(n);u.next=c,d.prev=c,c.next=d,u.prev=d,d.next=u,c.prev=u;for(let m=3;m<t;++m){p=!1,n=i[m],ne(u._,c._,n),d=L(n),l=c.next,s=u.prev,o=c._.radius,h=u._.radius;do if(o<=h){if(se(l._,d._)){c=l,u.next=c,c.prev=u,--m,p=!0;break}o+=l._.radius,l=l.next}else{if(se(s._,d._)){u=s,u.next=c,c.prev=u,--m,p=!0;break}h+=s._.radius,s=s.prev}while(l!==s.next);if(!p){for(d.prev=u,d.next=c,u.next=c.prev=c=d,g=le(u),d=d.next;d!==c;)y=le(d),y<g&&(u=d,g=y),d=d.next;c=u.next}}const k=[c._];for(d=c.next;d!==c;)k.push(d._),d=d.next;n=rt(k,e);for(let m=0;m<t;++m)a=i[m],a.x-=n.x,a.y-=n.y;return n.radius}function oe(i){return function(e){e.children||(e.radius=Math.max(0,+i(e)||0))}}function V(i,e,t){return function(a){const r=a==null?void 0:a.children;if(r){let n;const l=r.length,s=i(a)*e||0;if(s)for(n=0;n<l;++n)r[n].radius+=s;const o=lt(r,t);if(s)for(n=0;n<l;++n)r[n].radius-=s;a.radius=o+s}}}function ce(i,e){return function(t,a,r){t.radius*=i,t.maxDepth=e,r&&(t.x=r.x+i*t.x,t.y=r.y+i*t.y)}}class F{constructor(e){this.options=e;const t=e==null?void 0:e.nodeKey,a=J(t)?t:t?ke(t):null;this._getNodeKey=a,this._getPadding=De(e==null?void 0:e.padding)?r=>e.padding:q(e==null?void 0:e.padding)?r=>{var n;return(n=e.padding[r.depth+1])!==null&&n!==void 0?n:0}:()=>0,this._maxDepth=-1}layout(e,t){var a;const r="width"in t?{x0:0,x1:t.width,y0:0,y1:t.height,width:t.width,height:t.height}:{x0:Math.min(t.x0,t.x1),x1:Math.max(t.x0,t.x1),y0:Math.min(t.y0,t.y1),y1:Math.max(t.y0,t.y1),width:Math.abs(t.x1-t.x0),height:Math.abs(t.y1-t.y0)};if(!e||!e.length)return[];const n=[],l=ye(e,n,0,-1,null,this._getNodeKey);this._maxDepth=l.maxDepth;const s=it(),o={flattenIndex:-1,maxDepth:-1,key:"root",depth:-1,index:-1,value:l.sum,datum:null,children:n,x:r.x0+r.width/2,y:r.y0+r.height/2},{nodeSort:h,setRadius:g,padding:y,includeRoot:p}=(a=this.options)!==null&&a!==void 0?a:{};if(h!==!1){const u=J(h)?this.options.nodeKey:F.defaultOpionts.nodeSort;f([o],c=>{c.children&&c.children.length&&c.children.sort(u)})}if(g)f([o],oe(g)),O([o],V(this._getPadding,.5,s)),f([o],ce(1,this._maxDepth));else{const u=Math.min(r.width,r.height);f([o],oe(F.defaultOpionts.setRadius)),O([o],V(Me,1,s)),y&&O([o],V(this._getPadding,o.radius/u,s)),f([o],ce(u/(2*o.radius),this._maxDepth))}return p?[o]:n}}F.defaultOpionts={setRadius:i=>Math.sqrt(i.value),padding:0,nodeSort:(i,e)=>e.value-i.value};const ot=(i,e={})=>{if(!i)return[];const t=[];return ge(i,t,e),t};var x;(function(i){i.DrillDown="drillDown",i.DrillUp="drillUp"})(x||(x={}));const ct=(i,e)=>{const t=e.info(),a=e.keyField(),r=t==null?void 0:t.key;if(_(r))return i;if(t.type===x.DrillDown){const n=Pe(i,r,a,"children");return j(n)}if(t.type===x.DrillUp){const n=Ce(i,r,a,"children");if(n)return j(n)}return i};class dt{_getDrillTriggerEvent(e){var t;const{mode:a}=this._drillParams;return(t=Fe(a))===null||t===void 0?void 0:t[e]}_hideTooltip(){const e=this.getChart().getComponentsByType(Se.tooltip)[0];e&&e.hideTooltip()}initDrillable(e){this._drillParams=e}initDrillableData(e){const{getRawData:t}=this._drillParams;N(e,"drillFilter",ct),t().transform({type:"drillFilter",options:{info:()=>this._drillInfo,keyField:()=>this._drillParams.drillField()}})}bindDrillEvent(){const{event:e,getRawData:t,drillField:a}=this._drillParams,r=a();this._getDrillTriggerEvent("start")&&e.on(this._getDrillTriggerEvent("start"),n=>{var l,s,o;if(_(n.datum)||_((l=n.datum)===null||l===void 0?void 0:l[r]))return void this.drillUp();this._hideTooltip();const h=n.datum[r],g=(o=(s=this._drillInfo)===null||s===void 0?void 0:s.path)!==null&&o!==void 0?o:[],y=be(t().rawData,h,r,"children");g[g.length-1]===y[y.length-1]?this.drillUp():this.drillDown(y)})}drillDown(e=[]){const{getRawData:t,event:a}=this._drillParams;if(!q(e)||Q(e))return e;const r=e[e.length-1];return this._drillInfo={key:r,path:e,type:x.DrillDown},t().reRunAllTransform(),a.emit(X.drill,{value:{path:e,type:x.DrillDown},model:this}),e}drillUp(){var e,t;const{getRawData:a,event:r}=this._drillParams,n=(t=(e=this._drillInfo)===null||e===void 0?void 0:e.path)!==null&&t!==void 0?t:[];if(!q(n)||Q(n))return n;const l=n.pop();return this._drillInfo={key:l,path:n,type:x.DrillUp},a().reRunAllTransform(),r.emit(X.drill,{value:{path:n,type:x.DrillUp},model:this}),n}}const ut=(i,e)=>{if(!i)return i;const t=e(),{width:a,height:r}=t;return a===0||r===0?i:new F(t).layout(i,{width:a,height:r})};class ht extends Ae{constructor(){super(...arguments),this.markTooltipKeyCallback=e=>e==null?void 0:e[this.series.getDimensionField()[0]]}}const gt=i=>i==="fadeIn"?{type:"fadeIn"}:{type:"growRadiusIn"},yt=()=>{C.registerAnimation("circlePacking",(i,e)=>({appear:gt(e),enter:{type:"growRadiusIn"},exit:{type:"growRadiusOut"},disappear:{type:"growRadiusOut"}}))},pt=Object.assign(Object.assign({},Re),{circlePacking:{name:"circlePacking",type:"arc"}});class v extends Le{constructor(){super(...arguments),this.type=S.circlePacking}setCategoryField(e){return this._categoryField=e,this._categoryField}getCategoryField(){return this._categoryField}setValueField(e){return this._valueField=e,this._valueField}getValueField(){return this._valueField}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}setAttrFromSpec(){var e;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField((e=this._spec.seriesField)!==null&&e!==void 0?e:Z),this._spec.drill&&this.initDrillable({event:this.event,mode:this._option.mode,drillField:()=>{var t;return(t=this._spec.drillField)!==null&&t!==void 0?t:Ne},getRawData:()=>this.getRawData()}),this._circlePacking=this._spec.circlePacking,this._label=this._spec.label,this._layoutPadding=this._spec.layoutPadding}initData(){super.initData();const e=this.getRawData();_(e)||(this._spec.drill&&this.initDrillableData(this._dataSet),N(this._dataSet,"circlePackingLayout",ut),N(this._dataSet,"flatten",ot),e.transform({type:"circlePackingLayout",options:()=>({nodeKey:this._categoryField,padding:this._layoutPadding,includeRoot:!1,width:this.getLayoutRect().width||1,height:this.getLayoutRect().height||1})}),e.transform({type:"flatten",options:{callback:t=>{if(t.datum){const a=t.datum[t.depth];return Object.assign(Object.assign({},t),a)}return t}}}))}_addDataIndexAndKey(){const e=this.getRawData();_(e==null?void 0:e.dataSet)||(N(e.dataSet,"addVChartProperty",Oe),e.transform({type:"addVChartProperty",options:{beforeCall:He.bind(this),call:Ke}}))}initMark(){this._initCirclePackingMark(),this._initLabelMark()}initMarkStyle(){this._initCirclePackingMarkStyle(),this._initLabelMarkStyle()}_initCirclePackingMark(){var e,t;if(((e=this._circlePacking)===null||e===void 0?void 0:e.visible)===!1)return;const a=this._createMark(v.mark.circlePacking,{isSeriesMark:!0,customShape:(t=this._spec.circlePacking)===null||t===void 0?void 0:t.customShape});this._circlePackingMark=a}_initCirclePackingMarkStyle(){_(this._circlePackingMark)||this.setMarkStyle(this._circlePackingMark,{x:e=>e.x,y:e=>e.y,outerRadius:e=>e.radius,innerRadius:0,startAngle:0,endAngle:2*Math.PI,fill:this.getColorAttribute(),zIndex:e=>e.depth},B.STATE_NORMAL,ee.Series)}_initLabelMark(){var e;if(((e=this._label)===null||e===void 0?void 0:e.visible)===!1)return;const t=this._createMark(v.mark.label,{isSeriesMark:!1});this._labelMark=t}_initLabelMarkStyle(){_(this._labelMark)||this.setMarkStyle(this._labelMark,{x:e=>e.x,y:e=>e.y,text:e=>e.key,cursor:"pointer"},B.STATE_NORMAL,ee.Series)}getStatisticFields(){return super.getStatisticFields().concat([{key:this._categoryField,operations:["values"]},{key:this._valueField,operations:["max","min"]},{key:Ue,operations:["max","min","values"]},{key:Z,operations:["values"]}])}initTooltip(){this._tooltipHelper=new ht(this),this._tooltipHelper.updateTooltipSpec(),this._circlePackingMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._circlePackingMark),this._labelMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._labelMark)}initAnimation(){var e;const t=(e=this._spec.animationAppear)===null||e===void 0?void 0:e.preset;this.getMarksInType("arc").forEach(a=>{var r;a.setAnimationConfig(te((r=C.getAnimationInKey("circlePacking"))===null||r===void 0?void 0:r(void 0,t),ie(a.name,this._spec,this._markAttributeContext)))}),this.getMarksInType("text").forEach(a=>{var r;a.setAnimationConfig(te((r=C.getAnimationInKey("scaleInOut"))===null||r===void 0?void 0:r(),ie(a.name,this._spec,this._markAttributeContext)))})}initEvent(){super.initEvent(),this._spec.drill&&this.bindDrillEvent()}onLayoutEnd(e){super.onLayoutEnd(e),this._rawData.reRunAllTransform()}_noAnimationDataKey(e,t){}getActiveMarks(){return[this._circlePackingMark]}getMarkData(e){return e!=null&&e.datum?e.datum[e.datum.length-1]:e}}v.type=S.circlePacking,v.mark=pt,we(v,dt);const mt=()=>{C.registerSeries(v.type,v),Te(),Ee(),Ie(),yt()};class _e extends Ve{_getDefaultSeriesSpec(e){const t=Object.assign(Object.assign({},super._getDefaultSeriesSpec(e)),{categoryField:e.categoryField,valueField:e.valueField,seriesField:e.seriesField,layoutPadding:e.layoutPadding,label:e.label,circlePacking:e.circlePacking,drill:e.drill,drillField:e.drillField}),a=S.circlePacking;return t.type=a,t[a]=e[a],t}transformSpec(e){super.transformSpec(e),this.transformSeriesSpec(e)}}let P=class extends je{constructor(){super(...arguments),this.transformerConstructor=_e,this.type="circlePacking",this.seriesType=S.circlePacking}};P.type="circlePacking",P.seriesType=S.circlePacking,P.transformerConstructor=_e;const _t=()=>{mt(),C.registerChart(P.type,P)},xt=[qe,ze,We,Ye,$e,Ge,Je,Qe,Xe],vt=Ze("CirclePackingChart",{type:"circlePacking",vchartConstrouctor:Be},[_t,...xt]),Ft={title:"VChart/CirclePacking"};function M(){const i={data:{values:[{name:"上海",value:4},{name:"深圳",value:6},{name:"北京",value:10}]},categoryField:"name",valueField:"value"};return xe.createElement(vt,{...i})}M.__docgenInfo={description:"",methods:[],displayName:"Basic"};var de,ue,he;M.parameters={...M.parameters,docs:{...(de=M.parameters)==null?void 0:de.docs,source:{originalSource:`function Basic() {
  const config: CirclePackingProps = {
    data: {
      values: [{
        name: '上海',
        value: 4
      }, {
        name: '深圳',
        value: 6
      }, {
        name: '北京',
        value: 10
      }]
    },
    categoryField: 'name',
    valueField: 'value'
  };
  return <CirclePacking {...config} />;
}`,...(he=(ue=M.parameters)==null?void 0:ue.docs)==null?void 0:he.source}}};const St=["Basic"];export{M as Basic,St as __namedExportsOrder,Ft as default};
