import{R as ln}from"./index-RYns6xqu.js";import{Z as wr,_ as hs,$ as zr,a0 as ge,a1 as Qt,a2 as Ee,a3 as ds,a4 as M,a5 as cs,a6 as Ri,a7 as Fr,a8 as Is,i as O,a9 as ws,aa as U,e as $,l as N,b as L,ab as ae,ac as Be,ad as Et,ae as gi,af as w,c as R,ag as Hr,ah as Re,ai as Pe,aj as _i,ak as W,al as j,am as Vr,an as jr,ao as Xr,a as C,ap as ne,aq as ei,ar as zs,as as Yr,at as Gr,au as Ur,av as jt,aw as S,ax as Zr,ay as hn,o as At,az as Nr,aA as Wr,aB as Ie,aC as $r,aD as Kr,aE as qr,aF as Qr,aG as Jr,aH as Fs,aI as Hs,aJ as us,aK as to,aL as eo,aM as io,aN as so,aO as ao,aP as Vs,aQ as K,aR as It,aS as Bt,aT as no,aU as Ne,aV as ro,aW as oo,aX as dn,aY as lo,aZ as ye,a_ as Le,a$ as cn,b0 as gs,b1 as Ii,b2 as ho,b3 as pi,b4 as Mt,b5 as un,b6 as co,b7 as uo,b8 as q,b9 as $t,ba as Kt,bb as re,bc as gn,bd as Ce,be as dt,bf as We,E as I,m as V,bg as wi,bh as bt,bi as $e,bj as js,A as ie,bk as J,n as _e,bl as zi,bm as go,r as at,bn as _n,F as X,bo as ii,bp as St,H as Ct,bq as Ke,br as vt,C as F,bs as _o,bt as po,bu as mo,bv as z,bw as vo,bx as be,by as yo,bz as pn,bA as mn,bB as _s,bC as et,bD as Vt,bE as Se,bF as Dt,bG as hi,bH as vn,bI as Xs,bJ as Ys,bK as Gs,bL as bo,bM as De,bN as xo,bO as Us,bP as qe,bQ as fo,bR as Zs,bS as yn,bT as qt,bU as bn,bV as Ns,bW as So,S as xt,bX as xn,bY as ps,bZ as fn,t as Sn,u as Fi,I as Zt,b_ as Hi,J as An,b$ as kn,c0 as Ao,c1 as Mn,c2 as ko,c3 as Mo,c4 as To,K as Tn,B as Co,c5 as Bo,c6 as Po,c7 as ct,c8 as Lo,c9 as Ws,ca as $s,cb as Ks,cc as qs,w as Do,cd as Qs,ce as Js,cf as Cn,cg as ta,ch as ea,ci as ia,cj as sa,ck as Oo,cl as di,v as Bn,cm as Eo,d as yt,cn as Pn,co as Ln,j as Ft,cp as mi,cq as $i,cr as mt,cs as Xt,ct as Ro,cu as Io,cv as wo,cw as Ki,cx as zo,cy as Fo,cz as Ho,cA as Yt,cB as oe,cC as Vo,p as jo,cD as Xo,cE as Yo,cF as Go,cG as aa,cH as na,cI as Uo,cJ as Zo,cK as No,cL as Wo,cM as ra,cN as ci,cO as ms,cP as $o,cQ as vs,cR as vi,cS as Dn,cT as Ko,cU as qo,cV as Qo,cW as Jo,cX as tl,cY as el,cZ as il,c_ as sl,c$ as al,d0 as nl,d1 as oa,d2 as rl,d3 as ol,d4 as ll,d5 as hl,d6 as dl,d7 as cl,d8 as ul,d9 as gl,da as _l,db as pl,dc as ml,dd as vl,de as yl,df as bl,dg as xl,dh as fl,di as Sl,M as Al,N as kl,O as Ml,P as Tl,R as Cl,Q as Bl,T as Pl,U as Ll,V as Dl,W as On,X as En,Y as Rn}from"./index-CBbQ1MSY.js";import"./index-BX6J8nRb.js";import"./index-DcfIKM1A.js";import"./index-CpOIycTO.js";const Ol=o=>typeof o=="string"&&!isNaN(Number(o))&&!isNaN(parseFloat(o)),El=1e-8;function Rl(o,t,e,i,s){for(let a=0,n=s[s.length-1];a<s.length;a++){const r=s[a];if(wr([o,t],[e,i],[r.x,r.y],[n.x,n.y]))return!0;n=r}return!1}function In(o,t,e){let i=0,s=o[0];if(!s)return!1;for(let n=1;n<o.length;n++){const r=o[n];i+=la(s.x,s.y,r.x,r.y,t,e),s=r}const a=o[0];return ha(s.x,a.x)&&ha(s.y,a.y)||(i+=la(s.x,s.y,a.x,a.y,t,e)),i!==0}function la(o,t,e,i,s,a){if(a>t&&a>i||a<t&&a<i||i===t)return 0;const n=(a-t)/(i-t);let r=i<t?1:-1;n!==1&&n!==0||(r=i<t?.5:-.5);const l=n*(e-o)+o;return l===s?1/0:l>s?r:0}function ha(o,t){return Math.abs(o-t)<El}function da(o,t){for(let e=0;e<t.length;e++)if(In(o,t[e].x,t[e].y)||e>0&&Rl(t[e-1].x,t[e-1].y,t[e].x,t[e].y,o))return!0;return!1}class Il extends hs{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:0}})}onEnd(){this.target.setTheme({common:{opacity:1}})}onUpdate(t,e,i){this.target.setTheme({common:{opacity:e}})}}class wl extends hs{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:1}})}onEnd(){this.target.setTheme({common:{opacity:0}})}onUpdate(t,e,i){this.target.setTheme({common:{opacity:1-e}})}}function zl(o,t){let e,i,s=o[0].x,a=o[0].y;const n=[o[0]];for(let r=1,l=o.length;r<l;r++)e=o[r].x-s,i=o[r].y-a,e*e+i*i>t&&(s=o[r].x,a=o[r].y,n.push(o[r]));return o[o.length-1].x===s&&o[o.length-1].y===a||n.push(o[o.length-1]),n}function Fl(o,t,e){return o.length<=10?o:o=zl(o,t!==void 0?t*t:1)}function ts(o){const t=[];for(let e=0;e<o.length;e++){const i=o[e];e===0&&t.push(i[0]),t.push(i[1])}return t}function Hl(o,t){return[o[0]*t,o[1]*t]}function Vl(o){const[t,e]=o;return Math.sqrt(t*t+e*e)}function jl(o){let t=Vl(o);return t>0&&(t=1/t),[o[0]*t,o[1]*t]}function Xl(o,t){const[e,i]=o,[s,a]=t,n=Math.sqrt((e*e+i*i)*(s*s+a*a)),r=n&&(e*s+i*a)/n;return Math.acos(Math.min(Math.max(r,-1),1))}function Yl(o,t,e){const i=Xl(o,t),s=zr(o,t)>=0;return e?s?2*Math.PI-i:i:s?i:2*Math.PI-i}const qi=(o,t)=>{const e=Math.atan2(o,t);return e<0?e+2*Math.PI:e};function wn(o,t){const{x1:e,y1:i,x2:s,y2:a}=t,{x1:n,y1:r,x2:l,y2:h}=o.AABBBounds;let d=0,c=0;return n<e&&(d=e-n),r<i&&(c=i-r),l>s&&(d=s-l),h>a&&(c=a-h),{dx:d,dy:c}}function zn(o,t){const{dx:e,dy:i}=wn(o,t),{dx:s=0,dy:a=0}=o.attribute;e&&o.setAttribute("dx",e+s),i&&o.setAttribute("dy",i+a)}class Fn extends ge{constructor(){super(...arguments),this.name="crosshair"}render(){this.renderCrosshair(this)}}function Gl(){Qt(),Ee()}function Ul(){Qt(),ds()}Gl();class Vi extends Fn{constructor(t,e){super(e!=null&&e.skipDefault?t:M({},Vi.defaultAttributes,t))}renderCrosshair(t){const{start:e,end:i,lineStyle:s}=this.attribute;return t.createOrUpdateChild("crosshair-line",Object.assign({points:[e,i]},s),"line")}setLocation(t){const{start:e,end:i}=t;this.setAttributes({start:e,end:i})}}Vi.defaultAttributes={lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}};Ul();class ji extends Fn{constructor(t,e){super(e!=null&&e.skipDefault?t:M({},ji.defaultAttributes,t))}renderCrosshair(t){const{start:e,end:i,rectStyle:s}=this.attribute;return t.createOrUpdateChild("crosshair-rect",Object.assign({x:e.x,y:e.y,width:i.x-e.x,height:i.y-e.y},s),"rect")}setLocation(t){const{start:e,end:i}=t;this.setAttributes({start:e,end:i})}}ji.defaultAttributes={rectStyle:{fill:"#b2bacf",opacity:.2}};function ys(){Qt(),Ee(),cs(),Ri()}function Hn(){Qt(),Ee(),Fr(),Ri()}ys();class wt extends ge{getStartAngle(){return Is(this._startAngle)}getEndAngle(){return Is(this._endAngle)}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(t,e){super(e!=null&&e.skipDefault?t:M({},wt.defaultAttributes,t)),this.name="segment",this.key="segment",this.lines=[]}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:s,visible:a=!0,multiSegment:n,mainSegmentIndex:r}=this.attribute;if(!a)return;this._computeLineAngle();const l=this._getMainSegmentPoints(),h=this._renderSymbol(t,l,"start"),d=this._renderSymbol(e,l,"end");if(this.startSymbol=h,this.endSymbol=d,n){const c=[...this.attribute.points];if(O(r))c[r]=this._clipPoints(c[r]);else{const u=this._clipPoints(ws(c));c[0][0]=u[0],c[c.length-1][c[c.length-1].length-1]=u[u.length-1]}c.forEach((u,g)=>{var _,p;const m=U.line(Object.assign(Object.assign({points:u},$(i)?(_=i[g])!==null&&_!==void 0?_:i[i.length-1]:i),{fill:!1}));m.name=`${this.name}-line`,m.id=this._getNodeId("line"+g),N(s==null?void 0:s.line)||(m.states=$(s.line)?(p=s.line[g])!==null&&p!==void 0?p:s.line[s.line.length-1]:s.line),this.add(m),this.lines.push(m)})}else{let c=U.line;L(i)[0].cornerRadius&&(c=U.polygon);const u=c(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},L(i)[0]),{fill:!1,closePath:!1}));u.name=`${this.name}-line`,u.id=this._getNodeId("line"),N(s==null?void 0:s.line)||(u.states=[].concat(s.line)[0]),this.add(u),this.lines.push(u)}}_computeStartRotate(t){return t+Math.PI/2}_computeEndRotate(t){return t+Math.PI/2}_renderSymbol(t,e,i){if(!e.length)return;const{autoRotate:s=!0}=t;let a;if(t&&t.visible){const n=this.getStartAngle(),r=this.getEndAngle(),{state:l}=this.attribute,h=e[0],d=e[e.length-1],{refX:c=0,refY:u=0,refAngle:g=0,style:_,symbolType:p,size:m=12}=t;let b,x;i==="start"?(b={x:h.x+(O(n)?c*Math.cos(n)+u*Math.cos(n-Math.PI/2):0),y:h.y+(O(n)?c*Math.sin(n)+u*Math.sin(n-Math.PI/2):0)},x=this._computeStartRotate(this._startAngle)):(b={x:d.x+(O(r)?c*Math.cos(r)+u*Math.cos(r-Math.PI/2):0),y:d.y+(O(r)?c*Math.sin(r)+u*Math.sin(r-Math.PI/2):0)},x=this._computeEndRotate(this._endAngle)),a=U.symbol(Object.assign(Object.assign(Object.assign({},b),{symbolType:p,size:m,angle:s?x+g:0,strokeBoundsBuffer:0}),_)),a.name=`${this.name}-${i}-symbol`,a.id=this._getNodeId(`${i}-symbol`),N(l==null?void 0:l.symbol)||(a.states=l.symbol),i==="start"?N(l==null?void 0:l.startSymbol)||(a.states=l.startSymbol):N(l==null?void 0:l.endSymbol)||(a.states=l.endSymbol),this.add(a)}return a}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;const{points:t,multiSegment:e,mainSegmentIndex:i}=this.attribute;let s;return s=e?O(i)?t[i]:ws(t):t,this._mainSegmentPoints=s,s}_clipPoints(t){const{startSymbol:e={},endSymbol:i={}}=this.attribute;let s=t;if(e.visible){const a=e.clip?e.size||10:0;s=[{x:t[0].x-a/2*(Math.cos(this._startAngle)||0),y:t[0].y-a/2*(Math.sin(this._startAngle)||0)},...s.slice(1)]}if(i.visible){const a=i.clip?i.size||10:0,n={x:t[t.length-1].x-a/2*(Math.cos(this._endAngle)||0),y:t[t.length-1].y-a/2*(Math.sin(this._endAngle)||0)};s=[...s.slice(0,s.length-1),n]}return s}_computeLineAngle(){const t=this._getMainSegmentPoints();if(t.length<=1)return;const e=t[0],i=t[1],s=t[t.length-2],a=t[t.length-1],n=[e.x-i.x,e.y-i.y],r=Math.atan2(n[1],n[0]),l=[a.x-s.x,a.y-s.y],h=Math.atan2(l[1],l[0]);this._startAngle=r,this._endAngle=h}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}}wt.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}};Hn();class ca extends wt{constructor(t,e){super(e!=null&&e.skipDefault?t:M({},wt.defaultAttributes,t)),this.name="arc-segment",this.key="arc-segment",this.isReverseArc=!1}getStartAngle(){const t=this.isReverseArc?this._startAngle+Math.PI/2:this._startAngle-Math.PI/2;return t<0?t+2*Math.PI:t>2*Math.PI?t-2*Math.PI:t}getEndAngle(){const t=this.isReverseArc?this._endAngle-Math.PI/2:this._endAngle+Math.PI/2;return t<0?t+2*Math.PI:t>2*Math.PI?t-2*Math.PI:t}getMainSegmentPoints(){return this._mainSegmentPoints}_computeStartRotate(t){return this.isReverseArc?t+Math.PI:t}_computeEndRotate(t){return this.isReverseArc?t:t+Math.PI}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:s,visible:a=!0,radius:n,startAngle:r,endAngle:l,center:h}=this.attribute;if(!a)return;this._startAngle=r,this._endAngle=l,this.isReverseArc=r>l;const d={x:h.x+n*Math.cos(this._startAngle),y:h.y+n*Math.sin(this._startAngle)},c={x:h.x+n*Math.cos(this._endAngle),y:h.y+n*Math.sin(this._endAngle)};this._mainSegmentPoints=[d,c];const u=this._renderSymbol(t,this._mainSegmentPoints,"start"),g=this._renderSymbol(e,this._mainSegmentPoints,"end");this.startSymbol=u,this.endSymbol=g;const _=U.arc(Object.assign({x:h.x,y:h.y,startAngle:r,endAngle:l,innerRadius:n,outerRadius:n},i));_.name=`${this.name}-line`,_.id=this._getNodeId("arc"),N(s==null?void 0:s.line)||(_.states=[].concat(s.line)[0]),this.add(_),this.line=_}}var it;(function(o){o.innerView="inner-view",o.axisContainer="axis-container",o.labelContainer="axis-label-container",o.tickContainer="axis-tick-container",o.tick="axis-tick",o.subTick="axis-sub-tick",o.label="axis-label",o.title="axis-title",o.gridContainer="axis-grid-container",o.grid="axis-grid",o.gridRegion="axis-grid-region",o.line="axis-line",o.background="axis-background",o.axisLabelBackground="axis-label-background",o.axisBreak="axis-break",o.axisBreakSymbol="axis-break-symbol"})(it||(it={}));var Ae;(function(o){o.selected="selected",o.selectedReverse="selected_reverse",o.hover="hover",o.hoverReverse="hover_reverse"})(Ae||(Ae={}));const xe={[Ae.selectedReverse]:{},[Ae.selected]:{},[Ae.hover]:{},[Ae.hoverReverse]:{}},Zl=999,es={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}},ua={size:8,stroke:"#000",lineWidth:1,zIndex:1};function Nl(o={}){var t,e;const{style:i={},angle:s=.5*Math.PI}=o,a=M({},ua,i),n=(t=a.size)!==null&&t!==void 0?t:ua.size;return Object.assign(Object.assign({},a),{symbolType:(e=a.symbolType)!==null&&e!==void 0?e:`M ${-n/2} ${n*Math.sin(s)} L ${n/2} ${-n*Math.sin(s)}`,symbolSize:n})}function Vn(o){const t={};return Be(o,e=>{e.type!=="group"&&e.id&&(t[e.id]=e)}),t}function jn(o,t){return{x:o.x+t[0],y:o.y+t[1]}}function Wl(o,t,e,i,s){const a=[],n=s-i;for(let r=0;r<t;r++){const l=i+r*n/t;a.push(ae(o,e,l))}return a}function ke(o,t){let e="";return o.length===0||(o.forEach((i,s)=>{s===0?e=`M${i.x},${i.y}`:e+=`L${i.x},${i.y}`}),t&&(e+="Z")),e}function ft(o,t,e){let i=o.OBBBounds,s=t.OBBBounds;return i&&s&&!i.empty()&&!s.empty()?i.intersects(s):(i=o.AABBBounds,s=t.AABBBounds,e>Math.max(s.x1-i.x2,i.x1-s.x2,s.y1-i.y2,i.y1-s.y2))}function is(o,t){for(let e,i=1,s=o.length,a=o[0];i<s;a=e,++i)if(e=o[i],ft(a,e,t))return!0;return!1}const Xn=(o,t,e)=>{const i=o.target;return i!==e&&i.name&&!N(i.states)?(i.addState(Et.hover,!0),Be(t,s=>{s!==i&&s.name&&!N(s.states)&&s.addState(Et.hoverReverse,!0)}),i):e},Yn=(o,t,e)=>e&&(Be(t,i=>{i.name&&!N(i.states)&&(i.removeState(Et.hoverReverse),i.removeState(Et.hover))}),null),Gn=(o,t,e)=>{const i=o.target;return e===i&&i.hasState(Et.selected)?(Be(t,s=>{s.name&&!N(s.states)&&(s.removeState(Et.selectedReverse),s.removeState(Et.selected))}),null):i.name&&!N(i.states)?(i.addState(Et.selected,!0),Be(t,s=>{s!==i&&s.name&&!N(s.states)&&s.addState(Et.selectedReverse,!0)}),i):e};class $l extends ge{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=t=>{this._lastHover=Xn(t,this.axisContainer,this._lastHover)},this._onUnHover=t=>{this._lastHover=Yn(t,this.axisContainer,this._lastHover)},this._onClick=t=>{this._lastSelect=Gn(t,this.axisContainer,this._lastSelect)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(t){const e=gi(this.attribute);M(this.attribute,t);const i=U.group({x:this.attribute.x,y:this.attribute.y});return this.add(i),this._renderInner(i),this.removeChild(i),this.attribute=e,i.AABBBounds}render(){this._prevInnerView=this._innerView&&Vn(this._innerView),this.removeAllChild(!0),this._innerView=U.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent()}_bindEvent(){if(this.attribute.disableTriggerEvent)return;const{hover:t,select:e}=this.attribute;t&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),e&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(t){const{title:e,label:i,tick:s,line:a,items:n}=this.attribute,r=U.group({x:0,y:0,zIndex:1,pickable:!1});if(r.name=it.axisContainer,r.id=this._getNodeId("container"),r.setMode(this.mode),this.axisContainer=r,t.add(r),a&&a.visible&&this.renderLine(r),n&&n.length&&(this.data=this._transformItems(n[0]),s&&s.visible&&this.renderTicks(r),i&&i.visible)){const l=U.group({x:0,y:0,pickable:!1});l.name=it.labelContainer,l.id=this._getNodeId("label-container"),this.axisLabelsContainer=l,r.add(l),n.forEach((h,d)=>{const c=this.renderLabels(l,h,d),u=c.getChildren();this.beforeLabelsOverlap(u,h,c,d,n.length),this.handleLabelsOverlap(u,h,c,d,n.length),this.afterLabelsOverlap(u,h,c,d,n.length);let g=0,_=0,p="center",m="middle",b=0;u.forEach((x,v)=>{var y;const f=x.attribute,A=(y=f.angle)!==null&&y!==void 0?y:0,k=x.AABBBounds;let T=k.width(),P=k.height();A&&(T=Math.abs(T*Math.cos(A)),P=Math.abs(P*Math.sin(A))),g=Math.max(g,T),_=Math.max(_,P),p=f.textAlign,m=f.textBaseline,v===0&&(b=f.x)}),this.axisLabelLayerSize[d]={width:g,height:_,labelPos:b,textAlign:p,textBaseline:m}})}e&&e.visible&&this.renderTitle(r)}renderTicks(t){const e=this.getTickLineItems(),i=U.group({x:0,y:0,pickable:!1});i.name=it.tickContainer,i.id=this._getNodeId("tick-container"),t.add(i),e.forEach((a,n)=>{var r;const l=U.line(Object.assign({},this._getTickLineAttribute("tick",a,n,e)));if(l.name=it.tick,l.id=this._getNodeId(a.id),N((r=this.attribute.tick)===null||r===void 0?void 0:r.state))l.states=w;else{const h=this.data[n],d=M({},w,this.attribute.tick.state);Object.keys(d).forEach(c=>{R(d[c])&&(d[c]=d[c](h.rawValue,n,h,this.data))}),l.states=d}i.add(l)}),this.tickLineItems=e;const{subTick:s}=this.attribute;if(s&&s.visible){const a=this.getSubTickLineItems();a.length&&a.forEach((n,r)=>{const l=U.line(Object.assign({},this._getTickLineAttribute("subTick",n,r,e)));if(l.name=it.subTick,l.id=this._getNodeId(`${r}`),N(s.state))l.states=w;else{const h=M({},w,s.state);Object.keys(h).forEach(d=>{R(h[d])&&(h[d]=h[d](n.value,r,n,e))}),l.states=h}i.add(l)}),this.subTickLineItems=a}}renderLabels(t,e,i){const{dataFilter:s}=this.attribute.label;s&&R(s)&&(e=s(e,i));const a=this._transformItems(e),n=U.group({x:0,y:0,pickable:!1});return n.name=`${it.labelContainer}-layer-${i}`,n.id=this._getNodeId(`label-container-layer-${i}`),t.add(n),a.forEach((r,l)=>{var h;const d=this._getLabelAttribute(r,l,a,i),c=Hr(d);if(c.name=it.label,c.id=this._getNodeId(`layer${i}-label-${r.id}`),N((h=this.attribute.label)===null||h===void 0?void 0:h.state))c.states=w;else{const u=M({},w,this.attribute.label.state);Object.keys(u).forEach(g=>{R(u[g])&&(u[g]=u[g](r,l,a,i))}),c.states=u}n.add(c)}),n}renderTitle(t){const e=this.getTitleAttribute(),i=new Re(Object.assign({},e));i.name=it.title,i.id=this._getNodeId("title"),t.add(i)}getVerticalCoord(t,e,i){return jn(t,this.getVerticalVector(e,i,t))}getTickLineItems(){const{tick:t}=this.attribute,e=this.data,i=[],{alignWithLabel:s,inside:a=!1,length:n,dataFilter:r}=t;let l=1;return e.length>=2&&(l=e[1].value-e[0].value),(r&&R(r)?r(e):e).forEach(h=>{let d=h.point,c=h.value;if(!s){const g=h.value-l/2;if(this.isInValidValue(g))return;d=this.getTickCoord(g),c=g}const u=this.getVerticalCoord(d,n,a);if(this.mode==="3d"){const g=this.getVerticalVector(n,a,d);let _=0,p=0;Pe(g[0])>Pe(g[1])?_=_i/2*(u.x>d.x?1:-1):p=_i/2*(u.y>d.y?-1:1),i.push({start:d,end:u,value:c,id:`tick-${h.id}`,anchor:[d.x,d.y],alpha:_,beta:p})}else i.push({start:d,end:u,value:c,id:`tick-${h.id}`})}),i}getSubTickLineItems(){const{subTick:t}=this.attribute,e=[],{count:i=4,inside:s=!1,length:a=2}=t,n=this.tickLineItems,r=n.length;if(r>=2)for(let l=0;l<r-1;l++){const h=n[l],d=n[l+1];for(let c=0;c<i;c++){const u=(c+1)/(i+1),g=(1-u)*h.value+u*d.value,_=this.getTickCoord(g),p=this.getVerticalCoord(_,a,s);e.push({start:_,end:p,value:g,id:`sub-tick-${g}`})}}return e}_getTickLineAttribute(t,e,i,s){let a=W(this.attribute,`${t}.style`);const n=this.data[i];a=R(a)?M({},W(es,`${t}.style`),t==="tick"?a(n.rawValue,i,n,this.data):a(e.value,i,e,s)):a;const{start:r,end:l,anchor:h,alpha:d,beta:c}=e;return Object.assign({points:[r,l],anchor:h,alpha:d,beta:c},a)}_getLabelAttribute(t,e,i,s){var a,n;const{space:r=4,inside:l=!1,formatMethod:h,type:d="text",text:c}=this.attribute.label;let u=r,g=0;!((a=this.attribute.tick)===null||a===void 0)&&a.visible&&this.attribute.tick.inside===l&&(g=this.attribute.tick.length||4),!((n=this.attribute.subTick)===null||n===void 0)&&n.visible&&this.attribute.subTick.inside===l&&(g=Math.max(g,this.attribute.subTick.length||2)),u+=g;const _=this.getRelativeVector(t.point);s>0&&(_[1]===0?u+=(this.axisLabelLayerSize[s-1].height+W(this.attribute,"label.space",4))*s:u+=(this.axisLabelLayerSize[s-1].width+W(this.attribute,"label.space",4))*s);const p=this.getVerticalCoord(t.point,u,l),m=this.getVerticalVector(u||1,l,p),b=h?h(`${t.label}`,t,e,i,s):t.label;let{style:x}=this.attribute.label;x=R(x)?M({},es.label.style,x(t,e,i,s)):x;const v=this.getLabelAlign(m,l,x.angle);return x=M(v,x),R(x.text)&&(x.text=x.text({label:t.label,value:t.rawValue,index:t.index,layer:s})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(p,m,b,x)),{text:c??b,_originText:t.label,lineHeight:x==null?void 0:x.fontSize,type:d}),x)}getLabelPosition(t,e,i,s){return t}_transformItems(t){const e=[];return t.forEach(i=>{var s;e.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(s=i.id)!==null&&s!==void 0?s:i.label}))}),e}release(){super.release(),this._prevInnerView=null,this._innerView=null}}const ga={parity:function(o){return o.filter((t,e)=>e%2?t.setAttribute("opacity",0):1)},greedy:function(o,t){let e;return o.filter((i,s)=>s&&ft(e,i,t)?i.setAttribute("opacity",0):(e=i,1))}};function Kl(o){let t;return t=o.OBBBounds.empty()?o.AABBBounds:o.OBBBounds,t.width()>1&&t.height()>1}function ql(o){return o.forEach(t=>t.setAttribute("opacity",1)),o}function _a(o,t,e,i,s=!1){if(e&&!o.attribute.opacity){const a=t.length;if(a>1){o.setAttribute("opacity",1);for(let n=0;n<a;n++){const r=s?t[a-1-n]:t[n];if(!i(r))break;r.setAttribute("opacity",0)}}}}function Ql(o,t){if(N(o))return;const e=o.filter(Kl);if(N(e))return;let i;i=ql(e);const{method:s="parity",separation:a=0}=t,n=R(s)?s:ga[s]||ga.parity;if(i.length>=3&&is(i,a)){do i=n(i,a);while(i.length>=3&&is(i,a));const r=(u,g,_=!0)=>_&&u<3||g,l=r(i.length,t.firstVisible,!1);let h=r(i.length,t.lastVisible);const d=e[0],c=j(e);ft(d,c,a)&&l&&h&&(c.setAttribute("opacity",0),h=!1),_a(d,i,l,u=>ft(u,d,a)),_a(c,i,h,u=>ft(u,c,a)||!(!l||u===d)&&ft(u,d,a),!0)}e.forEach(r=>{r.setAttribute("visible",!!r.attribute.opacity)})}function Jl(o){const t=o.AABBBounds;return{x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,centerX:o.attribute.x,centerY:o.attribute.y,angle:o.attribute.angle}}function th(o){o.forEach(t=>{if(t.rotatedBounds||!t.attribute.angle)return;const e=Jl(t),i=Vr({x:t.attribute.x,y:t.attribute.y},e.angle,{x:e.centerX,y:e.centerY}),s=i.x-e.centerX,a=i.y-e.centerY;e.x1+=s,e.x2+=s,e.y1+=a,e.y2+=a,e.centerX+=s,e.centerY+=a,t.rotatedBounds=e})}function eh(o,t){var e,i;return!((e=o.OBBBounds)===null||e===void 0)&&e.empty()||!((i=t.OBBBounds)===null||i===void 0)&&i.empty()?jr(o.AABBBounds,t.AABBBounds,!1)&&(!o.rotatedBounds||!t.rotatedBounds||Xr(o.rotatedBounds,t.rotatedBounds,!0)):o.OBBBounds.intersects(t.OBBBounds)}const Un=Math.sin(Math.PI/10);function Zn(o){const t=!C(o)&&o!==0,e=t?Math.cos(o):1;return t&&Math.abs(e)<=Un}function Nn(o){const t=!C(o)&&o!==0,e=t?Math.sin(o):0;return!t||Math.abs(e)<=Un}function ih(o,t){if(N(o))return;const{orient:e,labelRotateAngle:i=[0,45,90]}=t;if(i.length===0||o.some(n=>!!n.attribute.angle))return;let s=0,a=0;for(i&&i.length>0&&(a=i.length);s<a;){const n=i[s++];if(o.forEach(r=>{r.attribute.angle=ne(n)}),ah(e,o),!sh(o))break}}function sh(o){for(let t=1;t<o.length;t++)if(eh(o[t-1],o[t]))return!0;return!1}function ah(o,t){o!=="bottom"&&o!=="top"||rh(o,t),o!=="left"&&o!=="right"||nh(o,t),th(t)}function Xi(o=0){if(o<0)for(;o<0;)o+=2*Math.PI;if(o>0)for(;o>=2*Math.PI;)o-=2*Math.PI;return o}function nh(o,t){t.forEach((e,i)=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},$n(o,e.attribute.angle)),{angle:Xi(e.attribute.angle)}))})}function rh(o,t){t.forEach(e=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},Wn(o,e.attribute.angle)),{angle:Xi(e.attribute.angle)}))})}function Wn(o,t=0){let e=["center","left","left","left","center","right","right","right","left"],i=["top","top","middle","bottom","bottom","bottom","middle","top","top"];o==="top"&&(e=["center","right","right","right","center","left","left","left","right"],i=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);const s=(t=Xi(t))/(.5*Math.PI);let a;return a=s===Math.floor(s)?2*Math.floor(s):2*Math.floor(s)+1,{textAlign:e[a],textBaseline:i[a]}}function $n(o,t=0){let e=["right","right","center","left","left","left","center","right","right"],i=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];o==="right"&&(e=["left","left","center","right","right","right","center","left","left"],i=["middle","middle","bottom","bottom","middle","middle","top","middle","middle"]);const s=(t=Xi(t))/(.5*Math.PI);let a;return a=s===Math.floor(s)?2*Math.floor(s):2*Math.floor(s)+1,{textAlign:e[a],textBaseline:i[a]}}function oh(o){return O(o)?{left:o,right:o}:ei(o)?{left:o.left||0,right:o.right||0}:{left:0,right:0}}function lh(o,t){const{limitLength:e,verticalLimitLength:i,ellipsis:s="...",orient:a,axisLength:n}=t;if(N(o)||!O(e))return;const r=oh(t.overflowLimitLength),l=o[0],h=l.attribute.angle,d=!C(h),c=d?Math.cos(h):1,u=d?Math.sin(h):0,g=Nn(h),_=Zn(h),p=a==="top"||a==="bottom",m=l.attribute.direction,b=!g&&!_&&p&&(o.length<2||o.some(x=>Math.abs(x.AABBBounds.width()-l.AABBBounds.width())>=2))&&l.AABBBounds.width()>Math.abs(e/u);o.forEach(x=>{var v;if(p&&(_&&Math.floor(x.AABBBounds.height())<=e||g&&Math.floor(x.AABBBounds.width())<=i)||!p&&(m==="vertical"&&Math.floor(x.AABBBounds.height())<=i||m!=="vertical"&&(g&&Math.floor(x.AABBBounds.width())<=e||_&&Math.floor(x.AABBBounds.height())<=i)))return;let y=null;if(g||_)y=p?g?i:e:m==="vertical"||_?i:e;else if(p){const{x1:f,x2:A}=x.AABBBounds,k=u/c,T=Math.abs(e/u);if(b&&k>0&&f<=n+r.right&&e/k+f>n+r.right){const P=(n-f+r.right)/Math.abs(c);y=Math.min(P,T)}else if(b&&k<0&&A>=-r.left&&e/k+A<-r.left){const P=(A+r.left)/Math.abs(c);y=Math.min(P,T)}else y=T}else y=Math.abs(e/c);O(x.attribute.maxLineWidth)&&(y=O(y)?Math.min(x.attribute.maxLineWidth,y):x.attribute.maxLineWidth),x.setAttributes({maxLineWidth:y,ellipsis:(v=x.attribute.ellipsis)!==null&&v!==void 0?v:s})})}function hh(o,t){const{limitLength:e,axisLength:i,ellipsis:s="...",orient:a}=t;if(N(o)||!O(e))return;const n=o[0].attribute.angle,r=Nn(n),l=Zn(n),h=a==="top"||a==="bottom";let d=i/o.length;o.forEach((c,u)=>{var g,_,p,m,b;if(h){if(l&&Math.floor(c.AABBBounds.height())<=e)return;if(r){const y=pa(c.attribute.x,(g=o[u+1])===null||g===void 0?void 0:g.attribute.x,(_=o[u-1])===null||_===void 0?void 0:_.attribute.x);O(y)&&(d=zs(d,y))}}else{if(l){const y=pa(c.attribute.y,(p=o[u+1])===null||p===void 0?void 0:p.attribute.y,(m=o[u-1])===null||m===void 0?void 0:m.attribute.y);O(y)&&(d=zs(d,y))}if(r&&Math.floor(c.AABBBounds.width())<=e)return}let x=null,v=null;h?l?(x=e,v=d):(x=d,v=e):l?(x=d,v=e):(x=e,v=d),c.setAttributes({maxLineWidth:x,ellipsis:(b=c.attribute.ellipsis)!==null&&b!==void 0?b:s,whiteSpace:"normal",heightLimit:v})})}function pa(o,t,e){let i;return O(t)&&(i=Math.abs(t-o)),O(e)&&(i=O(i)?Math.min(Math.abs(o-e),i):Math.abs(o-e)),i}function dh(o,t,e,i,s){i==="left"||i==="right"?s==="left"?o.forEach(a=>{var n;a.setAttributes({dx:((n=a.attribute.dx)!==null&&n!==void 0?n:0)+t-a.AABBBounds.x1})}):s==="right"?o.forEach(a=>{var n;a.setAttributes({dx:((n=a.attribute.dx)!==null&&n!==void 0?n:0)+t+e-a.AABBBounds.x2})}):s==="center"&&o.forEach(a=>{var n;a.setAttributes({dx:((n=a.attribute.dx)!==null&&n!==void 0?n:0)+t+e/2-(a.AABBBounds.x1+a.AABBBounds.x2)/2})}):i!=="bottom"&&i!=="top"||(s==="top"?o.forEach(a=>{var n;a.setAttributes({dy:((n=a.attribute.dy)!==null&&n!==void 0?n:0)+t-a.AABBBounds.y1})}):s==="bottom"?o.forEach(a=>{var n;a.setAttributes({dy:((n=a.attribute.dy)!==null&&n!==void 0?n:0)+t+e-a.AABBBounds.y2})}):s==="middle"&&o.forEach(a=>{var n;a.setAttributes({dy:((n=a.attribute.dy)!==null&&n!==void 0?n:0)+t+e/2-(a.AABBBounds.y1+a.AABBBounds.y2)/2})}))}class Kn{isInValidValue(t){return t<0||t>1}getTickCoord(t){const{start:e}=this.attribute,i=this.getRelativeVector();return{x:e.x+i[0]*t,y:e.y+i[1]*t}}getRelativeVector(t){const{start:e,end:i}=this.attribute;return[i.x-e.x,i.y-e.y]}getVerticalVector(t,e=!1,i){const{verticalFactor:s=1}=this.attribute,a=this.getRelativeVector(),n=jl(a),r=[n[1],-1*n[0]];return Hl(r,t*(e?1:-1)*s)}}function ch(){Qt(),Ee(),Gr(),Ur()}function uh(){ch(),ds()}function gh(){Qt(),Yr()}var ma=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};uh();class Qe extends $l{constructor(t,e){super(e!=null&&e.skipDefault?t:M({},Qe.defaultAttributes,t),e)}_renderInner(t){var e;if(this._breaks=null,this.attribute.breaks&&this.attribute.breaks.length){const s=[];for(let a=0;a<this.attribute.breaks.length;a++){const n=this.attribute.breaks[a],{range:r,breakSymbol:l,rawRange:h}=n;s.push({startPoint:this.getTickCoord(r[0]),endPoint:this.getTickCoord(r[1]),range:r,breakSymbol:l,rawRange:h})}this._breaks=s}super._renderInner(t),this._breaks&&this._breaks.length&&this._breaks.forEach((s,a)=>{const{startPoint:n,endPoint:r,breakSymbol:l,rawRange:h}=s;if((l==null?void 0:l.visible)!==!1){const d=U.group({zIndex:Zl});d.name=it.axisBreak,d.id=this._getNodeId(`${it.axisBreak}-${a}`),d.data=h;const c=Nl(l),u=U.symbol(Object.assign({x:n.x,y:n.y},c));u.name=it.axisBreakSymbol;const g=U.symbol(Object.assign({x:r.x,y:r.y},c));g.name=it.axisBreakSymbol,d.add(u),d.add(g),t.add(d)}});const{panel:i}=this.attribute;if(i&&i.visible){const s=this.axisContainer,a=s.AABBBounds,n=U.rect(Object.assign({x:a.x1,y:a.y1,width:a.width(),height:a.height()},i.style));n.name=it.background,n.id=this._getNodeId("background"),n.states=M({},xe,(e=i.state)!==null&&e!==void 0?e:{}),s.insertBefore(n,s.firstChild)}}renderLine(t){const{start:e,end:i,line:s}=this.attribute,a=s,{startSymbol:n,endSymbol:r,style:l,state:h}=a,d=ma(a,["startSymbol","endSymbol","style","state"]),c=Object.assign({startSymbol:n,endSymbol:r,lineStyle:l},d);if(this._breaks&&this._breaks.length){const g=[];let _=e;this._breaks.forEach(p=>{const{startPoint:m,endPoint:b}=p;g.push([_,m]),_=b}),g.push([_,i]),c.points=g,c.multiSegment=!0}else c.points=[e,i];N(h)||(c.state={line:M({},xe,h),symbol:M({},xe,h)});const u=new wt(c);u.name=it.line,u.id=this._getNodeId("line"),t.add(u)}getTextAlign(t){let e="center";return jt(t[0],0)?jt(t[1],0)?Object.is(t[1],-0)?e="start":Object.is(t[0],-0)&&(e="end"):e="center":t[0]>0?e="start":t[0]<0&&(e="end"),e}getTitleAttribute(){var t,e,i;const s=this.attribute.title,{position:a="middle",space:n=4,textStyle:r={},autoRotate:l=!0,shape:h,background:d,state:c={},maxWidth:u}=s,g=ma(s,["position","space","textStyle","autoRotate","shape","background","state","maxWidth"]);let _=.5;a==="start"?_=0:a==="end"&&(_=1);const{verticalFactor:p=1}=this.attribute,m=-1*p,b=this.getTickCoord(_),x=this.getRelativeVector();let v=0;if(!((t=this.attribute.label)===null||t===void 0)&&t.visible&&this.attribute.label.inside===!1){const H=+W(this.attribute,"label.space",4);v+=H;const nt=Object.keys(this.axisLabelLayerSize).length;if(x[1]===0){const Y=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(Y)?v+=Y+(nt-1)*H:v=0}else if(x[0]===0)if(this.axisLabelsContainer&&this.axisLabelsContainer.AABBBounds&&!this.axisLabelsContainer.AABBBounds.empty()){const Y=this.axisLabelLayerSize[0].labelPos,Z=this.axisLabelsContainer.AABBBounds;v+=(m===1?Z.x2>Y?Math.min(Z.x2-Y,Z.width()):0:Z.x1<Y?Math.min(Y-Z.x1,Z.width()):0)+(nt-1)*H}else v=0;else Object.keys(this.axisLabelLayerSize).forEach((Y,Z)=>{v+=this.axisLabelLayerSize[Y].width+(Z>0?H:0)})}let y=0;!((e=this.attribute.tick)===null||e===void 0)&&e.visible&&this.attribute.tick.inside===!1&&(y=this.attribute.tick.length||4),!((i=this.attribute.subTick)===null||i===void 0)&&i.visible&&this.attribute.subTick.inside===!1&&(y=Math.max(y,this.attribute.subTick.length||2));const f=y+v+n,A=this.getVerticalCoord(b,f,!1),k=this.getVerticalVector(f,!1,{x:0,y:0});let T,P,{angle:D}=g;if(T=a==="start"?"start":a==="end"?"end":"center",C(D)&&l){D=Yl(x,[1,0],!0);const{verticalFactor:H=1}=this.attribute;P=-1*H===1?"bottom":"top"}else T=this.getTextAlign(k),P=this.getTextBaseline(k,!1);let B=u;if(C(B)){const{verticalLimitSize:H,verticalMinSize:nt,orient:Y}=this.attribute,Z=Math.min(H||1/0,nt||1/0);if(O(Z))if(Y==="bottom"||Y==="top")if(D!==Math.PI/2){const rt=Math.abs(Math.cos(D??0));B=rt<1e-6?1/0:this.attribute.end.x/rt}else B=Z-f;else if(D&&D!==0){const rt=Math.abs(Math.sin(D));B=rt<1e-6?1/0:this.attribute.end.y/rt}else B=Z-f}const E=Object.assign(Object.assign(Object.assign({},A),g),{maxWidth:B,textStyle:Object.assign({textAlign:T,textBaseline:P},r),state:{text:M({},xe,c.text),shape:M({},xe,c.shape),panel:M({},xe,c.background)}});return E.angle=D,h&&h.visible&&(E.shape=Object.assign({visible:!0},h.style),h.space&&(E.space=h.space)),d&&d.visible&&(E.panel=Object.assign({visible:!0},d.style)),E}getTextBaseline(t,e){let i="middle";const{verticalFactor:s=1}=this.attribute,a=(e?1:-1)*s;return jt(t[1],0)?i=!jt(t[0],0)||Object.is(t[0],-0)||Object.is(t[1],-0)?"middle":a===1?"bottom":"top":t[1]>0?i="top":t[1]<0&&(i="bottom"),i}getLabelAlign(t,e,i){const s=this.attribute.orient;if(["top","bottom","right","left"].includes(s)||t[0]===0&&t[1]===0){if(s==="top"||s==="bottom")return Wn(e?s==="bottom"?"top":"bottom":s,i);if(s==="left"||s==="right")return $n(e?s==="left"?"right":"left":s,i)}return{textAlign:this.getTextAlign(t),textBaseline:this.getTextBaseline(t,e)}}beforeLabelsOverlap(t,e,i,s,a){var n,r,l,h;const{flush:d=!1}=this.attribute.label||{};if(d&&t.length){const{orient:c,start:u,end:g}=this.attribute,_=c==="bottom"||c==="top",p=t[0],m=j(t),b=_?p.attribute.x>m.attribute.x:p.attribute.y<m.attribute.y;if(_){const x=b?m:p,v=b?p:m,y=u.x,f=g.x,A=x.AABBBounds.x1,k=v.AABBBounds.x2;A<y&&(x.attribute.angle?x.setAttributes({dx:((n=x.attribute.dx)!==null&&n!==void 0?n:0)+y-A}):x.setAttributes({x:y,textAlign:"left"})),k>f&&(v.attribute.angle?v.setAttributes({dx:((r=v.attribute.dx)!==null&&r!==void 0?r:0)+f-k}):v.setAttributes({x:f,textAlign:"right"}))}else{const x=b?m:p,v=b?p:m,y=x.AABBBounds.y2,f=v.AABBBounds.y1,A=u.y,k=g.y;f<A&&(v.attribute.angle?v.setAttributes({dy:((l=v.attribute.dy)!==null&&l!==void 0?l:0)+A-f}):v.setAttributes({y:A,textBaseline:"top"})),y>k&&(x.attribute.angle?x.setAttributes({dy:((h=x.attribute.dy)!==null&&h!==void 0?h:0)+k-y}):x.setAttributes({y:k,textBaseline:"bottom"}))}}}handleLabelsOverlap(t,e,i,s,a){if(N(t))return;const{verticalLimitSize:n,label:r,orient:l}=this.attribute,h=this._getAxisLabelLimitLength(n,a),{layoutFunc:d,autoRotate:c,autoRotateAngle:u,autoLimit:g,limitEllipsis:_,autoHide:p,autoHideMethod:m,autoHideSeparation:b,lastVisible:x,firstVisible:v,autoWrap:y,overflowLimitLength:f}=r;if(R(d))d(t,e,s,this);else{if(c)ih(t,{labelRotateAngle:u,orient:l});else if(y){const A=Math.abs(l==="left"||l==="right"?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x);hh(t,{orient:l,limitLength:h,axisLength:A,ellipsis:_})}if(!y&&g&&O(h)&&h>0){const A=l==="left"||l==="right",k=Math.abs(A?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x),T=A?k/t.length:p||c?1/0:k/t.length;lh(t,{limitLength:h,verticalLimitLength:T,ellipsis:_,orient:l,axisLength:k,overflowLimitLength:f})}p&&Ql(t,{orient:l,method:m,separation:b,lastVisible:x,firstVisible:v})}}afterLabelsOverlap(t,e,i,s,a){const{verticalLimitSize:n,orient:r}=this.attribute,l=r==="bottom"||r==="top",h=i.AABBBounds;let d=l?h.height():h.width();const{verticalMinSize:c}=this.attribute;if(O(c)&&(!O(n)||c<=n)){const u=this._getAxisLabelLimitLength(c,a);let g,_;d=Math.max(d,u),r==="left"?(g=h.x2-d,_=h.y1):r==="right"?(g=h.x1,_=h.y1):r==="top"?(g=h.x1,_=h.y2-d):r==="bottom"&&(g=h.x1,_=h.y1);const p=U.rect({x:g,y:_,width:l?h.width():d,height:l?d:h.height(),pickable:!1});p.name=it.axisLabelBackground,p.id=this._getNodeId("axis-label-background"),i.insertBefore(p,i.firstChild)}if(S(this.attribute.label.containerAlign)){let u;r==="left"?u=h.x2-d:r==="right"?u=h.x1:r==="top"?u=h.y2-d:r==="bottom"&&(u=h.y1),dh(t,u,d,r,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(t,e){var i,s,a,n,r;const{label:l,title:h,line:d,tick:c}=this.attribute,u=(i=l.space)!==null&&i!==void 0?i:4;let g=t,_=0,p=0;const m=d&&d.visible?(s=d.style.lineWidth)!==null&&s!==void 0?s:1:0,b=c&&c.visible?(a=c.length)!==null&&a!==void 0?a:4:0;if(h&&h.visible&&typeof h.text=="string"){_=Zr(h.text,h.textStyle,(r=(n=this.stage)===null||n===void 0?void 0:n.getTheme())===null||r===void 0?void 0:r.text).height;const x=hn(h.padding);p=h.space+x[0]+x[2]}return g&&(g=(g-u-p-_-m-b)/e),g}release(){super.release(),this._breaks=null}}Qe.defaultAttributes=es,At(Qe,Kn);class _h extends hs{constructor(){super(...arguments),this.mode=Nr.NORMAL}onBind(){const t=this.target.getInnerView(),e=this.target.getPrevInnerView();e&&(this._newElementAttrMap={},Be(t,i=>{var s,a,n,r,l,h;if(i.type!=="group"&&i.id){const d=e[i.id];if(d){if(!Ie(i.attribute,d.attribute)){const c=gi(i.attribute);this._newElementAttrMap[i.id]={state:"update",node:i,attrs:Object.assign(Object.assign({},c),{opacity:(s=c.opacity)!==null&&s!==void 0?s:1,fillOpacity:(a=c.fillOpacity)!==null&&a!==void 0?a:1,strokeOpacity:(n=c.strokeOpacity)!==null&&n!==void 0?n:1})},i.setAttributes(d.attribute)}}else{const c={opacity:(r=i.attribute.opacity)!==null&&r!==void 0?r:1,fillOpacity:(l=i.attribute.fillOpacity)!==null&&l!==void 0?l:1,strokeOpacity:(h=i.attribute.strokeOpacity)!==null&&h!==void 0?h:1};this._newElementAttrMap[i.id]={state:"enter",node:i,attrs:c},i.setAttributes({opacity:0,fillOpacity:0,strokeOpacity:0})}}}))}onStart(){let t=this.duration,e=this.easing;this._newElementAttrMap&&Object.keys(this._newElementAttrMap).forEach(i=>{var s;const{node:a,attrs:n,state:r}=this._newElementAttrMap[i];if(r==="enter"){const{enter:l={}}=(s=this.params)!==null&&s!==void 0?s:{};t=O(l.duration)?l.duration:t,e=l.easing?l.easing:e}a.type==="path"?a.animate({interpolate:(l,h,d,c,u)=>l==="path"&&(u.path=Wr(d,c)(h),!0)}).to(n,t,e):a.animate().to(n,t,e)})}onUpdate(t,e,i){}}const le=o=>o.map((t,e)=>({index:e,value:t})),ui=(o,t,e,i)=>e<o?Math.max(o-t/2,e):e>o?Math.min(o-t/2,e-t):e<i?e:e-t,qn=(o,t,e)=>{var i;const{labelStyle:s,axisOrientType:a,labelFlush:n,labelFormatter:r,startAngle:l=0}=e;let h=(i=s.angle)!==null&&i!==void 0?i:0;s.direction==="vertical"&&(h+=ne(90));const d=["bottom","top"].includes(a),c=["left","right"].includes(a);let u=1,g=0;d||(c?(u=0,g=1):l&&(u=Math.cos(l),g=-Math.sin(l)));const _=$r(s),p=o.range();return t.map((b,x)=>{var v,y;const f=r?r(b):`${b}`,{width:A,height:k}=_.quickMeasure(f),T=Math.max(A,12),P=Math.max(k,12),D=o.scale(b),B=u*D,E=g*D;let H,nt,Y=B,Z=E;n&&d&&x===0?Y=ui(B,T,p[0],p[p.length-1]):n&&d&&x===t.length-1?Y=ui(B,T,p[p.length-1],p[0]):H=(v=s.textAlign)!==null&&v!==void 0?v:"center",H==="right"?Y-=T:H==="center"&&(Y-=T/2),n&&c&&x===0?Z=ui(E,P,p[0],p[p.length-1]):n&&c&&x===t.length-1?Z=ui(E,P,p[p.length-1],p[0]):nt=(y=s.textBaseline)!==null&&y!==void 0?y:"middle",nt==="bottom"?Z-=P:nt==="middle"&&(Z-=P/2);const rt=new Kr().set(Y,Z,Y+T,Z+P);return h&&rt.rotate(h,B,E),rt})},ph=o=>["bottom","top","z"].includes(o);class mh{nice(t=10,e){var i,s,a,n;const r=this._domain;let l=[],h=null;if(e){const d=qr(r,e);if(l=d.niceMinMax,this._domainValidator=d.domainValidator,h=d.niceType,d.niceDomain)return this._niceDomain=d.niceDomain,this.rescale(),this}else h="all";if(h){const d=Qr(r.slice(),(s=(i=this.getNiceConfig)===null||i===void 0?void 0:i.call(this))!==null&&s!==void 0?s:{floor:c=>Math.floor(c),ceil:c=>Math.ceil(c)});return h==="min"?d[d.length-1]=(a=l[1])!==null&&a!==void 0?a:d[d.length-1]:h==="max"&&(d[0]=(n=l[0])!==null&&n!==void 0?n:d[0]),this._niceDomain=d,this.rescale(),this}return this}niceMin(){const t=this._domain[this._domain.length-1];this.nice();const e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){const t=this._domain[0];this.nice();const e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}}function va(o){return t=>-o(-t)}function ya(o=Number.EPSILON){return t=>Math.max(t,o)}function vh(o=Number.EPSILON){return t=>Math.min(t,-o)}class Yi extends Jr{constructor(){super(Fs(10),Hs(10)),this.type=us.Log,this._limit=ya(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return new Yi().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(t){var e;if(t)return this;super.rescale();const i=Fs(this._base),s=Hs(this._base);return((e=this._niceDomain)!==null&&e!==void 0?e:this._domain)[0]<0?(this._logs=va(i),this._pows=va(s),this._limit=vh(),this.transformer=to,this.untransformer=eo):(this._logs=i,this._pows=s,this._limit=ya(),this.transformer=this._logs,this.untransformer=s),this}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._limit(this._clamp(t))));return this._fishEyeTransform?this._fishEyeTransform(i):i}base(t,e){return arguments.length?(this._base=t,this.rescale(e)):this._base}tickFormat(){return io}d3Ticks(t=10,e){const i=this.domain(),s=this._limit(i[0]),a=this._limit(i[i.length-1]);return so(s,a,t,this._base,this.transformer,this.untransformer,e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return ao(this._limit(e[0]),this._limit(e[e.length-1]),t,this._base,this.transformer,this.untransformer)}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return Vs(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return Vs(this._limit(e[0]),this._limit(e[e.length-1]),t,this.transformer,this.untransformer)}getNiceConfig(){return{floor:t=>this._pows(Math.floor(this._logs(this._limit(t)))),ceil:t=>Math.abs(t)>=1?Math.ceil(t):this._pows(Math.ceil(this._logs(this._limit(t))))}}}At(Yi,mh);function Qi(o,t,e,i){let s;const{breakData:a}=o;if(a&&a()){const{breakDomains:n}=a(),r=t.domain();s=[];for(let l=0;l<r.length-1;l++)i(e,[r[l],r[l+1]]).forEach(h=>{n.some(d=>h>=d[0]&&h<=d[1])||s.push(h)});t.domain(r)}else s=i(e);return s}function ba(o,t,e,i,s=!1){if(e&&!t.includes(o)){let a=t.length;if(a>1){s?t.push(o):t.unshift(o);for(let n=0;n<a;n++){const r=s?a-1-n:n;if(!i(t[r]))break;t.splice(r,1),n--,a--}}}}const bs=(o,t)=>{var e,i;if(!K(o.type))return le(o.domain());const s=o.range(),a=Math.abs(s[s.length-1]-s[0]);if(a<2)return le([o.domain()[0]]);const{tickCount:n,forceTickCount:r,tickStep:l,noDecimals:h=!1,labelStyle:d,breakData:c}=t;let u;if(S(l))u=o.stepTicks(l);else if(S(r))u=Qi(t,o,r,(_,p)=>p&&p.length?o.domain(p,!0).forceTicks(_):o.forceTicks(_));else if(t.tickMode==="d3"){const _=(e=R(n)?n({axisLength:a,labelStyle:d}):n)!==null&&e!==void 0?e:5;u=Qi(t,o,_,(p,m)=>m&&m.length?o.domain(m,!0).d3Ticks(p,{noDecimals:h}):o.d3Ticks(p,{noDecimals:h}))}else{const _=(i=R(n)?n({axisLength:a,labelStyle:d}):n)!==null&&i!==void 0?i:5,p=R(t.tickMode)?t.tickMode:void 0;u=Qi(t,o,_,(m,b)=>b&&b.length?o.domain(b,!0).ticks(m,{noDecimals:h,customTicks:p}):o.ticks(m,{noDecimals:h,customTicks:p}))}const g=o.domain();if(t.labelFirstVisible&&g[0]!==u[0]&&!u.includes(g[0])&&u.unshift(g[0]),t.labelLastVisible&&g[g.length-1]!==u[u.length-1]&&!u.includes(g[g.length-1])&&u.push(g[g.length-1]),t.sampling&&u.length>1&&(t.coordinateType==="cartesian"||t.coordinateType==="polar"&&t.axisOrientType==="radius")){const{labelGap:_=4,labelFlush:p}=t;let m=qn(o,u,t).map((T,P)=>({AABBBounds:T,value:u[P]}));const b=[...m],x=b[0],v=j(b),y=c&&c()?xa.greedy:xa.parity;for(;m.length>=3&&is(m,_);)m=y(m,_);const f=t.labelFirstVisible;let A=t.labelLastVisible;ft(x,v,_)&&m.includes(v)&&m.length>1&&f&&A&&(m.splice(m.indexOf(v),1),A=!1),ba(x,m,f,T=>ft(T,x,_)),ba(v,m,A,T=>ft(T,v,_)||!(!f||T===x)&&ft(T,x,_),!0);const k=m.map(T=>T.value);k.length<3&&p&&(k.length>1&&k.pop(),j(k)!==j(u)&&k.push(j(u))),u=k}return le(u)},xa={parity:function(o){return o.filter((t,e)=>e%2==0)},greedy:function(o,t){let e;return o.filter((i,s)=>(!s||!ft(e,i,t))&&(e=i,!0))}},fa=(o,t,e,i)=>qn(o,t,e).map(s=>i?[s.x1,s.x2,s.width()]:[s.y1,s.y2,s.height()]),Sa=(o,t,e=0)=>Math.max(o[0],t[0])-e/2<=Math.min(o[1],t[1])+e/2,Aa=(o,t)=>o[1]<t[0]?t[0]-o[1]:t[1]<o[0]?o[0]-t[1]:0,yh=(o,t)=>{var e;const i=o.domain();if(!i.length)return[];const{tickCount:s,forceTickCount:a,tickStep:n,labelGap:r=4,axisOrientType:l,labelStyle:h}=t,d=ph(l),c=o.range(),u=o.calculateWholeRangeSize();if(u<2)return t.labelLastVisible?le([i[i.length-1]]):le([i[0]]);let g;if(S(n))g=o.stepTicks(n);else if(S(a))g=o.forceTicks(a);else if(S(s)){const _=R(s)?s({axisLength:u,labelStyle:h}):s;g=o.ticks(_)}else if(t.sampling){const _=((e=t.labelStyle.fontSize)!==null&&e!==void 0?e:12)+2,p=It(c),m=Bt(c);if(i.length<=u/_){const b=(m-p)/i.length,x=fa(o,i,t,d),v=Math.min(...x.map(f=>f[2])),y=bh(i,x,r,t.labelLastVisible,Math.floor(v/b),!1);g=o.stepTicks(y.step),t.labelLastVisible&&(y.delCount&&(g=g.slice(0,g.length-y.delCount)),g.push(i[i.length-1]))}else{const b=[i[0],i[Math.floor(i.length/2)],i[i.length-1]],x=fa(o,b,t,d);let v=null;x.forEach(f=>{v?v[2]<f[2]&&(v=f):v=f});const y=m-p-r>0?Math.ceil(i.length*(r+v[2])/(m-p-r)):i.length-1;g=o.stepTicks(y),!t.labelLastVisible||g.length&&g[g.length-1]===i[i.length-1]||(g.length&&Math.abs(o.scale(g[g.length-1])-o.scale(i[i.length-1]))<v[2]&&(g=g.slice(0,-1)),g.push(i[i.length-1]))}}else g=o.domain();return le(g)},bh=(o,t,e,i,s,a)=>{let n=0,r=0,l=-1,h=Number.MAX_VALUE;const d=g=>{let _=!0,p=0;do p+g<o.length&&Sa(t[p],t[p+g],e)&&(_=!1),p+=g;while(_&&p<o.length);return _},c=no(s,o.length,g=>d(g)?1:-1);let u=c;do if(u>c&&!a&&!d(u))u++;else{if(!i){r=u;break}{const g=o.length-1;let _,p=0;_=o.length%u>0?o.length-o.length%u+u:o.length;do{if(_-=u,_!==g&&!Sa(t[_],t[g],e))break;p++}while(_>0);if(_===g){r=u,n=p;break}{const m=Math.floor(o.length/u)-p+1;if(m<l)break;{l=m;const b=Aa(t[_],t[g]),x=_-u>=0?Aa(t[_-u],t[_]):b,v=Math.abs(b-x);if(v<h&&(h=v,r=u,n=p),b<=x)break}}}u++}while(u<=o.length);return{step:r,delCount:n}};function ss(o,t,e,i){let s="";if(!o||t.length===0)return s;const a=t[0],n=Ne.distancePP(o,a),r=e?0:1;return i?s+=`M${o.x},${o.y-n}A${n},${n},0,0,${r},${o.x},${o.y+n}A${n},${n},0,0,${r},${o.x},${o.y-n}Z`:t.forEach((l,h)=>{h===0?s=`M${l.x},${l.y}`:s+=`A${n},${n},0,0,${r},${l.x},${l.y}`}),s}function xh(o,t,e){const{type:i,closed:s}=e,a=t.slice(0).reverse();let n="",r="";if(i==="line"&&e.smoothLink&&e.center){const l=o[0],h=a[0],d=e.center;n=ke(o,!!s),r=ke(a,!!s);const c=Ne.distancePP(h,d),u=Ne.distancePP(l,d);n+=`A${c},${c},0,0,1,${h.x},${h.y}L${h.x},${h.y}`,r+=`A${u},${u},0,0,0,${l.x},${l.y}`}else if(i==="circle"){const{center:l}=e;n=ss(l,o,!1,!!s),r=ss(l,a,!0,!!s)}else i!=="line"&&i!=="polygon"||(n=ke(o,!!s),r=ke(a,!!s));return s?n+=r:(r="L"+r.substring(1),n+=r,n+="Z"),n}class Oe extends ge{constructor(){super(...arguments),this.name="axis-grid",this.data=[]}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}render(){this._prevInnerView=this._innerView&&Vn(this._innerView),this.removeAllChild(!0),this._innerView=U.group({x:0,y:0,pickable:!1}),this.add(this._innerView);const{items:t,visible:e}=this.attribute;t&&t.length&&e!==!1&&(this.data=this._transformItems(t),this._renderGrid(this._innerView))}getVerticalCoord(t,e,i){return jn(t,this.getVerticalVector(e,i,t))}_transformItems(t){const e=[];return t.forEach(i=>{var s;e.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(s=i.id)!==null&&s!==void 0?s:i.label}))}),e}_renderGrid(t){const{visible:e}=this.attribute.subGrid||{};e&&this._renderGridByType(!0,t),this._renderGridByType(!1,t)}_renderGridByType(t,e){const i=M({},this.attribute,this.getGridAttribute(t)),{type:s,items:a,style:n,closed:r,alternateColor:l,depth:h=0}=i,d=t?`${it.grid}-sub`:`${it.grid}`;if(a.forEach((c,u)=>{const{id:g,points:_}=c;let p="";if(s==="line"||s==="polygon")p=ke(_,!!r);else if(s==="circle"){const{center:b}=this.attribute;p=ss(b,_,!1,!!r)}const m=U.path(Object.assign({path:p,z:h},R(n)?M({},this.skipDefault?null:Oe.defaultAttributes.style,n(c,u)):n));m.name=`${d}-line`,m.id=this._getNodeId(`${d}-path-${g}`),e.add(m)}),h&&s==="line"&&a.forEach((c,u)=>{const{id:g,points:_}=c,p=[];p.push(_[0]);const m=_[1].x-_[0].x,b=_[1].y-_[0].y,x=Math.sqrt(m*m+b*b),v=h/x;p.push({x:_[0].x+m*v,y:_[0].y+b*v});const y=ke(p,!!r),f=Pe(p[0].x-p[1].x),A=Pe(p[0].y-p[1].y),k=U.path(Object.assign({path:y,z:0,alpha:f>A?(_[1].x-_[0].x>0?-1:1)*_i/2:0,beta:f<A?-_i/2:0,anchor3d:f>A?[p[0].x,0]:[0,p[0].y]},R(n)?M({},this.skipDefault?null:Oe.defaultAttributes.style,n(c,u)):n));k.name=`${d}-line`,k.id=this._getNodeId(`${d}-path-${g}`),e.add(k)}),a.length>1&&l){const c=$(l)?l:[l,"transparent"],u=y=>c[y%c.length],g=this.attribute.items,_=g[0],p=g[g.length-1],m=!jt(_.value,0)&&!jt(p.value,0),b=!jt(_.value,1)&&!jt(p.value,1),x=[],v=_.value>p.value;(v&&b||!v&&m)&&x.push(this.getGridPointsByValue(v?1:0)),a.forEach(y=>{x.push(y.points)}),(v&&m||!v&&b)&&x.push(this.getGridPointsByValue(v?0:1));for(let y=0;y<x.length-1;y++){const f=xh(x[y],x[y+1],i),A=U.path({path:f,fill:u(y)});A.name=`${d}-region`,A.id=this._getNodeId(`${d}-region-${y}`),e.add(A)}}}_getNodeId(t){return`${this.id}-${t}`}_parseTickSegment(){let t=1;return this.data.length>=2&&(t=this.data[1].value-this.data[0].value),t}_getPointsOfSubGrid(t,e){const i=this.data.length,s=[];return i>=2&&this.data.forEach(a=>{let n=a.value;if(!e){const r=a.value-t/2;if(this.isInValidValue(r))return;n=r}s.push({value:n})}),s}release(){super.release(),this._prevInnerView=null,this._innerView=null}}Oe.defaultAttributes={style:{lineWidth:1,stroke:"#999",strokeOpacity:1,lineDash:[4,4]},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#999",strokeOpacity:1,lineDash:[4,4]}}};gh();class Qn extends Oe{constructor(t,e){super(e!=null&&e.skipDefault?t:M({},Oe.defaultAttributes,t),e)}_getGridPoint(t,e){let i;if(t==="line"){const{length:s}=this.attribute;i=[e,this.getVerticalCoord(e,s,!0)]}else if(t==="circle"||t==="polygon"){const{center:s,sides:a=6,startAngle:n=ro,endAngle:r=oo}=this.attribute,l=Ne.distancePP(s,e);i=Wl(s,a,l,n,r)}return i}getGridPointsByValue(t){const e=this.getTickCoord(t);return this._getGridPoint(this.attribute.type,e)}getGridAttribute(t){const{type:e,alignWithLabel:i=!0}=this.attribute,s=this._parseTickSegment();let a,n=[];if(t){a=M({},this.attribute,this.attribute.subGrid);const r=[],{count:l=4}=a;if(this.data.length>=2){const h=this._getPointsOfSubGrid(s,i);for(let d=0;d<h.length-1;d++){const c=h[d],u=h[d+1];r.push({id:`sub-${d}-0`,points:this.getGridPointsByValue(c.value),datum:{}});for(let g=0;g<l;g++){const _=(g+1)/(l+1),p=(1-_)*c.value+_*u.value;r.push({id:`sub-${d}-${g+1}`,points:this.getGridPointsByValue(p),datum:{}})}d===h.length-2&&r.push({id:`sub-${d}-${l+1}`,points:this.getGridPointsByValue(u.value),datum:{}})}n=r}}else{a=this.attribute;const r=[];this.data.forEach(l=>{let{point:h}=l;if(!i){const d=l.value-s/2;if(this.isInValidValue(d))return;h=this.getTickCoord(d)}r.push({id:l.label,datum:l,points:this._getGridPoint(e,h)})}),n=r}return Object.assign(Object.assign({},a),{items:n})}}At(Qn,Kn);const ka="M -0.0544 0.25 C -0.0742 0.25 -0.0901 0.234 -0.0901 0.2143 L -0.0901 -0.1786 C -0.0901 -0.1983 -0.0742 -0.2143 -0.0544 -0.2143 L -0.0187 -0.2143 L -0.0187 -0.5 L 0.017 -0.5 L 0.017 -0.2143 L 0.0527 -0.2143 C 0.0724 -0.2143 0.0884 -0.1983 0.0884 -0.1786 L 0.0884 0.2143 C 0.0884 0.234 0.0724 0.25 0.0527 0.25 L 0.017 0.25 L 0.017 0.5 L -0.0187 0.5 L -0.0187 0.25 L -0.0544 0.25 Z M -0.0187 -0.1429 L -0.0544 -0.1429 L -0.0544 0.1786 L -0.0187 0.1786 L -0.0187 -0.1429 Z M 0.0527 -0.1429 L 0.017 -0.1429 L 0.017 0.1786 L 0.0527 0.1786 L 0.0527 -0.1429 Z",fh={orient:"bottom",showDetail:"auto",brushSelect:!0,zoomLock:!1,minSpan:0,maxSpan:1,delayType:"throttle",delayTime:0,realTime:!0,backgroundStyle:{fill:"white",stroke:"#D1DBEE",lineWidth:1,cornerRadius:2},dragMaskStyle:{fill:"#B0C8F9",fillOpacity:.2},backgroundChartStyle:{area:{visible:!0,stroke:"#D1DBEE",lineWidth:1,fill:"#F6F8FC"},line:{visible:!0,stroke:"#D1DBEE",lineWidth:1}},selectedBackgroundStyle:{fill:"#B0C8F9",fillOpacity:.5},selectedBackgroundChartStyle:{area:{visible:!0,stroke:"#B0C8F9",lineWidth:1,fill:"#fbb934"},line:{visible:!0,stroke:"#fbb934",lineWidth:1}},middleHandlerStyle:{visible:!0,background:{size:8,style:{fill:"white",stroke:"#B0C8F9",cornerRadius:2}},icon:{size:6,fill:"white",stroke:"#B0C8F9",symbolType:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",lineWidth:.5}},startHandlerStyle:{visible:!0,triggerMinSize:0,symbolType:ka,fill:"white",stroke:"#B0C8F9",lineWidth:.5},endHandlerStyle:{visible:!0,triggerMinSize:0,symbolType:ka,fill:"white",stroke:"#B0C8F9",lineWidth:.5},startTextStyle:{padding:4,textStyle:{fontSize:10,fill:"#6F6F6F"}},endTextStyle:{padding:4,textStyle:{fontSize:10,fill:"#6F6F6F"}}},Ht={horizontal:{angle:0,strokeBoundsBuffer:0,boundsPadding:2,pickMode:"imprecise",cursor:"ew-resize"},vertical:{angle:Math.PI/180*90,cursor:"ns-resize",boundsPadding:2,pickMode:"imprecise",strokeBoundsBuffer:0}};var _t;(function(o){o.startHandler="startHandler",o.endHandler="endHandler",o.middleHandler="middleHandler",o.background="background"})(_t||(_t={}));function Sh(){dn(),ds(),Ri(),lo(),Ee()}var Ma=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};const Ah={debounce:gs,throttle:Ii};Sh();let Jn=class tr extends ge{setPropsFromAttrs(){const{start:t,end:e,orient:i,previewData:s,previewPointsX:a,previewPointsY:n,previewPointsX1:r,previewPointsY1:l}=this.attribute;t&&(this.state.start=t),e&&(this.state.end=e);const{width:h,height:d}=this.getLayoutAttrFromConfig();this._spanCache=this.state.end-this.state.start,this._isHorizontal=i==="top"||i==="bottom",this._layoutCache.max=this._isHorizontal?h:d,this._layoutCache.attPos=this._isHorizontal?"x":"y",this._layoutCache.attSize=this._isHorizontal?"width":"height",s&&(this._previewData=s),R(a)&&(this._previewPointsX=a),R(n)&&(this._previewPointsY=n),R(r)&&(this._previewPointsX1=r),R(l)&&(this._previewPointsY1=l)}constructor(t,e){super(e!=null&&e.skipDefault?t:M({},tr.defaultAttributes,t)),this.name="dataZoom",this._previewData=[],this._activeState=!1,this._activeCache={startPos:{x:0,y:0},lastPos:{x:0,y:0}},this._layoutCache={attPos:"x",attSize:"width",max:0},this.state={start:0,end:1},this._statePointToData=a=>a,this._onHandlerPointerDown=(a,n)=>{a.stopPropagation(),n==="start"?(this._activeTag=_t.startHandler,this._activeItem=this._startHandlerMask):n==="end"?(this._activeTag=_t.endHandler,this._activeItem=this._endHandlerMask):n==="middleRect"?(this._activeTag=_t.middleHandler,this._activeItem=this._middleHandlerRect):n==="middleSymbol"?(this._activeTag=_t.middleHandler,this._activeItem=this._middleHandlerSymbol):n==="background"&&(this._activeTag=_t.background,this._activeItem=this._background),this._activeState=!0,this._activeCache.startPos=this.eventPosToStagePos(a),this._activeCache.lastPos=this.eventPosToStagePos(a),ye.env==="browser"&&(ye.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),ye.addEventListener("pointerup",this._onHandlerPointerUp)),this.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0})},this._pointerMove=a=>{a.stopPropagation();const{start:n,end:r,brushSelect:l,realTime:h=!0}=this.attribute,d=this.eventPosToStagePos(a),{attPos:c,max:u}=this._layoutCache,g=(d[c]-this._activeCache.lastPos[c])/u;let{start:_,end:p}=this.state;this._activeState&&(this._activeTag===_t.middleHandler?this.moveZoomWithMiddle((this.state.start+this.state.end)/2+g):this._activeTag===_t.startHandler?_+g>p?(_=p,p=_+g,this._activeTag=_t.endHandler):_+=g:this._activeTag===_t.endHandler&&(p+g<_?(p=_,_=p+g,this._activeTag=_t.startHandler):p+=g),this._activeCache.lastPos=d,l&&this.renderDragMask()),_=Math.min(Math.max(_,0),1),p=Math.min(Math.max(p,0),1),n===_&&r===p||(this.setStateAttr(_,p,!0),h&&this._dispatchEvent("change",{start:_,end:p,tag:this._activeTag}))},this._onHandlerPointerMove=this.attribute.delayTime===0?this._pointerMove:Ah[this.attribute.delayType](this._pointerMove,this.attribute.delayTime),this._onHandlerPointerUp=a=>{a.preventDefault();const{start:n,end:r,brushSelect:l,realTime:h=!0}=this.attribute;if(this._activeState&&this._activeTag===_t.background){const d=this.eventPosToStagePos(a);this.backgroundDragZoom(this._activeCache.startPos,d)}this._activeState=!1,l&&this.renderDragMask(),n===this.state.start&&r===this.state.end||(this.setStateAttr(this.state.start,this.state.end,!0),this._dispatchEvent("change",{start:this.state.start,end:this.state.end,tag:this._activeTag})),ye.env==="browser"&&(ye.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),ye.removeEventListener("pointerup",this._onHandlerPointerUp)),this.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.removeEventListener("pointerup",this._onHandlerPointerUp)};const{position:i,showDetail:s}=t;this._activeCache.startPos=i,this._activeCache.lastPos=i,this._showText=s!=="auto"&&s,this.setPropsFromAttrs()}setAttributes(t,e){super.setAttributes(t,e),this.setPropsFromAttrs()}bindEvents(){if(this.attribute.disableTriggerEvent)return void this.setAttribute("childrenPickable",!1);const{showDetail:t,brushSelect:e}=this.attribute;this._startHandlerMask&&this._startHandlerMask.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"start")),this._endHandlerMask&&this._endHandlerMask.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"end")),this._middleHandlerSymbol&&this._middleHandlerSymbol.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"middleSymbol")),this._middleHandlerRect&&this._middleHandlerRect.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"middleRect"));const i=e?"background":"middleRect";this._selectedBackground&&this._selectedBackground.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,i)),e&&this._background&&this._background.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"background")),e&&this._previewGroup&&this._previewGroup.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"background")),this._selectedPreviewGroup&&this._selectedPreviewGroup.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,i)),this.addEventListener("pointerup",this._onHandlerPointerUp),this.addEventListener("pointerupoutside",this._onHandlerPointerUp),t==="auto"&&(this.addEventListener("pointerenter",this._onHandlerPointerEnter),this.addEventListener("pointerleave",this._onHandlerPointerLeave))}dragMaskSize(){const{position:t}=this.attribute,{attPos:e,max:i}=this._layoutCache;return this._activeCache.lastPos[e]-t[e]>i?i+t[e]-this._activeCache.startPos[e]:this._activeCache.lastPos[e]-t[e]<0?t[e]-this._activeCache.startPos[e]:this._activeCache.lastPos[e]-this._activeCache.startPos[e]}setStateAttr(t,e,i){const{zoomLock:s=!1,minSpan:a=0,maxSpan:n=1}=this.attribute,r=e-t;r!==this._spanCache&&(s||r<a||r>n)||(this._spanCache=r,this.state.start=t,this.state.end=e,i&&this.setAttributes({start:t,end:e}))}eventPosToStagePos(t){return this.stage.eventPointTransform(t)}_onHandlerPointerEnter(t){t.stopPropagation(),this._showText=!0,this.renderText()}_onHandlerPointerLeave(t){t.stopPropagation(),this._showText=!1,this.renderText()}backgroundDragZoom(t,e){const{attPos:i,max:s}=this._layoutCache,{position:a}=this.attribute,n=t[i]-a[i],r=e[i]-a[i],l=Math.min(Math.max(Math.min(n,r)/s,0),1),h=Math.min(Math.max(Math.max(n,r)/s,0),1);Math.abs(l-h)<.01?this.moveZoomWithMiddle(l):this.setStateAttr(l,h,!1)}moveZoomWithMiddle(t){let e=t-(this.state.start+this.state.end)/2;e!==0&&(e>0?this.state.end+e>1&&(e=1-this.state.end):e<0&&this.state.start+e<0&&(e=-this.state.start),this.setStateAttr(this.state.start+e,this.state.end+e,!1))}renderDragMask(){const{dragMaskStyle:t}=this.attribute,{position:e,width:i,height:s}=this.getLayoutAttrFromConfig();this._isHorizontal?this._dragMask=this._container.createOrUpdateChild("dragMask",Object.assign({x:Le(this.dragMaskSize()<0?this._activeCache.lastPos.x:this._activeCache.startPos.x,e.x,e.x+i),y:e.y,width:this._activeState&&this._activeTag===_t.background&&Math.abs(this.dragMaskSize())||0,height:s},t),"rect"):this._dragMask=this._container.createOrUpdateChild("dragMask",Object.assign({x:e.x,y:Le(this.dragMaskSize()<0?this._activeCache.lastPos.y:this._activeCache.startPos.y,e.y,e.y+s),width:i,height:this._activeState&&this._activeTag===_t.background&&Math.abs(this.dragMaskSize())||0},t),"rect")}isTextOverflow(t,e,i){if(!e)return!1;if(this._isHorizontal){if(i==="start"){if(e.x1<t.x1)return!0}else if(e.x2>t.x2)return!0}else if(i==="start"){if(e.y1<t.y1)return!0}else if(e.y2>t.y2)return!0;return!1}setTextAttr(t,e){var i,s,a,n,r,l,h,d;const{startTextStyle:c,endTextStyle:u}=this.attribute,{formatMethod:g}=c,_=Ma(c,["formatMethod"]),{formatMethod:p}=u,m=Ma(u,["formatMethod"]),{start:b,end:x}=this.state;this._startValue=this._statePointToData(b),this._endValue=this._statePointToData(x);const{position:v,width:y,height:f}=this.getLayoutAttrFromConfig(),A=g?g(this._startValue):this._startValue,k=p?p(this._endValue):this._endValue,T={x1:v.x,y1:v.y,x2:v.x+y,y2:v.y+f};let P,D,B,E;this._isHorizontal?(P={x:v.x+b*y,y:v.y+f/2},D={x:v.x+x*y,y:v.y+f/2},B={textAlign:this.isTextOverflow(T,t,"start")?"left":"right",textBaseline:(s=(i=_==null?void 0:_.textStyle)===null||i===void 0?void 0:i.textBaseline)!==null&&s!==void 0?s:"middle"},E={textAlign:this.isTextOverflow(T,e,"end")?"right":"left",textBaseline:(n=(a=m==null?void 0:m.textStyle)===null||a===void 0?void 0:a.textBaseline)!==null&&n!==void 0?n:"middle"}):(P={x:v.x+y/2,y:v.y+b*f},D={x:v.x+y/2,y:v.y+x*f},B={textAlign:(l=(r=_==null?void 0:_.textStyle)===null||r===void 0?void 0:r.textAlign)!==null&&l!==void 0?l:"center",textBaseline:this.isTextOverflow(T,t,"start")?"top":"bottom"},E={textAlign:(d=(h=m==null?void 0:m.textStyle)===null||h===void 0?void 0:h.textAlign)!==null&&d!==void 0?d:"center",textBaseline:this.isTextOverflow(T,e,"end")?"bottom":"top"}),this._startText=this.maybeAddLabel(this._container,M({},_,{text:A,x:P.x,y:P.y,visible:this._showText,pickable:!1,childrenPickable:!1,textStyle:B}),`data-zoom-start-text-${v}`),this._endText=this.maybeAddLabel(this._container,M({},m,{text:k,x:D.x,y:D.y,visible:this._showText,pickable:!1,childrenPickable:!1,textStyle:E}),`data-zoom-end-text-${v}`)}renderText(){let t=null,e=null;this.setTextAttr(t,e),t=this._startText.AABBBounds,e=this._endText.AABBBounds,this.setTextAttr(t,e),t=this._startText.AABBBounds,e=this._endText.AABBBounds;const{x1:i,x2:s,y1:a,y2:n}=t,{dx:r=0,dy:l=0}=this.attribute.startTextStyle;if(new cn().set(i,a,s,n).intersects(e)){const h=this.attribute.orient==="bottom"||this.attribute.orient==="right"?-1:1;this._isHorizontal?this._startText.setAttribute("dy",l+h*Math.abs(e.y1-e.y2)):this._startText.setAttribute("dx",r+h*Math.abs(e.x1-e.x2))}else this._isHorizontal?this._startText.setAttribute("dy",l):this._startText.setAttribute("dx",r)}getLayoutAttrFromConfig(){var t,e,i,s,a,n;if(this._layoutAttrFromConfig)return this._layoutAttrFromConfig;const{position:r,size:l,orient:h,middleHandlerStyle:d={},startHandlerStyle:c={},endHandlerStyle:u={},backgroundStyle:g={}}=this.attribute,{width:_,height:p}=l,m=(e=(t=d.background)===null||t===void 0?void 0:t.size)!==null&&e!==void 0?e:10;let b,x,v;d.visible?this._isHorizontal?(b=_,x=p-m,v={x:r.x,y:r.y+m}):(b=_-m,x=p,v={x:r.x+(h==="left"?m:0),y:r.y}):(b=_,x=p,v=r);const y=(i=c.size)!==null&&i!==void 0?i:this._isHorizontal?x:b,f=(s=u.size)!==null&&s!==void 0?s:this._isHorizontal?x:b;return c.visible&&(this._isHorizontal?(b-=(y+f)/2,v={x:v.x+y/2,y:v.y}):(x-=(y+f)/2,v={x:v.x,y:v.y+y/2})),x+=(a=g.lineWidth/2)!==null&&a!==void 0?a:1,b+=(n=g.lineWidth/2)!==null&&n!==void 0?n:1,this._layoutAttrFromConfig={position:v,width:b,height:x},this._layoutAttrFromConfig}render(){var t,e,i,s,a,n,r,l,h,d,c,u,g,_,p,m,b,x,v,y,f,A,k,T,P,D,B,E,H,nt,Y,Z,rt,Jt;this._layoutAttrFromConfig=null;const{orient:pe,backgroundStyle:si,backgroundChartStyle:Pt={},selectedBackgroundStyle:Fe={},selectedBackgroundChartStyle:He={},middleHandlerStyle:ht={},startHandlerStyle:te={},endHandlerStyle:ee={},brushSelect:ai,zoomLock:gt}=this.attribute,{start:pt,end:kt}=this.state,{position:G,width:tt,height:lt}=this.getLayoutAttrFromConfig(),ni=(t=te.triggerMinSize)!==null&&t!==void 0?t:40,ri=(e=ee.triggerMinSize)!==null&&e!==void 0?e:40,Q=this.createOrUpdateChild("dataZoom-container",{},"group");if(this._container=Q,this._background=Q.createOrUpdateChild("background",Object.assign(Object.assign({x:G.x,y:G.y,width:tt,height:lt,cursor:ai?"crosshair":"auto"},si),{pickable:!gt&&((i=si.pickable)===null||i===void 0||i)}),"rect"),!((s=Pt.line)===null||s===void 0)&&s.visible&&this.setPreviewAttributes("line",Q),!((a=Pt.area)===null||a===void 0)&&a.visible&&this.setPreviewAttributes("area",Q),ai&&this.renderDragMask(),this._isHorizontal?this._selectedBackground=Q.createOrUpdateChild("selectedBackground",Object.assign(Object.assign({x:G.x+pt*tt,y:G.y,width:(kt-pt)*tt,height:lt,cursor:ai?"crosshair":"move"},Fe),{pickable:!gt&&((n=He.pickable)===null||n===void 0||n)}),"rect"):this._selectedBackground=Q.createOrUpdateChild("selectedBackground",Object.assign(Object.assign({x:G.x,y:G.y+pt*lt,width:tt,height:(kt-pt)*lt,cursor:ai?"crosshair":"move"},Fe),{pickable:!gt&&((r=Fe.pickable)===null||r===void 0||r)}),"rect"),!((l=He.line)===null||l===void 0)&&l.visible&&this.setSelectedPreviewAttributes("line",Q),!((h=He.area)===null||h===void 0)&&h.visible&&this.setSelectedPreviewAttributes("area",Q),this._isHorizontal){if(ht.visible){const zt=((d=ht.background)===null||d===void 0?void 0:d.size)||10;this._middleHandlerRect=Q.createOrUpdateChild("middleHandlerRect",Object.assign(Object.assign({x:G.x+pt*tt,y:G.y-zt,width:(kt-pt)*tt,height:zt},(c=ht.background)===null||c===void 0?void 0:c.style),{pickable:!gt&&((_=(g=(u=ht.background)===null||u===void 0?void 0:u.style)===null||g===void 0?void 0:g.pickable)===null||_===void 0||_)}),"rect"),this._middleHandlerSymbol=Q.createOrUpdateChild("middleHandlerSymbol",Object.assign(Object.assign({x:G.x+(pt+kt)/2*tt,y:G.y-zt/2,strokeBoundsBuffer:0,angle:0,symbolType:(m=(p=ht.icon)===null||p===void 0?void 0:p.symbolType)!==null&&m!==void 0?m:"square"},ht.icon),{pickable:!gt&&((b=ht.icon.pickable)===null||b===void 0||b)}),"symbol")}this._startHandler=Q.createOrUpdateChild("startHandler",Object.assign(Object.assign(Object.assign({x:G.x+pt*tt,y:G.y+lt/2,size:lt,symbolType:(x=te.symbolType)!==null&&x!==void 0?x:"square"},Ht.horizontal),te),{pickable:!gt&&((v=te.pickable)===null||v===void 0||v)}),"symbol"),this._endHandler=Q.createOrUpdateChild("endHandler",Object.assign(Object.assign(Object.assign({x:G.x+kt*tt,y:G.y+lt/2,size:lt,symbolType:(y=ee.symbolType)!==null&&y!==void 0?y:"square"},Ht.horizontal),ee),{pickable:!gt&&((f=ee.pickable)===null||f===void 0||f)}),"symbol");const oi=Math.max(this._startHandler.AABBBounds.width(),ni),li=Math.max(this._startHandler.AABBBounds.height(),ni),me=Math.max(this._endHandler.AABBBounds.width(),ri),ve=Math.max(this._endHandler.AABBBounds.height(),ri);this._startHandlerMask=Q.createOrUpdateChild("startHandlerMask",Object.assign(Object.assign({x:G.x+pt*tt-oi/2,y:G.y+lt/2-li/2,width:oi,height:li,fill:"white",fillOpacity:0,zIndex:999},Ht.horizontal),{pickable:!gt}),"rect"),this._endHandlerMask=Q.createOrUpdateChild("endHandlerMask",Object.assign(Object.assign({x:G.x+kt*tt-me/2,y:G.y+lt/2-ve/2,width:me,height:ve,fill:"white",fillOpacity:0,zIndex:999},Ht.horizontal),{pickable:!gt}),"rect")}else{if(ht.visible){const zt=((A=ht.background)===null||A===void 0?void 0:A.size)||10;this._middleHandlerRect=Q.createOrUpdateChild("middleHandlerRect",Object.assign(Object.assign({x:pe==="left"?G.x-zt:G.x+tt,y:G.y+pt*lt,width:zt,height:(kt-pt)*lt},(k=ht.background)===null||k===void 0?void 0:k.style),{pickable:!gt&&((D=(P=(T=ht.background)===null||T===void 0?void 0:T.style)===null||P===void 0?void 0:P.pickable)===null||D===void 0||D)}),"rect"),this._middleHandlerSymbol=Q.createOrUpdateChild("middleHandlerSymbol",Object.assign(Object.assign({x:pe==="left"?G.x-zt/2:G.x+tt+zt/2,y:G.y+(pt+kt)/2*lt,angle:Math.PI/180*90,symbolType:(E=(B=ht.icon)===null||B===void 0?void 0:B.symbolType)!==null&&E!==void 0?E:"square",strokeBoundsBuffer:0},ht.icon),{pickable:!gt&&((nt=(H=ht.icon)===null||H===void 0?void 0:H.pickable)===null||nt===void 0||nt)}),"symbol")}this._startHandler=Q.createOrUpdateChild("startHandler",Object.assign(Object.assign(Object.assign({x:G.x+tt/2,y:G.y+pt*lt,size:tt,symbolType:(Y=te.symbolType)!==null&&Y!==void 0?Y:"square"},Ht.vertical),te),{pickable:!gt&&((Z=te.pickable)===null||Z===void 0||Z)}),"symbol"),this._endHandler=Q.createOrUpdateChild("endHandler",Object.assign(Object.assign(Object.assign({x:G.x+tt/2,y:G.y+kt*lt,size:tt,symbolType:(rt=ee.symbolType)!==null&&rt!==void 0?rt:"square"},Ht.vertical),ee),{pickable:!gt&&((Jt=ee.pickable)===null||Jt===void 0||Jt)}),"symbol");const oi=Math.max(this._startHandler.AABBBounds.width(),ni),li=Math.max(this._startHandler.AABBBounds.height(),ni),me=Math.max(this._endHandler.AABBBounds.width(),ri),ve=Math.max(this._endHandler.AABBBounds.height(),ri);this._startHandlerMask=Q.createOrUpdateChild("startHandlerMask",Object.assign(Object.assign({x:G.x+tt/2+oi/2,y:G.y+pt*lt-li/2,width:ve,height:me,fill:"white",fillOpacity:0,zIndex:999},Ht.vertical),{pickable:!gt}),"rect"),this._endHandlerMask=Q.createOrUpdateChild("endHandlerMask",Object.assign(Object.assign({x:G.x+tt/2+me/2,y:G.y+kt*lt-ve/2,width:ve,height:me,fill:"white",fillOpacity:0,zIndex:999},Ht.vertical),{pickable:!gt}),"rect")}this._showText&&this.renderText()}computeBasePoints(){const{orient:t}=this.attribute,{position:e,width:i,height:s}=this.getLayoutAttrFromConfig();let a,n;return this._isHorizontal?(a=[{x:e.x,y:e.y+s}],n=[{x:e.x+i,y:e.y+s}]):t==="left"?(a=[{x:e.x+i,y:e.y}],n=[{x:e.x+i,y:e.y+s}]):(a=[{x:e.x,y:e.y+s}],n=[{x:e.x,y:e.y}]),{basePointStart:a,basePointEnd:n}}simplifyPoints(t){var e;if(t.length>1e4){const i=(e=this.attribute.tolerance)!==null&&e!==void 0?e:this._previewData.length/1e4;return Fl(t,i)}return t}getPreviewLinePoints(){let t=this._previewData.map(s=>({x:this._previewPointsX&&this._previewPointsX(s),y:this._previewPointsY&&this._previewPointsY(s)}));if(t.length===0)return t;t=this.simplifyPoints(t);const{basePointStart:e,basePointEnd:i}=this.computeBasePoints();return e.concat(t).concat(i)}getPreviewAreaPoints(){let t=this._previewData.map(s=>({x:this._previewPointsX&&this._previewPointsX(s),y:this._previewPointsY&&this._previewPointsY(s),x1:this._previewPointsX1&&this._previewPointsX1(s),y1:this._previewPointsY1&&this._previewPointsY1(s)}));if(t.length===0)return t;t=this.simplifyPoints(t);const{basePointStart:e,basePointEnd:i}=this.computeBasePoints();return e.concat(t).concat(i)}setPreviewAttributes(t,e){this._previewGroup||(this._previewGroup=e.createOrUpdateChild("previewGroup",{pickable:!1},"group")),t==="line"?this._previewLine=this._previewGroup.createOrUpdateChild("previewLine",{},"line"):this._previewArea=this._previewGroup.createOrUpdateChild("previewArea",{curveType:"basis"},"area");const{backgroundChartStyle:i={}}=this.attribute;t==="line"&&this._previewLine.setAttributes(Object.assign({points:this.getPreviewLinePoints(),curveType:"basis",pickable:!1},i.line)),t==="area"&&this._previewArea.setAttributes(Object.assign({points:this.getPreviewAreaPoints(),curveType:"basis",pickable:!1},i.area))}setSelectedPreviewAttributes(t,e){this._selectedPreviewGroupClip||(this._selectedPreviewGroupClip=e.createOrUpdateChild("selectedPreviewGroupClip",{pickable:!1},"group"),this._selectedPreviewGroup=this._selectedPreviewGroupClip.createOrUpdateChild("selectedPreviewGroup",{},"group")),t==="line"?this._selectedPreviewLine=this._selectedPreviewGroup.createOrUpdateChild("selectedPreviewLine",{},"line"):this._selectedPreviewArea=this._selectedPreviewGroup.createOrUpdateChild("selectedPreviewArea",{curveType:"basis"},"area");const{selectedBackgroundChartStyle:i={}}=this.attribute,{start:s,end:a}=this.state,{position:n,width:r,height:l}=this.getLayoutAttrFromConfig();this._selectedPreviewGroupClip.setAttributes({x:this._isHorizontal?n.x+s*r:n.x,y:this._isHorizontal?n.y:n.y+s*l,width:this._isHorizontal?(a-s)*r:r,height:this._isHorizontal?l:(a-s)*l,clip:!0,pickable:!1}),this._selectedPreviewGroup.setAttributes({x:-(this._isHorizontal?n.x+s*r:n.x),y:-(this._isHorizontal?n.y:n.y+s*l),width:this._isHorizontal?(a-s)*r:r,height:this._isHorizontal?l:(a-s)*l,pickable:!1}),t==="line"&&this._selectedPreviewLine.setAttributes(Object.assign({points:this.getPreviewLinePoints(),curveType:"basis",pickable:!1},i.line)),t==="area"&&this._selectedPreviewArea.setAttributes(Object.assign({points:this.getPreviewAreaPoints(),curveType:"basis",pickable:!1},i.area))}maybeAddLabel(t,e,i){let s=this.find(a=>a.name===i,!0);return s?s.setAttributes(e):(s=new Re(e),s.name=i),t.add(s),s}setStartAndEnd(t,e){const{start:i,end:s}=this.attribute;S(t)&&S(e)&&(t!==this.state.start||e!==this.state.end)&&(this.state.start=t,this.state.end=e,i===this.state.start&&s===this.state.end||(this.setStateAttr(t,e,!0),this._dispatchEvent("change",{start:t,end:e,tag:this._activeTag})))}setPreviewData(t){this._previewData=t}setText(t,e){e==="start"?this._startText.setAttribute("text",t):this._endText.setAttribute("text",t)}getStartValue(){return this._startValue}getEndTextValue(){return this._endValue}getMiddleHandlerSize(){var t,e,i,s;const{middleHandlerStyle:a={}}=this.attribute,n=(e=(t=a.background)===null||t===void 0?void 0:t.size)!==null&&e!==void 0?e:10,r=(s=(i=a.icon)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:10;return Math.max(n,...L(r))}setPreviewPointsX(t){R(t)&&(this._previewPointsX=t)}setPreviewPointsY(t){R(t)&&(this._previewPointsY=t)}setPreviewPointsX1(t){R(t)&&(this._previewPointsX1=t)}setPreviewPointsY1(t){R(t)&&(this._previewPointsY1=t)}setStatePointToData(t){R(t)&&(this._statePointToData=t)}};Jn.defaultAttributes=fh;var as;(function(o){o.start="start",o.startTop="startTop",o.startBottom="startBottom",o.insideStart="insideStart",o.insideStartTop="insideStartTop",o.insideStartBottom="insideStartBottom",o.middle="middle",o.insideMiddleTop="insideMiddleTop",o.insideMiddleBottom="insideMiddleBottom",o.end="end",o.endTop="endTop",o.endBottom="endBottom",o.insideEnd="insideEnd",o.insideEndTop="insideEndTop",o.insideEndBottom="insideEndBottom"})(as||(as={}));var ns;(function(o){o.left="left",o.right="right",o.top="top",o.bottom="bottom",o.middle="middle",o.insideLeft="insideLeft",o.insideRight="insideRight",o.insideTop="insideTop",o.insideBottom="insideBottom"})(ns||(ns={}));var yi;(function(o){o.arcInnerStart="arcInnerStart",o.arcInnerEnd="arcInnerEnd",o.arcInnerMiddle="arcInnerMiddle",o.arcOuterStart="arcOuterStart",o.arcOuterEnd="arcOuterEnd",o.arcOuterMiddle="arcOuterMiddle",o.center="center"})(yi||(yi={}));var rs;(function(o){o.top="top",o.bottom="bottom",o.middle="middle",o.insideTop="insideTop",o.insideBottom="insideBottom",o.insideMiddle="insideMiddle"})(rs||(rs={}));function xs(){Qt(),dn()}function kh(){xs(),ys()}function Mh(){xs(),cs()}function Th(){xs(),ys(),Hn(),Ri(),ho(),Ee()}class fs extends ge{constructor(){super(...arguments),this.name="marker",this._onHover=t=>{this._lastHover=Xn(t,this._container,this._lastHover)},this._onUnHover=t=>{this._lastHover=Yn(t,this._container,this._lastHover)},this._onClick=t=>{this._lastSelect=Gn(t,this._container,this._lastSelect)}}transAnimationConfig(){var t,e,i;if(this.attribute.animation!==!1){const s=ei(this.attribute.animation)?this.attribute.animation:{};this._animationConfig={enter:M({},this.defaultUpdateAnimation,s,(t=this.attribute.animationEnter)!==null&&t!==void 0?t:{}),exit:M({},this.defaultExitAnimation,s,(e=this.attribute.animationExit)!==null&&e!==void 0?e:{}),update:M({},this.defaultUpdateAnimation,s,(i=this.attribute.animationUpdate)!==null&&i!==void 0?i:{})}}}setAttribute(t,e,i){super.setAttribute(t,e,i),t==="visible"&&this.render()}_bindEvent(){var t,e,i;if(!this.attribute.interactive)return;const{hover:s,select:a}=this.attribute;s&&((t=this._container)===null||t===void 0||t.addEventListener("pointermove",this._onHover),(e=this._container)===null||e===void 0||e.addEventListener("pointerout",this._onUnHover)),a&&((i=this._container)===null||i===void 0||i.addEventListener("pointerdown",this._onClick))}_releaseEvent(){var t,e,i;(t=this._container)===null||t===void 0||t.removeEventListener("pointermove",this._onHover),(e=this._container)===null||e===void 0||e.removeEventListener("pointerout",this._onUnHover),(i=this._container)===null||i===void 0||i.removeEventListener("pointerdown",this._onClick)}_initContainer(){var t,e;const{limitRect:i={},clipInRange:s}=this.attribute;let a;if(s){const n=U.group(Object.assign(Object.assign({},i),{clip:!0,pickable:!1}));a=U.group({x:-((t=i.x)!==null&&t!==void 0?t:0),y:-((e=i.y)!==null&&e!==void 0?e:0),pickable:!1}),n.add(a),this._containerClip=n,this.add(n)}else a=U.group({x:0,y:0,pickable:!1}),this.add(a);a.name="marker-container",this._container=a}_updateContainer(){var t,e;const{limitRect:i={},clipInRange:s}=this.attribute;this._containerClip&&this._containerClip.setAttributes(Object.assign({},i)),this._container.setAttributes({x:s?-((t=i.x)!==null&&t!==void 0?t:0):0,y:s?-((e=i.y)!==null&&e!==void 0?e:0):0})}render(){var t;this.transAnimationConfig(),this.setAttribute("pickable",!1);const e=(t=this.attribute.visible)===null||t===void 0||t;this.attribute.interactive===!1&&this.setAttribute("childrenPickable",!1),e&&this.isValidPoints()?this._container?(this._updateContainer(),this.updateMarker(),this.markerAnimate("update")):(this._initContainer(),this.initMarker(this._container),this.markerAnimate("enter")):(this.markerAnimate("exit"),this._container=null,this.removeAllChild(!0)),this._releaseEvent(),this._bindEvent()}release(){this.markerAnimate("exit"),super.release(),this._releaseEvent(),this._container=null}}function st(o,t,e,i){var s,a,n,r,l;if(!o)return;(s=o==null?void 0:o.animates)===null||s===void 0||s.forEach(c=>c.stop("end"));const h=(n=(a=o.attribute)===null||a===void 0?void 0:a.fillOpacity)!==null&&n!==void 0?n:1,d=(l=(r=o.attribute)===null||r===void 0?void 0:r.strokeOpacity)!==null&&l!==void 0?l:1;o.setAttributes({fillOpacity:0,strokeOpacity:0}),o.animate().wait(t).to({fillOpacity:h,strokeOpacity:d},e,i)}function er(o,t,e,i){o&&(st(o.startSymbol,t,e,i),o.lines.forEach(s=>st(s,t,e,i)),st(o.line,t,e,i),st(o.endSymbol,t,e,i))}function Ss(o,t,e,i){o&&(st(o.getTextShape(),t,e,i),st(o.getBgRect(),t,e,i))}function Rt(o,t,e,i){var s,a,n,r;o&&(o.setAttributes({fillOpacity:(a=(s=o.attribute)===null||s===void 0?void 0:s.fillOpacity)!==null&&a!==void 0?a:1,strokeOpacity:(r=(n=o.attribute)===null||n===void 0?void 0:n.strokeOpacity)!==null&&r!==void 0?r:1}),o.animate().wait(t).to({fillOpacity:0,strokeOpacity:0},e,i))}function ir(o,t,e,i){o&&(Rt(o.startSymbol,t,e,i),o.lines.forEach(s=>Rt(s,t,e,i)),Rt(o.line,t,e,i),Rt(o.endSymbol,t,e,i))}function As(o,t,e,i){o&&(Rt(o.getTextShape(),t,e,i),Rt(o.getBgRect(),t,e,i))}function Ta(o,t,e,i,s){const a=.1*e,n=.7*e,r=.1*e,l=.1*e;st(o.startSymbol,i,a,s),o.lines.forEach(h=>h.setAttribute("clipRange",0)),o.lines.forEach((h,d)=>{const c=n/o.lines.length;h.animate().wait(i+a+d*c).to({clipRange:1},c,s)}),st(o.endSymbol,i+a+n,r,s),st(t.getTextShape(),i+a+n+r,l,s),st(t.getBgRect(),i+a+n+r,l,s)}function Ca(o,t,e,i,s){er(o,i,e,s),Ss(t,i,e,s)}function Ba(o,t,e,i,s){st(o,i,e,s),Ss(t,i,e,s)}function Pa(o,t,e,i,s,a){var n;er(o,s,i,a),st(t,s,i,a),!((n=e.getTextShape)===null||n===void 0)&&n.call(e)?Ss(e,s,i,a):st(e,s,i,a)}function Ch(o,t,e,i,s){ir(o,i,e,s),As(t,i,e,s)}function Bh(o,t,e,i,s){Rt(o,i,e,s),As(t,i,e,s)}function Ph(o,t,e,i,s,a){var n;ir(o,s,i,a),Rt(t,s,i,a),!((n=e.getTextShape)===null||n===void 0)&&n.call(e)?As(e,s,i,a):Rt(e,s,i,a)}function La(o,t,e,i,s,a){var n;const r=.1*i,l=.65*i,h=.05*i,d=.1*i,c=.1*i;st(o.startSymbol,s,r,a),o.lines.forEach(u=>u.setAttribute("clipRange",0)),o.lines.forEach((u,g)=>{const _=l/o.lines.length;u.animate().wait(s+r+g*_).to({clipRange:1},_,a)}),st(t,s+r+l,h,a),st(o.endSymbol,s+r+l+h,d,a),!((n=e.getTextShape)===null||n===void 0)&&n.call(e)?(st(e.getTextShape(),s+r+l+h+d,c,a),st(e.getBgRect(),s+r+l+d,c,a)):st(e,s+r+l+d,c,a)}function Lh(o,t,e,i){const{enter:s,update:a,exit:n}=e;if(i==="enter"){const{type:r,duration:l,delay:h,easing:d}=s;r==="clipIn"?Ta(o,t,l,h,d):r==="fadeIn"&&Ca(o,t,l,h,d)}else if(i==="update"){const{type:r,duration:l,delay:h,easing:d}=a;r==="clipIn"?Ta(o,t,l,h,d):r==="fadeIn"&&Ca(o,t,l,h,d)}else if(i==="exit"){const{duration:r,delay:l,easing:h}=n;Ch(o,t,r,l,h)}}function Dh(o,t,e,i){const{enter:s,update:a,exit:n}=e;if(i==="enter"){const{type:r,duration:l,delay:h,easing:d}=s;r==="fadeIn"&&Ba(o,t,l,h,d)}else if(i==="update"){const{type:r,duration:l,delay:h,easing:d}=a;r==="fadeIn"&&Ba(o,t,l,h,d)}else if(i==="exit"){const{duration:r,delay:l,easing:h}=n;Bh(o,t,r,l,h)}}function Oh(o,t,e,i){const[s,a]=o,{enter:n,update:r,exit:l}=e;if(i==="enter"){const{type:h,duration:d,delay:c,easing:u}=n;h==="fadeIn"?Pa(s,a,t,d,c,u):h==="callIn"&&La(s,a,t,d,c,u)}else if(i==="update"){const{type:h,duration:d,delay:c,easing:u}=r;h==="fadeIn"?Pa(s,a,t,d,c,u):h==="callIn"&&La(s,a,t,d,c,u)}else if(i==="exit"){const{duration:h,delay:d,easing:c}=l;Ph(s,a,t,h,d,c)}}const Eh={type:"clipIn",duration:500,easing:"linear",delay:0},Rh={type:"fadeIn",duration:500,easing:"linear",delay:0},Ih={type:"callIn",duration:500,easing:"linear",delay:0},ks={type:"fadeOut",duration:500,easing:"linear",delay:0};class wh extends fs{constructor(){super(...arguments),this.name="markCommonLine",this.defaultUpdateAnimation=Eh,this.defaultExitAnimation=ks}getLine(){return this._line}getLabel(){return this._label}setLabelPos(){const{label:t={},limitRect:e}=this.attribute,{position:i,confine:s,autoRotate:a}=t,n=this.getPointAttrByPosition(i),r=i.toString().toLocaleLowerCase().includes("start")?this._line.getStartAngle()||0:this._line.getEndAngle()||0;if(this._label.setAttributes(Object.assign(Object.assign({},n.position),{angle:a?this.getRotateByAngle(n.angle):0,textStyle:Object.assign(Object.assign({},this.getTextStyle(i,r,a)),t.textStyle)})),e&&s){const{x:l,y:h,width:d,height:c}=e;zn(this._label,{x1:l,y1:h,x2:l+d,y2:h+c})}}initMarker(t){const{label:e,state:i}=this.attribute,s=this.createSegment();s.name="mark-common-line-line",this._line=s,t.add(s);const a=new Re(Object.assign(Object.assign({},e),{state:{panel:M({},w,i==null?void 0:i.labelBackground),text:M({},w,i==null?void 0:i.label)}}));a.name="mark-common-line-label",this._label=a,t.add(a),this.setLabelPos()}updateMarker(){const{label:t,state:e}=this.attribute;this.setLineAttributes(),this._label&&(this._label.setAttributes(Object.assign(Object.assign({dx:0,dy:0},t),{state:{panel:M({},w,e==null?void 0:e.labelBackground),text:M({},w,e==null?void 0:e.label)}})),this.setLabelPos())}}const Tt=.001,zh={interactive:!0,startSymbol:{visible:!1,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},endSymbol:{visible:!0,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},label:{position:as.end,refX:0,refY:0,refAngle:0,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}},Da={postiveXAxis:{start:{textAlign:"left",textBaseline:"middle"},startTop:{textAlign:"left",textBaseline:"bottom"},startBottom:{textAlign:"left",textBaseline:"top"},insideStart:{textAlign:"right",textBaseline:"middle"},insideStartTop:{textAlign:"right",textBaseline:"bottom"},insideStartBottom:{textAlign:"right",textBaseline:"top"},middle:{textAlign:"center",textBaseline:"middle"},insideMiddleTop:{textAlign:"center",textBaseline:"bottom"},insideMiddleBottom:{textAlign:"center",textBaseline:"top"},end:{textAlign:"left",textBaseline:"middle"},endTop:{textAlign:"left",textBaseline:"bottom"},endBottom:{textAlign:"left",textBaseline:"top"},insideEnd:{textAlign:"right",textBaseline:"middle"},insideEndTop:{textAlign:"right",textBaseline:"bottom"},insideEndBottom:{textAlign:"right",textBaseline:"top"}},negativeXAxis:{start:{textAlign:"right",textBaseline:"middle"},startTop:{textAlign:"right",textBaseline:"bottom"},startBottom:{textAlign:"right",textBaseline:"top"},insideStart:{textAlign:"left",textBaseline:"middle"},insideStartTop:{textAlign:"left",textBaseline:"bottom"},insideStartBottom:{textAlign:"left",textBaseline:"top"},middle:{textAlign:"center",textBaseline:"middle"},insideMiddleTop:{textAlign:"center",textBaseline:"bottom"},insideMiddleBottom:{textAlign:"center",textBaseline:"top"},end:{textAlign:"right",textBaseline:"middle"},endTop:{textAlign:"right",textBaseline:"bottom"},endBottom:{textAlign:"right",textBaseline:"top"},insideEnd:{textAlign:"left",textBaseline:"middle"},insideEndTop:{textAlign:"left",textBaseline:"bottom"},insideEndBottom:{textAlign:"left",textBaseline:"top"}}};yi.arcOuterMiddle;const Fh={interactive:!0,label:{position:ns.right,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},areaStyle:{fill:"#b2bacf",visible:!0}};yi.arcOuterMiddle;const Hh={left:{textAlign:"right",textBaseline:"middle"},insideLeft:{textAlign:"left",textBaseline:"middle"},right:{textAlign:"left",textBaseline:"middle"},insideRight:{textAlign:"right",textBaseline:"middle"},top:{textAlign:"center",textBaseline:"bottom"},insideTop:{textAlign:"center",textBaseline:"top"},bottom:{textAlign:"center",textBaseline:"top"},insideBottom:{textAlign:"center",textBaseline:"bottom"},middle:{textAlign:"center",textBaseline:"middle"}},Vh={interactive:!0,targetSymbol:{visible:!1,offset:0,style:{symbolType:"circle",size:20,fill:!1,stroke:"rgba(46, 47, 50)"}},itemLine:{visible:!0,decorativeLine:{visible:!1,length:30},startSymbol:{visible:!0,clip:!0,symbolType:"circle",size:20,style:{fill:!1,stroke:"rgba(46, 47, 50)"}},endSymbol:{visible:!1,clip:!0,symbolType:"triangle",size:12,style:{fill:!1,stroke:"rgba(46, 47, 50)"}},lineStyle:{stroke:"#000",lineWidth:1}},itemContent:{type:"text",position:"middle",refX:10,symbolStyle:{symbolType:"star",fill:"rgb(48, 115, 242)",fillOpacity:.8,size:20},textStyle:{dx:0,dy:0},imageStyle:{width:80,height:80},richTextStyle:{width:100,height:100}}},Oa={postiveXAxis:{top:{textAlign:"left",textBaseline:"bottom"},bottom:{textAlign:"left",textBaseline:"top"},middle:{textAlign:"left",textBaseline:"middle"},insideTop:{textAlign:"right",textBaseline:"bottom"},insideBottom:{textAlign:"right",textBaseline:"top"},insideMiddle:{textAlign:"right",textBaseline:"middle"}},negativeXAxis:{top:{textAlign:"right",textBaseline:"bottom"},bottom:{textAlign:"right",textBaseline:"top"},middle:{textAlign:"right",textBaseline:"middle"},insideTop:{textAlign:"left",textBaseline:"bottom"},insideBottom:{textAlign:"left",textBaseline:"top"},insideMiddle:{textAlign:"left",textBaseline:"middle"}}};kh();function jh(){he._animate=Lh}class he extends wh{markerAnimate(t){he._animate&&this._animationConfig&&he._animate(this._line,this._label,this._animationConfig,t)}constructor(t,e){super(e!=null&&e.skipDefault?t:M({},he.defaultAttributes,t)),this.name="markLine"}getPointAttrByPosition(t){var e;const{label:i={}}=this.attribute,{refX:s=0,refY:a=0}=i,n=this._line.getMainSegmentPoints(),r=(e=this._line.getEndAngle())!==null&&e!==void 0?e:0,l=r,h=s*Math.cos(l)+a*Math.cos(l-Math.PI/2),d=s*Math.sin(l)+a*Math.sin(l-Math.PI/2);return t.includes("start")||t.includes("Start")?{position:{x:n[0].x+h,y:n[0].y+d},angle:l}:t.includes("middle")||t.includes("Middle")?{position:{x:(n[0].x+n[n.length-1].x)/2+h,y:(n[0].y+n[n.length-1].y)/2+d},angle:l}:{position:{x:n[n.length-1].x+h,y:n[n.length-1].y+d},angle:l}}getRotateByAngle(t){var e;return(pi(t)?t:t-Math.PI)+((e=this.attribute.label.refAngle)!==null&&e!==void 0?e:0)}getTextStyle(t,e,i){return Mt(Math.abs(e),Math.PI/2,Tt)||Mt(Math.abs(e),3*Math.PI/2,Tt)?un(i,e,t):pi(e)?Da.postiveXAxis[t]:Da.negativeXAxis[t]}createSegment(){const{points:t,startSymbol:e,endSymbol:i,lineStyle:s,mainSegmentIndex:a,multiSegment:n,state:r}=this.attribute;return new wt({points:t,startSymbol:e,endSymbol:i,lineStyle:s,mainSegmentIndex:a,multiSegment:n,pickable:!1,state:{line:M({},w,r==null?void 0:r.line),startSymbol:M({},w,r==null?void 0:r.lineStartSymbol),endSymbol:M({},w,r==null?void 0:r.lineEndSymbol)}})}setLineAttributes(){const{points:t,startSymbol:e,endSymbol:i,lineStyle:s,mainSegmentIndex:a,multiSegment:n,state:r}=this.attribute;this._line&&this._line.setAttributes({points:t,startSymbol:e,endSymbol:i,lineStyle:s,mainSegmentIndex:a,multiSegment:n,state:{line:M({},w,r==null?void 0:r.line),startSymbol:M({},w,r==null?void 0:r.lineStartSymbol),endSymbol:M({},w,r==null?void 0:r.lineEndSymbol)}})}isValidPoints(){const{points:t}=this.attribute;if(!t||t.length<2)return!1;let e=!0;return t.forEach(i=>{if(i.length)i.forEach(s=>{O(s.x)&&O(s.y)||(e=!1)});else if(!O(i.x)||!O(i.y))return void(e=!1)}),e}}he.defaultAttributes=zh;Mh();function Xh(){de._animate=Dh}class de extends fs{markerAnimate(t){de._animate&&this._animationConfig&&de._animate(this._area,this._label,this._animationConfig,t)}getArea(){return this._area}getLabel(){return this._label}constructor(t,e){super(e!=null&&e.skipDefault?t:M({},de.defaultAttributes,t)),this.name="markArea",this.defaultUpdateAnimation=Rh,this.defaultExitAnimation=ks}getPointAttrByPosition(t){const{x1:e,x2:i,y1:s,y2:a}=this._area.AABBBounds;return t.includes("left")||t.includes("Left")?{x:e,y:(s+a)/2}:t.includes("right")||t.includes("Right")?{x:i,y:(s+a)/2}:t.includes("top")||t.includes("Top")?{x:(e+i)/2,y:s}:t.includes("bottom")||t.includes("Bottom")?{x:(e+i)/2,y:a}:{x:(e+i)/2,y:(s+a)/2}}setLabelPos(){var t;if(this._label&&this._area){const{label:e={}}=this.attribute,i=(t=e.position)!==null&&t!==void 0?t:"middle",s=this.getPointAttrByPosition(i);if(this._label.setAttributes(Object.assign(Object.assign({},s),{textStyle:Object.assign(Object.assign({},Hh[i]),e.textStyle)})),this.attribute.limitRect&&e.confine){const{x:a,y:n,width:r,height:l}=this.attribute.limitRect;zn(this._label,{x1:a,y1:n,x2:a+r,y2:n+l})}}}initMarker(t){const{points:e,label:i,areaStyle:s,state:a}=this.attribute,n=U.polygon(Object.assign({points:e},s));n.states=M({},w,a==null?void 0:a.area),n.name="mark-area-polygon",this._area=n,t.add(n);const r=new Re(Object.assign(Object.assign({},i),{state:{panel:M({},w,a==null?void 0:a.labelBackground),text:M({},w,a==null?void 0:a.label)}}));r.name="mark-area-label",this._label=r,t.add(r),this.setLabelPos()}updateMarker(){const{points:t,label:e,areaStyle:i,state:s}=this.attribute;this._area&&(this._area.setAttributes(Object.assign({points:t},i)),this._area.states=M({},w,s==null?void 0:s.area)),this._label&&this._label.setAttributes(Object.assign(Object.assign({dx:0,dy:0},e),{state:{panel:M({},w,s==null?void 0:s.labelBackground),text:M({},w,s==null?void 0:s.label)}})),this.setLabelPos()}isValidPoints(){const{points:t}=this.attribute;if(!t||t.length<3)return!1;let e=!0;return t.forEach(i=>{O(i.x)&&O(i.y)||(e=!1)}),e}}de.defaultAttributes=Fh;Th();function Yh(){ce._animate=Oh}class ce extends fs{markerAnimate(t){ce._animate&&this._animationConfig&&ce._animate([this._line,this._decorativeLine],this._item,this._animationConfig,t)}constructor(t,e){super(e!=null&&e.skipDefault?t:M({},ce.defaultAttributes,t)),this.name="markPoint",this.defaultUpdateAnimation=Ih,this.defaultExitAnimation=ks,this._isArcLine=!1,this._isStraightLine=!1}setLabelPos(){}getTextAlignAttr(t,e,i,s,a){return Mt(Math.abs(s),Math.PI/2,Tt)||Mt(Math.abs(s),3*Math.PI/2,Tt)?un(t,s,a):pi(s)?Oa.postiveXAxis[a]:Oa.negativeXAxis[a]}setItemAttributes(t,e,i,s,a){var n,r;if(!t)return;const{autoRotate:l=!0,refX:h=0,refY:d=0,refAngle:c=0,textStyle:u={},richTextStyle:g={},imageStyle:_={},position:p=rs.middle}=e,{state:m}=this.attribute,b=((n=this._line)===null||n===void 0?void 0:n.getEndAngle())||0,x=h*Math.cos(b)+d*Math.cos(b-Math.PI/2),v=h*Math.sin(b)+d*Math.sin(b-Math.PI/2);if(a==="text"){const f=s.x-i.x,A=s.y-i.y;t.setAttributes(Object.assign(Object.assign({},u),{textStyle:Object.assign(Object.assign({},this.getTextAlignAttr(l,f,A,b,(r=e.position)!==null&&r!==void 0?r:"end")),u.textStyle),state:{panel:M({},w,m==null?void 0:m.textBackground),text:M({},w,m==null?void 0:m.text)}}))}else a==="richText"?(t.setAttributes({dx:this.getItemDx(t,p,g)+(g.dx||0),dy:this.getItemDy(t,p,g)+(g.dy||0)}),t.states=M({},w,m==null?void 0:m.richText)):a==="image"&&(t.setAttributes({dx:this.getItemDx(t,p,_)+(_.dx||0),dy:this.getItemDy(t,p,_)+(_.dy||0)}),t.states=M({},w,m==null?void 0:m.image));const y=pi(b)?b:b-Math.PI;t.setAttributes({x:s.x+(x||0),y:s.y+(v||0),angle:l&&y+c})}getItemDx(t,e,i){var s,a;const n=(a=(s=t==null?void 0:t.AABBBounds)===null||s===void 0?void 0:s.width())!==null&&a!==void 0?a:(i==null?void 0:i.width)||0;return e.includes("inside")?-n:0}getItemDy(t,e,i){var s,a;const n=(a=(s=t==null?void 0:t.AABBBounds)===null||s===void 0?void 0:s.height())!==null&&a!==void 0?a:(i==null?void 0:i.height)||0;return e.includes("top")||e.includes("Top")?-n:e.includes("middle")||e.includes("Middle")?-n/2:0}initItem(t,e,i){const{state:s}=this.attribute,{type:a="text",symbolStyle:n,richTextStyle:r,imageStyle:l,renderCustomCallback:h}=t;let d;return a==="symbol"?(d=U.symbol(Object.assign(Object.assign({},i),n)),d.states=M({},w,s==null?void 0:s.symbol)):a==="text"?d=new Re(Object.assign(Object.assign({},i),{state:{panel:M({},w,s==null?void 0:s.textBackground),text:M({},w,s==null?void 0:s.text)}})):a==="richText"?(d=U.richtext(Object.assign(Object.assign({},i),r)),d.states=M({},w,s==null?void 0:s.richText)):a==="image"?(d=U.image(Object.assign(Object.assign({},i),l)),d.states=M({},w,s==null?void 0:s.image)):a==="custom"&&h&&(d=h(),d.states=M({},w,s==null?void 0:s.customMark)),d.name=`mark-point-${a}`,this.setItemAttributes(d,t,e,i,a),d}getItemLineAttr(t,e,i){let s=[],a={x:0,y:0},n=0,r=0,l=0;const{type:h="type-s",arcRatio:d=.8}=t,c=i.x-e.x,u=i.y-e.y;if(this._isStraightLine=Mt(c,0,Tt)||Mt(u,0,Tt),this._isArcLine){const{x:g,y:_}=e,{x:p,y:m}=i,b=(g+p)/2,x=(_+m)/2,v=_===m?0:-(g-p)/(_-m),y=b+d*(m>_?-1:1)*b,f=(A=>v*(A-b)+x)(y);r=qi(_-f,g-y),l=qi(m-f,p-y),a={x:y,y:f},d>0?l<r&&(l+=2*Math.PI):r<l&&(r+=2*Math.PI),n=Math.sqrt((y-g)*(y-g)+(f-_)*(f-_))}else s=h!=="type-do"||this._isStraightLine?h!=="type-po"||this._isStraightLine?h!=="type-op"||this._isStraightLine?[e,i]:[e,{x:e.x,y:i.y},i]:[e,{x:i.x,y:e.y},i]:[e,{x:(e.x+i.x)/2,y:i.y},i];return s=co(s),{points:s,center:a,radius:n,startAngle:r,endAngle:l}}reDrawLine(t,e){this._line.release();const{startSymbol:i,endSymbol:s,lineStyle:a,type:n="type-s"}=t,{state:r}=this.attribute,l=this._isArcLine?ca:wt;this._container.removeChild(this._line),this._line=new l(Object.assign(Object.assign({},e),{pickable:!1,startSymbol:i,endSymbol:s,lineStyle:a,visible:t.visible,state:{line:M({},w,r==null?void 0:r.line),startSymbol:M({},w,r==null?void 0:r.lineStartSymbol),endSymbol:M({},w,r==null?void 0:r.lineEndSymbol)}})),this._container.add(this._line)}setItemLineAttr(t,e,i){if(this._line){const{startSymbol:s,endSymbol:a,lineStyle:n,type:r="type-s"}=t,{state:l}=this.attribute,h=this.getItemLineAttr(t,e,i);this._isArcLine&&this._line.key==="arc-segment"||!this._isArcLine&&this._line.key==="segment"?this._line.setAttributes(Object.assign(Object.assign({},h),{startSymbol:s,endSymbol:a,lineStyle:n,visible:t.visible,state:{line:M({},w,l==null?void 0:l.line),startSymbol:M({},w,l==null?void 0:l.lineStartSymbol),endSymbol:M({},w,l==null?void 0:l.lineEndSymbol)}})):this.reDrawLine(t,h)}}getDecorativeLineAttr(t){var e;const i=((e=t==null?void 0:t.decorativeLine)===null||e===void 0?void 0:e.length)||10,s=this._line.getEndAngle()||0;return{startPointOffsetX:i/2*Math.cos(s-Math.PI/2),startPointOffsetY:i/2*Math.sin(s-Math.PI/2),endPointOffsetX:-i/2*Math.cos(s-Math.PI/2),endPointOffsetY:-i/2*Math.sin(s-Math.PI/2)}}setDecorativeLineAttr(t,e,i){var s;if(this._decorativeLine){const{lineStyle:a}=t,{startPointOffsetX:n,startPointOffsetY:r,endPointOffsetX:l,endPointOffsetY:h}=this.getDecorativeLineAttr(t);this._decorativeLine.setAttributes(Object.assign(Object.assign({points:[{x:e.x+n,y:e.y+r},{x:e.x+l,y:e.y+h}]},a),{visible:i})),this._decorativeLine.states=M({},w,(s=this.attribute.state)===null||s===void 0?void 0:s.line)}}setTargetItemAttributes(t,e){var i,s;this._targetItem&&(this._targetItem.setAttributes(Object.assign({x:e.x,y:e.y,visible:(i=t.visible)!==null&&i!==void 0&&i,size:t.size},t.style)),this._targetItem.states=M({},w,(s=this.attribute.state)===null||s===void 0?void 0:s.targetItem))}setAllOfItemsAttr(t,e){var i;const{position:s,itemLine:a={},itemContent:n={},limitRect:r,targetSymbol:l}=this.attribute,{type:h="text",confine:d}=n;if(r&&d){const{x:c,y:u,width:g,height:_}=r,{dx:p,dy:m}=wn(this._item,{x1:c,y1:u,x2:c+g,y2:u+_});e.x=e.x+p,e.y=e.y+m}this.setTargetItemAttributes(l,s),this.setItemLineAttr(a,t,e),this.setItemAttributes(this._item,n,t,e,h),this.setDecorativeLineAttr(a,e,(i=a.decorativeLine)===null||i===void 0?void 0:i.visible)}computeNewPositionAfterTargetItem(t){var e,i;const{itemContent:s={},targetSymbol:a}=this.attribute,{offsetX:n=0,offsetY:r=0}=s,{offset:l=0,style:h,visible:d=!1,size:c}=a,u=d?(i=(e=h.size)!==null&&e!==void 0?e:c)!==null&&i!==void 0?i:20:0,g=qi(r,n);return{newPosition:{x:t.x+(u/2+l)*Math.cos(g),y:t.y+(u/2+l)*Math.sin(g)},newItemPosition:{x:t.x+(u/2+l)*Math.cos(g)+n,y:t.y+(u/2+l)*Math.sin(g)+r}}}initMarker(t){const{position:e,itemContent:i={},itemLine:s}=this.attribute,{type:a="type-s",arcRatio:n=.8}=s,{offsetX:r=0,offsetY:l=0}=i;this._isStraightLine=Mt(r,0,Tt)||Mt(l,0,Tt),this._isArcLine=a==="type-arc"&&n!==0&&!this._isStraightLine;const{newPosition:h,newItemPosition:d}=this.computeNewPositionAfterTargetItem(e),c=new(this._isArcLine?ca:wt)({points:[],pickable:!1,center:{x:0,y:0},radius:0,startAngle:0,endAngle:0});c.name="mark-point-line",this._line=c,t.add(c);const u=U.line({points:[]});u.name="mark-point-decorativeLine",this._decorativeLine=u,t.add(u);const g=U.symbol({});g.name="mark-point-targetItem",this._targetItem=g,t.add(this._targetItem);const _=this.initItem(i,h,d);this._item=_,t.add(_),this.setAllOfItemsAttr(h,d)}updateMarker(){const{position:t,itemContent:e={},itemLine:i}=this.attribute,{type:s="text"}=e,{type:a="type-s",arcRatio:n=.8}=i,{offsetX:r=0,offsetY:l=0}=e;this._isStraightLine=Mt(r,0,Tt)||Mt(l,0,Tt);const h=a==="type-arc"&&n!==0&&!this._isStraightLine,{newPosition:d,newItemPosition:c}=this.computeNewPositionAfterTargetItem(t);h!==this._isArcLine?(this._isArcLine=h,this.reDrawLine(i,{points:[{x:0,y:0}],pickable:!1,center:{x:0,y:0},radius:0,startAngle:0,endAngle:0})):this._isArcLine=h,this.setItemAttributes(this._item,e,d,c,s),this.setAllOfItemsAttr(d,c)}isValidPoints(){const{position:t}=this.attribute;return!(!O(t.x)||!O(t.y))}}ce.defaultAttributes=Vh;var ut;(function(o){o.drawStart="drawStart",o.drawEnd="drawEnd",o.drawing="drawing",o.moving="moving",o.moveStart="moveStart",o.moveEnd="moveEnd",o.brushClear="brushClear"})(ut||(ut={}));const Ot={trigger:"pointerdown",updateTrigger:"pointermove",endTrigger:"pointerup",resetTrigger:"pointerupoutside",hasMask:!0,brushMode:"single",brushType:"rect",brushStyle:{fill:"#B0C8F9",fillOpacity:.2,stroke:"#B0C8F9",strokeWidth:2},brushMoved:!0,removeOnClick:!0,delayType:"throttle",delayTime:10,interactiveRange:{y1:-1/0,y2:1/0,x1:-1/0,x2:1/0}},Gh=5;function Uh(){Qt(),cs()}const Zh={debounce:gs,throttle:Ii};Uh();let sr=class ar extends ge{constructor(t,e){super(e!=null&&e.skipDefault?t:M({},ar.defaultAttributes,t)),this.name="brush",this._activeDrawState=!1,this._cacheDrawPoints=[],this._isDrawedBeforeEnd=!1,this._activeMoveState=!1,this._operatingMaskMoveDx=0,this._operatingMaskMoveDy=0,this._operatingMaskMoveRangeX=[-1/0,1/0],this._operatingMaskMoveRangeY=[-1/0,1/0],this._brushMaskAABBBoundsDict={},this._onBrushStart=i=>{var s;if(this._outOfInteractiveRange(i))return;i.stopPropagation();const a=(s=this.attribute.brushMoved)===null||s===void 0||s;this._activeMoveState=a&&this._isPosInBrushMask(i),this._activeDrawState=!this._activeMoveState,this._activeDrawState&&this._initDraw(i),this._activeMoveState&&this._initMove(i)},this._onBrushing=i=>{this._outOfInteractiveRange(i)||((this._activeDrawState||this._activeMoveState)&&i.stopPropagation(),this._activeDrawState&&this._drawing(i),this._activeMoveState&&this._moving(i))},this._onBrushingWithDelay=this.attribute.delayTime===0?this._onBrushing:Zh[this.attribute.delayType](this._onBrushing,this.attribute.delayTime),this._onBrushEnd=i=>{var s;if(!this._activeDrawState&&!this._activeMoveState)return;i.preventDefault();const{removeOnClick:a=!0}=this.attribute;this._activeDrawState&&!this._isDrawedBeforeEnd&&a?(!((s=this._operatingMask)===null||s===void 0)&&s._AABBBounds.empty()&&this._dispatchEvent(ut.brushClear,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:i}),this._container.incrementalClearChild(),this._brushMaskAABBBoundsDict={}):(this._activeDrawState&&this._dispatchEvent(ut.drawEnd,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:i}),this._activeMoveState&&this._dispatchEvent(ut.moveEnd,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:i})),this._activeDrawState=!1,this._activeMoveState=!1,this._isDrawedBeforeEnd=!1,this._operatingMask&&this._operatingMask.setAttribute("pickable",!1)}}_bindBrushEvents(){if(this.attribute.disableTriggerEvent)return;const{trigger:t=Ot.trigger,updateTrigger:e=Ot.updateTrigger,endTrigger:i=Ot.endTrigger,resetTrigger:s=Ot.resetTrigger}=this.attribute;this.stage.addEventListener(t,this._onBrushStart),this.stage.addEventListener(e,this._onBrushingWithDelay),this.stage.addEventListener(i,this._onBrushEnd),this.stage.addEventListener(s,this._onBrushEnd)}_isPosInBrushMask(t){const e=this.eventPosToStagePos(t),i=this._container.getChildren();for(let s=0;s<i.length;s++){const{points:a=[],dx:n=0,dy:r=0}=i[s].attribute,l=a.map(h=>({x:h.x+n,y:h.y+r}));if(In(l,e.x,e.y))return this._operatingMask=i[s],!0}return!1}_initDraw(t){const{brushMode:e}=this.attribute,i=this.eventPosToStagePos(t);this._cacheDrawPoints=[i],this._isDrawedBeforeEnd=!1,e==="single"&&(this._brushMaskAABBBoundsDict={},this._container.incrementalClearChild()),this._addBrushMask(),this._dispatchEvent(ut.drawStart,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:t})}_initMove(t){var e,i;this._cacheMovePoint=this.eventPosToStagePos(t),this._operatingMaskMoveDx=(e=this._operatingMask.attribute.dx)!==null&&e!==void 0?e:0,this._operatingMaskMoveDy=(i=this._operatingMask.attribute.dy)!==null&&i!==void 0?i:0;const{interactiveRange:s}=this.attribute,{minY:a=-1/0,maxY:n=1/0,minX:r=-1/0,maxX:l=1/0}=s,{x1:h,x2:d,y1:c,y2:u}=this._operatingMask.globalAABBBounds,g=r-h,_=l-d,p=a-c,m=n-u;this._operatingMaskMoveRangeX=[g,_],this._operatingMaskMoveRangeY=[p,m],this._operatingMask.setAttribute("pickable",!0),this._dispatchEvent(ut.moveStart,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:t})}_drawing(t){var e,i;const s=this.eventPosToStagePos(t),{sizeThreshold:a=Gh,brushType:n}=this.attribute,r=this._cacheDrawPoints.length;if(r>0){const g=(e=this._cacheDrawPoints[this._cacheDrawPoints.length-1])!==null&&e!==void 0?e:{};if(s.x===g.x&&s.y===g.y)return}n==="polygon"||r<=1?this._cacheDrawPoints.push(s):this._cacheDrawPoints[r-1]=s;const l=this._computeMaskPoints();this._operatingMask.setAttribute("points",l);const{x1:h=0,x2:d=0,y1:c=0,y2:u=0}=(i=this._operatingMask)===null||i===void 0?void 0:i._AABBBounds;this._isDrawedBeforeEnd=!this._operatingMask._AABBBounds.empty()&&(Math.abs(d-h)>a||Math.abs(c-u)>a),this._isDrawedBeforeEnd&&(this._brushMaskAABBBoundsDict[this._operatingMask.name]=this._operatingMask.AABBBounds,this._dispatchEvent(ut.drawing,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:t}))}_moving(t){const e=this._cacheMovePoint,i=this.eventPosToStagePos(t);if(i.x===(e==null?void 0:e.x)&&i.y===(e==null?void 0:e.y))return;const s=i.x-e.x,a=i.y-e.y,n=Math.min(this._operatingMaskMoveRangeX[1],Math.max(this._operatingMaskMoveRangeX[0],s))+this._operatingMaskMoveDx,r=Math.min(this._operatingMaskMoveRangeY[1],Math.max(this._operatingMaskMoveRangeY[0],a))+this._operatingMaskMoveDy;this._operatingMask.setAttributes({dx:n,dy:r}),this._brushMaskAABBBoundsDict[this._operatingMask.name]=this._operatingMask.AABBBounds,this._dispatchEvent(ut.moving,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:t})}_computeMaskPoints(){const{brushType:t,xRange:e=[0,0],yRange:i=[0,0]}=this.attribute;let s=[];const a=this._cacheDrawPoints[0],n=this._cacheDrawPoints[this._cacheDrawPoints.length-1];return s=t==="rect"?[a,{x:n.x,y:a.y},n,{x:a.x,y:n.y}]:t==="x"?[{x:a.x,y:i[0]},{x:n.x,y:i[0]},{x:n.x,y:i[1]},{x:a.x,y:i[1]}]:t==="y"?[{x:e[0],y:a.y},{x:e[0],y:n.y},{x:e[1],y:n.y},{x:e[1],y:a.y}]:gi(this._cacheDrawPoints),s}_addBrushMask(){var t;const{brushStyle:e,hasMask:i}=this.attribute,s=U.polygon(Object.assign(Object.assign({points:gi(this._cacheDrawPoints),cursor:"move",pickable:!1},e),{opacity:i?(t=e.opacity)!==null&&t!==void 0?t:1:0}));s.name=`brush-${Date.now()}`,this._operatingMask=s,this._container.add(s),this._brushMaskAABBBoundsDict[s.name]=s.AABBBounds}_outOfInteractiveRange(t){const{interactiveRange:e}=this.attribute,{minY:i=-1/0,maxY:s=1/0,minX:a=-1/0,maxX:n=1/0}=e,r=this.eventPosToStagePos(t);return r.x>n||r.x<a||r.y>s||r.y<i}eventPosToStagePos(t){return this.stage.eventPointTransform(t)}render(){this._bindBrushEvents();const t=this.createOrUpdateChild("brush-container",{},"group");this._container=t}releaseBrushEvents(){const{delayType:t="throttle",delayTime:e=0,trigger:i=Ot.trigger,updateTrigger:s=Ot.updateTrigger,endTrigger:a=Ot.endTrigger,resetTrigger:n=Ot.resetTrigger}=this.attribute;this.stage.removeEventListener(i,this._onBrushStart),this.stage.removeEventListener(s,this._onBrushingWithDelay),this.stage.removeEventListener(a,this._onBrushEnd),this.stage.removeEventListener(n,this._onBrushEnd)}};sr.defaultAttributes=Ot;function Ji(o){return function(t){let e;return e=$(o)?o.reduce((i,s)=>i==null?void 0:i[s],t):t==null?void 0:t[o],e}}class nr extends uo{parseAddition(t){return super.parseAddition(t),this.scale(t.scale),this}scale(t){if(this.spec.scale){const i=q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this.detach(i),this.spec.scale=void 0}const e=q(t)?this.view.getScaleById(t):t;return this.spec.scale=e,this.attach(e),this._updateComponentEncoders(),this.commit(),this}getScale(){return q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale}}const Nh=(o,t,e,i)=>{var s,a,n,r;const l=(a=(s=t==null?void 0:t.components)===null||s===void 0?void 0:s.axis)!==null&&a!==void 0?a:{};if(!o)return M({},l,e??{});const h=[((r=(n=o.tickData)===null||n===void 0?void 0:n.call(o,i))!==null&&r!==void 0?r:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}))];return M({},l,{items:h},e??{})},Wh=(o,t,e,i)=>{var s,a,n,r;const l=(a=(s=t==null?void 0:t.components)===null||s===void 0?void 0:s.circleAxis)!==null&&a!==void 0?a:{};if(!o)return M({},l,e??{});const h=[((r=(n=o.tickData)===null||n===void 0?void 0:n.call(o,i))!==null&&r!==void 0?r:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}))];return M({},l,{items:h},e??{})},rr=(o,t,e,i,s,a)=>{var n;const r=o.getCoordinateAxisPosition();s&&s.position==="auto"&&(s.position=e?"content":r);const l=o.getCoordinateAxisPoints(i);if(l){const c={start:l[0],end:l[1],verticalFactor:(r==="top"||r==="left"?-1:1)*(e?-1:1)*(!((n=o.getSpec().range)===null||n===void 0)&&n.reversed?-1:1)};if(a&&t.type==="polar"){const u=t.angle();c.center=t.origin(),c.startAngle=u[0],c.endAngle=u[1]}return c}const h=t.radius(),d=t.angle();return{center:t.origin(),radius:h[1],innerRadius:h[0],inside:e,startAngle:d[0],endAngle:d[1]}};class or extends nr{constructor(t,e,i){super(t,$t.axis,e),this.spec.componentType=$t.axis,this.mode=i}parseAddition(t){return super.parseAddition(t),this.axisType(t.axisType),this.tickCount(t.tickCount),this.inside(t.inside),this.baseValue(t.baseValue),this}scale(t){return super.scale(t),this._axisComponentType=null,this}axisType(t){return this.spec.axisType=t,this._axisComponentType=null,this._prepareRejoin(),this.commit(),this}addGraphicItem(t,e){const i=M({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},t),s=Kt.createGraphicComponent(this._getAxisComponentType(),i,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(i,e,s)}tickCount(t){const e=q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return e&&e.tickCount(t),this.setFunctionSpec(t,"tickCount")}inside(t){return this.setFunctionSpec(t,"inside")}baseValue(t){return this.setFunctionSpec(t,"baseValue")}getAxisComponentType(){return this._axisComponentType}_updateComponentEncoders(){const t=q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale,e=Object.assign({update:{}},this.spec.encode),i=Object.keys(e).reduce((s,a)=>{const n=e[a];return n&&(s[a]={callback:(r,l,h)=>{var d,c;const u=this.spec.skipTheme?null:this.view.getCurrentTheme();let g=gn(n,r,l,h);const _=Ce(this.spec.inside,h,r,l),p=Ce(this.spec.baseValue,h,r,l),m=(d=t==null?void 0:t.getCoordinate)===null||d===void 0?void 0:d.call(t);m&&(g=Object.assign(rr(t,m,_,p,this.spec.layout),g));const b=(c=t==null?void 0:t.getScale)===null||c===void 0?void 0:c.call(t),x=Ce(this.spec.tickCount,h,r,l);switch(this._getAxisComponentType()){case re.lineAxis:return Nh(b,u,g,x);case re.circleAxis:return Wh(b,u,g,x)}return g}}),s},{});this._encoders=i}_getAxisComponentType(){var t;if(this._axisComponentType)return this._axisComponentType;let e=this.spec.axisType;if(C(e)){const i=q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;e=!((t=i==null?void 0:i.getCoordinate)===null||t===void 0)&&t.call(i)?i.getCoordinateAxisPoints()?"line":"circle":"line"}return this._axisComponentType=e==="circle"?re.circleAxis:re.lineAxis,this._axisComponentType}}or.componentType=$t.axis;const Gi=()=>{Kt.registerGraphicComponent(re.lineAxis,(o,t)=>new Qe(o,t)),Kt.registerComponent($t.axis,or)},$h=(o,t,e,i)=>{var s,a,n,r;const l=(a=(s=t==null?void 0:t.components)===null||s===void 0?void 0:s.grid)!==null&&a!==void 0?a:{};if(!o)return M({},l,e??{});const h=((r=(n=o.tickData)===null||n===void 0?void 0:n.call(o,i))!==null&&r!==void 0?r:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}));return M({},l,{items:h},e??{})},Kh=(o,t,e,i)=>{var s,a,n,r;const l=(a=(s=t==null?void 0:t.components)===null||s===void 0?void 0:s.circleGrid)!==null&&a!==void 0?a:{};if(!o)return M({},l,e??{});const h=((r=(n=o.tickData)===null||n===void 0?void 0:n.call(o,i))!==null&&r!==void 0?r:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}));return M({},l,{items:h},e??{})};class lr extends nr{constructor(t,e,i){super(t,$t.grid,e),this.spec.componentType=$t.grid,this.mode=i}parseAddition(t){return super.parseAddition(t),this.target(t.target),this.gridType(t.gridType),this.gridShape(t.gridShape),this}scale(t){return super.scale(t),this._gridComponentType=null,this}gridType(t){return this.spec.gridType=t,this._gridComponentType=null,this._prepareRejoin(),this.commit(),this}gridShape(t){return this.spec.gridShape=t,this.commit(),this}target(t){if(this.spec.target){const i=q(this.spec.target)?this.view.getMarkById(this.spec.target):this.spec.target;this.detach(i)}this.spec.target=t;const e=q(t)?this.view.getMarkById(t):t;return this.attach(e),this._targetAxis=e,this._gridComponentType=null,this._updateComponentEncoders(),this.commit(),this}tickCount(t){const e=q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return e&&e.tickCount(t),this.setFunctionSpec(t,"tickCount")}inside(t){return this.setFunctionSpec(t,"inside")}baseValue(t){return this.setFunctionSpec(t,"baseValue")}addGraphicItem(t,e){const i=M({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},t),s=Kt.createGraphicComponent(this._getGridComponentType(),i,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(i,e,s)}_updateComponentEncoders(){const t=Object.assign({update:{}},this.spec.encode),e=Object.keys(t).reduce((i,s)=>{const a=t[s];return a&&(i[s]={callback:(n,r,l)=>{var h,d,c,u;const g=this.spec.skipTheme?null:this.view.getCurrentTheme();let _,p=gn(a,n,r,l);const m=Ce(this.spec.baseValue,l,n,r);if(this._targetAxis){const v=(h=this._targetAxis.getSpec())===null||h===void 0?void 0:h.scale;_=q(v)?this.view.getScaleById(v):v;const y=this._targetAxis.elements[0];if(y)switch(this._getGridComponentType()){case dt.lineAxisGrid:p=Object.assign({x:y.getGraphicAttribute("x"),y:y.getGraphicAttribute("y"),start:y.getGraphicAttribute("start"),end:y.getGraphicAttribute("end"),verticalFactor:(d=y.getGraphicAttribute("verticalFactor"))!==null&&d!==void 0?d:1},p);break;case dt.circleAxisGrid:p=Object.assign({x:y.getGraphicAttribute("x"),y:y.getGraphicAttribute("y"),center:y.getGraphicAttribute("center"),radius:y.getGraphicAttribute("radius"),innerRadius:y.getGraphicAttribute("innerRadius"),inside:y.getGraphicAttribute("inside"),startAngle:y.getGraphicAttribute("startAngle"),endAngle:y.getGraphicAttribute("endAngle")},p)}}else{_=q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;const v=Ce(this.spec.inside,l,n,r),y=(c=_==null?void 0:_.getCoordinate)===null||c===void 0?void 0:c.call(_);y&&(p=Object.assign(rr(_,y,v,m,this.spec.layout,!0),p))}this._getGridComponentType()===dt.lineAxisGrid&&(p=this.spec.gridShape!=="line"&&this.spec.gridShape?Object.assign({center:p.start,closed:!0},p,{type:this.spec.gridShape}):Object.assign({},p,{type:"line"}));const b=(u=_==null?void 0:_.getScale)===null||u===void 0?void 0:u.call(_),x=Ce(this.spec.tickCount,l,n,r);switch(this._getGridComponentType()){case dt.lineAxisGrid:return $h(b,g,p,x);case dt.circleAxisGrid:return Kh(b,g,p,x)}return p}}),i},{});this._encoders=e}_getGridComponentType(){var t;if(this._gridComponentType)return this._gridComponentType;if(this.spec.gridType)this.spec.gridType==="circle"?this._gridComponentType=dt.circleAxisGrid:this._gridComponentType=dt.lineAxisGrid;else if(this._targetAxis)switch(this._targetAxis.getAxisComponentType()){case re.circleAxis:this._gridComponentType=dt.circleAxisGrid;break;case re.lineAxis:default:this._gridComponentType=dt.lineAxisGrid}else if(this.spec.scale){const e=q(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this._gridComponentType=!((t=e==null?void 0:e.getCoordinate)===null||t===void 0)&&t.call(e)?e.getCoordinateAxisPoints()?dt.lineAxisGrid:dt.circleAxisGrid:dt.lineAxisGrid}else this._gridComponentType=dt.lineAxisGrid;return this._gridComponentType}}lr.componentType=$t.grid;const Ui=()=>{Kt.registerGraphicComponent(dt.lineAxisGrid,(o,t)=>new Qn(o,t)),Kt.registerComponent($t.grid,lr)};function hr(o){return o.reduce((t,e)=>t+e,0)}function qh(o){return o.length===0?0:hr(o)/o.length}const Qh={min:It,max:Bt,average:qh,sum:hr};function Jh(o,t,e,i){const s=Math.floor(t.length/o),a=[],n=t.length;let r,l,h,d=0,c=0;a[c++]=d;for(let u=1;u<n-1;u+=s){const g=Math.min(u+s,n-1),_=Math.min(u+2*s,n),p=(_+g)/2;let m=0;for(let f=g;f<_;f++){const A=t[f][i];Number.isNaN(A)||(m+=A)}m/=_-g;const b=u,x=Math.min(u+s,n),v=u-1,y=t[d][i];r=-1,h=b;for(let f=b;f<x;f++){const A=t[f][i];Number.isNaN(i)||(l=Math.abs((v-p)*(A-y)-(v-f)*(m-y)),l>r&&(r=l,h=f))}a[c++]=h,d=h}return a[c-1]!==n-1&&(a[c++]=n-1),a.map(u=>e?t[u].i:u)}function Zi(o,t,e,i,s){let a=Math.floor(t.length/o);const n=[],r=t.length;let l=0,h=[];n.push(l),t[l][s]=t[l][s];for(let d=1;d<r-1;d+=a){a>r-d&&(a=r-d,h.length=a),h=[];for(let u=0;u<a;u++)h.push(t[d+u][s]);const c=Qh[i](h);l=Math.min(Math.round(d+h.length/2)||0,r-1),t[l][s]=c,n.push(l)}return n.map(d=>e?t[d].i:d)}function td(o,t,e,i){return Zi(o,t,e,"min",i)}function ed(o,t,e,i){return Zi(o,t,e,"max",i)}function id(o,t,e,i){return Zi(o,t,e,"average",i)}function sd(o,t,e,i){return Zi(o,t,e,"sum",i)}const ad=(o,t)=>{let e=o.size;const i=o.factor||1;if(Array.isArray(e)&&(e=Math.floor(e[1]-e[0])),e*=i,e<=0)return[];if(t.length<=e)return t;if(o.skipfirst)return t.slice(0,1);const{mode:s,yfield:a,groupBy:n}=o,r=a??"y";let l=Jh;if(s==="min"?l=td:s==="max"?l=ed:s==="average"?l=id:s==="sum"&&(l=sd),t.length){const h={};if(n){for(let c=0,u=t.length;c<u;c++){const g=t[c],_=g[n];h[_]?h[_].push({[r]:g[r],i:c}):(h[_]=[],h[_].push({[r]:g[r],i:c}))}let d=[];return Object.keys(h).forEach(c=>{const u=h[c];if(u.length<=e){const g=u.map(_=>_.i);d=d.concat(g)}else{const g=l(e,u,!0,r);d=d.concat(g),u.forEach(_=>t[_.i][r]=_[r])}}),d.sort((c,u)=>c-u),d.map(c=>t[c])}return l(e,t,!1,r).map(d=>t[d])}return[]};function nd(o){return o.forEach(t=>{t.getGraphicAttribute(We)&&(t.setGraphicAttribute("visible",!0),t.setGraphicAttribute(We,!1))}),o}function rd(o,t,e,i){if(i){let s=-1/0,a=0;const n=C(t);let r=t;o.forEach(l=>{if(l.getGraphicAttribute("visible")===!1)return;const h=l.getGraphicAttribute("size")/2,d=l.getGraphicAttribute("x");n&&(r=(h+a)*e),Math.abs(d-s)<r+a+h?l.getGraphicAttribute("forceShow")||(l.setGraphicAttribute(We,!0),l.setGraphicAttribute("visible",!1)):s=d,a=h})}}function od(o,t,e,i){if(i){let s=-1/0,a=0;const n=C(t);let r=t;o.forEach(l=>{if(l.getGraphicAttribute("visible")===!1)return;const h=l.getGraphicAttribute("size")/2,d=l.getGraphicAttribute("y");n&&(r=(h+a)*e),Math.abs(d-s)<r+a+h?l.getGraphicAttribute("forceShow")||(l.setGraphicAttribute(We,!0),l.setGraphicAttribute("visible",!1)):s=d,a=h})}}function ld(o,t,e,i){if(i){let a=-1/0,n=0,r=0;const l=C(t);let h=t;o.forEach(d=>{if(d.getGraphicAttribute("visible")===!1)return;const c=d.getGraphicAttribute("size")/2,u=d.getGraphicAttribute("x"),g=d.getGraphicAttribute("y");l&&(h=(c+n)*e),r=(-1/0-u)**2+(a-g)**2,r<(h+n+c)**2?d.getGraphicAttribute("forceShow")||(d.setGraphicAttribute(We,!0),d.setGraphicAttribute("visible",!1)):a=g,n=c})}}const hd=(o,t)=>{if(!t||t.length===0)return;let{radius:e}=o;C(e)&&t[0].mark.markType==="symbol"&&(e=!0);const{direction:i,delta:s,deltaMul:a=1,groupBy:n}=o,r=l=>{nd(l);const h=o.sort?l.slice().sort((d,c)=>d.getGraphicAttribute("x")-c.getGraphicAttribute("x")):l;i===0?ld(h,s,a,e):i===1?rd(h,s,a,e):od(h,s,a,e)};if(n){const l=t.reduce((h,d)=>{const c=d.getDatum()[n];return h[c]?h[c].push(d):h[c]=[d],h},{});Object.keys(l).forEach(h=>{r(l[h])})}else r(t);return t},Ms=()=>{Kt.registerTransform("sampling",{transform:ad,markPhase:"afterEncode"},!0)},dr=()=>{Kt.registerTransform("markoverlap",{transform:hd,markPhase:"afterEncode"},!0)},cr="monotone",dd="linear",cd="bevel",se={point:{name:"point",type:"symbol"},line:{name:"line",type:"line"}};class ur{addSamplingCompile(){if(this._spec.sampling){const{width:t,height:e}=this._region.getLayoutRect(),i=[],s=this._fieldY,a=this._fieldX;i.push({type:"sampling",size:this._direction==="horizontal"?e:t,factor:this._spec.samplingFactor,yfield:this._direction==="horizontal"?a[0]:s[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(i)}}addOverlapCompile(){var t;if(this._spec.markOverlap){const e=[];e.push({type:"markoverlap",direction:this._direction==="horizontal"&&this.coordinate==="cartesian"?2:1,delta:this._spec.pointDis,deltaMul:this._spec.pointDisMul,groupBy:this._seriesField}),(t=this._symbolMark)===null||t===void 0||t.getProduct().transform(e)}}reCompileSampling(){this._spec.sampling&&this.compile()}initLineMark(t,e){var i,s;return this._lineMark=this._createMark(se.line,{groupKey:this._seriesField,isSeriesMark:e==null||e,stateSort:(i=this._spec.line)===null||i===void 0?void 0:i.stateSort},Object.assign(Object.assign({},t),{setCustomizedShape:(s=this._spec.line)===null||s===void 0?void 0:s.customShape,morphElementKey:this.getDimensionField()[0]})),this._lineMark}initLineMarkStyle(t,e){var i,s;const a=this._lineMark;if(a){if(this.setMarkStyle(a,{stroke:this.getColorAttribute()},"normal",I.Series),this._invalidType!=="zero"&&this.setMarkStyle(a,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",I.Series),this.event.on(V.viewDataStatisticsUpdate,{filter:n=>n.model===this},()=>{this.encodeDefined(a,"defined")}),this.coordinate==="polar")this.setMarkStyle(a,{lineJoin:cd,curveType:dd,closePath:!0},"normal",I.Series);else{const n=e??((s=(i=this.getSpec().line)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.curveType),r=n===cr?t==="horizontal"?"monotoneY":"monotoneX":n;this.setMarkStyle(a,{curveType:r},"normal",I.Built_In)}this.setMarkStyle(a,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",I.Series)}return a}_getEventElement(t,e=!1){let i=[];return t.dimensionInfo.some(s=>(s.data.some(a=>a.series===this&&(i=a.datum,!0)),!i.length)),i}_dimensionTrigger(t){const e=this._getEventElement(t);switch(t.action){case"enter":this._symbolActiveMark.getDataView().parse(e),this._symbolActiveMark.getData().updateData(!1);break;case"leave":this._symbolActiveMark.getDataView().parse([]),this._symbolActiveMark.getData().updateData(!1)}}initSymbolMark(t,e){const i=this._spec.point||{};if(i.visible!==!1&&(this._symbolMark=this._createMark(se.point,{groupKey:this._seriesField,isSeriesMark:!!e,stateSort:i.stateSort},Object.assign(Object.assign({},t),{setCustomizedShape:i.customShape,morph:wi(this._spec,se.point.name),morphElementKey:this.getDimensionField()[0]}))),this._spec.activePoint===!0){const s=new bt(this._option.dataSet,{name:`${$e}_series_${this.id}_active_point`});s.parse([]),this._symbolActiveMark=this._createMark({name:`active_point_${this.id}`,type:"symbol"},{groupKey:this._seriesField,isSeriesMark:!1,dataView:s,parent:this._region.getInteractionMark(),stateSort:i.stateSort},{setCustomizedShape:i.customShape,morph:!1}),this._symbolActiveMark.setVisible(!1)}return this._symbolMark}initSymbolMarkStyle(){const t=this._symbolMark;if(!t)return this._initSymbolActiveMarkAlone(),t;if(this._initSymbolMark(t),this._symbolActiveMark&&this._symbolMark.stateStyle.dimension_hover){this._symbolActiveMark.setVisible(!0),this.event.on(js.dimensionHover,this._dimensionTrigger.bind(this));for(const e in this._symbolMark.stateStyle){this._symbolActiveMark.stateStyle[e]={};for(const i in this._symbolMark.stateStyle[e])i!=="visible"&&(this._symbolActiveMark.stateStyle[e][i]={style:null,level:I.Series,referer:t})}this._symbolActiveMark.state.changeStateInfo({stateValue:ie.STATE_DIMENSION_HOVER,filter:()=>!0})}return t}_initSymbolMark(t){t&&(this.setMarkStyle(t,{fill:this.getColorAttribute()},"normal",I.Series),this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)},"normal",I.Series),this.event.on(V.viewDataStatisticsUpdate,{filter:e=>e.model===this},()=>{this.encodeDefined(t,"visible")}),this.setMarkStyle(t,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",I.Series))}_initSymbolActiveMarkAlone(){var t,e;const i=this._symbolActiveMark;i&&(this._initSymbolMark(i),i&&(!((e=(t=this._spec[se.point.name])===null||t===void 0?void 0:t.state)===null||e===void 0)&&e.dimension_hover)&&(i.setVisible(!0),this.event.on(js.dimensionHover,this._dimensionTrigger.bind(this)),this.initMarkStyleWithSpec(i,J({},this._spec[se.point.name],{visible:!0})),this._symbolActiveMark.state.changeStateInfo({stateValue:ie.STATE_DIMENSION_HOVER,filter:()=>!0})))}initLabelMarkStyle(t){var e;t&&(((e=t.getTarget())===null||e===void 0?void 0:e.type)!=="symbol"&&t.setRule("line-data"),this.setMarkStyle(t,{fill:this.getColorAttribute(),text:i=>i[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null}),this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)},"normal",I.Series),this.event.on(V.viewDataStatisticsUpdate,{filter:i=>i.model===this},()=>{this.encodeDefined(t,"visible")}))}initLineLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this.getSeriesField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null})}encodeDefined(t,e){var i,s,a,n;if(!t)return;const r=this._isFieldAllValid();if(this._invalidType==="zero"||r){if(((s=(i=t.stateStyle.normal)===null||i===void 0?void 0:i[e])===null||s===void 0?void 0:s.style)===!0)return;this.setMarkStyle(t,{[e]:!0},"normal",I.Series)}else{if(((n=(a=t.stateStyle.normal)===null||a===void 0?void 0:a[e])===null||n===void 0?void 0:n.style)!==!0)return;this.setMarkStyle(t,{[e]:this._getInvalidDefined.bind(this)},"normal",I.Series)}t.getProduct()&&t.compileEncode()}_isFieldAllValid(){const t=this.getViewDataStatistics(),e=this.getStackValueField();return!!(t&&t.latestData&&e)&&t.latestData[e]&&t.latestData[e].allValid}}const ud=Object.assign(Object.assign({},_e),se);class Ts extends zi{_transformLabelSpec(t){var e,i,s;((e=t.point)===null||e===void 0?void 0:e.visible)!==!1&&((s=(i=t.point)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.visible)!==!1?this._addMarkLabelSpec(t,"point"):this._addMarkLabelSpec(t,"line"),this._addMarkLabelSpec(t,"line","lineLabel","initLineLabelMarkStyle",void 0,!0)}}function Ea(o){return o.length===2&&O(o[0])&&O(j(o))&&j(o)>=o[0]}function Ra(o,t){const e=j(t)-t[0],i=j(t)*t[0]<0;let s=t[0]<=0?0-t[0]:0,a=j(t)>0?j(t)-0:0;e===0?t[0]<0?(s=1,a=0):t[0]>0&&(s=0,a=1):(s/=e,a/=e);const n=o.getDomainSpec();return{total:e,negative:s,positive:a,includeZero:i,domain:t,extendable_min:!O(n.min),extendable_max:!O(n.max)}}function Ia(o,t){const{positive:e,negative:i,extendable_min:s,extendable_max:a,domain:n}=o,{positive:r,negative:l,extendable_min:h,extendable_max:d,domain:c}=t;if(r>0){if(!h)return!1;let u=i/e;a&&(u=i/Math.max(e,r),n[1]=-n[0]/u),c[0]=-c[1]*u}else if(l>0){if(!d)return!1;let u=e/i;s&&(u=e/Math.max(i,i),n[0]=-n[1]/u),c[1]=-c[0]*u}return!0}function wa(o,t){const{extendable_min:e,extendable_max:i,domain:s}=o,{positive:a,negative:n,domain:r}=t;return(a!==0||n!==0)&&!(a>0&&!i)&&!(n>0&&!e)&&(s[0]=r[0],s[1]=r[1],!0)}function za(o,t){const{positive:e,negative:i,extendable_max:s,domain:a}=o,{positive:n,negative:r,extendable_min:l,domain:h}=t;if(s&&l){const d=Math.max(i,r)/Math.max(e,n);a[1]=-a[0]/d,h[0]=-h[1]*d}else if(l){const d=i/e;h[0]=-h[1]*d}else{if(!s)return!1;{const d=r/n;a[1]=-a[0]/d}}return!0}function Fa(o,t){const{extendable_min:e,domain:i}=o,{extendable_max:s,domain:a}=t;return!(!e||!s)&&(i[0]=-i[1],a[1]=-a[0],!0)}const gd=(o,t)=>{var e,i,s,a,n,r;const l=o.getScale(),h=t.getScale();if(!l||!h)return;const d=(s=(i=(e=o).getDomainAfterSpec)===null||i===void 0?void 0:i.call(e))!==null&&s!==void 0?s:[0,1],c=(r=(n=(a=t).getDomainAfterSpec)===null||n===void 0?void 0:n.call(a))!==null&&r!==void 0?r:[0,1];if(!(d&&c&&Ea(d)&&Ea(c)))return;const u=Ra(o,d),g=Ra(t,c),{positive:_,negative:p,extendable_min:m,extendable_max:b,includeZero:x}=u,{positive:v,negative:y,extendable_min:f,extendable_max:A,includeZero:k}=g;if(_===0&&p===0){if(!wa(u,g))return}else if(v===0&&y===0){if(!wa(g,u))return}else if(x||k)if(x&&!k){if(!Ia(u,g))return}else if(k&&!x){if(!Ia(g,u))return}else{if(p===y)return;if(p>y){if(!za(u,g))return}else if(!za(g,u))return}else{if(p===0&&v===0){if(!Fa(u,g))return}else if(y===0&&_===0&&!Fa(g,u))return;if(p===0&&y===0)if(d[0]===0&&c[0]>0){if(!f)return;c[0]=0}else{if(!(c[0]===0&&d[0]>0)||!m)return;d[0]=0}if(_===0&&v===0)if(d[1]===0&&c[1]>0){if(!A)return;c[1]=0}else{if(!(c[1]===0&&d[1]>0)||!b)return;d[1]=0}}l.domain(d),h.domain(c)},_d=(o,t)=>{var e,i,s,a,n;if(!o)return o;const r=(e=t==null?void 0:t.targetAxis)===null||e===void 0?void 0:e.call(t);if(!r)return o;const l=(i=t==null?void 0:t.currentAxis)===null||i===void 0?void 0:i.call(t);if(!l)return o;const h=(s=l.getTickData())===null||s===void 0?void 0:s.getDataView();if(!h||!h.transformsArr.find(x=>x.type.includes("ticks")))return o;const d=l.getScale();if(!d)return o;const c=(n=(a=r.getTickData())===null||a===void 0?void 0:a.getDataView())===null||n===void 0?void 0:n.latestData;if(!(c!=null&&c.length))return o;const u=r.getScale();if(!u)return o;const g=u.domain(),_=j(g)-g[0];if(_===0)return o;const p=d.domain(),m=j(p)-p[0];if(_===0)return o;const b=c.map(x=>{const v=(x.value-g[0])/_;return m*v+p[0]});return le(b)};class Je extends go{constructor(){super(Je.type),this.type="AxisSyncPlugin"}_checkEnableSync(t){if(!K(t.getScale().type))return!1;const e=t.getSpec().sync;return!!(e!=null&&e.axisId)&&e}_getTargetAxis(t,e){const i=t.getOption().getChart().getComponentByUserId(e.axisId);return i!=null&&i.type.startsWith("cartesianAxis")?i:null}onInit(t,e){const i=this._checkEnableSync(e);if(!i||!i.zeroAlign)return;const s=this._getTargetAxis(e,i);s&&e.event.on(V.scaleDomainUpdate,{filter:({model:a})=>a.id===e.id||a.id===s.id},()=>{gd(s,e)})}onDidCompile(t,e){const i=this._checkEnableSync(e);if(!i)return;const s=this._getTargetAxis(e,i);if(s&&i.tickAlign){at(e.getOption().dataSet,"tickAlign",_d);const a={targetAxis:()=>s,currentAxis:()=>e};e.addTransformToTickData({type:"tickAlign",options:a,level:Number.MAX_SAFE_INTEGER},!1)}}}Je.pluginType="component",Je.type="AxisSyncPlugin";const pd=o=>o;var md=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};class gr extends ii{getOrient(){return this._orient}getScale(){return this._scale}getScales(){return this._scales}getTickData(t=0){return this._tickData[t]}get visible(){return this._visible}getInverse(){return this._inverse}getCoordinateType(){return this._coordinateType}constructor(t,e){var i;super(t,e),this.specKey="axes",this._scales=[],this._tickData=[],this._visible=!0,this._tick=void 0,this._visible=(i=t.visible)===null||i===void 0||i,this._coordinateType="none"}_getNeedClearVRenderComponents(){return[]}getVRenderComponents(){var t,e,i,s;return[(e=(t=this._axisMark)===null||t===void 0?void 0:t.getProduct())===null||e===void 0?void 0:e.getGroupGraphicItem(),(s=(i=this._gridMark)===null||i===void 0?void 0:i.getProduct())===null||s===void 0?void 0:s.getGroupGraphicItem()].filter(S)}created(){var t,e,i,s,a,n,r,l,h,d,c,u,g,_,p,m,b,x;if(super.created(),this.setSeriesAndRegionsFromSpec(),this.initEvent(),this.initScales(),this.updateSeriesScale(),this._shouldComputeTickData()&&this._initData(),this._visible){const v=this._createMark({type:"component",name:`axis-${this.getOrient()}`},{componentType:this.getOrient()==="angle"?"circleAxis":"axis",mode:this._spec.mode,noSeparateStyle:!0},{skipTheme:!0});if(this._axisMark=v,v.setMarkConfig({zIndex:this.layoutZIndex}),S(this._spec.id)&&v.setUserId(this._spec.id),v.setMarkConfig({interactive:(t=this._spec.interactive)!==null&&t!==void 0?t:this.getDefaultInteractive()}),this._marks.addMark(v),(e=this._spec.grid)===null||e===void 0?void 0:e.visible){const y=this._createMark({type:"component",name:`axis-${this.getOrient()}-grid`},{componentType:this.getOrient()==="angle"?dt.circleAxisGrid:dt.lineAxisGrid,mode:this._spec.mode,noSeparateStyle:!0},{skipTheme:!0});y.setMarkConfig({zIndex:(r=(a=(s=(i=this._spec.grid)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.zIndex)!==null&&a!==void 0?a:(n=this._spec.grid)===null||n===void 0?void 0:n.zIndex)!==null&&r!==void 0?r:St.Axis_Grid,interactive:!1}),this._marks.addMark(y),this._gridMark=y}if(this._option.animation!==!1&&W(this._option.getChart().getSpec(),"animation")!==!1&&this._spec.animation===!0){const y=Ct((l=X.getAnimationInKey("axis"))===null||l===void 0?void 0:l(),{appear:(d=(h=this._spec.animationAppear)!==null&&h!==void 0?h:W(this._option.getChart().getSpec(),"animationAppear.axis"))!==null&&d!==void 0?d:W(this._option.getChart().getSpec(),"animationAppear"),disappear:(u=(c=this._spec.animationDisappear)!==null&&c!==void 0?c:W(this._option.getChart().getSpec(),"animationDisappear.axis"))!==null&&u!==void 0?u:W(this._option.getChart().getSpec(),"animationDisappear"),enter:(_=(g=this._spec.animationEnter)!==null&&g!==void 0?g:W(this._option.getChart().getSpec(),"animationEnter.axis"))!==null&&_!==void 0?_:W(this._option.getChart().getSpec(),"animationEnter"),exit:(m=(p=this._spec.animationExit)!==null&&p!==void 0?p:W(this._option.getChart().getSpec(),"animationExit.axis"))!==null&&m!==void 0?m:W(this._option.getChart().getSpec(),"animationExit"),update:(x=(b=this._spec.animationUpdate)!==null&&b!==void 0?b:W(this._option.getChart().getSpec(),"animationUpdate.axis"))!==null&&x!==void 0?x:W(this._option.getChart().getSpec(),"animationUpdate")});y.enter&&(y.update[0].customParameters={enter:y.enter[0]}),this._marks.forEach(f=>f.setAnimationConfig(y))}}}_shouldComputeTickData(){return this.getVisible()||this._spec.forceInitTick}_initData(){const t=this._initTickDataSet(this._tickTransformOption());t.target.addListener("change",this._forceLayout.bind(this)),this._tickData=[new Ke(this._option,t)]}collectData(t,e){const i=[];return vt(this._regions,s=>{var a;let n=this.collectSeriesField(t,s);if(n=$(n)?K(this._scale.type)?n:[n[0]]:[n],t||(this._dataFieldText=s.getFieldAlias(n[0])),n){const r=s.getViewData();if(e)n.forEach(l=>{i.push(s.getRawDataStatisticsByField(l,!1))});else if(r&&r.latestData&&r.latestData.length){const l=(a=s.getViewDataStatistics)===null||a===void 0?void 0:a.call(s),h=this.type===F.cartesianLinearAxis&&this._spec.breaks&&this._spec.breaks.length;n.forEach(d=>{var c;!((c=l==null?void 0:l.latestData)===null||c===void 0)&&c[d]&&(h?i.push(Object.assign(Object.assign({},l.latestData[d]),{values:r.latestData.map(u=>u[d])})):i.push(l.latestData[d]))})}}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),i}isSeriesDataEnable(){let t=!0;return vt(this._regions,e=>{var i;$((i=e.getViewDataStatistics())===null||i===void 0?void 0:i.latestData)&&(t=!1)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t}setSeriesAndRegionsFromSpec(){const{seriesId:t,seriesIndex:e,regionId:i,regionIndex:s}=this._spec;S(t)&&(this._seriesUserId=L(t)),S(i)&&(this._regionUserId=L(i)),S(e)&&(this._seriesIndex=L(e)),S(s)&&(this._regionIndex=L(s)),this._regions=this._option.getRegionsInUserIdOrIndex(this._regionUserId,this._regionIndex),this.layout.layoutBindRegionID=this._regions.map(a=>a.id)}getBindSeriesFilter(){return{userId:this._seriesUserId,specIndex:this._seriesIndex}}initEvent(){this.event.on(V.scaleUpdate,{filter:({model:e})=>(e==null?void 0:e.id)===this.id},this.effect.scaleUpdate.bind(this));const t=_o(this._regions,{userId:this._seriesUserId,specIndex:this._seriesIndex}).map(e=>e.getViewDataStatistics()).filter(e=>!!e);t.length>1?this._option.dataSet.multipleDataViewAddListener(t,"change",()=>{this.updateScaleDomain()}):t.length===1&&t[0].target.addListener("change",()=>{this.updateScaleDomain()}),vt(this._regions,e=>{e.event.on(V.rawDataUpdate,{filter:({model:i})=>(i==null?void 0:i.id)===e.id},()=>{this._clearRawDomain()})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}updateScaleDomain(){}_clearRawDomain(){}onLayoutEnd(t){this.updateScaleRange(),this.event.emit(V.scaleUpdate,{model:this,value:"range"}),super.onLayoutEnd(t)}computeData(t){t!=="force"||this._tickData&&this._tickData.length?!this._tickData||!this._tickData.length||t!=="force"&&Ie(this._scale.range(),[0,1])||this._tickData.forEach(e=>{e.getDataView().reRunAllTransform(),e.updateData()}):vt(this._regions,e=>{var i;(i=e.getViewData())===null||i===void 0||i.reRunAllTransform()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}initScales(){this._scales=[this._scale];const t=[];if(vt(this._regions,e=>{const i=e.getGroups();i&&t.push(i)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t.length!==0){const e=Bt(t.map(i=>i.fields.length));for(let i=1;i<e;i++){const s=this._scale.clone();this._scales.push(s)}}}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake?i:(i.reRender=!0,(e==null?void 0:e.type)!==(t==null?void 0:t.type)||(e==null?void 0:e.visible)!==(t==null?void 0:t.visible)?(i.reMake=!0,i):(i.reMake=["grid","subGrid","tick","subTick","label","domainLine","title"].some(s=>{var a,n;return((a=e==null?void 0:e[s])===null||a===void 0?void 0:a.visible)!==((n=t==null?void 0:t[s])===null||n===void 0?void 0:n.visible)}),i))}_getAxisAttributes(){const t=this._spec,e={orient:this.getOrient(),select:this._option.disableTriggerEvent!==!0&&t.select,hover:this._option.disableTriggerEvent!==!0&&t.hover};if(t.domainLine&&t.domainLine.visible?e.line=po(t.domainLine):e.line={visible:!1},t.label&&t.label.visible){const i=mo(t.label,["style","formatMethod","state"]);e.label=i,t.label.style&&(e.label.style=R(t.label.style)?(s,a,n,r)=>{var l;const h=t.label.style(s.rawValue,a,s,n,r);return z(J({},(l=this._theme.label)===null||l===void 0?void 0:l.style,h))}:z(t.label.style)),(t.label.formatMethod||t.label.formatter)&&(e.label.formatMethod=this._getLabelFormatMethod()),t.label.state&&(e.label.state=vo(t.label.state))}else e.label={visible:!1};if(t.tick&&t.tick.visible?(e.tick={visible:t.tick.visible,length:t.tick.tickSize,inside:t.tick.inside,alignWithLabel:t.tick.alignWithLabel,dataFilter:t.tick.dataFilter},t.tick.style&&(e.tick.style=R(t.tick.style)?(i,s,a,n)=>{var r;const l=t.tick.style(i,s,a,n);return z(J({},(r=this._theme.tick)===null||r===void 0?void 0:r.style,l))}:z(t.tick.style)),t.tick.state&&(e.tick.state=be(t.tick.state))):e.tick={visible:!1},t.subTick&&t.subTick.visible?(e.subTick={visible:t.subTick.visible,length:t.subTick.tickSize,inside:t.subTick.inside,count:t.subTick.tickCount},t.subTick.style&&(e.subTick.style=R(t.subTick.style)?(i,s,a,n)=>{var r;const l=t.subTick.style(i,s,a,n);return z(J({},(r=this._theme.subTick)===null||r===void 0?void 0:r.style,l))}:z(t.subTick.style)),t.subTick.state&&(e.subTick.state=be(t.subTick.state))):e.subTick={visible:!1},t.title&&t.title.visible){const i=t.title,{autoRotate:s,angle:a,style:n={},background:r,state:l,shape:h}=i,d=md(i,["autoRotate","angle","style","background","state","shape"]);let c,u=a;t.orient!=="left"&&t.orient!=="right"||s&&C(u)&&(u=t.orient==="left"?-90:90,c=yo[t.orient]),e.title=Object.assign(Object.assign({},d),{autoRotate:!1,angle:u?ne(u):null,textStyle:J({},c,z(n)),pickable:n.pickable!==!1,childrenPickable:n.pickable!==!1,state:{}}),h&&h.visible?(e.title.shape=Object.assign(Object.assign({},h),{style:z(h.style)}),h.state&&(e.title.state.shape=be(h.state))):e.title.shape={visible:!1},r&&r.visible?(e.title.background=Object.assign(Object.assign({},r),{style:z(r.style)}),r.state&&(e.title.state.background=be(r.state))):e.title.background={visible:!1},l&&(e.title.state.text=be(l))}else e.title={visible:!1};return t.background&&t.background.visible?(e.panel={visible:!0},t.background.style&&(e.panel.style=z(t.background.style)),t.background.state&&(e.panel.state=be(t.background.state))):e.panel={visible:!1},e}_getGridAttributes(){const t=this._spec;return{alternateColor:t.grid.alternateColor,alignWithLabel:t.grid.alignWithLabel,style:R(t.grid.style)?()=>(e,i)=>{var s,a;const n=t.grid.style((s=e.datum)===null||s===void 0?void 0:s.rawValue,i,e.datum);return z(J({},(a=this._theme.grid)===null||a===void 0?void 0:a.style,n))}:z(t.grid.style),subGrid:t.subGrid.visible===!1?{visible:!1}:{type:"line",visible:t.subGrid.visible,alternateColor:t.subGrid.alternateColor,style:z(t.subGrid.style)}}}_getLabelFormatMethod(){const{formatMethod:t,formatter:e}=this._spec.label,{formatFunc:i}=pn(t,e);return i?(s,a,n)=>i(a.rawValue,a,e):null}_initTickDataSet(t,e=0){mn(this._option.dataSet,"scale",pd);const i=this.registerTicksTransform();return new bt(this._option.dataSet,{name:`${this.type}_${this.id}_ticks_${e}`}).parse(this._scales[e],{type:"scale"}).transform({type:i,options:t},!1)}_tickTransformOption(){const t=this._tick||{},e=this._spec.label||{},{tickCount:i,forceTickCount:s,tickStep:a,tickMode:n}=t,{style:r,formatMethod:l,minGap:h}=e;return{sampling:this._spec.sampling!==!1,tickCount:i,forceTickCount:s,tickStep:a,tickMode:n,axisOrientType:this._orient,coordinateType:this._coordinateType,labelStyle:r,labelFormatter:l,labelGap:h}}addTransformToTickData(t,e){this._tickData.forEach(i=>{var s;(s=i==null?void 0:i.getDataView())===null||s===void 0||s.transform(t,e)})}dataToPosition(t){return this._scale.scale(t)}}gr.specKey="axes";const Ni=()=>{_n(),X.registerAnimation("axis",()=>({appear:{custom:Il},update:{custom:_h},exit:{custom:wl}}))};var Ha=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};const vd=[Je];class bi extends gr{getOrient(){return this._orient}getDefaultInteractive(){return!0}set autoIndentOnce(t){this._autoIndentOnce=t}getScales(){return this._scales}constructor(t,e){super(t,e),this.type=F.cartesianAxis,this.name=F.cartesianAxis,this._defaultBandPosition=.5,this._defaultBandInnerPadding=.1,this._defaultBandOuterPadding=.3,this.layoutType="region-relative",this.layoutZIndex=St.Axis,this.layoutLevel=_s.Axis,this._orient="left",this._autoIndentOnce=!1,this._hasAutoIndent=!1,this._scales=[],this._tick=void 0,this._layoutCache={width:0,height:0,_lastComputeOutBounds:{x1:0,x2:0,y1:0,y2:0}},this._innerOffset={top:0,bottom:0,left:0,right:0},this.effect={scaleUpdate:i=>{this.computeData(i==null?void 0:i.value),vt(this._regions,s=>{const a=this.getOrient();et(a)?Vt(s.getXAxisHelper(),this.axisHelper(),S(this._seriesUserId)||S(this._seriesIndex))&&s.setXAxisHelper(this.axisHelper()):Se(a)?Vt(s.getYAxisHelper(),this.axisHelper(),S(this._seriesUserId)||S(this._seriesIndex))&&s.setYAxisHelper(this.axisHelper()):Dt(a)&&Vt(s.getZAxisHelper(),this.axisHelper(),S(this._seriesUserId)||S(this._seriesIndex))&&s.setZAxisHelper(this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._transformLayoutPosition=i=>{let{x:s,y:a}=i;return O(s)&&(s+=+(this._orient==="left")*this.getLayoutRect().width),O(a)&&(a+=+(this._orient==="top")*this.getLayoutRect().height),{x:s,y:a}},this._transformLayoutRect=i=>{if(!this._visible)return i;const s=this._latestBounds.clone().translate(-this.getLayoutStartPoint().x,-this.getLayoutStartPoint().y);switch(this._layout.layoutOrient){case"left":this._layout.layoutRectLevelMap.width===hi&&(i.width=s.x1<0?-s.x1:0);break;case"right":this._layout.layoutRectLevelMap.width===hi&&(i.width=s.x2>0?s.x2:0);break;case"top":this._layout.layoutRectLevelMap.height===hi&&(i.height=s.y1<0?-s.y1:0);break;case"bottom":this._layout.layoutRectLevelMap.height===hi&&(i.height=s.y2>0?s.y2:0)}return i.width=Math.ceil(i.width),i.height=Math.ceil(i.height),this._layout.setRectInSpec(this._layoutCacheProcessing(i))},this._updateAxisLayout=()=>{const i=this.getLayoutStartPoint(),s=this._getUpdateAttribute(!1),{grid:a}=s,n=Ha(s,["grid"]),r=this._axisMark.getProduct(),l=J({x:i.x,y:i.y},this._axisStyle,n);r.encode(l),this._gridMark&&this._gridMark.getProduct().encode(J({x:i.x,y:i.y},this._getGridAttributes(),a))},this._fixAxisOnZero=()=>{const{onZero:i,visible:s}=this._spec.domainLine;if(this.visible&&i&&s!==!1){const{onZeroAxisId:a,onZeroAxisIndex:n}=this._spec.domainLine,r=this._option.getComponentsByKey("axes"),l=et(this.getOrient()),h=c=>{var u;return(l?!et(c.getOrient()):et(c.getOrient()))&&K(c.getScale().type)&&(c.getTickData()?(u=c.getTickData().getLatestData())===null||u===void 0?void 0:u.find(g=>g.value===0):c.getScale().domain()[0]<=0&&j(c.getScale().domain())>=0)},d=r.filter(c=>h(c));if(d.length){let c;if(S(a))c=d.find(u=>u.id===a);else if(S(n)){const u=r[n];h(u)&&(c=u)}else c=d[0];if(c){const u=this._axisMark.getProduct(),g=c.valueToPosition(0);l?u.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dy:this._orient==="bottom"?-((c.getInverse()?c.getScale().range()[1]:c.getScale().range()[0])-g):g})}):u.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dx:this._orient==="left"?g:-((c.getInverse()?c.getScale().range()[0]:c.getScale().range()[1])-g)})})}}}},this._orient=vn(t,["z"]),Dt(this._orient)&&(this.layoutType="absolute"),this._dataSet=e.dataSet,this._coordinateType="cartesian"}static getSpecInfo(t){const e=t[this.specKey];if(!e)return null;const i=t.direction==="horizontal";if(!$(e)){if(!Xs(e))return null;const{axisType:r,componentName:l}=Ys(e,i);return e.type=r,[{spec:e,specPath:[this.specKey],specInfoPath:["component",this.specKey,0],type:l}]}let s=!0;if(e.filter(r=>r.orient==="z")[0]){const r=e.filter(h=>h.orient==="bottom")[0],l=e.filter(h=>Se(h.orient))[0];s=e.length===3&&r&&l}let a=e.map((r,l)=>({spec:r,index:l}));s||(a=a.filter(({spec:r})=>r.orient!=="z"));const n=[];return a.forEach(({spec:r,index:l})=>{if(!Xs(r))return;const{axisType:h,componentName:d}=Ys(r,i);r.type=h,n.push({spec:r,specPath:[this.specKey,l],specInfoPath:["component",this.specKey,l],type:d})}),n}static createComponent(t,e){const{spec:i}=t,s=Ha(t,["spec"]),a=X.getComponentInKey(s.type);return a?new a(i,Object.assign(Object.assign({},e),s)):(e.onError(`Component ${s.type} not found`),null)}initLayout(){super.initLayout(),this._layout.autoIndent=this._spec.autoIndent!==!1,this._layout.layoutOrient=this._orient}setLayout3dBox(t){this.layout3dBox=t}getNewScaleRange(){const{width:t,height:e}=this.getLayoutRect(),{left:i,right:s,top:a,bottom:n}=this._innerOffset;let r=[];return et(this.getOrient())?O(t)&&(r=this._inverse?[t-s,i]:[i,t-s]):Dt(this.getOrient())?O(t)&&(r=this._inverse?[t-s,i]:[i,t-s],this._scale.range(r)):O(e)&&(r=this._inverse?[a,e-n]:[e-n,a]),r}updateScaleRange(){let t=!1;const e=this.getNewScaleRange(),i=this._scale.range();return e.length===i.length&&e.every((s,a)=>s===i[a])?t=!1:(t=!0,this._scale.range(e)),t}init(t){var e;super.init(t),(e=this.pluginService)===null||e===void 0||e.load(vd.map(i=>new i)),this.callPlugin(i=>{this.pluginService&&i.onInit&&i.onInit(this.pluginService,this)})}setAttrFromSpec(){var t;if(super.setAttrFromSpec(),this.visible){et(this.getOrient())?Gs(this._spec.maxHeight)&&(this._spec.maxHeight="30%"):Gs(this._spec.maxWidth)&&(this._spec.maxWidth="30%");const i=this._getAxisAttributes();i.label.formatMethod=this._getLabelFormatMethod(),i.verticalFactor=this.getOrient()==="top"||this.getOrient()==="right"?-1:1,this._axisStyle=i}this._tick=this._spec.tick;const e=(t=this._option.getChart())===null||t===void 0?void 0:t.getSpec();this._inverse=bo(this._spec,(e==null?void 0:e.direction)==="horizontal")}onLayoutStart(t,e,i){if(super.onLayoutStart(t,e,i),!Dt(this.getOrient())&&this._spec.innerOffset){const s=this._spec;Se(this.getOrient())?["top","bottom"].forEach(a=>{this._innerOffset[a]=De(s.innerOffset[a],e.height,e)}):["left","right"].forEach(a=>{this._innerOffset[a]=De(s.innerOffset[a],e.width,e)})}}getSeriesStatisticsField(t){let e;return e=et(this.getOrient())?t.fieldX:Dt(this.getOrient())?t.fieldZ:t.fieldY,K(this._scale.type)?e:[e[0]]}_tickTransformOption(){var t,e,i,s;return Object.assign(Object.assign({},super._tickTransformOption()),{noDecimals:(t=this._tick)===null||t===void 0?void 0:t.noDecimals,labelLastVisible:(e=this._spec.label)===null||e===void 0?void 0:e.lastVisible,labelFirstVisible:(i=this._spec.label)===null||i===void 0?void 0:i.firstVisible,labelFlush:(s=this._spec.label)===null||s===void 0?void 0:s.flush})}axisHelper(){return{isContinuous:K(this._scale.type),dataToPosition:this.dataToPosition.bind(this),getScale:(t=0)=>this._scales[t],getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>this._inverse===!0,getSpec:()=>this._spec}}afterCompile(){var t;const e=(t=this._axisMark)===null||t===void 0?void 0:t.getProduct();e&&e.addEventListener(xo.AFTER_ELEMENT_ENCODE,()=>{if(this._isLayout===!1&&(et(this.getOrient())?this.callPlugin(i=>{this.pluginService&&i.onDidLayoutHorizontal&&i.onDidLayoutHorizontal(this.pluginService,this)}):this.callPlugin(i=>{this.pluginService&&i.onDidLayoutVertical&&i.onDidLayoutVertical(this.pluginService,this)}),this._unitText)){const{x:i,y:s}=this.getLayoutStartPoint(),a=et(this._orient)?{x:Bt(this._scale.range())+i,y:s}:{x:i,y:It(this._scale.range())+s};this._unitText.setAttributes(a)}}),this.callPlugin(i=>{this.pluginService&&i.onDidCompile&&i.onDidCompile(this.pluginService,this)})}onRender(t){}changeRegions(t){}update(t){}resize(t){}collectScale(){const t=[];return vt(this._regions,e=>{t.push(this.getOrient()==="left"||this.getOrient()==="right"?e.scaleY:e.scaleX)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t}collectSeriesField(t,e){var i,s;let a;return a=t>0?(s=(i=e.getGroups())===null||i===void 0?void 0:i.fields)===null||s===void 0?void 0:s[t]:et(this.getOrient())?e.getSpec().x2Field?[...e.fieldX,e.fieldX2]:e.fieldX:Dt(this.getOrient())?e.fieldZ:e.getSpec().y2Field?[...e.fieldY,e.fieldY2]:e.fieldY,a}updateSeriesScale(){const t=this.getOrient();vt(this._regions,e=>{et(t)?Vt(e.getXAxisHelper(),this.axisHelper(),S(this._seriesUserId)||S(this._seriesIndex))&&(e.setScaleX(this._scale),e.setXAxisHelper(this.axisHelper())):Se(t)?Vt(e.getYAxisHelper(),this.axisHelper(),S(this._seriesUserId)||S(this._seriesIndex))&&(e.setScaleY(this._scale),e.setYAxisHelper(this.axisHelper())):Dt(t)&&Vt(e.getZAxisHelper(),this.axisHelper(),S(this._seriesUserId)||S(this._seriesIndex))&&(e.setScaleZ(this._scale),e.setZAxisHelper(this.axisHelper()))},{userId:this._seriesUserId,specIndex:this._seriesIndex})}getBoundsInRect(t){var e;let i={x1:0,y1:0,x2:0,y2:0};if(!this._visible)return i;this._verticalLimitSize=et(this.getOrient())?t.height:t.width,this.setLayoutRect(t),!this.updateScaleRange()&&$((e=this.getTickData())===null||e===void 0?void 0:e.getLatestData())||this.computeData("range");const s={skipLayout:!1},a=et(this.getOrient());this.pluginService&&(a?this.callPlugin(l=>{l.onWillLayoutHorizontal&&l.onWillLayoutHorizontal(this.pluginService,s,this)}):this.callPlugin(l=>{l.onWillLayoutVertical&&l.onWillLayoutVertical(this.pluginService,s,this)}));const n=this._axisMark.getProduct();let r=!1;if(!s.skipLayout){const l=this._getUpdateAttribute(!0),h=n.getGroupGraphicItem(),d=J(Object.assign({},this.getLayoutStartPoint()),this._axisStyle,l,{line:{visible:!1}});let c=h.getBoundsWithoutRender(d);c.empty()&&(c=new cn().set(d.x,d.y,d.x,d.y)),r=!0,this._latestBounds=c,i=this._appendAxisUnit(c,a)}return r||(this._latestBounds=n.getBounds()),i}positionToData(t,e){const i=et(this.getOrient());e&&(t-=i?this.getLayoutStartPoint().x:this.getLayoutStartPoint().y),this._innerOffset&&(t=i?Le(t,this._innerOffset.left,this.getLayoutRect().width-this._innerOffset.right):Le(t,this._innerOffset.top,this.getLayoutRect().height-this._innerOffset.bottom));const s=this._scale.range();return(t-s[0])*(t-j(s))>0?null:this._scale.invert(t)}_getTitleLimit(t){var e,i,s,a,n;if(this._spec.title.visible&&C((e=this._spec.title.style)===null||e===void 0?void 0:e.maxLineWidth)){const r=(n=(s=(i=this._axisStyle.title)===null||i===void 0?void 0:i.angle)!==null&&s!==void 0?s:(a=this._spec.title.style)===null||a===void 0?void 0:a.angle)!==null&&n!==void 0?n:0;if(t){const d=this.getLayoutRect().width,c=Math.abs(Math.cos(r));return c<1e-6?1/0:d/c}const l=this.getLayoutRect().height,h=Math.abs(Math.sin(r));return h<1e-6?1/0:l/h}return null}_getUpdateAttribute(t){var e;let i=0,s=0;if(!t){const b=this.getRegions();let{x,y:v}=b[0].getLayoutStartPoint(),y=x+b[0].getLayoutRect().width,f=v+b[0].getLayoutRect().height;for(let A=1;A<b.length;A++){const k=b[A],{x:T,y:P}=k.getLayoutStartPoint(),{width:D,height:B}=k.getLayoutRect();x=Math.min(x,T),y=Math.max(y,D+T),v=Math.min(v,P),f=Math.max(f,B+P)}i=Math.abs(f-v),s=Math.abs(y-x)}const{width:a,height:n}=this.getLayoutRect(),r=et(this._orient),l=Se(this._orient),h=Dt(this._orient);let d={x:0,y:0},c=0,u=0;const g=this.layout3dBox?this.layout3dBox.length:0;if(r?(d={x:a,y:0},c=i,u=a):l&&(d={x:0,y:n},c=s,u=n),h){const b=(e=this.directionStr)!==null&&e!==void 0?e:"r2l",x=this.layout3dBox?this.layout3dBox.width:0;let v=[0,0],y=-Math.PI/2,f=0;b==="l2r"&&(f=this.layout3dBox.length,v=[0,0,0],y=Math.PI/2);const A=this.getLabelItems(a),k={start:{x:0,y:0},end:{x:g,y:0},z:f,alpha:y,anchor3d:v,title:{text:this._spec.title.text||this._dataFieldText,maxWidth:this._getTitleLimit(r)},items:A};return t||(k.grid={type:"line",start:{x:0,y:0},end:{x:g,y:0},items:A[0],verticalFactor:this._axisStyle.verticalFactor,depth:x,length:i,z:f,alpha:y,anchor3d:v}),k}let _=r?this.layout.minHeight:this.layout.minWidth;(r&&this._layout.layoutRectLevelMap.height===Us||l&&this._layout.layoutRectLevelMap.width===Us)&&(_=this._verticalLimitSize);const p=this.getLabelItems(u),m={start:{x:0,y:0},end:d,title:{text:this._spec.title.text||this._dataFieldText,maxWidth:this._getTitleLimit(r)},items:p,verticalLimitSize:this._verticalLimitSize,verticalMinSize:_,label:{overflowLimitLength:this._getLabelOverflowLimit(r)}};return t||(m.grid={type:"line",start:{x:0,y:0},end:d,items:p[0],verticalFactor:this._axisStyle.verticalFactor,depth:g,length:c}),m}getLabelItems(t){var e;const i=(e=this.getTickData())===null||e===void 0?void 0:e.getLatestData();return i&&i.length?[i.map(s=>{const a=this._getNormalizedValue([s.value],t);return qe(s.value,a)}).filter(s=>{const{value:a,rawValue:n}=s,r=this._scale.domain();return this.getSpec().type==="log"?a>=0&&a<=1:K(this._scale.type)?n>=r[0]&&n<=j(r):r.includes(n)})]:[]}initEvent(){super.initEvent(),this.visible&&(this.event.on(V.layoutEnd,this._updateAxisLayout),this.event.on(V.layoutEnd,this._fixAxisOnZero),this.event.on(V.layoutRectUpdate,()=>{this._clearLayoutCache()}))}_getNormalizedValue(t,e){return e===0?0:this.dataToPosition(t)/e}_layoutCacheProcessing(t){return["width","height"].forEach(e=>{t[e]<this._layoutCache[e]?t[e]=this._layoutCache[e]:this._layoutCache[e]=t[e]}),this._autoIndentOnce&&this._hasAutoIndent?["x1","x2","y1","y2"].forEach(e=>{this.layout.getLastComputeOutBounds()[e]=this._layoutCache._lastComputeOutBounds[e]}):(this._hasAutoIndent=!0,["x1","x2","y1","y2"].forEach(e=>{this.layout.getLastComputeOutBounds()[e]<this._layoutCache._lastComputeOutBounds[e]?this.layout.getLastComputeOutBounds()[e]=this._layoutCache._lastComputeOutBounds[e]:this._layoutCache._lastComputeOutBounds[e]=this.layout.getLastComputeOutBounds()[e]})),t}_clearLayoutCache(){this._hasAutoIndent=!1,this._layoutCache.width=0,this._layoutCache.height=0,this._layoutCache._lastComputeOutBounds={x1:0,x2:0,y1:0,y2:0}}onDataUpdate(){this._clearLayoutCache()}_appendAxisUnit(t,e){var i;if(this._spec.unit&&this._spec.unit.visible){const{text:s,style:a}=this._spec.unit;let n,r;const{x:l,y:h}=this.getLayoutStartPoint();e?(n={x:Bt(this._scale.range())+l,y:h},r={textAlign:"left",textBaseline:"middle"}):(n={x:l,y:It(this._scale.range())+h},r={textAlign:this._orient==="left"?"left":"right",textBaseline:"bottom"}),r=Object.assign(Object.assign(Object.assign({},r),a),{x:n.x,y:n.y,text:s}),this._unitText?this._unitText.setAttributes(r):(this._unitText=fo(r),this._unitText.name="axis-unit",(i=this.getContainer())===null||i===void 0||i.add(this._unitText));const d=this._unitText.AABBBounds;e?(t.x2+=d.x2>t.x2?d.x2-t.x2:0,t.y2+=d.y2>t.y2?d.y2-t.y2:0):(t.x1+=d.x1<t.x1?d.x1-t.x1:0,t.y1+=d.y1<t.y1?d.y1-t.y1:0)}return t}_getNeedClearVRenderComponents(){return this._unitText?[this._unitText]:[]}_getLabelOverflowLimit(t){var e,i;if(t&&((e=this._spec.label)===null||e===void 0?void 0:e.visible)!==!1&&((i=this._spec.label)===null||i===void 0?void 0:i.autoLimit)===!0){const s=this._option.getComponentsByKey("axes"),a=this.getRegions(),n=s.filter(c=>{const u=c.getOrient();return(u==="left"||u==="right")&&c.getRegions().some(g=>a.includes(g))});let r=0,l=0;const h=this.getLayoutStartPoint().x,d=h+this.getLayoutRect().width;return n.forEach(c=>{const u=c.getLayoutStartPoint().x;if(c.getOrient()==="left"&&u===h){const g=c.getLayoutRect().width;r=Math.max(r,g)}else if(u===d){const g=c.getLayoutRect().width;l=Math.max(l,g)}}),{left:r,right:l}}}}bi.type=F.cartesianAxis,bi.specKey="axes";const yd=(o,t,e)=>e.reduce((i,s,a)=>(i.push([s,e.length===a+1?t:e[a+1]]),i),[[o,e[0]]]);function bd(o,t){const e=o[0],i=o[o.length-1],s=t.filter(a=>a>e&&a<i);return s.length===0?[[e,i]]:yd(e,i,s)}const Va=(o,t)=>o-t,xd=(o,t)=>{const e=[0];let i=0,s=0;for(;i<t.length;)o[s]<=t[i]?(e[i]+=1,s+=1):(i+=1,e[i]=0);return e[i]=o.slice(s).length,e};function fd(o,t){const e=xd(o,t),i=o.length;return e.reduce((s,a,n)=>{const r=s[n-1]?s[n-1][1]:0,l=(100*r+100*+(a/i).toFixed(2))/100;return s.push([r,l>1||l>.95?1:l]),s},[]).filter(s=>!(s[0]===0&&s[1]===0||s[0]===1&&s[1]===1))}function Sd(o,t){return o.sort(Va),t.sort(Va),{domain:bd(o,t),scope:fd(o,t)}}const Ad=Math.sqrt(50),kd=Math.sqrt(10),Md=Math.sqrt(2);class _r{constructor(){this._extend={},this.niceLabelFormatter=null}setExtraAttrFromSpec(){S(this._spec.nice)&&(this._nice=this._spec.nice),S(this._spec.zero)&&(this._zero=this._spec.zero),this._expand=this._spec.expand,this._domain=Zs(this._spec)}transformScaleDomain(){this.setScaleNice()}setLinearScaleNice(){var t;if(!this._nice)return!1;let e=5;const i=this._spec.tick||{};if(O(i.forceTickCount))e=i.forceTickCount;else if(R(i.tickCount)){const n=this._scale.range();let r=Math.abs(j(n)-n[0]);r===1&&this._option&&(r=et(this._orient)?this._option.getChartViewRect().width:this._option.getChartViewRect().height),e=i.tickCount({axisLength:r,labelStyle:this._spec.label&&this._spec.label.style})}else e=O(i.tickCount)?i.tickCount:5;this._spec.niceType==="accurateFirst"&&(e=Math.max(5,e));const{min:s,max:a}=(t=this._domain)!==null&&t!==void 0?t:{};return C(s)&&C(a)&&C(this._softMaxValue)&&C(this._softMinValue)?this._scale.nice(e):(S(s)||S(this._softMinValue))&&C(a)&&C(this._softMaxValue)?this._scale.niceMax(e):!(!C(s)||!C(this._softMinValue)||!S(a)&&!S(this._softMaxValue))&&this._scale.niceMin(e)}setLogScaleNice(){var t;if(!this._nice)return!1;const{min:e,max:i}=(t=this._domain)!==null&&t!==void 0?t:{};return C(e)&&C(i)&&C(this._softMaxValue)&&C(this._softMinValue)?this._scale.nice():(S(e)||S(this._softMinValue))&&C(i)&&C(this._softMaxValue)?this._scale.niceMax():!(!C(e)||!C(this._softMinValue)||!S(i)&&!S(this._softMaxValue))&&this._scale.niceMin()}setScaleNice(){return this._spec.type==="log"?this.setLogScaleNice():this.setLinearScaleNice()}dataToPosition(t,e){return this.valueToPosition(t[0])}valueToPosition(t){return this._scale.scale(t)}computeLinearDomain(t){let e=[];if(t.length){const i=this._spec.breaks&&this._spec.breaks.length;let s,a,n=[];if(t.forEach(r=>{const{min:l,max:h}=r;s=s===void 0?l:Math.min(s,l),a=a===void 0?h:Math.max(a,h),i&&(n=n.concat(r.values))}),i){const r=[],l=[];for(let h=0;h<this._spec.breaks.length;h++){const{range:d}=this._spec.breaks[h];d[0]<=d[1]&&d[1]<=a&&(r.push(d),l.push(this._spec.breaks[h]))}if(r.sort((h,d)=>h[0]-d[0]),r.length){const{domain:h,scope:d}=Sd(n,ts(r));e=ts(h),this._break={domain:h,scope:d,breakDomains:r,breaks:l}}else e=[s,a]}else e=[s,a]}else e[0]=0,e[1]=0;return this.setSoftDomainMinMax(e),this.expandDomain(e),this.includeZero(e),this.setDomainMinMax(e),e}expandDomain(t){if(!this._expand)return;let e=t[0],i=j(t);e===i&&(i===0?i=1:i>0?e=0:i<0&&(i=0)),S(this._expand.min)&&(t[0]=e-(i-e)*this._expand.min),S(this._expand.max)&&(t[t.length-1]=i+(i-e)*this._expand.max)}niceDomain(t){const{min:e,max:i}=Zs(this._spec);if(S(e)||S(i)||this._spec.type!=="linear")return t;if(Math.abs(It(t)-Bt(t))<=1e-12){let s=t[0];const a=s>=0?1:-1;if(s=Math.abs(s),s<1)t[0]=0,t[t.length-1]=1;else{let n=s/5;const r=Math.floor(Math.log(n)/Math.LN10),l=n/Math.pow(10,r);n=(l>=Ad?10:l>=kd?5:l>=Md?2:1)*Math.pow(10,r),t[0]=0,t[t.length-1]=10*n}a<0&&(t.reverse(),t[0]*=-1,t[t.length-1]*=-1)}return t}includeZero(t){this._zero&&(t[0]=Math.min(t[0],0),t[t.length-1]=Math.max(j(t),0))}setExtendDomain(t,e){if(e===void 0)return void delete this._extend[t];this._extend[t]=e;const i=this._scale.domain();this.extendDomain(i),this.includeZero(i),this.setDomainMinMax(i),this.niceDomain(i),this._scale.domain(i,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this.event.emit(V.scaleUpdate,{model:this,value:"domain"})}extendDomain(t){let e;const i=t.length-1,s=t[0]-t[i]>0,a=s?i:0,n=s?0:i;for(const r in this._extend)e=this._extend[r],e>t[n]&&(t[n]=e),e<t[a]&&(t[a]=e)}getDomainSpec(){return this._domain}setDomainMinMax(t){if(!this._domain)return;const{min:e,max:i}=this._domain;S(e)&&(t[0]=e),S(i)&&(t[t.length-1]=i)}setSoftDomainMinMax(t){const{softMin:e,softMax:i}=this._spec;if(S(e)){let s=R(e)?e(t):e;C(s)&&(s=t[0]),s<=t[0]&&(t[0]=s,this._softMinValue=s)}if(S(i)){let s=R(i)?i(t):i;C(s)&&(s=j(t)),s>=j(t)&&(t[t.length-1]=s),this._softMaxValue=s}}setZero(t){this._zero!==t&&(this._zero=t,this.updateScaleDomain())}updateScaleDomain(){if(!this.isSeriesDataEnable())return;const t=this.collectData(),e=this.computeLinearDomain(t);this.updateScaleDomainByModel(e)}updateScaleDomainByModel(t){t=t??this._scale.domain(),this.extendDomain(t),this.includeZero(t),this.setDomainMinMax(t),this.niceDomain(t),this._scale.domain(t,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this._updateNiceLabelFormatter(t),this._domainAfterSpec=this._scale.domain(),this.event.emit(V.scaleDomainUpdate,{model:this}),this.event.emit(V.scaleUpdate,{model:this,value:"domain"})}getDomainAfterSpec(){return this._domainAfterSpec}_updateNiceLabelFormatter(t){const e=Math.abs(j(t)-t[0]),i=Math.max(-Math.floor(Math.log10(e)),0)+2,s=Math.pow(10,i);this.niceLabelFormatter=a=>O(+a)?Math.round(+a*s)/s:a}}class ue extends bi{constructor(){super(...arguments),this.type=F.cartesianLinearAxis,this._zero=!0,this._nice=!0,this._extend={},this._scale=new yn}setAttrFromSpec(){super.setAttrFromSpec(),this.setExtraAttrFromSpec()}initScales(){var t,e;super.initScales();const i=[0,1];S((t=this._domain)===null||t===void 0?void 0:t.min)&&(i[0]=this._domain.min),S((e=this._domain)===null||e===void 0?void 0:e.max)&&(i[1]=this._domain.max),this._scale.domain(i)}_tickTransformOption(){var t;return Object.assign(Object.assign({},super._tickTransformOption()),{breakData:!((t=this._spec.breaks)===null||t===void 0)&&t.length?()=>this._break:null})}_getUpdateAttribute(t){var e,i;const s=super._getUpdateAttribute(t);if(!Dt(this._orient)&&(!((i=(e=this._break)===null||e===void 0?void 0:e.breaks)===null||i===void 0)&&i.length)){const{width:a,height:n}=this.getLayoutRect(),r=et(this._orient),l=r?a:n;s.breaks=this._break.breaks.map(h=>{const{range:d,breakSymbol:c,gap:u=6}=h,g=this.valueToPosition((d[0]+d[1])/2)/l;let _;_=qt(u)?Number(u.substring(0,u.length-1))/100:u/l;const p=O(c==null?void 0:c.angle)?c.angle:r?60:15;return{range:[g-_/2,g+_/2],breakSymbol:Object.assign(Object.assign({visible:!0},c),{angle:p*Math.PI/180}),rawRange:d}})}return s}getNewScaleRange(){var t,e;let i=super.getNewScaleRange();return!((t=this._spec.breaks)===null||t===void 0)&&t.length&&(!((e=this._break)===null||e===void 0)&&e.scope)&&(i=ts(this._break.scope).map(s=>i[0]+(j(i)-i[0])*s)),i}computeDomain(t){return this.computeLinearDomain(t)}axisHelper(){const t=super.axisHelper();return t.setExtendDomain=this.setExtendDomain.bind(this),t.valueToPosition=this.valueToPosition.bind(this),t}registerTicksTransform(){const t=`${this.type}-ticks`;return at(this._option.dataSet,t,bs),t}}ue.type=F.cartesianLinearAxis,ue.specKey="axes",At(ue,_r);const we=()=>{Gi(),Ui(),Ni(),X.registerComponent(ue.type,ue)};class Td{constructor(){this._rawDomainIndex=[]}_initData(){var t;if(this._spec.showAllGroupLayers&&this._scales.length>1)for(let e=0;e<this._scales.length;e++){const i=((t=this._spec.layers)!==null&&t!==void 0?t:[])[this._scales.length-1-e]||{};if(i.visible!==!1&&i.tickCount!==0&&i.forceTickCount!==0){const s=this._initTickDataSet(Object.assign(Object.assign({},this._tickTransformOption()),i),e);s.target.addListener("change",this._forceLayout.bind(this));const a=new Ke(this._option,s);this._tickData.push(a),this._tickDataMap||(this._tickDataMap={}),this._tickDataMap[e]=a}}else{const e=this._initTickDataSet(this._tickTransformOption());e.target.addListener("change",this._forceLayout.bind(this));const i=new Ke(this._option,e);this._tickData=[i],this._tickDataMap={0:i}}}dataToPosition(t,e={}){var i,s;if(t.length===0||this._scales.length===0)return 0;const{position:a,bandScale:n}=this.getPosition(t);return a+n.bandwidth()*((s=(i=e.bandPosition)!==null&&i!==void 0?i:this._spec.bandPosition)!==null&&s!==void 0?s:this._defaultBandPosition)}valueToPosition(t){return this._scale.scale(t)}updateGroupScaleRange(){let t=this._scale;this._scales.forEach((e,i)=>{i>0&&(e.range([0,t.bandwidth()]),t=e)})}getPosition(t){let e=0,i=this._scale;if(this._scales.length===1||t.length===1)e=this.valueToPosition(t[0]);else{const s=Math.min(t.length,this._scales.length);for(let a=0;a<s;a++)e+=this._scales[a].scale(t[a]);i=this._scales[s-1]}return{position:e,bandScale:i}}calcScales(t,e){var i,s;const{bandPadding:a,paddingInner:n,paddingOuter:r}=this._spec,l=$(a),h=$(n),d=$(r);for(let c=0;c<this._scales.length;c++){const u=l?a[c]:a,g=h?n[c]:n,_=d?r[c]:r;this._scales[c].paddingInner((i=g??u)!==null&&i!==void 0?i:t,!0).paddingOuter((s=_??u)!==null&&s!==void 0?s:e,!0)}}computeBandDomain(t){if(!t.length)return[];if(t.length===1)return t[0].values;const e=new Set;for(let i=0;i<t.length;i++)for(let s=0;s<t[i].values.length;s++)e.add(t[i].values[s]);return Array.from(e)}updateScaleDomain(){var t;if(!this.isSeriesDataEnable())return;!(!((t=this._rawDomainIndex)===null||t===void 0)&&t.length)&&this._scales.length&&this._updateRawDomain();const e=this._spec.domain;for(let i=0;i<this._scales.length;i++)if(e&&e.length&&i===0)this._scales[i].domain(e);else{const s=this.collectData(i),a=this.computeBandDomain(s);this._scales[i].domain(a.sort((n,r)=>this._rawDomainIndex[i][n]-this._rawDomainIndex[i][r]))}this.transformScaleDomain(),this.event.emit(V.scaleDomainUpdate,{model:this}),this.event.emit(V.scaleUpdate,{model:this,value:"domain"})}getLabelItems(t){const e=[];let i=[];return this._scales.forEach((s,a)=>{var n;const r=this._tickDataMap[a],l=(n=r==null?void 0:r.getLatestData())===null||n===void 0?void 0:n.length,h=l?r.getLatestData().map(d=>d.value):s.domain();if(h&&h.length)if(i&&i.length){const d=[],c=[];i.forEach(u=>{h.forEach(g=>{const _=L(u).concat(g);if(c.push(_),l){const p=qe(g,this._getNormalizedValue(_,t));d.push(p)}})}),l&&e.push(d.filter(u=>u.value>=0&&u.value<=1)),i=c}else h.forEach(d=>{i.push(d)}),l&&e.push(r.getLatestData().map(d=>qe(d.value,this._getNormalizedValue([d.value],t))).filter(d=>d.value>=0&&d.value<=1))}),e.reverse()}_updateRawDomain(){this._rawDomainIndex=[];const t=this._spec.domain;for(let e=0;e<this._scales.length;e++)if(t&&t.length&&e===0)this._scales[e].domain(t);else{const i=this.collectData(e,!0),s=this.computeBandDomain(i);this._rawDomainIndex[e]={},s.forEach((a,n)=>this._rawDomainIndex[e][a]=n)}}_clearRawDomain(){this._rawDomainIndex=[]}}class Ye extends bi{constructor(){super(...arguments),this.type=F.cartesianBandAxis,this._scale=new bn}computeDomain(t){return this.computeBandDomain(t)}updateScaleRange(){const t=super.updateScaleRange();return this.updateGroupScaleRange(),t}initScales(){super.initScales(),this.calcScales(this._defaultBandInnerPadding,this._defaultBandOuterPadding)}axisHelper(){const t=(e=0)=>this._scales[e];return{isContinuous:!1,dataToPosition:this.dataToPosition.bind(this),getScale:t,getBandwidth:(e=0)=>t(e).bandwidth(),getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>this._inverse,getSpec:()=>this._spec}}registerTicksTransform(){const t=`${this.type}-ticks`;return at(this._option.dataSet,t,yh),t}transformScaleDomain(){this.updateFixedWholeLength()}updateFixedWholeLength(){if(this._scale){const{bandSize:t,maxBandSize:e,minBandSize:i}=this._getOuterBandSizeFromSpec();if(t&&this._scale.bandwidth(t),e&&this._scale.maxBandwidth(e),i&&this._scale.minBandwidth(i),this._scale.isBandwidthFixed()&&this._spec.autoRegionSize&&(t||e)){const s=Ns(this._scale.domain().length,t??e,this._scale.paddingInner(),this._scale.paddingOuter());["bottom","top"].includes(this._orient)?this._regions.forEach(a=>a.setMaxWidth(s)):["left","right"].includes(this._orient)&&this._regions.forEach(a=>a.setMaxHeight(s))}}}_getOuterBandSizeFromSpec(){var t;let{bandSize:e,maxBandSize:i,minBandSize:s,bandSizeLevel:a=0}=this._spec;const{gap:n,extend:r=0}=(t=this._spec.bandSizeExtend)!==null&&t!==void 0?t:{};a=Math.min(a,this._scales.length-1);for(let l=a;l>0;l--){const h=this._scales[l],d=h.domain(),c=h.paddingInner(),u=h.paddingOuter(),g=_=>{const p=l===a?r:0;return C(n)||l<a?Ns(d.length,_,c,u)+p:(_+(q(n)?_*(Number(n.substring(0,n.length-1))/100):n))*d.length/(this._scales[l-1].paddingInner()+1)+p};S(e)&&(e=g(e)),S(i)&&(i=g(i)),S(s)&&(s=g(s))}return{bandSize:e,maxBandSize:i,minBandSize:s}}}Ye.type=F.cartesianBandAxis,Ye.specKey="axes",At(Ye,Td);const ze=()=>{Gi(),Ui(),Ni(),X.registerComponent(Ye.type,Ye)};class xi extends ue{constructor(){super(...arguments),this.type=F.cartesianTimeAxis,this._zero=!1,this.effect={scaleUpdate:t=>{this.computeData(t==null?void 0:t.value),vt(this._regions,e=>{et(this.getOrient())?Vt(e.getXAxisHelper(),this.axisHelper(),S(this._seriesUserId)||S(this._seriesIndex))&&e.setXAxisHelper(this.axisHelper()):Vt(e.getYAxisHelper(),this.axisHelper(),S(this._seriesUserId)||S(this._seriesIndex))&&e.setYAxisHelper(this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}}}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._tick=J({},this._spec.tick,(t=this._spec.layers)===null||t===void 0?void 0:t[0])}_initData(){var t;if(super._initData(),(t=this._spec.layers)===null||t===void 0?void 0:t[1]){const e=new bt(this._option.dataSet,{name:`${this.type}_${this.id}_layer_1_ticks`}).parse(this._scale,{type:"scale"}).transform({type:`${this.type}-ticks`,options:Object.assign(Object.assign({},this._tickTransformOption()),{tickCount:this._spec.layers[1].tickCount,forceTickCount:this._spec.layers[1].forceTickCount,tickStep:this._spec.layers[1].tickStep})},!1);this._layerTickData=new Ke(this._option,e)}}computeData(t){super.computeData(t),this._layerTickData&&(this._layerTickData.getDataView().reRunAllTransform(),this._layerTickData.updateData())}_getLabelFormatMethod(){var t,e,i,s,a,n,r,l;const h=So.getInstance(),d=((e=(t=this._spec.layers)===null||t===void 0?void 0:t[1])===null||e===void 0?void 0:e.timeFormat)||"%Y%m%d",c=(((s=(i=this._spec.layers)===null||i===void 0?void 0:i[1])===null||s===void 0?void 0:s.timeFormatMode)||"local")==="local"?h.timeFormat:h.timeUTCFormat,u=((n=(a=this._spec.layers)===null||a===void 0?void 0:a[0])===null||n===void 0?void 0:n.timeFormat)||"%Y%m%d",g=(((l=(r=this._spec.layers)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.timeFormatMode)||"local")==="local"?h.timeFormat:h.timeUTCFormat;return(_,p,m,b,x)=>{var v;let y;return y=x===0?g(u,_):c(d,_),!((v=this._spec.label)===null||v===void 0)&&v.formatMethod?this._spec.label.formatMethod(y,p):y}}getLabelItems(t){var e,i;const s=[],a=(e=this.getTickData())===null||e===void 0?void 0:e.getLatestData();a&&a.length&&s.push(a.map(r=>qe(r.value,this._getNormalizedValue([r.value],t))));const n=(i=this._layerTickData)===null||i===void 0?void 0:i.getLatestData();return n&&n.length&&s.push(n.map(r=>qe(r.value,this._getNormalizedValue([r.value],t)))),s}registerTicksTransform(){const t=`${this.type}-ticks`;return at(this._option.dataSet,t,bs),t}transformScaleDomain(){}}xi.type=F.cartesianTimeAxis,xi.specKey="axes";const pr=()=>{Gi(),Ui(),Ni(),X.registerComponent(xi.type,xi)};class Ge extends ue{constructor(){super(...arguments),this.type=F.cartesianLogAxis,this._zero=!1,this._scale=new Yi}initScales(){var t;super.initScales(),this._scale.base((t=this._spec.base)!==null&&t!==void 0?t:10),this._scale.clamp(!0,null,!1)}registerTicksTransform(){const t=`${this.type}-ticks`;return at(this._option.dataSet,t,bs),t}transformScaleDomain(){}}Ge.type=F.cartesianLogAxis,Ge.specKey="axes",At(Ge,_r);const mr=()=>{Gi(),Ui(),Ni(),X.registerComponent(Ge.type,Ge)};class Me extends Fi{constructor(){super(...arguments),this.type=xt.line,this.transformerConstructor=Ts,this._sortDataByAxis=!1}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}initMark(){var t;const e={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},i=(t=this._spec.seriesMark)!==null&&t!==void 0?t:"line";this.initLineMark(e,i==="line"),this.initSymbolMark(e,i==="point")}initTooltip(){super.initTooltip();const{group:t,mark:e}=this._tooltipHelper.activeTriggerSet;this._lineMark&&t.add(this._lineMark),this._symbolMark&&(e.add(this._symbolMark),t.add(this._symbolMark))}initMarkStyle(){this.initLineMarkStyle(this._direction),this.initSymbolMarkStyle()}initAnimation(){var t,e,i,s;const a={direction:this.direction},n=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;if(this._lineMark.setAnimationConfig(Ct((i=X.getAnimationInKey("line"))===null||i===void 0?void 0:i(a,n),Zt("line",this._spec,this._markAttributeContext))),this._symbolMark){const r=Hi(this);this._symbolMark.setAnimationConfig(Ct((s=X.getAnimationInKey("scaleInOut"))===null||s===void 0?void 0:s(),Zt("point",this._spec,this._markAttributeContext),r))}}onLayoutEnd(t){super.onLayoutEnd(t),this.reCompileSampling()}getSeriesStyle(t){var e;const i=((e=this._spec)===null||e===void 0?void 0:e.seriesMark)!=="point";return s=>{var a,n;return i&&s==="fill"&&(s="stroke"),(n=(a=this._seriesMark)===null||a===void 0?void 0:a.getAttribute(s,t))!==null&&n!==void 0?n:void 0}}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._lineMark,this._symbolMark]}}Me.type=xt.line,Me.mark=ud,Me.transformerConstructor=Ts,At(Me,ur);const vr=()=>{Ms(),dr(),xn(),ps(),fn(),Sn(),ze(),we(),X.registerSeries(Me.type,Me)};class Cd extends An{needAxes(){return!0}_isValidSeries(t){return!this.seriesType||t===this.seriesType}_getDefaultSeriesSpec(t){const e=Object.assign(Object.assign({},super._getDefaultSeriesSpec(t)),{xField:t.xField,yField:t.yField,zField:t.zField,seriesField:t.seriesField,seriesStyle:t.seriesStyle,direction:t.direction,stack:t.stack,percent:t.percent,stackOffsetSilhouette:t.stackOffsetSilhouette,totalLabel:t.totalLabel,sortDataByAxis:t.sortDataByAxis}),i=this.seriesType;return i&&(e.type=i,e[i]=t[i]),e}transformSpec(t){super.transformSpec(t);const e=this._getDefaultSeriesSpec(t);t.series&&t.series.length!==0?t.series.forEach(i=>{this._isValidSeries(i.type)&&Object.keys(e).forEach(s=>{s in i||(i[s]=e[s])})}):t.series=[e],this._transformAxisSpec(t)}_setDefaultXAxisSpec(t){return{orient:"bottom"}}_setDefaultYAxisSpec(t){return{orient:"left"}}_setDefaultZAxisSpec(t){return{orient:"z"}}_transformAxisSpec(t){if(this.needAxes()){t.axes||(t.axes=[]);const e={x:!1,y:!1,z:!1};t.axes.forEach(i=>{const{orient:s}=i;let a=null;s!=="top"&&s!=="bottom"||(e.x=!0,a=this._setDefaultXAxisSpec(t)),s!=="left"&&s!=="right"||(e.y=!0,a=this._setDefaultYAxisSpec(t)),s==="z"&&(e.z=!0,a=this._setDefaultZAxisSpec(t)),a&&Object.keys(a).forEach(n=>{C(i[n])&&(i[n]=a[n])}),W(i,"trimPadding")&&J(i,kn(this.type,t))}),e.x||t.axes.push(this._setDefaultXAxisSpec(t)),e.y||t.axes.push(this._setDefaultYAxisSpec(t)),t.zField&&!e.z&&t.axes.push(this._setDefaultZAxisSpec(t))}}}class yr extends Cd{_getDefaultSeriesSpec(t){var e;return Object.assign(Object.assign({},super._getDefaultSeriesSpec(t)),{point:t.point,line:t.line,seriesMark:(e=t.seriesMark)!==null&&e!==void 0?e:"line",activePoint:t.activePoint,sampling:t.sampling,samplingFactor:t.samplingFactor,pointDis:t.pointDis,pointDisMul:t.pointDisMul,markOverlap:t.markOverlap,lineLabel:t.lineLabel})}transformSpec(t){super.transformSpec(t),Ao(t)}}const Bd=(o,t)=>{const e={nodes:{}},{fields:i}=t;if(!(i!=null&&i.length))return e;const s=i.length-1;let a,n,r=e;return o.forEach(l=>{l.latestData&&l.latestData.forEach(h=>{r=e;for(let d=0;d<i.length;d++){const c=i[d],u=h[c];if(C(u))break;r.groupField=c,r.nodes[u]||(d===s?r.nodes[u]={values:[]}:(a={nodes:{}},r.nodes[u]=a)),d===s?(n=r.nodes[u],n.values.push(h)):r=r.nodes[u]}})}),e};class Pd{constructor(t,e){this.stackRegion=({model:i})=>{var s;const a=i.getSeries();if(!a.some(d=>d.getStack()))return;const n=a.some(d=>{var c,u;return(u=(c=d.getSpec())===null||c===void 0?void 0:c.totalLabel)===null||u===void 0?void 0:u.visible}),r=n||a.some(d=>d.getPercent()),l=a.some(d=>d.getStackOffsetSilhouette()),h=Mn(i,!0);for(const d in h)for(const c in h[d].nodes)ko(h[d].nodes[c],i.getStackInverse(),r,n);if(l)for(const d in h)for(const c in h[d].nodes)Mo(h[d].nodes[c]);n&&i.getSeries().forEach(d=>{const c=d.getStackData(),u=d.getStackValue(),g=d.getStackValueField();c&&g&&To(h[u],g)}),!((s=this._options)===null||s===void 0)&&s.afterStackRegion&&this._options.afterStackRegion(i,h)},this._chart=t,this._options=e}init(){this._chart.getAllRegions().forEach(t=>{t.event.on(V.regionSeriesDataFilterOver,{filter:({model:e})=>(e==null?void 0:e.id)===t.id},this.stackRegion)})}stackAll(){this._chart.getAllRegions().forEach(t=>{this.stackRegion({model:t})})}}class br{_beforeInit(){this._dataSet&&at(this._dataSet,"stackSplit",Bd)}_initStack(){this._stack=new Pd(this),this._stack.init()}}let Te=class extends Tn{constructor(){super(...arguments),this.transformerConstructor=yr,this.type="line",this.seriesType=xt.line}};Te.type="line",Te.seriesType=xt.line,Te.transformerConstructor=yr,At(Te,br);const Ld=()=>{vr(),X.registerChart(Te.type,Te)};class Dd extends Co{constructor(){super(...arguments),this._getSeriesStyle=(t,e,i)=>{var s,a,n,r;for(const l of L(e)){let h=(s=this.series.getSeriesStyle(t))===null||s===void 0?void 0:s(l);if(h!==!1||l!=="fill"&&l!=="stroke"||(h=l==="fill"?(n=(a=this.series.getSeriesStyle(t))===null||a===void 0?void 0:a("stroke"))===null||n===void 0?void 0:n[0]:(r=this.series.getSeriesStyle(t))===null||r===void 0?void 0:r("fill")),S(h))return h}return i}}}const Od=Object.assign(Object.assign(Object.assign({},_e),se),{area:{name:"area",type:"area"}}),Ed=()=>{Bo(),fn(),Sn()};class xr extends Ts{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(t){var e,i,s;super._transformLabelSpec(t),this._addMarkLabelSpec(t,"area","areaLabel","initLineLabelMarkStyle",void 0,!0),((e=t.point)===null||e===void 0?void 0:e.visible)!==!1&&((s=(i=t.point)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.visible)!==!1||this._addMarkLabelSpec(t,"area")}_transformSpecAfterMergingTheme(t,e,i){var s,a,n,r,l;super._transformSpecAfterMergingTheme(t,e,i);const{area:h={},line:d={},seriesMark:c}=t,u=h.visible!==!1&&((s=h.style)===null||s===void 0?void 0:s.visible)!==!1,g=d.visible!==!1&&((a=d.style)===null||a===void 0?void 0:a.visible)!==!1;h.support3d=!(!h.support3d&&!d.support3d),h.zIndex=S(h.zIndex)||S(d.zIndex)?Math.max((n=h.zIndex)!==null&&n!==void 0?n:0,(r=d.zIndex)!==null&&r!==void 0?r:0):void 0,h.style&&delete h.style.stroke,h.state&&Object.keys(h.state).forEach(m=>{"style"in h.state[m]?delete h.state[m].style.stroke:delete h.state[m].stroke});let _=h,p=d;(c==="line"||g&&!u)&&(_=d,p=h),h.style=J({},p.style,_.style),h.state=J({},p.state,_.state),u||(h.style.fill=!1),g||(h.style.stroke=!1),h.interactive===!1&&(h.style.fillPickable=!1),d.interactive===!1&&(d.style.strokePickable=!1),h.interactive=!(!h.interactive&&(l=d.interactive)!==null&&l!==void 0&&!l),h.visible=!(!u&&!g),t.area=h,t.line=d}}class Gt extends Fi{constructor(){super(...arguments),this.type=xt.area,this.transformerConstructor=xr,this._sortDataByAxis=!1}initMark(){var t,e;const i={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},s=this._spec.area||{},a=s.visible!==!1&&((t=s.style)===null||t===void 0?void 0:t.visible)!==!1,n=(e=this._spec.seriesMark)!==null&&e!==void 0?e:"area";this._areaMark=this._createMark(Gt.mark.area,{groupKey:this._seriesField,isSeriesMark:a&&n!=="point",stateSort:s.stateSort},Object.assign(Object.assign({},i),{morphElementKey:this.getDimensionField()[0],setCustomizedShape:s.customShape})),this.initSymbolMark(i,n==="point")}initMarkStyle(){this.initAreaMarkStyle(),this.initSymbolMarkStyle()}initAreaMarkStyle(){var t,e,i,s,a;const n=(i=(e=(t=this.getSpec().area)===null||t===void 0?void 0:t.style)===null||e===void 0?void 0:e.curveType)!==null&&i!==void 0?i:(a=(s=this.getSpec().line)===null||s===void 0?void 0:s.style)===null||a===void 0?void 0:a.curveType,r=n===cr?this._direction==="horizontal"?"monotoneY":"monotoneX":n,l=this._areaMark;l&&(this._direction==="horizontal"?this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),x1:h=>{var d,c;return ct(this.dataToPositionX1(h),(c=(d=this._xAxisHelper)===null||d===void 0?void 0:d.getScale)===null||c===void 0?void 0:c.call(d,0))},y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null,orient:this._direction},"normal",I.Series):this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),y1:h=>{var d,c;return ct(this.dataToPositionY1(h),(c=(d=this._yAxisHelper)===null||d===void 0?void 0:d.getScale)===null||c===void 0?void 0:c.call(d,0))},y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",I.Series),this.setMarkStyle(l,{fill:this.getColorAttribute(),stroke:this.getColorAttribute()},"normal",I.Series),this._invalidType!=="zero"&&this.setMarkStyle(l,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",I.Series),this.setMarkStyle(l,{curveType:r},"normal",I.Built_In),Object.keys(l.stateStyle).forEach(h=>{l.stateStyle[h].stroke&&l.setPostProcess("stroke",d=>[d,!1,!1,!1],h)}))}initAnimation(){var t,e,i,s;const a={direction:this.direction},n=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;if(this._lineMark&&this._lineMark.setAnimationConfig(Ct((e=X.getAnimationInKey("line"))===null||e===void 0?void 0:e(a,n),Zt("line",this._spec,this._markAttributeContext))),this._areaMark&&this._areaMark.setAnimationConfig(Ct((i=X.getAnimationInKey("area"))===null||i===void 0?void 0:i(a,n),Zt("area",this._spec,this._markAttributeContext))),this._symbolMark){const r=Hi(this);this._symbolMark.setAnimationConfig(Ct((s=X.getAnimationInKey("scaleInOut"))===null||s===void 0?void 0:s(),Zt("point",this._spec,this._markAttributeContext),r))}}initTooltip(){this._tooltipHelper=new Dd(this);const{group:t,mark:e}=this._tooltipHelper.activeTriggerSet;this._areaMark&&t.add(this._areaMark),this._lineMark&&t.add(this._lineMark),this._symbolMark&&(e.add(this._symbolMark),t.add(this._symbolMark))}viewDataStatisticsUpdate(t){super.viewDataStatisticsUpdate(t),this.encodeDefined(this._areaMark,"defined")}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._areaMark,this._symbolMark,this._lineMark]}onLayoutEnd(t){super.onLayoutEnd(t),this.reCompileSampling()}getSeriesStyle(t){return e=>{var i,s,a,n,r;const l=(i=this._spec.seriesMark)!==null&&i!==void 0?i:"area";let h=(a=(s=this._seriesMark)===null||s===void 0?void 0:s.getAttribute(e,t))!==null&&a!==void 0?a:void 0;return e!=="fill"||h&&l!=="line"||(e="stroke",h=(r=(n=this._seriesMark)===null||n===void 0?void 0:n.getAttribute(e,t))!==null&&r!==void 0?r:void 0),e==="stroke"&&$(h)?h[0]:h}}}Gt.type=xt.area,Gt.mark=Od,Gt.transformerConstructor=xr,At(Gt,ur);const Rd=()=>{Ms(),dr(),xn(),Po(),ps(),Ed(),ze(),we(),X.registerSeries(Gt.type,Gt)};function fr(o,t=!0){return(e,i,s)=>{const a=o.direction==="vertical"?o.yField:o.xField,n=e==null?void 0:e[a];return o.direction==="vertical"?{overall:t&&o.growFrom(),orient:n>0?"negative":"positive"}:{overall:!!t&&o.growFrom(),orient:n>0?"positive":"negative"}}}const Sr=(o,t=!0)=>({type:o.direction==="horizontal"?"growWidthIn":"growHeightIn",options:fr(o,t)}),ja=(o,t=!0)=>({type:o.direction==="horizontal"?"growWidthOut":"growHeightOut",options:fr(o,t)}),Id={type:"fadeIn"},wd={type:"growCenterIn"};function zd(o,t){if(t===!1)return{};switch(t){case"fadeIn":return Id;case"scaleIn":return wd;default:return Sr(o)}}const Fd=()=>{X.registerAnimation("bar",(o,t)=>({appear:zd(o,t),enter:Sr(o,!1),exit:ja(o,!1),disappear:ja(o)}))},Hd=Object.assign(Object.assign({},_e),{bar:{name:"bar",type:"rect"},barBackground:{name:"barBackground",type:"rect"}});Object.assign(Object.assign({},_e),{bar3d:{name:"bar3d",type:"rect3d"}});function Ar(o,t,e){var i,s;if(o.values.length>0){let a;if(o.sortDatums.length){let n=o.sortDatums;t&&(n=o.sortDatums.slice().reverse());for(let r=0;r<n.length;r++)a=Xa(n[r].datum,a,n[r].series,e,(s=(i=n[r].series[e.axisHelper]).getScale)===null||s===void 0?void 0:s.call(i,0),r===0)}else{let n=o.series;t&&(n=n.slice().reverse()),n.forEach(({s:r,values:l},h)=>{var d,c;const u=(c=(d=r[e.axisHelper]).getScale)===null||c===void 0?void 0:c.call(d,0);for(let g=0;g<l.length;g++){const _=l[t?l.length-1-g:g];a=Xa(_,a,r,e,u,g===0&&h===0)}})}}for(const a in o.nodes)Ar(o.nodes[a],t,e)}function Xa(o,t,e,i,s,a){const n=e.getSpec().barMinHeight,r=e[i.axisHelper].isInverse(),l=ct(e[i.startMethod](o),s);let h=ct(e[i.endMethod](o),s);a&&(t=l);let d=Math.abs(l-h);d<n&&(d=n);let c=1;return h<l?c=-1:h===l&&(c=i.isVertical?r?1:-1:r?-1:1),h=t+c*d,o[i.start]=t,o[i.end]=h,h}class kr extends zi{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(t){this._addMarkLabelSpec(t,"bar")}}class Nt extends Fi{constructor(){super(...arguments),this.type=xt.bar,this._barMarkName="bar",this._barMarkType="rect",this.transformerConstructor=kr,this._bandPosition=0,this._getBarXStart=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),t[Ws]):this._spec.barMinHeight?this._calculateRectPosition(t,!1):ct(this._dataToPosX(t),e),this._getBarXEnd=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),t[$s]):ct(this._dataToPosX1(t),e),this._getBarYStart=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),t[Ks]):this._spec.barMinHeight?this._calculateRectPosition(t,!0):ct(this._dataToPosY(t),e),this._getBarYEnd=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),t[qs]):ct(this._dataToPosY1(t),e),this._getBarBackgroundXStart=t=>{const e=t.range();return Math.min(e[0],e[e.length-1])},this._getBarBackgroundXEnd=t=>{const e=t.range();return Math.max(e[0],e[e.length-1])},this._getBarBackgroundYStart=t=>{const e=t.range();return Math.min(e[0],e[e.length-1])},this._getBarBackgroundYEnd=t=>{const e=t.range();return Math.max(e[0],e[e.length-1])},this._getBarBackgroundPositionXEncoder=()=>{var t;return(t=this._barBackgroundPositionXEncoder)===null||t===void 0?void 0:t.bind(this)},this._setBarBackgroundPositionXEncoder=t=>{this._barBackgroundPositionXEncoder=t.bind(this)},this._getBarBackgroundPositionYEncoder=()=>{var t;return(t=this._barBackgroundPositionYEncoder)===null||t===void 0?void 0:t.bind(this)},this._setBarBackgroundPositionYEncoder=t=>{this._barBackgroundPositionYEncoder=t.bind(this)}}initMark(){var t,e;this._initBarBackgroundMark(),this._barMark=this._createMark(Object.assign(Object.assign({},Nt.mark.bar),{name:this._barMarkName,type:this._barMarkType}),{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(t=this._spec.bar)===null||t===void 0?void 0:t.stateSort},{progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold,morphElementKey:this.getDimensionField()[0],morph:wi(this._spec,this._barMarkName),setCustomizedShape:(e=this._spec.bar)===null||e===void 0?void 0:e.customShape})}_initBarBackgroundMark(){this._spec.barBackground&&this._spec.barBackground.visible&&(this._barBackgroundMark=this._createMark(Nt.mark.barBackground,{dataView:this._barBackgroundViewData.getDataView(),dataProductId:this._barBackgroundViewData.getProductId(),stateSort:this._spec.barBackground.stateSort},{setCustomizedShape:this._spec.barBackground.customShape,progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold}))}initMarkStyle(){this._barMark&&this.setMarkStyle(this._barMark,{fill:this.getColorAttribute()},"normal",I.Series)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null})}initTooltip(){super.initTooltip();const{mark:t,group:e}=this._tooltipHelper.activeTriggerSet;this._barMark&&(t.add(this._barMark),e.add(this._barMark))}_statisticViewData(){var t,e;super._statisticViewData();const i=(t=this._spec.barBackground)!==null&&t!==void 0?t:{};if(!i.visible)return;const s=this._getRelatedComponentSpecInfo("axes").some(n=>n.type===F.cartesianBandAxis);let a;if(at(this._option.dataSet,"addVChartProperty",Do),s){const n=([r],{scaleDepth:l})=>{var h,d;let c=[{}];const u=this.getDimensionField(),g=C(l)?u.length:Math.min(u.length,l);for(let _=0;_<g;_++){const p=u[_],m=(h=r.latestData[p])===null||h===void 0?void 0:h.values;if(!(m!=null&&m.length))continue;const b=[],x=(d=this._spec.dataKey)!==null&&d!==void 0?d:Bn;for(let v=0;v<m.length;v++)for(let y=0;y<c.length;y++)b.push(Object.assign(Object.assign({},c[y]),{[p]:m[v],[x]:m[v]}));c=b}return c};at(this._option.dataSet,"dimensionItems",n),a=new bt(this._option.dataSet).parse([this._viewDataStatistics],{type:"dataview"}).transform({type:"dimensionItems",options:{scaleDepth:C(i.fieldLevel)?void 0:i.fieldLevel+1}},!1).transform({type:"addVChartProperty",options:{beforeCall:Qs.bind(this),call:Js}},!1),(e=this._viewDataStatistics)===null||e===void 0||e.target.addListener("change",a.reRunAllTransform)}else{const n=([l])=>{const h=[],[d,c]=this.getDimensionContinuousField(),u={};return r.latestData.forEach(g=>{const _=`${g[d]}-${g[c]}`;u[_]||(u[_]={[d]:g[d],[c]:g[c]},h.push(u[_]))}),h};at(this._option.dataSet,"dimensionItems",n);const r=this.getViewData();a=new bt(this._option.dataSet).parse([r],{type:"dataview"}).transform({type:"dimensionItems"},!1).transform({type:"addVChartProperty",options:{beforeCall:Qs.bind(this),call:Js}},!1),r==null||r.target.addListener("change",a.reRunAllTransform)}this._barBackgroundViewData=new Cn(this._option,a)}init(t){var e,i;super.init(t),this.direction==="vertical"?((e=this._xAxisHelper)===null||e===void 0?void 0:e.getScale(0).type)==="band"?this.initBandRectMarkStyle():this.initLinearRectMarkStyle():((i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale(0).type)==="band"?this.initBandRectMarkStyle():this.initLinearRectMarkStyle()}_shouldDoPreCalculate(){const t=this.getRegion();return this.getStack()&&t.getSeries().filter(e=>e.type===this.type&&e.getSpec().barMinHeight).length}_calculateStackRectPosition(t){const e=this.getRegion();if(e._bar_series_position_calculated)return;let i,s,a,n,r;e._bar_series_position_calculated=!0,t?(i=qs,s=Ks,a="_dataToPosY1",n="_dataToPosY",r="_yAxisHelper"):(i=$s,s=Ws,a="_dataToPosX1",n="_dataToPosX",r="_xAxisHelper");const l=Mn(e,!1,h=>h.type===this.type);for(const h in l)for(const d in l[h].nodes)Ar(l[h].nodes[d],e.getStackInverse(),{isVertical:t,start:i,end:s,startMethod:a,endMethod:n,axisHelper:r})}_calculateRectPosition(t,e){var i,s;let a,n,r;e?(a="_dataToPosY1",n="_dataToPosY",r="_yAxisHelper"):(a="_dataToPosX1",n="_dataToPosX",r="_xAxisHelper");const l=(s=(i=this[r]).getScale)===null||s===void 0?void 0:s.call(i,0),h=this[r].isInverse(),d=this._spec.barMinHeight,c=ct(this[a](t),l),u=ct(this[n](t),l);let g=Math.abs(c-u);g<d&&(g=d);let _=1;return u<c?_=-1:u===c&&(_=e?h?1:-1:h?-1:1),c+_*g}_dataToPosX(t){return this.dataToPositionX(t)}_dataToPosX1(t){return this.dataToPositionX1(t)}_dataToPosY(t){return this.dataToPositionY(t)}_dataToPosY1(t){return this.dataToPositionY1(t)}initBandRectMarkStyle(){var t,e,i,s;const a=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),n=(s=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0);this.direction==="horizontal"?this.setMarkStyle(this._barMark,{x:r=>this._getBarXStart(r,a),x1:r=>this._getBarXEnd(r,a),y:r=>this._getPosition(this.direction,r),height:()=>this._getBarWidth(this._yAxisHelper),width:()=>{},y1:()=>{}},"normal",I.Series):this.setMarkStyle(this._barMark,{y:r=>this._getBarYStart(r,n),y1:r=>this._getBarYEnd(r,n),x:r=>this._getPosition(this.direction,r),width:()=>this._getBarWidth(this._xAxisHelper),x1:()=>{},height:()=>{}},"normal",I.Series),this._initStackBarMarkStyle(),this._initBandBarBackgroundMarkStyle()}_initStackBarMarkStyle(){var t,e,i,s;if(!this._spec.stackCornerRadius)return;const a=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),n=(s=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0);this._barMark.setMarkConfig({clip:!0,clipPath:()=>{const r=[];return this._forEachStackGroup(l=>{let h=1/0,d=-1/0,c=!1,u=1/0,g=-1/0;l.values.forEach(m=>{const b=m[ta],x=m[ea],v=m[ia],y=m[sa];h=Math.min(h,b,x),d=Math.max(d,b,x),S(v)&&S(y)&&(c=!0,u=Math.min(u,v,y),g=Math.max(g,v,y))});const _=Object.assign(Object.assign(Object.assign({},l.values[0]),{[ta]:h,[ea]:d}),c?{[ia]:u,[sa]:g}:void 0),p=this.direction==="horizontal"?{x:this._getBarXStart(_,a),x1:this._getBarXEnd(_,a),y:this._getPosition(this.direction,_),height:this._getBarWidth(this._yAxisHelper)}:{y:this._getBarYStart(_,n),y1:this._getBarYEnd(_,n),x:this._getPosition(this.direction,_),width:this._getBarWidth(this._xAxisHelper)};r.push(Oo(Object.assign(Object.assign({},p),{cornerRadius:R(this._spec.stackCornerRadius)?this._spec.stackCornerRadius(p,_,this._markAttributeContext):this._spec.stackCornerRadius,fill:!0})))}),r}})}initLinearRectMarkStyle(){var t,e,i,s;const a=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),n=(s=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0);if(this.direction==="horizontal"){const r=S(this._fieldY2)?{y:l=>ct(this._dataToPosY(l),n),y1:l=>ct(this._dataToPosY1(l),n)}:{y:l=>ct(this._dataToPosY(l)-this._getBarWidth(this._yAxisHelper)/2,n),height:l=>this._getBarWidth(this._yAxisHelper)};this.setMarkStyle(this._barMark,Object.assign({x:l=>this._getBarXStart(l,a),x1:l=>this._getBarXEnd(l,a)},r),"normal",I.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign({x:()=>this._getBarBackgroundXStart(a),x1:()=>this._getBarBackgroundXEnd(a)},r),"normal",I.Series)}else{const r=S(this._fieldX2)?{x:l=>ct(this._dataToPosX(l),a),x1:l=>ct(this._dataToPosX1(l),a)}:{x:l=>ct(this._dataToPosX(l)-this._getBarWidth(this._xAxisHelper)/2,a),width:l=>this._getBarWidth(this._xAxisHelper)};this.setMarkStyle(this._barMark,Object.assign(Object.assign({},r),{y:l=>this._getBarYStart(l,n),y1:l=>this._getBarYEnd(l,n)}),"normal",I.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign(Object.assign({},r),{y:()=>this._getBarBackgroundYStart(n),y1:()=>this._getBarBackgroundYEnd(n)}),"normal",I.Series)}}_initBandBarBackgroundMarkStyle(){var t,e,i,s,a;if(!this._barBackgroundMark)return;const n=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),r=(s=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0),l=(a=this._spec.barBackground)!==null&&a!==void 0?a:{},h=C(l.fieldLevel)?void 0:l.fieldLevel+1;this.direction==="horizontal"?this.setMarkStyle(this._barBackgroundMark,{x:()=>this._getBarBackgroundXStart(n),x1:()=>this._getBarBackgroundXEnd(n),y:d=>this._getPosition(this.direction,d,h,"barBackground"),height:()=>this._getBarWidth(this._yAxisHelper,h),width:()=>{},y1:()=>{}},"normal",I.Series):this.setMarkStyle(this._barBackgroundMark,{x:d=>this._getPosition(this.direction,d,h,"barBackground"),y:()=>this._getBarBackgroundYStart(r),y1:()=>this._getBarBackgroundYEnd(r),width:()=>this._getBarWidth(this._xAxisHelper,h),x1:()=>{},height:()=>{}},"normal",I.Series)}initAnimation(){var t,e;const i={yField:this._fieldY[0],xField:this._fieldX[0],direction:this.direction,growFrom:()=>{var n,r;return this.direction==="horizontal"?(n=this._xAxisHelper)===null||n===void 0?void 0:n.getScale(0).scale(0):(r=this._yAxisHelper)===null||r===void 0?void 0:r.getScale(0).scale(0)}},s=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset,a=Hi(this);this._barMark.setAnimationConfig(Ct((e=X.getAnimationInKey("bar"))===null||e===void 0?void 0:e(i,s),Zt(this._barMarkName,this._spec,this._markAttributeContext),a))}_getBarWidth(t,e){var i,s;const a=this._groups?this._groups.fields.length:1,n=C(e)?a:Math.min(a,e),r=(s=(i=t.getBandwidth)===null||i===void 0?void 0:i.call(t,n-1))!==null&&s!==void 0?s:6,l=S(this._spec.barWidth)&&n===a,h=S(this._spec.barMinWidth),d=S(this._spec.barMaxWidth);let c=r;return l&&(c=di(this._spec.barWidth,r)),h&&(c=Math.max(c,di(this._spec.barMinWidth,r))),d&&(c=Math.min(c,di(this._spec.barMaxWidth,r))),c}_getPosition(t,e,i,s){var a,n,r,l,h;let d,c,u;t==="horizontal"?(d=this.getYAxisHelper(),c="height",u=s==="barBackground"?this.dataToBarBackgroundPositionY.bind(this):this.dataToPositionY.bind(this)):(d=this.getXAxisHelper(),c="width",u=s==="barBackground"?this.dataToBarBackgroundPositionX.bind(this):this.dataToPositionX.bind(this));const g=d.getScale(0),_=this._groups?this._groups.fields.length:1,p=C(i)?_:Math.min(_,i),m=(n=(a=d.getBandwidth)===null||a===void 0?void 0:a.call(d,p-1))!==null&&n!==void 0?n:6,b=p===_?this._barMark.getAttribute(c,e):m;if(p>1&&S(this._spec.barGapInGroup)){const v=this._groups.fields,y=L(this._spec.barGapInGroup);let f=0,A=0;for(let k=v.length-1;k>=1;k--){const T=v[k],P=(l=(r=d.getScale(k))===null||r===void 0?void 0:r.domain())!==null&&l!==void 0?l:[],D=P.length,B=di((h=y[k-1])!==null&&h!==void 0?h:j(y),m),E=P.indexOf(e[T]);k===v.length-1?(f+=D*b+(D-1)*B,A+=E*(b+B)):(A+=E*(f+B),f+=f+(D-1)*B)}return g.scale(e[v[0]])+d.getBandwidth(0)/2-f/2+A}const x=K(g.type||"band");return u(e,p)+.5*(m-b)+(x?-m/2:0)}dataToBarBackgroundPositionX(t,e){return this._dataToPosition(t,this._xAxisHelper,this.fieldX,e,this._getBarBackgroundPositionXEncoder,this._setBarBackgroundPositionXEncoder)}dataToBarBackgroundPositionY(t,e){return this._dataToPosition(t,this._yAxisHelper,this.fieldY,e,this._getBarBackgroundPositionYEncoder,this._setBarBackgroundPositionYEncoder)}onLayoutEnd(t){super.onLayoutEnd(t),this.getRegion()._bar_series_position_calculated=!1,this._spec.sampling&&this.compile()}compile(){if(super.compile(),this._spec.sampling){const{width:t,height:e}=this._region.getLayoutRect(),i=[],s=this._fieldY,a=this._fieldX;i.push({type:"sampling",size:this._direction==="horizontal"?e:t,factor:this._spec.samplingFactor,yfield:this._direction==="horizontal"?a[0]:s[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(i)}}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._barMark]}compileData(){var t;super.compileData(),(t=this._barBackgroundViewData)===null||t===void 0||t.compile()}fillData(){var t,e;super.fillData(),(e=(t=this._barBackgroundViewData)===null||t===void 0?void 0:t.getDataView())===null||e===void 0||e.reRunAllTransform()}viewDataUpdate(t){var e,i,s;super.viewDataUpdate(t),(i=(e=this._barBackgroundViewData)===null||e===void 0?void 0:e.getDataView())===null||i===void 0||i.reRunAllTransform(),(s=this._barBackgroundViewData)===null||s===void 0||s.updateData()}release(){var t;super.release(),(t=this._barBackgroundViewData)===null||t===void 0||t.release(),this._barBackgroundViewData=null}}Nt.type=xt.bar,Nt.mark=Hd,Nt.transformerConstructor=kr;const Vd=()=>{Ms(),Lo(),Fd(),ze(),we(),X.registerSeries(Nt.type,Nt)},Ya=10,jd=[10,20],Xd=us.Linear,Ga="circle",Yd=us.Ordinal,Gd=["circle","square","triangle","diamond","star"],Ud=(o,t)=>t==="fadeIn"?{type:"fadeIn"}:{type:"scaleIn"},Zd=()=>{X.registerAnimation("scatter",(o,t)=>Object.assign({appear:Ud(0,t)},Eo))},Nd=Object.assign(Object.assign({},_e),{point:{name:"point",type:"symbol"}});class Mr extends zi{_transformLabelSpec(t){this._addMarkLabelSpec(t,"point")}}class Wt extends Fi{constructor(){super(...arguments),this.type=xt.scatter,this.transformerConstructor=Mr,this._invalidType="zero"}setAttrFromSpec(){super.setAttrFromSpec(),this._size=this._spec.size,this._sizeField=this._spec.sizeField,this._shape=this._spec.shape,this._shapeField=this._spec.shapeField}_getSeriesAttribute(t,e,{defaultScaleType:i,defaultRange:s},a){var n,r,l,h;if(R(e))return e;if($(e)){if(C(t))return(n=this._option)===null||n===void 0||n.onError(`${a}Field is required.`),e;if(i!=="ordinal"&&e.length>2)return(r=this._option)===null||r===void 0||r.onError(`${a} length is invalid, specify up to 2 ${a}s.`),e;const d=`${$e}_series_scatter_${this.id}_scale_${a}`;return this._option.globalScale.registerModelScale({id:d,type:i,domain:[{dataId:this._rawData.name,fields:[t]}],range:e}),{scale:d,field:t}}if(ei(e)){if(C(t))return(l=this._option)===null||l===void 0||l.onError(`${a}Field is required.`),e;const d=`${$e}_series_scatter_${this.id}_scale_${a}`,c=Object.assign({id:d,type:i,domain:[{dataId:this._rawData.name,fields:[t]}],range:s},e);return this._option.globalScale.registerModelScale(c),{scale:c.id,field:t}}return(h=this._option)===null||h===void 0||h.onError(`${a} attribute is invalid.`),e}getSizeAttribute(t,e){return C(e)?Ya:yt(e)?e:q(e)&&Ol(e)?parseFloat(e):this._getSeriesAttribute(t,e,{defaultScaleType:Xd,defaultRange:jd},"size")}getShapeAttribute(t,e){return C(e)?Ga:q(e)?e:this._getSeriesAttribute(t,e,{defaultScaleType:Yd,defaultRange:Gd},"shape")}initMark(){var t,e;this._symbolMark=this._createMark(Wt.mark.point,{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(t=this._spec.point)===null||t===void 0?void 0:t.stateSort},{progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold,morph:wi(this._spec,Wt.mark.point.name),morphElementKey:this.getDimensionField()[0],setCustomizedShape:(e=this._spec.point)===null||e===void 0?void 0:e.customShape})}initMarkStyle(){this.initSymbolMarkStyle()}initAnimation(){var t,e,i;const s=Hi(this),a=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._symbolMark.setAnimationConfig(Ct((i=X.getAnimationInKey("scatter"))===null||i===void 0?void 0:i({},a),Zt("point",this._spec,this._markAttributeContext),s))}initSymbolMarkStyle(){const t=this._symbolMark;t&&(this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)}),this.setMarkStyle(t,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null,fill:this.getColorAttribute(),size:yt(this._size)||R(this._size)?this._size:Ya,symbolType:q(this._shape)||R(this._shape)?this._shape:Ga},ie.STATE_NORMAL,I.Series),(S(this._sizeField)||S(this._size))&&this.setMarkStyle(t,{size:this.getSizeAttribute(this._sizeField,this._size)},ie.STATE_NORMAL,I.User_Mark),(S(this._shapeField)||S(this._shape))&&this.setMarkStyle(t,{symbolType:this.getShapeAttribute(this._shapeField,this._shape)},ie.STATE_NORMAL,I.User_Mark))}initTooltip(){super.initTooltip(),this._symbolMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._symbolMark)}viewDataStatisticsUpdate(t){super.viewDataStatisticsUpdate(t);const e=[this.getDimensionField()[0],this.getStackValueField()].every(i=>{var s,a,n;return i&&((n=(a=(s=this.getViewDataStatistics())===null||s===void 0?void 0:s.latestData)===null||a===void 0?void 0:a[i])===null||n===void 0?void 0:n.allValid)});this._invalidType==="zero"||e?this.setMarkStyle(this._symbolMark,{visible:!0},"normal",I.Series):this.setMarkStyle(this._symbolMark,{visible:this._getInvalidDefined.bind(this)},"normal",I.Series),this._symbolMark.getProduct()&&this._symbolMark.compileEncode()}initLabelMarkStyle(t){t&&(this._labelMark=t,this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null},ie.STATE_NORMAL,I.Series),this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)},ie.STATE_NORMAL,I.Series))}handleZoom(t){var e,i;this.getMarksWithoutRoot().forEach(a=>{const n=a.getProduct();!n||!n.elements||!n.elements.length||n.elements.forEach((r,l)=>{const h=r.getGraphicItem(),d=r.getDatum(),c=this.dataToPosition(d);c&&h&&h.translateTo(c.x,c.y)})});const s=(i=(e=this._labelMark)===null||e===void 0?void 0:e.getComponent())===null||i===void 0?void 0:i.getProduct();s&&s.evaluate(null,null)}handlePan(t){var e,i;this.getMarksWithoutRoot().forEach(a=>{const n=a.getProduct();!n||!n.elements||!n.elements.length||n.elements.forEach((r,l)=>{const h=r.getGraphicItem(),d=r.getDatum(),c=this.dataToPosition(d);c&&h&&h.translateTo(c.x,c.y)})});const s=(i=(e=this._labelMark)===null||e===void 0?void 0:e.getComponent())===null||i===void 0?void 0:i.getProduct();s&&s.evaluate(null,null)}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._symbolMark]}}Wt.type=xt.scatter,Wt.mark=Nd,Wt.transformerConstructor=Mr;const Wd=()=>{ps(),Zd(),ze(),we(),X.registerSeries(Wt.type,Wt)},fe={debounce:gs,throttle:Ii};class $d{constructor(){this._isGestureListener=!1}initZoomable(t,e=mi["desktop-browser"]){this._eventObj=t,this._renderMode=e,this._gestureController=this._option.getChart().getVGrammarView().renderer._gestureController,this._isGestureListener=Pn(this._renderMode)||Ln(this._renderMode),Ft(this._renderMode)&&(this._clickEnable=!0,this._zoomableTrigger=new(this._getZoomTriggerEvent("trigger")))}_getZoomTriggerEvent(t){return Ft(this._renderMode)[t]}_zoomEventDispatch(t,e,i){if(!this._isGestureListener&&!t.event)return;const s=this._isGestureListener?t:t.event.clone();this._zoomableTrigger.parserZoomEvent(s);const{zoomDelta:a,zoomX:n,zoomY:r}=s;if(C(a)||!$i({x:n,y:r},this._getRegionOrSeriesLayout(e)))return;let l={};i&&(l=i({zoomDelta:a,zoomX:n,zoomY:r},s)),this._eventObj.emit("zoom",Object.assign(Object.assign({scale:s.zoomDelta,scaleCenter:{x:s.zoomX,y:s.zoomY}},l),{model:this}))}_getRegionOrSeriesLayout(t){t.type!=="region"&&(t=t.getRegion());const{x:e,y:i,width:s,height:a}=t.layout.getLayout();return{x1:e,y1:i,x2:e+s,y2:i+a}}_bindZoomEventAsRegion(t,e,i,s){var a,n;const r=(a=s==null?void 0:s.delayType)!==null&&a!==void 0?a:"throttle",l=(n=s==null?void 0:s.delayTime)!==null&&n!==void 0?n:0,h=this._isGestureListener?this._gestureController:t,d=this._isGestureListener?[this._getZoomTriggerEvent("zoom")]:[this._getZoomTriggerEvent("zoom"),{level:mt.chart,consume:!0}],c=this._isGestureListener?[this._getZoomTriggerEvent("zoomEnd")]:[this._getZoomTriggerEvent("zoomEnd"),{level:mt.chart,consume:!1}];h.on(...c,fe[r](u=>{this._zoomableTrigger.clearZoom()},l)),h.on(...d,fe[r](u=>{this._zoomEventDispatch(u,e,i)},l))}initZoomEventOfSeries(t,e,i){this._option.disableTriggerEvent||Ft(this._renderMode)&&this._bindZoomEventAsRegion(t.event,t,e,i)}initZoomEventOfRegions(t,e,i,s){this._option.disableTriggerEvent||Ft(this._renderMode)&&t.forEach(a=>{e?a.getSeries().forEach(n=>{e(n)&&this._bindZoomEventAsRegion(n.event,n,i,s)}):this._bindZoomEventAsRegion(this._eventObj,a,i,s)})}_scrollEventDispatch(t,e,i){let s=!1;if(!this._isGestureListener&&(!t.event||this._option.disableTriggerEvent))return s;const a=this._isGestureListener?t:t.event;this._zoomableTrigger.parserScrollEvent(a);const{scrollX:n,scrollY:r,canvasX:l,canvasY:h}=a;return C(n)&&C(r)||$i({x:l,y:h},this._getRegionOrSeriesLayout(e))&&(i&&(s=i({scrollX:n,scrollY:r},a)),this._eventObj.emit("scroll",{scrollX:n,scrollY:r,model:this})),s}_bindScrollEventAsRegion(t,e,i,s){var a,n;const r=(a=s==null?void 0:s.delayType)!==null&&a!==void 0?a:"throttle",l=(n=s==null?void 0:s.delayTime)!==null&&n!==void 0?n:0,h=this._isGestureListener?this._gestureController:t,d=this._isGestureListener?[this._getZoomTriggerEvent("scroll")]:[this._getZoomTriggerEvent("scroll"),{level:mt.chart,consume:!0}],c=this._isGestureListener?[this._getZoomTriggerEvent("scrollEnd")]:[this._getZoomTriggerEvent("scrollEnd"),{level:mt.chart,consume:!1}];h.on(...c,fe[r](u=>{this._zoomableTrigger.clearScroll()},l)),h.on(...d,fe[r](u=>this._scrollEventDispatch(u,e,i),l))}initScrollEventOfSeries(t,e,i){Ft(this._renderMode)&&this._bindScrollEventAsRegion(t.event,t,e,i)}initScrollEventOfRegions(t,e,i,s){this._option.disableTriggerEvent||Ft(this._renderMode)&&t.forEach(a=>{e?a.getSeries().forEach(n=>{e(n)&&this._bindScrollEventAsRegion(n.event,n,i,s)}):this._bindScrollEventAsRegion(this._eventObj,a,i,s)})}_bindDragEventAsRegion(t,e,i,s){t.on(this._getZoomTriggerEvent("start"),{level:mt.chart},a=>{if(!a.event)return;const{event:n}=a;$i({x:n.canvasX,y:n.canvasY},this._getRegionOrSeriesLayout(e))&&this._handleDrag(a,i,s)}),t.on("click",{level:mt.chart},()=>!this._clickEnable)}initDragEventOfSeries(t,e,i){this._option.disableTriggerEvent||Ft(this._renderMode)&&t.event.on(this._getZoomTriggerEvent("start"),{level:mt.model,filter:({model:s})=>(s==null?void 0:s.id)===t.id},s=>{this._handleDrag(s,e,i)})}initDragEventOfRegions(t,e,i,s){this._option.disableTriggerEvent||Ft(this._renderMode)&&t.forEach(a=>{e?a.getSeries().forEach(n=>{e(n)&&(n.event.on(this._getZoomTriggerEvent("start"),{level:mt.model,filter:({model:r})=>(r==null?void 0:r.id)===n.id},r=>{this._handleDrag(r,i)}),n.event.on("click",{level:mt.model,filter:({model:r})=>(r==null?void 0:r.id)===n.id},()=>!this._clickEnable))}):this._bindDragEventAsRegion(this._eventObj,a,i,s)})}_handleDrag(t,e,i){var s,a,n;if(this._option.disableTriggerEvent||(this._clickEnable=!1,!this._zoomableTrigger.parserDragEvent(t.event)))return;const r=(s=i==null?void 0:i.delayType)!==null&&s!==void 0?s:"throttle",l=(a=i==null?void 0:i.delayTime)!==null&&a!==void 0?a:0,h=(n=i==null?void 0:i.realTime)===null||n===void 0||n,d=this._getZoomTriggerEvent("move"),c=this._getZoomTriggerEvent("end"),u=t.event;let g=u.canvasX,_=u.canvasY,p=u.canvasX,m=u.canvasY;const b=fe[r](v=>{this._clickEnable=!0;const y=v.event,f=[y.canvasX-p,y.canvasY-m];p=y.canvasX,m=y.canvasY,!h&&e&&e(f,v.event),this._eventObj.emit("panend",{delta:f,model:this}),this._zoomableTrigger.pointerId=null,this._eventObj.off(d,{level:mt.chart,source:Xt.chart},x),this._eventObj.off(c,{level:mt.chart,source:Xt.window},b),this._eventObj.allow(c)},l),x=fe[r](v=>{if(!this._zoomableTrigger.parserDragEvent(v.event))return;this._clickEnable=!1,this._eventObj.prevent(c,b);const y=v.event,f=[y.canvasX-g,y.canvasY-_];g=y.canvasX,_=y.canvasY,h&&e&&e(f,v.event),this._eventObj.emit("panmove",{delta:f,model:this})},l);this._eventObj.on(d,{level:mt.chart,source:Xt.chart},x),this._eventObj.on(c,{level:mt.chart,source:Xt.chart},b)}}class Kd extends Ro{constructor(){super(...arguments),this.coordinate="polar",this._outerRadius=Io,this._innerRadius=0,this._angleField=[],this._radiusField=[],this._sortDataByAxis=!1}get outerRadius(){return this._outerRadius}get innerRadius(){return this._innerRadius}getAngleField(){return this._angleField}setAngleField(t){return this._angleField=S(t)?L(t):[],this._angleField}getRadiusField(){return this._radiusField}setRadiusField(t){return this._radiusField=S(t)?L(t):[],this._radiusField}get innerRadiusField(){return this._innerRadiusField}setInnerRadiusField(t){return this._innerRadiusField=L(t),this._innerRadiusField}get radiusScale(){return this._radiusScale}setRadiusScale(t){return this._radiusScale=t,t}get angleScale(){return this._angleScale}setAngleScale(t){return this._angleScale=t,t}get angleAxisHelper(){return this._angleAxisHelper}set angleAxisHelper(t){this._angleAxisHelper=t,this.onAngleAxisHelperUpdate()}get radiusAxisHelper(){return this._radiusAxisHelper}set radiusAxisHelper(t){this._radiusAxisHelper=t,this.onRadiusAxisHelperUpdate()}get sortDataByAxis(){return this._sortDataByAxis}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this),this._markAttributeContext.getCenter=()=>this.angleAxisHelper.center(),this._markAttributeContext.getLayoutRadius=()=>this._computeLayoutRadius()}valueToPosition(t,e){if(C(t)||C(e)||!this.angleAxisHelper||!this.radiusAxisHelper)return{x:Number.NaN,y:Number.NaN};const i=this.radiusAxisHelper.dataToPosition(L(e));if(i<0){if(this._invalidType==="break"||this._invalidType==="link")return{x:Number.NaN,y:Number.NaN};if(this._invalidType==="zero")return this.angleAxisHelper.center()}const s=this.angleAxisHelper.dataToPosition(L(t));return this.angleAxisHelper.coordToPoint({angle:s,radius:i})}dataToPosition(t,e){return t&&this.angleAxisHelper&&this.radiusAxisHelper?e&&!this.isDatumInViewData(t)?null:this.valueToPosition(this.getDatumPositionValues(t,this._angleField),this.getDatumPositionValues(t,this._radiusField)):null}dataToPositionX(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.x}dataToPositionY(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.y}dataToPositionZ(t){return 0}positionToData(t){}radiusToData(t){}angleToData(t){}getStatisticFields(){var t,e;const i=[];return!((t=this.radiusAxisHelper)===null||t===void 0)&&t.getScale&&this._radiusField.forEach(s=>{const a={key:s,operations:[]};K(this.radiusAxisHelper.getScale(0).type)?a.operations=["max","min"]:a.operations=["values"],i.push(a)}),!((e=this.angleAxisHelper)===null||e===void 0)&&e.getScale&&this._angleField.forEach(s=>{const a={key:s,operations:[]};K(this.angleAxisHelper.getScale(0).type)?a.operations=["max","min"]:a.operations=["values"],i.push(a)}),i}setAttrFromSpec(){super.setAttrFromSpec(),S(this._spec.outerRadius)&&(this._outerRadius=this._spec.outerRadius),S(this._spec.radius)&&(this._outerRadius=this._spec.radius),S(this._spec.innerRadius)&&(this._innerRadius=this._spec.innerRadius),S(this._spec.sortDataByAxis)&&(this._sortDataByAxis=this._spec.sortDataByAxis===!0)}onRadiusAxisHelperUpdate(){this.onMarkPositionUpdate()}onAngleAxisHelperUpdate(){this.onMarkPositionUpdate()}afterInitMark(){super.afterInitMark()}_computeLayoutRadius(){const t=this._angleAxisHelper||this._radiusAxisHelper;if(t)return t.layoutRadius();const{width:e,height:i}=this._region.getLayoutRect();return Math.min(e/2,i/2)}initEvent(){super.initEvent(),this.sortDataByAxis&&this.event.on(V.scaleDomainUpdate,{filter:t=>{var e;return t.model.id===((e=this._angleAxisHelper)===null||e===void 0?void 0:e.getAxisId())}},()=>{this._sortDataInAxisDomain()})}_sortDataInAxisDomain(){var t,e;!((e=(t=this.getViewData())===null||t===void 0?void 0:t.latestData)===null||e===void 0)&&e.length&&wo(this.angleAxisHelper,this._angleField[0],this.getViewData().latestData)}getInvalidCheckFields(){const t=[];return this.angleAxisHelper.isContinuous&&this._angleField.forEach(e=>{t.push(e)}),this.radiusAxisHelper.isContinuous&&this._radiusField.forEach(e=>{t.push(e)}),t}}function fi(o){return Fo(o)?Number.parseFloat(o):0}const qd=(o,t)=>{const{asStartAngle:e,asEndAngle:i,asMiddleAngle:s,asRadian:a,asRatio:n,asQuadrant:r,asK:l,showAllZero:h,supportNegative:d,showEmptyCircle:c}=t,u=t.angleField(),g=t.startAngle(),_=t.endAngle(),p=t.minAngle(),m=o.map(B=>Object.assign({},B));if(!m||m.length===0||!h&&c&&Tr(m,u,d))return m;const b=(B,E,H)=>{B[e]=E,B[i]=E+H,B[s]=E+H/2,B[a]=H,B[r]=Ho(E+H/2)};let x=0,v=-1/0,y=!0;for(let B=0;B<m.length;B++){const E=d?Math.abs(fi(m[B][u])):fi(m[B][u]);x+=E,v=Math.max(E,v),y&&E!==0&&(y=!1),m[B][Ki]=E}const f=m.map(B=>Number(B[u])),A=_-g;let k=g,T=A,P=0;const D=zo(f);if(m.forEach((B,E)=>{const H=B[Ki],nt=x?H/x:0;let Y=nt*A;Y<p?(Y=p,T-=p):P+=H;const Z=k,rt=k+Y;B[n]=nt,B[l]=v?H/v:0,B._percent_=D[E],b(B,Z,Y),k=rt}),T<A)if(T<=.001){const B=A/m.length;m.forEach((E,H)=>{b(E,g+H*B,B)})}else{const B=T/P;k=g,m.forEach(E=>{const H=E[a]===p?p:E[Ki]*B;b(E,k,H),k+=H})}if(x!==0&&(m[m.length-1][i]=_),y&&h){const B=A/m.length;m.forEach((E,H)=>{b(E,g+H*B,B)})}return m},Tr=(o,t,e)=>!!C(o)||o.length===0||!!o.every(i=>fi(i[t])===0)||!e&&o.reduce((i,s)=>i+fi(s[t]),0)===0;function Wi(o,t,e){return(i,s,a)=>t?o.growField==="radius"?{overall:0}:{overall:o.growFrom(i,s,e)}:{overall:!1}}const Ua=o=>({type:o.growField==="radius"?"growRadiusIn":"growAngleIn",options:Wi(o,!0,Yt.appear)}),Qd={type:"fadeIn"},Jd=o=>({type:o.growField==="radius"?"growRadiusIn":"growAngleIn",easing:"linear",options:Wi(o,!0,Yt.enter)}),tc=o=>({type:o.growField==="radius"?"growRadiusOut":"growAngleOut",easing:"linear",options:Wi(o,!0,Yt.exit)}),ec=o=>({type:o.growField==="radius"?"growRadiusOut":"growAngleOut",options:Wi(o,!0,Yt.exit)});function Cr(o,t){if(t===!1)return{};switch(t){case"fadeIn":return Qd;case"growRadius":return Ua(Object.assign(Object.assign({},o),{growField:"radius"}));default:return Ua(Object.assign(Object.assign({},o),{growField:"angle"}))}}const ic=()=>{X.registerAnimation("pie",(o,t)=>({appear:Cr(o,t),enter:Jd(o),exit:tc(o),disappear:ec(o)}))},sc=()=>{X.registerAnimation("emptyCircle",(o,t)=>({appear:Cr(o,t)}))};function ac(o,t){var e,i,s,a;const n=(i=(e=t.options)===null||e===void 0?void 0:e.distance)!==null&&i!==void 0?i:10,r=O(t.duration)?t.duration/2:1e3,l=(s=t.options.easing)!==null&&s!==void 0?s:"cubicOut";return{oneByOne:t.oneByOne,loop:(a=t.loop)!==null&&a!==void 0&&a,timeSlices:[{duration:r,effects:{easing:l,channel:{x:{from:h=>o.getAttribute("x",h),to:h=>o.getAttribute("x",h)+ae({x:0,y:0},n,h[oe]).x},y:{from:h=>o.getAttribute("y",h),to:h=>o.getAttribute("y",h)+ae({x:0,y:0},n,h[oe]).y}}}},{duration:r,effects:{easing:l,channel:{x:{to:h=>o.getAttribute("x",h),from:h=>o.getAttribute("x",h)+ae({x:0,y:0},n,h[oe]).x},y:{to:h=>o.getAttribute("y",h),from:h=>o.getAttribute("y",h)+ae({x:0,y:0},n,h[oe]).y}}}}]}}const nc=Object.assign(Object.assign({},_e),{pie:{name:"pie",type:"arc"},labelLine:{name:"labelLine",type:"path"}});Object.assign(Object.assign({},_e),{pie3d:{name:"pie3d",type:"arc3d"},labelLine:{name:"labelLine",type:"path"}});class Br extends zi{_transformLabelSpec(t){this._addMarkLabelSpec(t,"pie")}_mergeThemeToSpec(t,e){const i=this._theme;let s=t;if(this._shouldMergeThemeToSpec()){const a=this._getDefaultSpecFromChart(e);s=J({},this._theme,a,t);const n=(r,l)=>J({},r==="inside"||r==="inside-center"?this._theme.innerLabel:this._theme.outerLabel,l);$(s.label)?s.label=s.label.map(r=>n(r.position,r)):s.label=n(s.label.position,s.label)}return{spec:s,theme:i}}_getDefaultSpecFromChart(t){var e;const i=(e=super._getDefaultSpecFromChart(t))!==null&&e!==void 0?e:{},{centerX:s,centerY:a}=t;return S(s)&&(i.centerX=s),S(a)&&(i.centerY=a),Object.keys(i).length>0?i:void 0}}const rc=`${$e}_LABEL_VISIBLE`,oc=(o,t,e,i)=>{const s=o();if(yt(s))return s;if(R(s))return s(t(),e());const a=t();if(s==="auto"&&a.width>0&&a.height>0){const{startAngle:n=0,endAngle:r=2*Math.PI}=i();return Vo(a,e(),n,r)}return Math.min(a.width/2,a.height/2)};class ti extends Kd{constructor(){super(...arguments),this.transformerConstructor=Br,this._pieMarkName="pie",this._pieMarkType="arc",this.getCenter=()=>{var t,e;const i=this._region.getLayoutRect();return{x:De((t=this._spec)===null||t===void 0?void 0:t.centerX,i.width,i,i.width/2),y:De((e=this._spec)===null||e===void 0?void 0:e.centerY,i.height,i,i.height/2)}},this._startAngle=Xo,this._endAngle=Yo,this._pieMark=null,this._labelMark=null,this._labelLineMark=null,this._emptyArcMark=null,this.dataToCentralPosition=t=>{const e=t[oe];if(C(e))return null;const i=this.computeDatumRadius(t),s=this.computeDatumInnerRadius(t),a=this.computeCenter(t);return ae(a,(i+s)/2,e)}}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.getCenter=()=>({x:()=>this.getCenter().x,y:()=>this.getCenter().y}),this._markAttributeContext.startAngleScale=t=>this.startAngleScale(t),this._markAttributeContext.endAngleScale=t=>this.endAngleScale(t)}setAttrFromSpec(){var t,e,i,s,a,n;super.setAttrFromSpec(),this._centerOffset=(t=this._spec.centerOffset)!==null&&t!==void 0?t:0,this._cornerRadius=(e=this._spec.cornerRadius)!==null&&e!==void 0?e:0;const r=Go(S(this._spec.startAngle)?ne(this._spec.startAngle):this._startAngle,S(this._spec.endAngle)?ne(this._spec.endAngle):this._endAngle);this._startAngle=r.startAngle,this._endAngle=r.endAngle,this._padAngle=S(this._spec.padAngle)?ne(this._spec.padAngle):0,this.setAngleField(this._spec.valueField||this._spec.angleField),this._spec.categoryField&&this.setSeriesField(this._spec.categoryField),this._radiusField=[],this._specAngleField=this._angleField.slice(),this._specRadiusField=[],this._showEmptyCircle=(s=(i=this._spec.emptyPlaceholder)===null||i===void 0?void 0:i.showEmptyCircle)!==null&&s!==void 0&&s,this._showAllZero=(a=this._spec.showAllZero)!==null&&a!==void 0&&a,this._supportNegative=(n=this._spec.supportNegative)!==null&&n!==void 0&&n}initData(){super.initData();const t=this.getViewData();if(!t)return;at(this._dataSet,"pie",qd),t.transform({type:"pie",options:{angleField:()=>this._angleField[0],startAngle:()=>this._startAngle,endAngle:()=>this._endAngle,minAngle:()=>S(this._spec.minAngle)?ne(this._spec.minAngle):0,asStartAngle:aa,asEndAngle:na,asRatio:Uo,asMiddleAngle:oe,asRadian:Zo,asQuadrant:No,asK:Wo,showAllZero:this._showAllZero,supportNegative:this._supportNegative,showEmptyCircle:this._showEmptyCircle}},!1);const e=new bt(this._dataSet,{name:`${$e}_series_${this.id}_viewDataLabel`});e.parse([this.getViewData()],{type:"dataview"}),this._viewDataLabel=new Cn(this._option,e)}compileData(){var t;super.compileData(),(t=this._viewDataLabel)===null||t===void 0||t.compile()}initMark(){var t,e;this._pieMark=this._createMark(Object.assign(Object.assign({},ti.mark.pie),{name:this._pieMarkName,type:this._pieMarkType}),{key:Bn,groupKey:this._seriesField,skipBeforeLayouted:!0,isSeriesMark:!0,stateSort:(t=this._spec.pie)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.pie)===null||e===void 0?void 0:e.customShape,morph:wi(this._spec,this._pieMarkName),morphElementKey:this._seriesField}),this._showEmptyCircle&&(this._emptyArcMark=this._createMark({name:"emptyCircle",type:"arc"},{dataView:!1}))}startAngleScale(t){return Ji(aa)(t)}endAngleScale(t){return Ji(na)(t)}_computeLayoutRadius(){return oc(()=>this._spec.layoutRadius,this.getLayoutRect,this.getCenter,()=>({startAngle:this._startAngle,endAngle:this._endAngle}))}initMarkStyle(){const t={x:()=>this.getCenter().x,y:()=>this.getCenter().y,fill:this.getColorAttribute(),outerRadius:ra(this._outerRadius)?this._outerRadius:()=>this._computeLayoutRadius()*this._outerRadius,innerRadius:ra(this._innerRadius)?this._innerRadius:()=>this._computeLayoutRadius()*this._innerRadius,cornerRadius:()=>this._computeLayoutRadius()*this._cornerRadius,startAngle:s=>this.startAngleScale(s),endAngle:s=>this.endAngleScale(s),padAngle:this._padAngle,centerOffset:this._centerOffset},e=this._pieMark;e&&this.setMarkStyle(e,t,"normal",I.Series);const i=this._emptyArcMark;i&&this.setMarkStyle(i,Object.assign(Object.assign({},t),{visible:()=>{const s=this.getAngleField()[0];return Tr(this.getViewData().latestData,s,this._supportNegative)}}),"normal",I.Series)}initInteraction(){this._parseInteractionConfig(this._pieMark?[this._pieMark]:[])}initTooltip(){super.initTooltip(),this._pieMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._pieMark)}initMarkStyleWithSpec(t,e,i){if(super.initMarkStyleWithSpec(t,e,i),t.name===this._pieMarkName){const s=this.getSpec()[t.name];if(s)for(const a in s.state||{})this.setMarkStyle(t,this.generateRadiusStyle(s.state[a]),a,I.User_Mark)}t.name==="emptyCircle"&&this.setMarkStyle(t,this.generateRadiusStyle(e.style),"normal",I.User_Mark)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{visible:Ji(rc).bind(this),text:e=>e[this.getDimensionField()[0]],fill:this.getColorAttribute(),z:this.dataToPositionZ.bind(this)})}afterInitMark(){super.afterInitMark()}initEvent(){var t;super.initEvent(),(t=this._viewDataLabel.getDataView())===null||t===void 0||t.target.addListener("change",this.viewDataLabelUpdate.bind(this))}initGroups(){}onLayoutEnd(t){this._viewDataLabel.getDataView().reRunAllTransform(),this.onMarkPositionUpdate(),super.onLayoutEnd(t)}getDimensionField(){return this._seriesField?[this._seriesField]:[]}getMeasureField(){return this._specAngleField}viewDataLabelUpdate(){this.event.emit(V.viewDataLabelUpdate,{model:this}),this._viewDataLabel.updateData()}generateRadiusStyle(t){if(!t)return;const e={};return t.outerRadius&&(e.outerRadius=()=>this._computeLayoutRadius()*t.outerRadius),t.innerRadius&&(e.innerRadius=()=>this._computeLayoutRadius()*t.innerRadius),t.cornerRadius&&(e.cornerRadius=()=>this._computeLayoutRadius()*t.cornerRadius),e}computeCenter(t){return{x:this._pieMark.getAttribute("x",t,"normal"),y:this._pieMark.getAttribute("y",t,"normal")}}getRadius(t="normal"){var e,i,s,a,n,r,l;const h=t==="normal"?(s=(i=this.getSpec()[((e=this._pieMark)===null||e===void 0?void 0:e.name)||"pie"])===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.outerRadius:(l=(r=(n=this.getSpec()[((a=this._pieMark)===null||a===void 0?void 0:a.name)||"pie"])===null||n===void 0?void 0:n.state)===null||r===void 0?void 0:r[t])===null||l===void 0?void 0:l.outerRadius;return h??this._outerRadius}getInnerRadius(t="normal"){var e,i,s,a,n,r,l;const h=t==="normal"?(s=(i=this.getSpec()[((e=this._pieMark)===null||e===void 0?void 0:e.name)||"pie"])===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.innerRadius:(l=(r=(n=this.getSpec()[((a=this._pieMark)===null||a===void 0?void 0:a.name)||"pie"])===null||n===void 0?void 0:n.state)===null||r===void 0?void 0:r[t])===null||l===void 0?void 0:l.innerRadius;return h??this._innerRadius}computeRadius(t,e){return this._computeLayoutRadius()*t*(C(e)?1:e)+this._centerOffset}computeDatumRadius(t,e){return this._computeLayoutRadius()*this.getRadius(e)+this._centerOffset}_compareSpec(t,e,i){i=i??{data:!0};const s=["centerX","centerY","centerOffset","radius","innerRadius","cornerRadius","startAngle","endAngle","padAngle"];s.forEach(n=>{i[n]=!0});const a=super._compareSpec(t,e,i);return t=t??{},s.some(n=>t[n]!==e[n])&&(a.reRender=!0,a.change=!0),a}computeDatumInnerRadius(t,e){return this._computeLayoutRadius()*this.getInnerRadius(e)+this._centerOffset}dataToPosition(t,e){const i=t[oe];if(C(i)||e&&!this.isDatumInViewData(t))return null;const s=this.computeDatumRadius(t),a=this.computeCenter(t);return ae(a,s,i)}initAnimation(){var t,e,i;const s={growFrom:(n,r,l)=>{var h;if(l===Yt.appear)return this._startAngle;if(l===Yt.disappear)return this._endAngle;const d=[Yt.disappear,Yt.exit],c=r.mark.elements,u=n,g=u==null?void 0:u[ci];if(c.find(p=>{var m;return((m=p.data[0])===null||m===void 0?void 0:m[ci])<g})===void 0)return this._startAngle;if(c.find(p=>{var m;return((m=p.data[0])===null||m===void 0?void 0:m[ci])>g})===void 0)return this._endAngle;const _=[...c].reverse().find(p=>{var m;return((m=p.data[0])===null||m===void 0?void 0:m[ci])<g});return d.includes(l)?(h=_==null?void 0:_.getNextGraphicAttributes())===null||h===void 0?void 0:h.endAngle:_==null?void 0:_.getGraphicAttribute("endAngle",!0)}},a=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;if(this._pieMark){const n=Ct((e=X.getAnimationInKey("pie"))===null||e===void 0?void 0:e(s,a),Zt("pie",this._spec,this._markAttributeContext));n.normal&&n.normal.type&&(n.normal=ac(this._pieMark,n.normal)),this._pieMark.setAnimationConfig(n)}if(this._emptyArcMark){const n=Ct((i=X.getAnimationInKey("emptyCircle"))===null||i===void 0?void 0:i(s,a??"fadeIn"));this._emptyArcMark.setAnimationConfig(n)}}getDefaultShapeType(){return"circle"}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}_noAnimationDataKey(t,e){return e}getActiveMarks(){return[this._pieMark]}}ti.transformerConstructor=Br,ti.mark=nc;class os extends ti{constructor(){super(...arguments),this.type=xt.pie}}os.type=xt.pie;const lc=()=>{jo(),ic(),sc(),X.registerSeries(os.type,os)};class Pr extends An{_getDefaultSeriesSpec(t){const e=super._getDefaultSeriesSpec(t);return delete e.data,e}_transformAxisSpec(t){t.axes&&t.autoBandSize&&t.series.forEach((e,i)=>{var s;if(e.type==="bar"){const a=this._findBandAxisBySeries(e,i,t.axes);if(a&&!a.bandSize&&!a.maxBandSize&&!a.minBandSize){const n=ei(e.autoBandSize)&&(s=e.autoBandSize.extend)!==null&&s!==void 0?s:0,{barMaxWidth:r,barMinWidth:l,barWidth:h,barGapInGroup:d}=e;this._applyAxisBandSize(a,n,{barMaxWidth:r,barMinWidth:l,barWidth:h,barGapInGroup:d})}}})}transformSpec(t){if(super.transformSpec(t),t.series&&t.series.length){const e=this._getDefaultSeriesSpec(t);t.series.forEach(i=>{this._isValidSeries(i.type)&&Object.keys(e).forEach(s=>{s in i||(i[s]=e[s])})})}t.axes&&t.axes.length&&t.axes.forEach(e=>{W(e,"trimPadding")&&J(e,kn(this.type,t))}),this._transformAxisSpec(t)}}let Ue=class extends Tn{constructor(){super(...arguments),this.transformerConstructor=Pr,this.type="common"}};Ue.type="common",Ue.transformerConstructor=Pr,At(Ue,br);const hc=()=>{X.registerChart(Ue.type,Ue)},Za=12;function dc(o){return o===mi["desktop-browser"]||o===mi["desktop-miniApp"]?{click:"pointertap",hover:"pointermove",hoverOut:"pointerleave",clickOut:"pointerleave"}:Pn(o)||Ln(o)?{click:"tap",hover:["pointerdown","pointermove"],hoverOut:"pointerleave",clickOut:"pointerleave"}:null}var Na;(function(o){o[o.ALL=3]="ALL",o[o.HORIZONTAL=2]="HORIZONTAL",o[o.VERTICAL=1]="VERTICAL"})(Na||(Na={}));var Wa=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};const cc={x:["top","bottom"],y:["left","right"],category:["angle"],value:["radius"]};class Lr extends ii{get enableRemain(){return this.triggerOff==="none"}constructor(t,e){super(t,e),this.specKey="crosshair",this.layoutType="none",this.gridZIndex=St.CrossHair_Grid,this.labelZIndex=St.CrossHair,this.trigger="hover",this._handleIn=i=>{if(!this._option)return;const{x:s,y:a}=this.calculateTriggerPoint(i);this.showDefault=!1,this._layoutCrosshair(s,a);const n=this._getNeedClearVRenderComponents();this._hasActive=n.some(r=>r&&r.attribute.visible!==!1)},this._handleClickInEvent=i=>{if(!this._hasActive||!this._spec.lockAfterClick||this._clickLock)return this._clickLock?(this._clickLock=!1,void this._handleOutEvent()):void(this._onlyLockClick||(this._handleIn(i),yt(this.triggerOff)&&(this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{this._handleOutEvent()},this.triggerOff))));this._clickLock=!0},this._handleHoverInEvent=Ii(i=>{this._clickLock||this._handleIn(i)},10),this._handleOutEvent=()=>{this.enableRemain||this._clickLock||!this._hasActive||(this.clearOutEvent(),this.hide())},this._handleTooltipShow=i=>{const s=i.tooltipData;if(i.isEmptyTooltip||!s||!s.length)return void this._handleTooltipHideOrRelease();if(ei(this._spec.followTooltip)&&this._spec.followTooltip[i.activeType]===!1)return void this._handleTooltipHideOrRelease();const{x:a,y:n}=this.calculateTriggerPoint(i);this.showDefault=!1,this._layoutCrosshair(a,n,s,i.activeType);const r=this._getNeedClearVRenderComponents();this._hasActive=r.some(l=>l&&l.attribute.visible!==!1)},this._handleTooltipHideOrRelease=()=>{this.clearOutEvent(),this.hide()},this.enable=!0,this.showDefault=!0}_getLimitBounds(){var t,e;if(!this._limitBounds){const{width:i,height:s}=(e=(t=this._option.globalInstance.getChart())===null||t===void 0?void 0:t.getViewRect())!==null&&e!==void 0?e:{width:0,height:0};this._limitBounds={x1:0,y1:0,x2:i,y2:s}}return this._limitBounds}_showDefaultCrosshair(){this.showDefault&&this._showDefaultCrosshairBySpec()}setAttrFromSpec(){super.setAttrFromSpec(),this._parseCrosshairSpec()}created(){super.created(),this._initEvent()}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake||Ie(e,t)||(i.reRender=!0,i.reMake=!0),i}_initEvent(){if(!this._option.disableTriggerEvent)if(this._spec.followTooltip)this._registerTooltipEvent();else{const t=this._getTriggerEvent();t&&t.forEach(e=>{this._registerEvent(e.in,!1,e.click),e.out&&this._registerEvent(e.out,!0)})}}_registerEvent(t,e,i){const s=e?this._handleOutEvent:i?this._handleClickInEvent:this._handleHoverInEvent,a=e?{level:mt.chart}:{source:Xt.chart};$(t)?t.forEach(n=>{this.event.on(n,a,s)}):this.event.on(t,a,s)}_eventOff(t,e,i){const s=e?this._handleOutEvent:i?this._handleClickInEvent:this._handleHoverInEvent;$(t)?t.forEach(a=>{this.event.off(a,s)}):this.event.off(t,s)}updateLayoutAttribute(){this._limitBounds=null,this._showDefaultCrosshair()}calculateTriggerPoint(t){const{event:e}=t,i=this._option.getCompiler().getStage().getLayer(void 0),s={x:e.viewX,y:e.viewY};return i.globalTransMatrix.transformPoint({x:e.viewX,y:e.viewY},s),{x:s.x-this.getLayoutStartPoint().x,y:s.y-this.getLayoutStartPoint().y}}_getTriggerEvent(){const{mode:t=mi["desktop-browser"]}=this._option,e=dc(t);if(e){const i=L(this.trigger||"hover"),s=n=>n==="click"?this.triggerOff==="none"?null:e.clickOut:e.hoverOut;this._spec.lockAfterClick&&!i.includes("click")?(i.push("click"),this._onlyLockClick=!0):this._onlyLockClick=!1;const a=[];return i.forEach(n=>{a.push({click:n==="click",in:e[n],out:s(n)})}),a}return null}_registerTooltipEvent(){this.event.on(V.tooltipHide,{source:Xt.chart},this._handleTooltipHideOrRelease),this.event.on(V.tooltipShow,{source:Xt.chart},this._handleTooltipShow),this.event.on(V.tooltipRelease,{source:Xt.chart},this._handleTooltipHideOrRelease)}_getAxisInfoByField(t){var e,i;const s=(i=(e=this._option).getComponentsByKey)===null||i===void 0?void 0:i.call(e,"axes");if(!(s!=null&&s.length))return null;let a=W(this._spec,`${t}Field.bindingAxesIndex`);if(a||(a=[],s.forEach((g,_)=>{cc[t].includes(g.getOrient())&&a.push(_)})),!a.length)return null;const n=new Map;let r=1/0,l=1/0,h=-1/0,d=-1/0;const{x:c,y:u}=this.getLayoutStartPoint();return a.forEach(g=>{r=1/0,l=1/0,h=-1/0,d=-1/0;const _=s.find(p=>p.getSpecIndex()===g);_&&(_.getRegions().forEach(p=>{const{x:m,y:b}=p.getLayoutStartPoint();r=Math.min(r,m-c),l=Math.min(l,b-u),h=Math.max(h,m+p.getLayoutRect().width-c),d=Math.max(d,b+p.getLayoutRect().height-u)}),n.set(g,{x1:r,y1:l,x2:h,y2:d,axis:_}))}),n}changeRegions(t){}onLayoutEnd(t){const e=this._regions[0];this.setLayoutRect(e.getLayoutRect()),this.setLayoutStartPosition(e.getLayoutStartPoint()),super.onLayoutEnd(t)}onRender(t){}_releaseEvent(){this.clearOutEvent();const t=this._getTriggerEvent();t&&t.forEach(e=>{this._eventOff(e.in,!1,e.click),e.out&&this._eventOff(e.out,!0)})}_parseCrosshairSpec(){this._parseFieldInfo();const{trigger:t,triggerOff:e,labelZIndex:i,gridZIndex:s}=this._spec;t&&(this.trigger=t),(e==="none"||yt(e)&&e>0)&&(this.triggerOff=e),i!==void 0&&(this.labelZIndex=i),s!==void 0&&(this.gridZIndex=s)}_parseField(t,e){var i,s,a;const n={},{line:r={},label:l={},visible:h}=t;if(n.visible=h,n.type=r.type||"line",r.visible===!1)n.style={visible:!1};else{const d=r.style||{},{stroke:c,fill:u,lineWidth:g}=d,_=d,{strokeOpacity:p,fillOpacity:m,opacity:b}=_,x=Wa(_,["strokeOpacity","fillOpacity","opacity"]),v=n.type==="line";let y=v?p:m;if(yt(b)&&(y=(y??1)*b),n.style=Object.assign({opacity:y,pickable:!1,visible:!0},x),v)n.style.stroke=c||u,n.style.lineWidth=W(r,"width",g||2);else{n.style.fill=u||c,!((a=(s=(i=this._spec[e])===null||i===void 0?void 0:i.line)===null||s===void 0?void 0:s.style)===null||a===void 0)&&a.stroke&&(n.style.stroke=this._spec[e].line.style.stroke);const f=W(r,"width");if(typeof f=="string"){const A=parseInt(f.substring(0,f.length-1),10)/100;n.style.sizePercent=A}else typeof f!="number"&&typeof f!="function"||(n.style.size=f)}}if(l.visible){const d=l.labelBackground||{},c=l.style||{},u=d.style||{},{fill:g="rgba(47, 59, 82, 0.9)",stroke:_,outerBorder:p}=u,m=Wa(u,["fill","stroke","outerBorder"]);n.label={visible:!0,formatMethod:l.formatMethod,formatter:l.formatter,minWidth:d.minWidth,maxWidth:d.maxWidth,padding:d.padding,textStyle:Object.assign(Object.assign({fontSize:14,pickable:!1},c),{fill:c.fill||"#fff",stroke:W(c,"stroke")}),panel:(ms(d.visible)?d.visible:d)?Object.assign({visible:!0,pickable:!1,fill:g,stroke:_,outerBorder:Object.assign({stroke:g,distance:0,lineWidth:3},p)},m):{visible:!1},zIndex:this.labelZIndex,childrenPickable:!1,pickable:!1}}else n.label={visible:!1};return n}_filterAxisByPoint(t,e,i){return t&&t.forEach(s=>{const a=s.axis;if($o(s,e,i)&&t.delete(a.getSpecIndex()),a.type.startsWith("polarAxis")){const n=a.getCenter(),r=a.getInnerRadius(),l=a.getOuterRadius(),h=Ne.distancePP({x:e,y:i},n);(h>l||h<r)&&t.delete(a.getSpecIndex())}}),t}clearOutEvent(){this._timer&&(clearTimeout(this._timer),this._timer=null),this._clickLock&&(this._clickLock=null),this._hasActive&&(this._hasActive=null)}}Lr.specKey="crosshair";class Si extends Lr{static getSpecInfo(t){return vs(t,this.specKey,this.type,e=>e.xField&&e.xField.visible!==!1||e.yField&&e.yField.visible!==!1)}constructor(t,e){super(t,e),this.type=F.cartesianCrosshair,this.name=F.cartesianCrosshair,this._currValueX=new Map,this._currValueY=new Map}_showDefaultCrosshairBySpec(){const{xField:t,yField:e}=this._spec;if(t!=null&&t.visible&&t.defaultSelect){const{axisIndex:i,datum:s}=t.defaultSelect;this._defaultCrosshair(i,s,1)}if(e!=null&&e.visible&&e.defaultSelect){const{axisIndex:i,datum:s}=e.defaultSelect;this._defaultCrosshair(i,s,2)}}_defaultCrosshair(t,e,i){const s=this._option.getComponentsByKey("axes").find(a=>a.getSpecIndex()===t);s&&(i===1?(this._currValueX.clear(),this._currValueX.set(t,{axis:s,value:e})):(this._currValueY.clear(),this._currValueY.set(t,{axis:s,value:e})),this.layoutByValue(i))}_findAllAxisContains(t,e){const i=this._getAxisInfoByField("x"),s=this._getAxisInfoByField("y");return{xAxisMap:this._filterAxisByPoint(i,t,e),yAxisMap:this._filterAxisByPoint(s,t,e)}}_getValueAt(t,e){return t.getScale().invert(e)}clearAxisValue(){this._currValueX.clear(),this._currValueY.clear()}setAxisValue(t,e){et(e.getOrient())?this._currValueX.set(e.getSpecIndex(),{value:t,axis:e}):this._currValueY.set(e.getSpecIndex(),{value:t,axis:e})}_getAllAxisValues(t,e,i,s){let a=!1;return t.forEach(n=>{vi(n.axis.getScale().type)&&(a?this.enable=!1:a=!0)}),!!this.enable&&(t.forEach((n,r)=>{const l=n.axis;i.set(r,{value:this._getValueAt(l,e-(s?l.getLayoutStartPoint().x-this.getLayoutStartPoint().x:l.getLayoutStartPoint().y-this.getLayoutStartPoint().y)),axis:l})}),!0)}_layoutCrosshair(t,e,i,s){var a;let n=t,r=e;if(i&&i.length){if(s==="dimension"){const d=i[0],c=d.data.findIndex(g=>g.datum.length>0);let u;if(c>-1){const g=d.data[c];u=g.series.dataToPosition(g.datum[0])}(S(d.dimType)?d.dimType==="y":Se((a=d==null?void 0:d.axis)===null||a===void 0?void 0:a.getOrient()))?r=u==null?void 0:u.y:n=u==null?void 0:u.x}else if(s==="mark"){const d=i[0],c=d.series.dataToPosition(d.datum[0]);n=c==null?void 0:c.x,r=c==null?void 0:c.y}}const{xAxisMap:l,yAxisMap:h}=this._findAllAxisContains(n,r);if(l&&l.size===0||h&&h.size===0){if(this.enableRemain)return;this.hide()}else this._currValueX.clear(),this._currValueY.clear(),l&&l.size&&this._getAllAxisValues(l,n,this._currValueX,!0),h&&h.size&&this._getAllAxisValues(h,r,this._currValueY,!1),this.layoutByValue(3)}hide(){this._xCrosshair&&this._xCrosshair.hideAll(),this._xTopLabel&&this._xTopLabel.hideAll(),this._xBottomLabel&&this._xBottomLabel.hideAll(),this._yCrosshair&&this._yCrosshair.hideAll(),this._yLeftLabel&&this._yLeftLabel.hideAll(),this._yRightLabel&&this._yRightLabel.hideAll()}layoutByValue(t=3){if(!this.enable)return;const e=Dn(this._regions,"cartesian");if(!e)return;const{x:i,y:s,offsetWidth:a,offsetHeight:n,bandWidth:r,bandHeight:l}=Ko(t,e,this.getLayoutStartPoint(),this._currValueX,this._currValueY,this._xHair,this._yHair,this.enableRemain,this._cacheXCrossHairInfo,this._cacheYCrossHairInfo);this.enableRemain&&(i&&(this._cacheXCrossHairInfo=Object.assign(Object.assign({},i),{_isCache:!0})),s&&(this._cacheYCrossHairInfo=Object.assign(Object.assign({},s),{_isCache:!0}))),i&&this._layoutVertical(i,r,a),s&&this._layoutHorizontal(s,l,n)}_layoutVertical(t,e,i){var s,a;if(t._isCache&&this.enableRemain||!this._xHair)return;const{x:n,topPos:r,height:l,top:h,bottom:d,visible:c}=t;if(c){const u=this._xHair.type,g=qo(this._xHair,t,e,i);if(this._updateCrosshair("x",u,g),h.visible){const _=Object.assign(Object.assign(Object.assign({x:n+e/2,y:r},h),this._xHair.label),{textStyle:Object.assign(Object.assign({},(s=this._xHair.label)===null||s===void 0?void 0:s.textStyle),{textAlign:"center",textBaseline:"bottom"}),zIndex:this.labelZIndex,visible:!0});this._updateCrosshairLabel(this._xTopLabel,_,p=>{p.name="crosshair-x-top-label",this._xTopLabel=p})}else this._xTopLabel&&this._xTopLabel.hideAll();if(d.visible){const _=Object.assign(Object.assign(Object.assign({x:n+e/2,y:r+l},d),this._xHair.label),{textStyle:Object.assign(Object.assign({},(a=this._xHair.label)===null||a===void 0?void 0:a.textStyle),{textAlign:"center",textBaseline:"top"}),zIndex:this.labelZIndex,visible:!0});this._updateCrosshairLabel(this._xBottomLabel,_,p=>{p.name="crosshair-x-bottom-label",this._xBottomLabel=p})}else this._xBottomLabel&&this._xBottomLabel.hideAll()}}_layoutHorizontal(t,e,i){var s,a;if(t._isCache&&this.enableRemain||!this._yHair)return;const{leftPos:n,width:r,y:l,left:h,right:d,visible:c}=t;if(c){const u=this._yHair.type,g=Qo(this._yHair,t,e,i);if(this._updateCrosshair("y",u,g),h.visible){const _=Object.assign(Object.assign(Object.assign({x:n,y:l+e/2},h),this._yHair.label),{textStyle:Object.assign(Object.assign({},(s=this._yHair.label)===null||s===void 0?void 0:s.textStyle),{textAlign:"right",textBaseline:"middle"}),zIndex:this.labelZIndex});this._updateCrosshairLabel(this._yLeftLabel,_,p=>{p.name="crosshair-y-left-label",this._yLeftLabel=p})}else this._yLeftLabel&&this._yLeftLabel.hideAll();if(d.visible){const _=Object.assign(Object.assign(Object.assign({x:n+r,y:l+e},d),this._yHair.label),{textStyle:Object.assign(Object.assign({},(a=this._yHair.label)===null||a===void 0?void 0:a.textStyle),{textAlign:"left",textBaseline:"middle"}),zIndex:this.labelZIndex});this._updateCrosshairLabel(this._yRightLabel,_,p=>{p.name="crosshair-y-right-label",this._yRightLabel=p})}else this._yRightLabel&&this._yRightLabel.hideAll()}}_parseFieldInfo(){const{xField:t,yField:e}=this._spec;this._parseAndSetCrosshair(t,"x"),this._parseAndSetCrosshair(e,"y")}_parseAndSetCrosshair(t,e){const i=`_${e}Hair`,s=`_${e}Crosshair`;if(t&&t.visible){if(this[i]=this._parseField(t,`${e}Field`),this[s]){const{style:a,type:n}=this[i],r=n==="rect"?"rectStyle":"lineStyle";this[s].setAttributes({[r]:a})}}else this[s]&&this[s].parent&&this[s].parent.removeChild(this[s])}_updateCrosshair(t,e,i){const s=this.getContainer();let a;if(a=t==="x"?this._xCrosshair:this._yCrosshair,a)a.setAttributes(i);else{const n=t==="x"?this._xHair.style:this._yHair.style;e==="line"?a=new Vi(Object.assign(Object.assign({},i),{lineStyle:n,zIndex:this.gridZIndex+1,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1})):e==="rect"&&(a=new ji(Object.assign(Object.assign({},i),{rectStyle:n,zIndex:this.gridZIndex,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1}))),s==null||s.add(a),t==="x"?this._xCrosshair=a:this._yCrosshair=a}}_updateCrosshairLabel(t,e,i){const s=this.getContainer();t?t.setAttributes(e):(i(t=new Re(e)),s==null||s.add(t)),Jo(t,this._getLimitBounds())}_getNeedClearVRenderComponents(){return[this._xCrosshair,this._xTopLabel,this._xBottomLabel,this._yCrosshair,this._yLeftLabel,this._yRightLabel]}}Si.specKey="crosshair",Si.type=F.cartesianCrosshair;const Dr=()=>{X.registerComponent(Si.type,Si)},uc=(o,t)=>{const{getNewDomain:e,isContinuous:i,field:s}=t,a=s(),n=e();if(C(n)||C(a))return o;if(n.length===0)return[];const r={};n.forEach(h=>{r[h]||(r[h]=1)});let l=null;return l=i()?h=>{let d=!1;return L(a).every(c=>{h[c]>=n[0]&&h[c]<=j(n)&&(d=!0)}),d}:h=>{let d=!1;return L(a).every(c=>{(r[h[c]+""]||r[h[c]])&&(d=!0)}),d},o.filter(l)},gc=(o,t)=>{const{stateFields:e,valueFields:i,dataCollection:s}=t.input,{stateField:a,valueField:n}=t.output,r={},l=[];return s.forEach((h,d)=>{var c;if(C(e[d]))return;const u=(c=h.getFields())===null||c===void 0?void 0:c[e[d]];u&&u.lockStatisticsByDomain&&u.domain.forEach(g=>{r[g]=0}),h.latestData.forEach(g=>{L(e[d]).forEach(_=>{C(g[_])||(C(r[g[_]])&&(r[g[_]]=0),C(i[d])||(r[g[_]]+=isNaN(parseFloat(g[i[d]]))?1:parseFloat(g[i[d]])))})})}),Object.keys(r).forEach((h,d)=>{const c={[a]:h};n&&(c[n]=r[h]),l.push(c)}),l};class Cs extends ii{get relatedAxisComponent(){return this._relatedAxisComponent}setStartAndEnd(t,e,i=["percent","percent"]){const[s="percent",a="percent"]=i,n=s==="percent"?t:this.dataToStatePoint(t),r=a==="percent"?e:this.dataToStatePoint(e);this._handleChange(n,r,!0)}enableInteraction(){this._activeRoam=!0}disableInteraction(){this._activeRoam=!1}zoomIn(t){this._handleChartZoom({zoomDelta:1.2,zoomX:t==null?void 0:t.x,zoomY:t==null?void 0:t.y})}zoomOut(t){this._handleChartZoom({zoomDelta:.8,zoomX:t==null?void 0:t.x,zoomY:t==null?void 0:t.y})}_handleChange(t,e,i){var s,a;(a=(s=this._spec)===null||s===void 0?void 0:s.zoomLock)!==null&&a!==void 0&&a||e-t!==this._spanCache&&(e-t<this._minSpan||e-t>this._maxSpan)?this._shouldChange=!1:(this._shouldChange=!0,this._spanCache=e-t)}_isReverse(){const t=this._relatedAxisComponent;if(!t)return!1;const e=t.getScale();return e.range()[0]>e.range()[1]&&(!t.getInverse()||this._isHorizontal)}_updateRangeFactor(t){const e=this._relatedAxisComponent.getScale(),i=this._isReverse(),s=i?[1-this._end,1-this._start]:[this._start,this._end];if(i)switch(t){case"startHandler":e.rangeFactorEnd(s[1]);break;case"endHandler":e.rangeFactorStart(s[0]);break;default:e.rangeFactorStart(s[0],!0),e.rangeFactorEnd(s[1])}else switch(t){case"startHandler":e.rangeFactorStart(s[0]);break;case"endHandler":e.rangeFactorEnd(s[1]);break;default:e.rangeFactorEnd(s[1],!0),e.rangeFactorStart(s[0])}const a=e.rangeFactor();a?(this._start=i?1-a[1]:a[0],this._end=i?1-a[0]:a[1]):(this._start=0,this._end=1)}get visible(){return this._visible}constructor(t,e){super(t,e),this.layoutType="none",this._orient="left",this._cacheVisibility=void 0,this._dataUpdating=!1,this._shouldChange=!0,this._stateField="x",this._activeRoam=!0,this._zoomAttr={enable:!0,rate:1,focus:!0},this._dragAttr={enable:!0,rate:1,reverse:!0},this._scrollAttr={enable:!0,rate:1,reverse:!0},this.effect={onZoomChange:i=>{var s,a;const n=this._relatedAxisComponent;if(n&&this._filterMode==="axis"){const r=n.getScale(),l=n.getSpec();this._auto&&this._getAxisBandSize(l)&&this._spec.ignoreBandSize&&(r.bandwidth("auto"),r.maxBandwidth("auto"),r.minBandwidth("auto")),this._updateRangeFactor(i),this._auto&&((a=(s=this._component)===null||s===void 0?void 0:s.setStartAndEnd)===null||a===void 0||a.call(s,this._start,this._end)),n.effect.scaleUpdate({value:"force"})}else vt(this._regions,r=>{var l;(l=r.getViewData())===null||l===void 0||l.markRunning()},{userId:this._seriesUserId,specIndex:this._seriesIndex}),vt(this._regions,r=>{r.reFilterViewData()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._visible=!0,this._handleStateChange=(i,s,a)=>{var n,r;return this._startValue=i,this._endValue=s,this._newDomain=this._parseDomainFromState(this._startValue,this._endValue),(r=(n=this.effect).onZoomChange)===null||r===void 0||r.call(n,a),!0},this._handleChartZoom=i=>{var s,a;if(!this._activeRoam)return;const{zoomDelta:n,zoomX:r,zoomY:l}=i,{x:h,y:d}=this._regions[0].getLayoutStartPoint(),{width:c,height:u}=this._regions[0].getLayoutRect(),g=Math.abs(this._start-this._end),_=(a=(s=this._spec.roamZoom)===null||s===void 0?void 0:s.rate)!==null&&a!==void 0?a:1;if(g>=1&&n<1||g<=.01&&n>1)return;const p=this._isHorizontal?r:l,m=g*(n-1)*_;let b=m/2,x=m/2;if(p){const f=this._isHorizontal?h:d,A=this._isHorizontal?c:u;b=Math.abs(f-p)/Math.abs(A-f)*m,x=Math.abs(A-p)/Math.abs(A-f)*m}const v=Le(this._start+b,0,1),y=Le(this._end-x,0,1);this._handleChange(Math.min(v,y),Math.max(v,y),!0)},this._handleChartScroll=(i,s)=>{var a;if(!this._activeRoam)return!1;const{scrollX:n,scrollY:r}=i;let l=this._isHorizontal?n:r;const h=this._isHorizontal?Pe(n/r)>=.5:Pe(r/n)>=.5;this._scrollAttr.reverse||(l=-l),h&&this._handleChartMove(l,(a=this._scrollAttr.rate)!==null&&a!==void 0?a:1);const d=this._start!==0&&this._end!==1;return h&&d},this._handleChartDrag=(i,s)=>{var a;if(!this._activeRoam)return;const[n,r]=i;let l=this._isHorizontal?n:r;this._dragAttr.reverse&&(l=-l),this._handleChartMove(l,(a=this._dragAttr.rate)!==null&&a!==void 0?a:1)},this._handleChartMove=(i,s)=>{const a=this._isHorizontal?this.getLayoutRect().width:this.getLayoutRect().height;if(Math.abs(i)>=1e-6){if(i>0&&this._end<1){const n=Math.min(1-this._end,i/a)*s;this._handleChange(this._start+n,this._end+n,!0)}else if(i<0&&this._start>0){const n=Math.max(-this._start,i/a)*s;this._handleChange(this._start+n,this._end+n,!0)}}return!1},this._orient=vn(t),this._isHorizontal=tl(this._orient)==="horizontal"}created(){super.created(),this._setAxisFromSpec(),this._setRegionsFromSpec(),this._initEvent(),this._initData(),this._initStateScale(),this._setStateFromSpec()}initLayout(){super.initLayout(),this._layout&&(this._layout.layoutOrient=this._orient)}_setAxisFromSpec(){if(S(this._spec.axisId)?this._relatedAxisComponent=this._option.getComponentByUserId(this._spec.axisId):S(this._spec.axisIndex)&&(this._relatedAxisComponent=this._option.getComponentByIndex("axes",this._spec.axisIndex)),C(this._spec.field)&&!this._relatedAxisComponent){const t=this._option.getComponentsByKey("axes"),e=t.find(i=>i._orient===this._orient);if(e)this._relatedAxisComponent=e;else{const i=t.find(s=>!K(s.getScale().type));this._relatedAxisComponent=i}}this._relatedAxisComponent&&this._filterMode==="axis"&&(this._relatedAxisComponent.autoIndentOnce=!0)}_setRegionsFromSpec(){var t,e;this._regions=this._relatedAxisComponent?this._relatedAxisComponent.getRegions():this._option.getAllRegions();const i=this._relatedAxisComponent?(e=(t=this._relatedAxisComponent).getBindSeriesFilter)===null||e===void 0?void 0:e.call(t):null;if(S(i)&&(S(i.userId)&&(this._seriesUserId=L(i.userId)),S(i.specIndex)&&(this._seriesIndex=L(i.specIndex))),S(this._spec.seriesId)){const s=L(this._spec.seriesId);this._seriesUserId?this._seriesUserId=this._seriesUserId.filter(a=>s.includes(a)):this._seriesUserId=s}if(S(this._spec.seriesIndex)){const s=L(this._spec.seriesIndex);this._seriesIndex?this._seriesIndex=this._seriesIndex.filter(a=>s.includes(a)):this._seriesIndex=s}if(S(this._spec.regionIndex)){const s=this._option.getRegionsInIndex(L(this._spec.regionIndex));this._regions=this._regions.filter(a=>s.includes(a))}else if(S(this._spec.regionId)){const s=L(this._spec.regionId);this._regions=s.length?this._regions.filter(a=>s.includes(a.id)):[]}}onDataUpdate(){var t;const e=this._computeDomainOfStateScale(K(this._stateScale.type));this._stateScale.domain(e,!1),this._handleChange(this._start,this._end,!0),this._spec.auto&&(this._dataUpdating=!0,(t=this.getChart())===null||t===void 0||t.setLayoutTag(!0,null,!1))}_computeDomainOfStateScale(t){if(this._spec.customDomain)return this._spec.customDomain;const e=this._data.getLatestData().map(i=>i[this._stateField]);if(t){const i=e.map(s=>1*s);return e.length?[It(i),Bt(i)]:[-1/0,1/0]}return e}_initEvent(){this._initCommonEvent()}_initData(){const t=[],e=[],i=[];if(this._relatedAxisComponent){const n={};vt(this._regions,r=>{var l,h;const d=r.coordinate==="cartesian"?r.getXAxisHelper():r.coordinate==="polar"?r.angleAxisHelper:null,c=r.coordinate==="cartesian"?r.getYAxisHelper():r.coordinate==="polar"?r.radiusAxisHelper:null;if(!d||!c)return;const u=d.getAxisId()===this._relatedAxisComponent.id?d:c.getAxisId()===this._relatedAxisComponent.id?c:this._isHorizontal?d:c,g=u===d?c:d,_=K(g.getScale(0).type),p=K(u.getScale(0).type);t.push(r.getRawData());const m=r.getSpec(),b=r.coordinate==="cartesian"?L(m.xField):L((l=m.angleField)!==null&&l!==void 0?l:m.categoryField),x=r.coordinate==="cartesian"?L(m.yField):L((h=m.radiusField)!==null&&h!==void 0?h:m.valueField);if(n[r.id]=r.type==="link"?["from_xField"]:u===d?b:x,p?e.push(n[r.id]):e.push(n[r.id][0]),this._valueField){const v=r.type==="link"?["from_yField"]:g===d?b:x;_&&i.push(...v)}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),this._originalStateFields=n}else vt(this._regions,n=>{t.push(n.getRawData()),e.push(this._field),this._valueField&&i.push(this._spec.valueField)},{userId:this._seriesUserId,specIndex:this._seriesIndex});const{dataSet:s}=this._option;mn(s,"dataview",el),at(s,"dataFilterComputeDomain",gc);const a=new bt(s,{name:`${this.type}_${this.id}_data`});a.transform({type:"dataFilterComputeDomain",options:{input:{dataCollection:t,stateFields:e,valueFields:i},output:{stateField:this._stateField,valueField:this._valueField}}},!1),this._data=new Ke(this._option,a),a.reRunAllTransform(),s.multipleDataViewAddListener(t,"change",this._handleDataCollectionChange.bind(this))}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._spec.roamZoom===!0||this._spec.roamZoom?this._zoomAttr=M({},this._zoomAttr,this._spec.roamZoom):this._zoomAttr.enable=!1,this._spec.roamDrag===!0||this._spec.roamDrag?this._dragAttr=M({},this._dragAttr,this._spec.roamDrag):this._dragAttr.enable=!1,this._spec.roamScroll===!0||this._spec.roamScroll?this._scrollAttr=M({},this._scrollAttr,this._spec.roamScroll):this._scrollAttr.enable=!1,this._field=this._spec.field,this._width=this._computeWidth(),this._height=this._computeHeight(),this._visible=(t=this._spec.visible)===null||t===void 0||t}_statePointToData(t){const e=this._stateScale,i=e.domain();if(K(e.type))return this._isReverse()?i[0]+(j(i)-i[0])*(1-t):i[0]+(j(i)-i[0])*t;let s=e.range();this._isReverse()&&(s=s.slice().reverse());const a=s[0]+(j(s)-s[0])*t;return e.invert(a)}dataToStatePoint(t){const e=this._stateScale,i=e.scale(t);let s=e.range();return!this._isHorizontal&&K(e.type)&&(s=s.slice().reverse()),(i-s[0])/(j(s)-s[0])}_modeCheck(t,e){return t==="start"?e==="percent"&&S(this._spec.start)||e==="value"&&S(this._spec.startValue):e==="percent"&&S(this._spec.end)||e==="value"&&S(this._spec.endValue)}_setStateFromSpec(){var t,e;let i,s;if(this._auto=!!this._spec.auto,this._spec.rangeMode){const[a,n]=this._spec.rangeMode;this._modeCheck("start",a)&&this._modeCheck("end",n)&&(i=a==="percent"?this._spec.start:this.dataToStatePoint(this._spec.startValue),s=n==="percent"?this._spec.end:this.dataToStatePoint(this._spec.endValue))}else i=this._spec.start?this._spec.start:this._spec.startValue?this.dataToStatePoint(this._spec.startValue):0,s=this._spec.end?this._spec.end:this._spec.endValue?this.dataToStatePoint(this._spec.endValue):1;this._startValue=this._statePointToData(i),this._endValue=this._statePointToData(s),this._start=i,this._end=s,this._minSpan=(t=this._spec.minSpan)!==null&&t!==void 0?t:0,this._maxSpan=(e=this._spec.maxSpan)!==null&&e!==void 0?e:1,K(this._stateScale.type)&&this._stateScale.domain()[0]!==j(this._stateScale.domain())&&(this._spec.minValueSpan&&(this._minSpan=this._spec.minValueSpan/(j(this._stateScale.domain())-this._stateScale.domain()[0])),this._spec.maxValueSpan&&(this._maxSpan=this._spec.maxValueSpan/(j(this._stateScale.domain())-this._stateScale.domain()[0]))),this._minSpan=Math.max(0,this._minSpan),this._maxSpan=Math.min(this._maxSpan,1),this._relatedAxisComponent&&this._filterMode==="axis"||this._start===0&&this._end===1||(this._newDomain=this._parseDomainFromState(this._startValue,this._endValue))}_parseFieldOfSeries(t){var e;return(e=this._originalStateFields)===null||e===void 0?void 0:e[t.id]}_initStateScale(){const t=[0,1];if(this._relatedAxisComponent){const e=this._relatedAxisComponent.getScale(),i=K(e.type),s=this._computeDomainOfStateScale(i);if(this._stateScale=e.clone(),i){const a=s.map(n=>1*n);this._stateScale.domain(s.length?[It(a),Bt(a)]:[0,1],!0).range(t)}else this._stateScale.domain(s,!0).range(t)}else this._stateScale=new bn,this._stateScale.domain(this._computeDomainOfStateScale(),!0).range(t)}init(t){super.init(t),this._addTransformToSeries(),this._start===0&&this._end===1||this.effect.onZoomChange()}_addTransformToSeries(){this._relatedAxisComponent&&this._filterMode==="axis"||(at(this._option.dataSet,"dataFilterWithNewDomain",uc),vt(this._regions,t=>{t.addViewDataFilter({type:"dataFilterWithNewDomain",options:{getNewDomain:()=>this._newDomain,field:()=>{var e;return(e=this._field)!==null&&e!==void 0?e:this._parseFieldOfSeries(t)},isContinuous:()=>K(this._stateScale.type)},level:il.dataZoomFilter})},{userId:this._seriesUserId,specIndex:this._seriesIndex}))}onRender(t){}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake||Ie(e,t)||(i.reRender=!0,i.reMake=!0),i}reInit(t){super.reInit(t),this._marks.forEach(e=>{e.getMarks().forEach(i=>{this.initMarkStyleWithSpec(i,this._spec[i.name])})})}changeRegions(){}update(t){}resize(t){}_parseDomainFromState(t,e){if(K(this._stateScale.type))return[Math.min(e,t),Math.max(e,t)];const i=this._stateScale.domain(),s=i.indexOf(t),a=i.indexOf(e);return i.slice(Math.min(s,a),Math.max(s,a)+1)}_initCommonEvent(){var t,e,i,s,a,n,r;const l={delayType:(e=(t=this._spec)===null||t===void 0?void 0:t.delayType)!==null&&e!==void 0?e:"throttle",delayTime:S((i=this._spec)===null||i===void 0?void 0:i.delayType)?(a=(s=this._spec)===null||s===void 0?void 0:s.delayTime)!==null&&a!==void 0?a:30:0,realTime:(r=(n=this._spec)===null||n===void 0?void 0:n.realTime)===null||r===void 0||r};this._zoomAttr.enable&&this.initZoomEventOfRegions(this._regions,null,this._handleChartZoom,l),this._scrollAttr.enable&&this.initScrollEventOfRegions(this._regions,null,this._handleChartScroll,l),this._dragAttr.enable&&this.initDragEventOfRegions(this._regions,null,this._handleChartDrag,l)}updateLayoutAttribute(){this._visible&&this._createOrUpdateComponent(),super.updateLayoutAttribute()}onLayoutStart(t,e,i){super.onLayoutStart(t,e,i);const s=this._autoUpdate(t),a=this._isHorizontal?"height":"width";this.layout.setLayoutRect({[a]:s?this[`_${a}`]:0},{[a]:I.Built_In}),this._dataUpdating=!1}getBoundsInRect(t){const e={x1:this.getLayoutStartPoint().x,y1:this.getLayoutStartPoint().y,x2:0,y2:0};return this._isHorizontal?(e.y2=e.y1+this._height,e.x2=e.x1+t.width):(e.x2=e.x1+this._width,e.y2=e.y1+t.height),e}hide(){var t;(t=this._component)===null||t===void 0||t.hideAll()}show(){var t;(t=this._component)===null||t===void 0||t.showAll()}_getAxisBandSize(t){const e=t==null?void 0:t.bandSize,i=t==null?void 0:t.maxBandSize,s=t==null?void 0:t.minBandSize;if(e||s||i)return{bandSize:e,maxBandSize:i,minBandSize:s}}_autoUpdate(t){var e,i,s,a,n,r;if(!this._auto)return this._cacheVisibility=void 0,!0;const l=this._relatedAxisComponent,h=l==null?void 0:l.getSpec(),d=l==null?void 0:l.getScale(),c=this._getAxisBandSize(h);if(!this._dataUpdating&&vi(d.type)&&(t==null?void 0:t.height)===((e=this._cacheRect)===null||e===void 0?void 0:e.height)&&(t==null?void 0:t.width)===((i=this._cacheRect)===null||i===void 0?void 0:i.width)&&this._fixedBandSize===(c==null?void 0:c.bandSize))return this._cacheVisibility;let u=!0;if(this._isHorizontal&&(t==null?void 0:t.width)!==((s=this._cacheRect)===null||s===void 0?void 0:s.width)?d.range(l.getInverse()?[t.width,0]:[0,t.width]):(t==null?void 0:t.height)!==((a=this._cacheRect)===null||a===void 0?void 0:a.height)&&d.range(l.getInverse()?[0,t.height]:[t.height,0]),this._cacheRect={width:t==null?void 0:t.width,height:t==null?void 0:t.height},this._fixedBandSize=c==null?void 0:c.bandSize,vi(d.type)){c&&(this._start||this._end)&&(this.type===F.scrollBar&&(this._start=0,this._end=1),this._updateRangeFactor());const[g,_]=(n=d.rangeFactor())!==null&&n!==void 0?n:[];u=(!C(g)||!C(_))&&!(g===0&&_===1)}else{const[g,_]=(r=d.rangeFactor())!==null&&r!==void 0?r:[this._start,this._end];u=!(g===0&&_===1)}return this.setStartAndEnd(this._start,this._end),u?this.show():this.hide(),this._cacheVisibility=u,u}_getNeedClearVRenderComponents(){return[this._component]}}At(Cs,$d);class Or extends sl{_mergeThemeToSpec(t,e){const i=this._theme;let s=t;if(this._shouldMergeThemeToSpec()){const a=r=>{const l=J({selectedBackgroundChart:{line:{},area:{}}},this._theme,r),{selectedBackgroundChart:h={}}=r,{line:d,area:c}=h;return d&&d.visible!==!1&&(l.selectedBackgroundChart.line.style=Object.assign(Object.assign({},l.selectedBackgroundChart.line.style),{visible:!0})),c&&c.visible!==!1&&(l.selectedBackgroundChart.area.style=Object.assign(Object.assign({},l.selectedBackgroundChart.area.style),{visible:!0})),l},n=t;s=$(n)?n.map(r=>a(r)):a(n)}return this._adjustPadding(s),{spec:s,theme:i}}}class Ze extends Cs{constructor(t,e){var i;super(t,e),this.type=F.dataZoom,this.name=F.dataZoom,this.transformerConstructor=Or,this.specKey="dataZoom",this.layoutZIndex=St.DataZoom,this.layoutLevel=_s.DataZoom,this.layoutType="region-relative",this._isReverseCache=!1,this._dataToPositionX=s=>{const a=this._orient==="left"?this._middleHandlerSize:0,n=this._isHorizontal?this._startHandlerSize/2:0,r=this._isHorizontal?this._stateScale:this._valueScale,l=this._isHorizontal?this._stateField:this._valueField;return r.scale(s[l])+this.getLayoutStartPoint().x+a+n},this._dataToPositionX2=s=>{const a=this._orient==="left"?this._middleHandlerSize:0,n=this._isHorizontal?this._startHandlerSize/2:0,r=this._isHorizontal?this._stateScale:this._valueScale,l=r.domain()[0];return r.scale(l)+this.getLayoutStartPoint().x+a+n},this._dataToPositionY=s=>{const a=this._isHorizontal?this._middleHandlerSize:0,n=this._isHorizontal?0:this._startHandlerSize/2,r=this._isHorizontal?this._valueScale:this._stateScale,l=this._isHorizontal?this._valueField:this._stateField;return r.scale(s[l])+this.getLayoutStartPoint().y+a+n},this._dataToPositionY2=s=>{const a=this._isHorizontal?this._middleHandlerSize:0,n=this._isHorizontal?0:this._startHandlerSize/2,r=this._isHorizontal?this._valueScale:this._stateScale,l=r.domain()[0];return r.scale(l)+this.getLayoutStartPoint().y+a+n},this._valueField="y",this._filterMode=(i=t.filterMode)!==null&&i!==void 0?i:"filter"}created(){super.created(),this._initValueScale()}setAttrFromSpec(){var t,e,i,s,a,n,r,l,h,d;super.setAttrFromSpec(),ms(this._spec.roam)&&(this._zoomAttr.enable=this._spec.roam,this._dragAttr.enable=this._spec.roam,this._scrollAttr.enable=this._spec.roam),(this._zoomAttr.enable||this._dragAttr.enable||this._scrollAttr.enable)&&this.initZoomable(this.event,this._option.mode),this._backgroundSize=(e=(t=this._spec.background)===null||t===void 0?void 0:t.size)!==null&&e!==void 0?e:30,this._middleHandlerSize=this._computeMiddleHandlerSize(),this._width=this._computeWidth(),this._height=this._computeHeight(),C((a=(s=(i=this._spec)===null||i===void 0?void 0:i.startHandler)===null||s===void 0?void 0:s.style)===null||a===void 0?void 0:a.size)&&(this._spec.startHandler.style.size=this._isHorizontal?this._height-this._middleHandlerSize:this._width-this._middleHandlerSize),C((l=(r=(n=this._spec)===null||n===void 0?void 0:n.endHandler)===null||r===void 0?void 0:r.style)===null||l===void 0?void 0:l.size)&&(this._spec.endHandler.style.size=this._isHorizontal?this._height-this._middleHandlerSize:this._width-this._middleHandlerSize);const c=(h=this._spec.startHandler.style.visible)===null||h===void 0||h,u=(d=this._spec.endHandler.style.visible)===null||d===void 0||d;this._startHandlerSize=c?this._spec.startHandler.style.size:0,this._endHandlerSize=u?this._spec.endHandler.style.size:0}onLayoutEnd(t){this._updateScaleRange(),this._isReverse()&&!this._isReverseCache&&(this._isReverseCache=this._isReverse(),this.effect.onZoomChange()),this._cacheVisibility!==!1&&super.onLayoutEnd(t)}_initValueScale(){const t=this._computeDomainOfValueScale();if(t){const e=new yn;e.domain(t),this._valueScale=e}}_updateScaleRange(){var t,e;const i=this._startHandlerSize+this._endHandlerSize;if(!this._stateScale||!this._valueScale)return;let s;const a=this._isHorizontal?this.getLayoutRect().width-i:this.getLayoutRect().height-i,n=(e=(t=this._relatedAxisComponent)===null||t===void 0?void 0:t.getScale().range())!==null&&e!==void 0?e:[this._startHandlerSize/2,a+this._startHandlerSize/2];this._isHorizontal?(s=this._visible?[this._startHandlerSize/2,this._computeWidth()-i+this._startHandlerSize/2]:n,this._stateScale.range(s),this._valueScale.range([this._computeHeight()-this._middleHandlerSize,0])):this.layoutOrient==="left"?(s=this._visible?[this._startHandlerSize/2,this._computeHeight()-i+this._startHandlerSize/2]:n,this._stateScale.range(s),this._valueScale.range([this._computeWidth()-this._middleHandlerSize,0])):(s=this._visible?[this._startHandlerSize/2,this._computeHeight()-i+this._startHandlerSize/2]:n,this._stateScale.range(s),this._valueScale.range([0,this._computeWidth()-this._middleHandlerSize])),this._component&&this._cacheVisibility!==!1&&this._component.setAttributes({size:{width:this._computeWidth(),height:this._computeHeight()},position:{x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y}})}_computeDomainOfValueScale(){const t=this._data.getLatestData().map(i=>i[this._valueField]),e=t.map(i=>1*i);return t.length?[It(e),Bt(e)]:null}_computeMiddleHandlerSize(){var t,e,i,s;let a=0;if(!((e=(t=this._spec)===null||t===void 0?void 0:t.middleHandler)===null||e===void 0)&&e.visible){const n=(i=this._spec.middleHandler.icon.style.size)!==null&&i!==void 0?i:8,r=(s=this._spec.middleHandler.background.size)!==null&&s!==void 0?s:40;a+=Math.max(n,r)}return a}_computeWidth(){return this._visible===!1?0:yt(this._spec.width)?this._spec.width:this._isHorizontal?this.getLayoutRect().width:this._backgroundSize+this._middleHandlerSize}_computeHeight(){return this._visible===!1?0:yt(this._spec.height)?this._spec.height:this._isHorizontal?this._backgroundSize+this._middleHandlerSize:this.getLayoutRect().height-(this._startHandlerSize+this._endHandlerSize)/2}_isScaleValid(t){if(!t||!t.domain())return!1;const e=t.domain();return(!K(t.type)||e[0]!==j(e))&&(!vi(t.type)||al(e).length!==1)}_getAttrs(t){var e,i,s,a,n;const r=(e=this._spec)!==null&&e!==void 0?e:{};return Object.assign({zIndex:this.layoutZIndex,start:this._start,end:this._end,position:{x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y},orient:this._orient,size:{width:this.getLayoutRect().width,height:this.getLayoutRect().height},showDetail:r.showDetail,brushSelect:(i=r.brushSelect)!==null&&i!==void 0&&i,zoomLock:(s=r.zoomLock)!==null&&s!==void 0&&s,minSpan:this._minSpan,maxSpan:this._maxSpan,delayType:r.delayType,delayTime:S(r.delayType)?(a=r.delayTime)!==null&&a!==void 0?a:30:0,realTime:(n=r.realTime)===null||n===void 0||n,previewData:t&&this._data.getLatestData(),previewPointsX:t&&this._dataToPositionX,previewPointsY:t&&this._dataToPositionY,tolerance:this._spec.tolerance},this._getComponentAttrs(t))}_createOrUpdateComponent(){if(this._visible){const t=this._isHorizontal?this._stateScale:this._valueScale,e=this._isHorizontal?this._valueScale:this._stateScale,i=this._isScaleValid(t)&&this._isScaleValid(e)&&this._spec.showBackgroundChart!==!1,s=this._getAttrs(i);if(this._component)this._component.setAttributes(s);else{const a=this.getContainer();this._component=new Jn(s),this._isHorizontal?i&&this._component.setPreviewPointsY1(this._dataToPositionY2):i&&this._component.setPreviewPointsX1(this._dataToPositionX2),this._component.setStatePointToData(n=>this._statePointToData(n)),this._component.addEventListener("change",n=>{const{start:r,end:l,tag:h}=n.detail;this._handleChange(r,l,void 0,h)}),a.add(this._component),this._updateScaleRange()}}}_handleChange(t,e,i,s){if(super._handleChange(t,e,i),this._shouldChange){i&&this._component&&this._component.setStartAndEnd(t,e),this._start=t,this._end=e;const a=this._statePointToData(t),n=this._statePointToData(e);(R(this._spec.updateDataAfterChange)?this._spec.updateDataAfterChange(t,e,a,n):this._handleStateChange(a,n,s))&&this.event.emit(V.dataZoomChange,{model:this,value:{filterData:this._filterMode!=="axis",start:t,end:e,startValue:this._startValue,endValue:this._endValue,newDomain:this._newDomain}})}}_handleDataCollectionChange(){var t;const e=this._data.getDataView();if(e.reRunAllTransform(),(t=this._component)===null||t===void 0||t.setPreviewData(e.latestData),this._valueScale){const i=this._computeDomainOfValueScale();i&&this._valueScale.domain(i)}}_getComponentAttrs(t){var e,i,s,a,n,r,l,h,d,c,u;const{middleHandler:g={},startText:_={},endText:p={},backgroundChart:m={},selectedBackgroundChart:b={}}=this._spec;return{backgroundStyle:z((e=this._spec.background)===null||e===void 0?void 0:e.style),startHandlerStyle:z((i=this._spec.startHandler)===null||i===void 0?void 0:i.style),middleHandlerStyle:g.visible?{visible:!0,icon:z((s=g.icon)===null||s===void 0?void 0:s.style),background:{size:(a=g.background)===null||a===void 0?void 0:a.size,style:z((n=g.background)===null||n===void 0?void 0:n.style)}}:{visible:!1},endHandlerStyle:z((r=this._spec.endHandler)===null||r===void 0?void 0:r.style),startTextStyle:{padding:_.padding,formatMethod:this._getHandlerTextFormatMethod(_),textStyle:z(_.style)},endTextStyle:{padding:p.padding,formatMethod:this._getHandlerTextFormatMethod(p),textStyle:z(p.style)},selectedBackgroundStyle:z(this._spec.selectedBackground.style),dragMaskStyle:z((l=this._spec.dragMask)===null||l===void 0?void 0:l.style),backgroundChartStyle:t?{line:J(z((h=m.line)===null||h===void 0?void 0:h.style),{fill:!1}),area:Object.assign({curveType:"basis",visible:!0},z((d=m.area)===null||d===void 0?void 0:d.style))}:{line:{visible:!1},area:{visible:!1}},selectedBackgroundChartStyle:t?{line:J(z((c=b.line)===null||c===void 0?void 0:c.style),{fill:!1}),area:Object.assign({curveType:"basis",visible:!0},z((u=b.area)===null||u===void 0?void 0:u.style))}:{line:{visible:!1},area:{visible:!1}},disableTriggerEvent:this._option.disableTriggerEvent}}_getHandlerTextFormatMethod(t){const{formatMethod:e,formatter:i}=t,{formatFunc:s}=pn(e,i);return s?a=>s(a,{label:a},i):void 0}_getNeedClearVRenderComponents(){return[this._component]}clear(){if(this._component){const t=this.getContainer();this._component.removeAllChild(),t&&t.removeChild(this._component),this._component=null}super.clear()}}Ze.type=F.dataZoom,Ze.transformerConstructor=Or,Ze.specKey="dataZoom";const _c=()=>{X.registerComponent(Ze.type,Ze)};class Ai extends Cs{constructor(t,e){var i;super(t,e),this.type=F.scrollBar,this.name=F.scrollBar,this.specKey="scrollBar",this.layoutZIndex=St.DataZoom,this.layoutLevel=_s.DataZoom,this.layoutType="region-relative",this._filterMode=(i=t.filterMode)!==null&&i!==void 0?i:"axis"}setAttrFromSpec(){super.setAttrFromSpec(),ms(this._spec.roam)&&(this._zoomAttr.enable=!1,this._dragAttr.enable=this._spec.roam,this._scrollAttr.enable=this._spec.roam),(this._zoomAttr.enable||this._dragAttr.enable||this._scrollAttr.enable)&&this.initZoomable(this.event,this._option.mode)}onLayoutEnd(t){var e,i;this._updateScaleRange(),(i=(e=this.effect).onZoomChange)===null||i===void 0||i.call(e),super.onLayoutEnd(t)}_updateScaleRange(){this._component&&this._component.setAttributes({x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y,width:this.getLayoutRect().width,height:this.getLayoutRect().height})}_computeWidth(){return yt(this._spec.width)?this._spec.width:this._isHorizontal?this.getLayoutRect().width:Za}_computeHeight(){return yt(this._spec.height)?this._spec.height:this._isHorizontal?Za:this.getLayoutRect().height}_getAttrs(){var t,e,i,s,a,n;return Object.assign({zIndex:this.layoutZIndex,x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y,width:this.getLayoutRect().width,height:this.getLayoutRect().height,range:[this._start,this._end],direction:this._isHorizontal?"horizontal":"vertical",delayType:(t=this._spec)===null||t===void 0?void 0:t.delayType,delayTime:S((e=this._spec)===null||e===void 0?void 0:e.delayType)?(s=(i=this._spec)===null||i===void 0?void 0:i.delayTime)!==null&&s!==void 0?s:30:0,realTime:(n=(a=this._spec)===null||a===void 0?void 0:a.realTime)===null||n===void 0||n},this._getComponentAttrs())}_createOrUpdateComponent(){const t=this._getAttrs();if(this._component)this._component.setAttributes(t);else{const e=this.getContainer();this._component=new nl(t),this._component.addEventListener("scrollDrag",i=>{const s=i.detail.value;this._handleChange(s[0],s[1])}),e.add(this._component)}}_handleChange(t,e,i){super._handleChange(t,e,i);const s=oa(this._start,t)&&oa(this._end,e);if(this._shouldChange&&!s){i&&this._component&&this._component.setAttribute("range",[t,e]),this._start=t,this._end=e;const a=this._statePointToData(t),n=this._statePointToData(e);(R(this._spec.updateDataAfterChange)?this._spec.updateDataAfterChange(t,e,a,n):this._handleStateChange(this._statePointToData(t),this._statePointToData(e)))&&this.event.emit(V.scrollBarChange,{model:this,value:{filterData:this._filterMode!=="axis",start:this._start,end:this._end,startValue:this._startValue,endValue:this._endValue,newDomain:this._newDomain}})}}_handleDataCollectionChange(){}_initCommonEvent(){super._initCommonEvent(),this._component&&this._component.on("scrollDrag",t=>{const e=t.detail.value;this._handleChange(e[0],e[1])})}_getComponentAttrs(){const{rail:t,slider:e,innerPadding:i}=this._spec,s={};return C(i)||(s.padding=i),N(t==null?void 0:t.style)||(s.railStyle=z(t.style)),N(e==null?void 0:e.style)||(s.sliderStyle=z(e.style)),s.disableTriggerEvent=this._option.disableTriggerEvent,s}_getNeedClearVRenderComponents(){return[this._component]}}Ai.type=F.scrollBar,Ai.specKey="scrollBar";const pc=()=>{X.registerComponent(Ai.type,Ai)},mc=["sum","average","min","max","variance","standardDeviation","median"];var vc=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};function ki(o,t,e){if(!e)return!1;const i=o.map(n=>1*n),s=It(i),a=Bt(i);return t<s||t>a}function $a(o,t,e,i,s,a){var n,r;const{relativeSeries:l}=i;let h;return yt(o.x)&&ki(t,o.x,e)&&((r=l==null?void 0:(n=l.getXAxisHelper()).setExtendDomain)===null||r===void 0||r.call(n,"marker_xAxis_extend",o.x)),h=qt(o.x)?Mi(o.x,s)+a.x:l.getXAxisHelper().dataToPosition([o.x])+a.x,h}function Ka(o,t,e,i,s,a){var n,r;const{relativeSeries:l}=i;let h;return yt(o.y)&&ki(t,o.y,e)&&((r=(n=l.getYAxisHelper())===null||n===void 0?void 0:n.setExtendDomain)===null||r===void 0||r.call(n,"marker_yAxis_extend",o.y)),h=qt(o.y)?Mi(o.y,s)+a.y:l.getYAxisHelper().dataToPosition([o.y])+a.y,h}function Mi(o,t){return Number(o.substring(0,o.length-1))*t/100}function Ve(o){return mc.includes(o)}function Ti(o,t,e,i,s){const a=t.getRegion(),n=a.getLayoutStartPoint(),r=e.getRegion(),l=r.getLayoutStartPoint(),h=Math.abs(Math.min(n.x,l.x)-Math.max(n.x+a.getLayoutRect().width,l.x+r.getLayoutRect().width)),d=Math.abs(Math.min(n.y,l.y)-Math.max(n.y+a.getLayoutRect().height,l.y+r.getLayoutRect().height)),c={relativeSeries:i,startRelativeSeries:t,endRelativeSeries:e},u=[],g=o.latestData[0]&&o.latestData[0].latestData?o.latestData[0].latestData:o.latestData,_=i.getXAxisHelper().getScale(0).domain(),p=i.getYAxisHelper().getScale(0).domain();return g.forEach(m=>{const b=S(m.x),x=S(m.y);if(b&&x){const v=$a(m,_,s,c,h,n),y=Ka(m,p,s,c,d,n);u.push([{x:v,y}])}else if(b){const v=$a(m,_,s,c,h,n),y=Math.max(n.y+a.getLayoutRect().height,l.y+r.getLayoutRect().height),f=Math.min(n.y,l.y);u.push([{x:v,y},{x:v,y:f}])}else if(x){const v=Math.min(n.x,l.x),y=Ka(m,p,s,c,d,n),f=Math.max(n.x+a.getLayoutRect().width,l.x+r.getLayoutRect().width);u.push([{x:v,y},{x:f,y}])}}),u}function Bs(o,t,e,i){const s=[],a=o.latestData[0]&&o.latestData[0].latestData?o.latestData[0].latestData:o.latestData,n=$(i);return a.forEach((r,l)=>{var h,d,c,u;const g=r!=null&&r.getRefRelativeSeries?r.getRefRelativeSeries():t,_=g.getRegion(),p=_.getLayoutStartPoint(),{width:m,height:b}=_.getLayoutRect();let x=0,v=0;if(i){const T=n?i[l]:i,P=T.x,D=T.y;P&&(x=qt(P)?Number(P.substring(0,P.length-1))*m/100:P),D&&(v=qt(D)?Number(D.substring(0,D.length-1))*b/100:D)}const y=g.getXAxisHelper().getScale(0).domain(),f=g.getYAxisHelper().getScale(0).domain(),A=L(r.x),k=L(r.y);A.length===1&&yt(A[0])&&ki(y,A[0],e)&&((d=(h=g.getXAxisHelper())===null||h===void 0?void 0:h.setExtendDomain)===null||d===void 0||d.call(h,"marker_xAxis_extend",A[0])),k.length===1&&yt(k[0])&&ki(f,k[0],e)&&((u=(c=g.getYAxisHelper())===null||c===void 0?void 0:c.setExtendDomain)===null||u===void 0||u.call(c,"marker_yAxis_extend",k[0])),s.push({x:g.getXAxisHelper().dataToPosition(A)+p.x+x,y:g.getYAxisHelper().dataToPosition(k)+p.y+v})}),s}function qa(o,t,e){let{x:i,y:s}=o;return qt(i)&&(i=Mi(i,t)),qt(s)&&(s=Mi(s,e)),{x:i,y:s}}function Ps(o,t,e){let i;if(i=R(o)?L(o(t.getData().getLatestData(),t)):L(o),e){const n=t.getRegion(),{x:r,y:l}=n.getLayoutStartPoint(),{width:h,height:d}=n.getLayoutRect();return i.map(c=>{let{x:u,y:g}=qa(c,h,d);return u+=r,g+=l,{x:u,y:g}})}const{width:s,height:a}=t.getOption().getChart().getViewRect();return i.map(n=>qa(n,s,a))}function Ls(o){let t=1/0,e=-1/0,i=1/0,s=-1/0;return o.forEach(a=>{const n=a.getLayoutStartPoint(),r=a.getLayoutRect();n.x<t&&(t=n.x),n.x+r.width>e&&(e=n.x+r.width),n.y<i&&(i=n.y),n.y+r.height>s&&(s=n.y+r.height)}),{minX:t,maxX:e,minY:i,maxY:s}}function Ds(o,t){const{labelBackground:e={},style:i,shape:s}=o,a=vc(o,["labelBackground","style","shape"]);if(o.visible!==!1){const n=a;return s!=null&&s.visible?n.shape=Object.assign({visible:!0},z(s.style)):n.shape={visible:!1},e.visible!==!1?(n.panel=Object.assign({visible:!0,customShape:e.customShape},Ut(z(e.style),t)),S(e.padding)&&(n.padding=hn(e.padding))):(n.panel={visible:!1},n.padding=0),i&&(n.textStyle=Ut(z(i),t)),n}return{visible:!1}}function ot(o,t){for(const e in o)R(o[e])&&(o[e]=o[e](t));return o}function Ut(o,t){return R(o)?o(t):o}function Qa(o,t){return R(o)?o(t):o}function Ja(o,t,e){return S(o)?t==="regionLeft"?e.getLayoutStartPoint().x-o.x:t==="regionRight"?e.getLayoutStartPoint().x+e.getLayoutRect().width-o.x:t==="regionTop"?e.getLayoutStartPoint().y-o.y:t==="regionBottom"?e.getLayoutStartPoint().y+e.getLayoutRect().height-o.y:t:t}function Ci(o){const t="x"in o,e="y"in o,i="x1"in o,s="y1"in o,a="angle"in o,n="radius"in o,r="angle1"in o,l="radius1"in o;return{doXProcess:t&&!e&&!s,doXYY1Process:t&&e&&s,doYProcess:e&&!t&&!i,doYXX1Process:e&&t&&i,doXYProcess:t&&e&&i&&s,doAngleProcess:a&&!r&&!n&&!l,doRadiusProcess:n&&!l&&!a&&!r,doAngRadRad1Process:a&&!r&&n&&l,doRadAngAng1Process:n&&a&&r&&!l,doRadAngProcess:a&&n&&r&&l,doCoordinatesProcess:"coordinates"in o&&(!("process"in o)||"process"in o&&"xy"in o.process)}}function Bi(o){const t="x"in o,e="x1"in o,i="y"in o,s="y1"in o,a="angle"in o,n="radius"in o,r="angle1"in o,l="radius1"in o;return{doXProcess:t&&e&&!i&&!s,doYProcess:i&&s&&!t&&!e,doXYProcess:t&&e&&i&&s,doAngleProcess:a&&r&&!n&&!l,doRadiusProcess:n&&l&&!a&&!r,doRadAngProcess:a&&n&&r&&l,doCoordinatesProcess:"coordinates"in o}}function ls(o){return{doXYProcess:S(o.x)&&S(o.y),doPolarProcess:S(o.angle)&&S(o.radius),doGeoProcess:S(o.areaName)}}function yc(o,t,e,i=0){const s=[],a=o.y-t.y,n=o.x-t.x;switch(e){case"top":s.push(o),s.push({x:o.x,y:a>0?o.y-i-Math.abs(a):o.y-i}),s.push({x:t.x,y:a>0?t.y-i:t.y-i-Math.abs(a)}),s.push(t);break;case"bottom":s.push(o),s.push({x:o.x,y:a<0?o.y+i+Math.abs(a):o.y+i}),s.push({x:t.x,y:a<0?t.y+i:t.y+i+Math.abs(a)}),s.push(t);break;case"left":s.push(o),s.push({x:n>0?o.x-i-Math.abs(n):o.x-i,y:o.y}),s.push({x:n>0?t.x-i:t.x-i-Math.abs(n),y:t.y}),s.push(t);break;case"right":s.push(o),s.push({x:n>0?o.x+i:o.x+i+Math.abs(n),y:o.y}),s.push({x:n>0?t.x+i+Math.abs(n):t.x+i,y:t.y}),s.push(t)}return s}function bc(o,t,e,i=0){const s=o.y-t.y,a=o.x-t.x;return e==="bottom"?{dx:a>0?-a/2:Math.abs(a/2),dy:s>0?i:Math.abs(s)+i}:e==="top"?{dx:a>0?-Math.abs(a/2):+Math.abs(a/2),dy:s>0?-(Math.abs(s)+i):-i}:e==="left"?{dx:a>0?-a-i:-i,dy:s>0?-s/2:Math.abs(s/2)}:e==="right"?{dx:a>0?i:Math.abs(a)+i,dy:s>0?-s/2:Math.abs(s/2)}:{}}var xc=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};const fc=(o,t)=>{const e=o[0].latestData;return ol(e,t.field)},Sc=(o,t)=>{const e=o[0].latestData;return ll(e,t.field)};function Ac(o,t){const e=o[0].latestData;return hl(e,t.field)}function kc(o,t){const e=o[0].latestData;return dl(e,t.field)}function Mc(o,t){const e=o[0].latestData;return cl(e,t.field)}function Tc(o,t){const e=o[0].latestData;return ul(e,t.field)}function Cc(o,t){const e=o[0].latestData;return gl(e,t.field)}function Os(o,t){let e;if(t.coordinates){const s=t,{coordinates:a,coordinateType:n,getSeriesByIdOrIndex:r}=s,l=xc(s,["coordinates","coordinateType","getSeriesByIdOrIndex"]);let h,d;if(R(a)){const c=t.getRelativeSeries();h=a(c.getData().getLatestData(),c)}else h=a;h=L(h),e=h.map(c=>{const u=r(c.refRelativeSeriesId,c.refRelativeSeriesIndex);if(n==="cartesian"){const{xField:g,yField:_}=u.getSpec(),{xFieldDim:p,xFieldIndex:m,yFieldDim:b,yFieldIndex:x}=c;let v=g;S(m)&&(v=L(g)[m]),p&&L(g).includes(p)&&(v=p);let y=_;S(x)&&(y=L(_)[x]),b&&L(_).includes(b)&&(y=b),d=Object.assign({x:void 0,y:void 0},l),q(c[v])&&Ve(c[v])?d.x={field:v,aggrType:c[v]}:d.x=L(v).map(f=>c[f]),q(c[y])&&Ve(c[y])?d.y={field:y,aggrType:c[y]}:d.y=L(y).map(f=>c[f])}else if(n==="polar"){const{valueField:g,categoryField:_}=u.getSpec(),{angleFieldDim:p,angleFieldIndex:m}=c;let b=_;S(m)&&(b=L(_)[m]),p&&L(_).includes(p)&&(b=p);const x=g;d=Object.assign({angle:void 0,radius:void 0},l),q(c[b])&&Ve(c[b])?d.angle={field:b,aggrType:c[b]}:d.angle=L(b).map(v=>c[v]),q(c[x])&&Ve(c[x])?d.radius={field:x,aggrType:c[x]}:d.radius=L(x).map(v=>c[v])}return d.getRefRelativeSeries=()=>u,d})}else e=t;const i=[];return e.forEach(s=>{const a={x:null,y:null,angle:null,radius:null,areaName:null};if(S(s.x)){const n=s.x;$(n)?a.x=n.map(r=>Lt(r,o,s)):a.x=Lt(n,o,s)}if(S(s.y)){const n=s.y;$(n)?a.y=n.map(r=>Lt(r,o,s)):a.y=Lt(n,o,s)}if(S(s.angle)){const n=s.angle;$(n)?a.angle=n.map(r=>Lt(r,o,s)):a.angle=Lt(n,o,s)}if(S(s.radius)){const n=s.radius;$(n)?a.radius=n.map(r=>Lt(r,o,s)):a.radius=Lt(n,o,s)}if(S(s.areaName)){const n=s.areaName;a.areaName=Lt(n,o,s)}s.getRefRelativeSeries&&(a.getRefRelativeSeries=s.getRefRelativeSeries),i.push(a)}),i}const Bc={min:fc,max:Sc,sum:Ac,average:kc,variance:Mc,standardDeviation:Tc,median:Cc};function Lt(o,t,e){const i=e.getRelativeSeries(),s=e.getStartRelativeSeries(),a=e.getEndRelativeSeries(),n=i.getData().getLatestData(),r=s.getData().getLatestData(),l=a.getData().getLatestData();if(R(o))return o(n,r,l,i,s,a);if(rl(o)){const{aggrType:h,field:d}=o;return Bc[h](t,{field:d})}return o}class Es extends ii{constructor(){super(...arguments),this.layoutType="none",this._layoutOffsetX=0,this._layoutOffsetY=0}getRelativeSeries(){return this._relativeSeries}getMarkerData(){return this._markerData}static _getMarkerCoordinateType(t){return"cartesian"}static getSpecInfo(t){return vs(t,this.specKey,this.type,e=>e.visible!==!1&&this._getMarkerCoordinateType(e)===this.coordinateType)}created(){super.created(),this._bindSeries(),this._initDataView(),this.initEvent()}_getAllRelativeSeries(){return{getRelativeSeries:()=>this._relativeSeries,getStartRelativeSeries:()=>this._startRelativeSeries,getEndRelativeSeries:()=>this._endRelativeSeries}}_getFieldInfoFromSpec(t,e,i){const s={x:"xField",y:"yField",radius:"valueField",angle:"categoryField",areaName:"nameField"};return q(e)&&Ve(e)?{field:i.getSpec()[s[t]],aggrType:e}:e}_processSpecByDims(t){const e=this._relativeSeries,i={};return t.forEach(s=>i[s.dim]=this._getFieldInfoFromSpec(s.dim,s.specValue,e)),Object.assign(Object.assign({},i),this._getAllRelativeSeries())}_processSpecCoo(t){return Object.assign(Object.assign({coordinates:t.coordinates||t.coordinate},this._getAllRelativeSeries()),{getSeriesByIdOrIndex:(e,i)=>this._getSeriesByIdOrIndex(e,i),coordinateType:this.coordinateType})}_getRelativeDataView(){if(this._specifiedDataSeries){let t=[];L(this._specifiedDataSeries).forEach(i=>{t=t.concat(i.getViewData().latestData)});const e=new _l;return e.registerParser("array",pl),new bt(e).parse(t,{type:"array"})}return this._relativeSeries.getViewData()}updateLayoutAttribute(){var t,e,i;if((t=this._spec.visible)===null||t===void 0||t){if(!this._markerComponent){const s=this._createMarkerComponent();s.name=(e=this._spec.name)!==null&&e!==void 0?e:this.type,s.id=(i=this._spec.id)!==null&&i!==void 0?i:`${this.type}-${this.id}`,this._markerComponent=s,this.getContainer().add(this._markerComponent),this._markerComponent.on("*",(a,n)=>{this._delegateEvent(this._markerComponent,a,n,null,this.getMarkerData.bind(this))})}this._markerLayout()}super.updateLayoutAttribute()}_getSeriesByIdOrIndex(t,e){var i,s;let a;return a=(i=this._option.getSeriesInUserIdOrIndex(S(t)?[t]:[],[e]))===null||i===void 0?void 0:i[0],a||(a=(s=this._relativeSeries)!==null&&s!==void 0?s:this._getFirstSeries()),a}_bindSeries(){const t=this._spec;this._relativeSeries=this._getSeriesByIdOrIndex(t.relativeSeriesId,t.relativeSeriesIndex),this._startRelativeSeries=this._getSeriesByIdOrIndex(t.startRelativeSeriesId,t.startRelativeSeriesIndex),this._endRelativeSeries=this._getSeriesByIdOrIndex(t.endRelativeSeriesId,t.endRelativeSeriesIndex),t.specifiedDataSeriesIndex&&t.specifiedDataSeriesIndex==="all"||t.specifiedDataSeriesId&&t.specifiedDataSeriesId==="all"?this._specifiedDataSeries=this._option.getAllSeries():(t.specifiedDataSeriesIndex||t.specifiedDataSeriesId)&&(this._specifiedDataSeries=this._getSeriesByIdOrIndex(t.specifiedDataSeriesId,t.specifiedDataSeriesIndex))}initEvent(){this._relativeSeries.coordinate!=="cartesian"&&(this._relativeSeries.event.on("zoom",this._markerLayout.bind(this)),this._relativeSeries.event.on("panmove",this._markerLayout.bind(this)),this._relativeSeries.event.on("scroll",this._markerLayout.bind(this)))}onRender(t){}changeRegions(t){}clear(){super.clear(),this._firstSeries=null}_getFirstSeries(){var t;if(this._firstSeries)return this._firstSeries;const e=Dn(this._regions);return e?(this._firstSeries=e,e):((t=this._option)===null||t===void 0||t.onError("need at least one series"),null)}_getNeedClearVRenderComponents(){return[this._markerComponent]}onLayoutStart(t,e,i){C(this._spec.offsetX)||(this._layoutOffsetX=De(this._spec.offsetX,e.width,e)),C(this._spec.offsetY)||(this._layoutOffsetY=De(this._spec.offsetY,e.height,e)),super.onLayoutStart(t,e,i)}_compareSpec(t,e){const i=super._compareSpec(t,e);return Ie(e,t)||(i.reRender=!0,i.reMake=!0,i.change=!0),i}}function Pc(o,t){const e=o[0].latestData;return ml(e,t.fieldX,t.fieldY)}function Rs(o,t){if(t&&t.getRelativeSeries){const e=t.getRelativeSeries();if(e){const i=e.getViewData();return i&&i.latestData&&i.latestData.length?o:[]}}return o}class Er extends Es{constructor(){super(...arguments),this.specKey="markLine",this.layoutZIndex=St.MarkLine}static _getMarkerCoordinateType(t){const{doAngleProcess:e,doRadiusProcess:i,doAngRadRad1Process:s,doRadAngAng1Process:a,doRadAngProcess:n}=Ci(t);return t.coordinateType==="polar"||e||i||s||a||n?"polar":"cartesian"}_createMarkerComponent(){var t,e,i,s,a,n,r,l,h,d,c,u,g,_,p,m,b,x,v;const{label:y={},startSymbol:f={},endSymbol:A={}}=this._spec,k={zIndex:this.layoutZIndex,interactive:(t=this._spec.interactive)===null||t===void 0||t,hover:(e=this._spec.interactive)===null||e===void 0||e,select:(i=this._spec.interactive)===null||i===void 0||i,points:[{x:0,y:0},{x:0,y:0}],center:{x:0,y:0},radius:0,startAngle:0,endAngle:0,lineStyle:Ut(z((s=this._spec.line)===null||s===void 0?void 0:s.style),this._markerData),clipInRange:(a=this._spec.clip)!==null&&a!==void 0&&a,label:Ds(y,this._markerData),state:{line:ot((r=(n=this._spec.line)===null||n===void 0?void 0:n.state)!==null&&r!==void 0?r:{},this._markerData),lineStartSymbol:ot((h=(l=this._spec.startSymbol)===null||l===void 0?void 0:l.state)!==null&&h!==void 0?h:{},this._markerData),lineEndSymbol:ot((c=(d=this._spec.endSymbol)===null||d===void 0?void 0:d.state)!==null&&c!==void 0?c:{},this._markerData),label:ot((_=(g=(u=this._spec)===null||u===void 0?void 0:u.label)===null||g===void 0?void 0:g.state)!==null&&_!==void 0?_:{},this._markerData),labelBackground:ot((x=(b=(m=(p=this._spec)===null||p===void 0?void 0:p.label)===null||m===void 0?void 0:m.labelBackground)===null||b===void 0?void 0:b.state)!==null&&x!==void 0?x:{},this._markerData)},animation:(v=this._spec.animation)!==null&&v!==void 0&&v,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};return f.visible?k.startSymbol=Object.assign(Object.assign({},f),{visible:!0,style:z(f.style)}):k.startSymbol={visible:!1},A.visible?k.endSymbol=Object.assign(Object.assign({},A),{visible:!0,style:z(A.style)}):k.endSymbol={visible:!1},this._newMarkLineComponent(k)}_getUpdateMarkerAttrs(){var t,e,i,s;const a=this._spec,n=this._markerData,r=this._startRelativeSeries,l=this._endRelativeSeries,h=this._relativeSeries,d=this._computePointsAttr(),c=h.getViewData().latestData,u=n.latestData[0]&&n.latestData[0].latestData?n.latestData[0].latestData:n.latestData;let g;if(a.clip||!((t=a.label)===null||t===void 0)&&t.confine){const{minX:m,maxX:b,minY:x,maxY:v}=Ls([r.getRegion(),l.getRegion(),h.getRegion()]);g={x:m,y:x,width:b-m,height:v-x}}const _=(i=(e=this._markerComponent)===null||e===void 0?void 0:e.attribute)!==null&&i!==void 0?i:{},p=Object.assign(Object.assign({},_.label),{text:this._spec.label.formatMethod?this._spec.label.formatMethod(u,c):(s=_.label)===null||s===void 0?void 0:s.text});return Object.assign(Object.assign({},d),{label:p,limitRect:g,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}_markerLayout(){var t;const e=this._getUpdateMarkerAttrs();(t=this._markerComponent)===null||t===void 0||t.setAttributes(e)}_initDataView(){const t=this._spec,e="coordinates"in t,{doXProcess:i,doYProcess:s,doXYY1Process:a,doYXX1Process:n,doXYProcess:r,doAngleProcess:l,doRadiusProcess:h,doAngRadRad1Process:d,doRadAngAng1Process:c,doRadAngProcess:u}=Ci(t);if(this._markerData=this._getRelativeDataView(),!(i||s||a||n||r||l||h||d||c||u||e))return;at(this._option.dataSet,"markerAggregation",Os),at(this._option.dataSet,"markerRegression",Pc),at(this._option.dataSet,"markerFilter",Rs);const{options:g,needAggr:_,needRegr:p,processData:m}=this._computeOptions(),b=new bt(this._option.dataSet);b.parse([m],{type:"dataview"}),_&&b.transform({type:"markerAggregation",options:g}),p&&b.transform({type:"markerRegression",options:g}),b.transform({type:"markerFilter",options:this._getAllRelativeSeries()}),b.target.on("change",()=>{this._markerLayout()}),this._markerData=b}}Er.specKey="markLine";class Pi extends Er{constructor(){super(...arguments),this.type=F.markLine,this.name=F.markLine,this.coordinateType="cartesian"}_newMarkLineComponent(t){return new he(t)}_computePointsAttr(){var t;const e=this._spec,i=this._markerData,s=this._startRelativeSeries,a=this._endRelativeSeries,n=this._relativeSeries,r=S(e.coordinates),l=S(e.process),h=l&&S(e.process.x),d=l&&S(e.process.y),c=S(e.positions),u=(t=e.autoRange)!==null&&t!==void 0&&t,{doXProcess:g,doYProcess:_,doXYY1Process:p,doYXX1Process:m,doXYProcess:b,doCoordinatesProcess:x}=Ci(e);let v=[];if(g||p||_||m||b||r&&h||r&&d){const y=Ti(i,s,a,n,u);v=y.length===1?y[0]:y.map(f=>f[0])}else x?v=Bs(i,n,u,e.coordinatesOffset):c&&(v=Ps(e.positions,n,e.regionRelative));return{points:v}}_markerLayout(){var t,e,i,s,a,n,r,l;const h=this._getUpdateMarkerAttrs();if(this._spec.type==="type-step"){const d=this._startRelativeSeries,c=this._endRelativeSeries,{multiSegment:u,mainSegmentIndex:g}=this._spec.line||{},{connectDirection:_,expandDistance:p=0}=this._spec;let m;if(qt(p)){const k=d.getRegion(),T=k.getLayoutStartPoint(),P=c.getRegion(),D=P.getLayoutStartPoint();if(_==="bottom"||_==="top"){const B=Math.abs(Math.min(T.y,D.y)-Math.max(T.y+k.getLayoutRect().height,D.y+P.getLayoutRect().height));m=Number(p.substring(0,p.length-1))*B/100}else{const B=Math.abs(Math.min(T.x,D.x)-Math.max(T.x+k.getLayoutRect().width,D.x+P.getLayoutRect().width));m=Number(p.substring(0,p.length-1))*B/100}}else m=p;const{points:b,label:x,limitRect:v}=h,y=yc(b[0],b[1],_,m);let f;f=u&&S(g)?{position:"middle",autoRotate:!1,refX:0,refY:0}:Object.assign(Object.assign({position:"start",autoRotate:!1},bc(b[0],b[1],_,m)),{refX:0,refY:0}),O((t=this._spec.label)===null||t===void 0?void 0:t.refX)&&(f.refX+=this._spec.label.refX),O((e=this._spec.label)===null||e===void 0?void 0:e.refY)&&(f.refY+=this._spec.label.refY),O((i=this._spec.label)===null||i===void 0?void 0:i.dx)&&(f.dx=(f.dx||0)+this._spec.label.dx),O((s=this._spec.label)===null||s===void 0?void 0:s.dy)&&(f.dy=(f.dy||0)+this._spec.label.dy);const A=(n=(a=this._markerComponent)===null||a===void 0?void 0:a.attribute)!==null&&n!==void 0?n:{};(r=this._markerComponent)===null||r===void 0||r.setAttributes({points:u?[[y[0],y[1]],[y[1],y[2]],[y[2],y[3]]]:y,label:Object.assign(Object.assign(Object.assign({},x),f),{textStyle:Object.assign(Object.assign({},A.label.textStyle),{textAlign:"center",textBaseline:"middle"})}),limitRect:v,multiSegment:u,mainSegmentIndex:g,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}else(l=this._markerComponent)===null||l===void 0||l.setAttributes(h)}_computeOptions(){let t,e=this._getRelativeDataView(),i=!0,s=!1;const a=this._spec,n=this._relativeSeries,{doXProcess:r,doYProcess:l,doXYY1Process:h,doYXX1Process:d,doXYProcess:c,doCoordinatesProcess:u}=Ci(a);if(c)t=[this._processSpecByDims([{dim:"x",specValue:a.x},{dim:"y",specValue:a.y}]),this._processSpecByDims([{dim:"x",specValue:a.x1},{dim:"y",specValue:a.y1}])];else if(r)t=[this._processSpecByDims([{dim:"x",specValue:a.x}])];else if(l)t=[this._processSpecByDims([{dim:"y",specValue:a.y}])];else if(h)t=[this._processSpecByDims([{dim:"x",specValue:a.x},{dim:"y",specValue:a.y}]),this._processSpecByDims([{dim:"x",specValue:a.x},{dim:"y",specValue:a.y1}])];else if(d)t=[this._processSpecByDims([{dim:"x",specValue:a.x},{dim:"y",specValue:a.y}]),this._processSpecByDims([{dim:"x",specValue:a.x1},{dim:"y",specValue:a.y}])];else if(u){if(t=this._processSpecCoo(a),i=!1,e=new bt(this._option.dataSet,{name:`${this.type}_${this.id}_data`}).parse([n.getViewData()],{type:"dataview"}).transform({type:"markerAggregation",options:t}),a.process&&"x"in a.process&&(t=[this._processSpecByDims([{dim:"x",specValue:a.process.x}])],i=!0),a.process&&"y"in a.process&&(t=t=[this._processSpecByDims([{dim:"y",specValue:a.process.y}])],i=!0),a.process&&"xy"in a.process){const{xField:g,yField:_}=n.getSpec();t={fieldX:g,fieldY:_},s=!0}}else i=!1;return{options:t,needAggr:i,needRegr:s,processData:e}}}Pi.type=F.markLine,Pi.coordinateType="cartesian";const Lc=()=>{X.registerComponent(Pi.type,Pi),jh()};class Rr extends Es{constructor(){super(...arguments),this.specKey="markArea",this.layoutZIndex=St.MarkArea}static _getMarkerCoordinateType(t){const{doAngleProcess:e,doRadiusProcess:i,doRadAngProcess:s}=Bi(t);return t.coordinateType==="polar"||e||i||s?"polar":"cartesian"}_createMarkerComponent(){var t,e,i,s,a,n,r,l,h,d,c,u;const g=(t=this._spec.label)!==null&&t!==void 0?t:{},_={zIndex:this.layoutZIndex,interactive:(e=this._spec.interactive)===null||e===void 0||e,hover:(i=this._spec.interactive)===null||i===void 0||i,select:(s=this._spec.interactive)===null||s===void 0||s,points:[{x:0,y:0}],center:{x:0,y:0},innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,areaStyle:Ut(z((a=this._spec.area)===null||a===void 0?void 0:a.style),this._markerData),clipInRange:(n=this._spec.clip)!==null&&n!==void 0&&n,label:Ds(g,this._markerData),state:{area:ot((r=this._spec.area)===null||r===void 0?void 0:r.state,this._markerData),label:ot((l=this._spec.label)===null||l===void 0?void 0:l.state,this._markerData),labelBackground:ot((c=(d=(h=this._spec)===null||h===void 0?void 0:h.label)===null||d===void 0?void 0:d.labelBackground)===null||c===void 0?void 0:c.state,this._markerData)},animation:(u=this._spec.animation)!==null&&u!==void 0&&u,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};return this._newMarkAreaComponent(_)}_markerLayout(){var t,e,i,s;const a=this._spec,n=this._markerData,r=this._startRelativeSeries,l=this._endRelativeSeries,h=this._relativeSeries,d=this._computePointsAttr(),c=this._getRelativeDataView().latestData,u=n?n.latestData[0]&&n.latestData[0].latestData?n.latestData[0].latestData:n.latestData:c;let g;if(a.clip||!((t=a.label)===null||t===void 0)&&t.confine){const{minX:_,maxX:p,minY:m,maxY:b}=Ls([r.getRegion(),l.getRegion(),h.getRegion()]);g={x:_,y:m,width:p-_,height:b-m}}this._markerComponent&&this._markerComponent.setAttributes(Object.assign(Object.assign({},d),{label:Object.assign(Object.assign({},(e=this._markerComponent.attribute)===null||e===void 0?void 0:e.label),{text:this._spec.label.formatMethod?this._spec.label.formatMethod(u,c):(s=(i=this._markerComponent.attribute)===null||i===void 0?void 0:i.label)===null||s===void 0?void 0:s.text}),limitRect:g,dx:this._layoutOffsetX,dy:this._layoutOffsetY}))}_initDataView(){const t=this._spec,{doXProcess:e,doYProcess:i,doXYProcess:s,doAngleProcess:a,doRadiusProcess:n,doRadAngProcess:r,doCoordinatesProcess:l}=Bi(t);if(!(e||i||s||a||n||r||l))return null;const{options:h}=this._computeOptions(),d=this._getRelativeDataView();at(this._option.dataSet,"markerAggregation",Os),at(this._option.dataSet,"markerFilter",Rs);const c=new bt(this._option.dataSet,{name:`${this.type}_${this.id}_data`});c.parse([d],{type:"dataview"}),c.transform({type:"markerAggregation",options:h}),c.transform({type:"markerFilter",options:this._getAllRelativeSeries()}),c.target.on("change",()=>{this._markerLayout()}),this._markerData=c}}Rr.specKey="markArea";class Li extends Rr{constructor(){super(...arguments),this.type=F.markArea,this.name=F.markArea,this.coordinateType="cartesian"}_newMarkAreaComponent(t){return new de(t)}_computePointsAttr(){var t;const e=this._spec,i=this._markerData,s=this._startRelativeSeries,a=this._endRelativeSeries,n=this._relativeSeries,{doXProcess:r,doYProcess:l,doXYProcess:h,doCoordinatesProcess:d}=Bi(e),c=S(e.positions),u=(t=e.autoRange)!==null&&t!==void 0&&t;let g=[],_=[];if(h){_=Ti(i,s,a,n,u);const[p,m]=_;p&&p.length&&m&&m.length&&(g=[{x:p[0].x,y:m[0].y},p[0],{x:m[0].x,y:p[0].y},m[0]])}else if(r||l){_=Ti(i,s,a,n,u);const[p,m]=_;p&&p.length&&m&&m.length&&(g=[...p,m[1],m[0]])}else d?g=Bs(i,n,u,e.coordinatesOffset):c&&(g=Ps(e.positions,n,e.regionRelative));return{points:g}}_computeOptions(){const t=this._spec,{doXProcess:e,doYProcess:i,doXYProcess:s,doCoordinatesProcess:a}=Bi(t);let n;return s?n=[this._processSpecByDims([{dim:"x",specValue:t.x},{dim:"y",specValue:t.y}]),this._processSpecByDims([{dim:"x",specValue:t.x1},{dim:"y",specValue:t.y1}])]:e?n=[this._processSpecByDims([{dim:"x",specValue:t.x}]),this._processSpecByDims([{dim:"x",specValue:t.x1}])]:i?n=[this._processSpecByDims([{dim:"y",specValue:t.y}]),this._processSpecByDims([{dim:"y",specValue:t.y1}])]:a&&(n=this._processSpecCoo(t)),{options:n}}}Li.type=F.markArea,Li.coordinateType="cartesian";const Dc=()=>{X.registerComponent(Li.type,Li),Xh()};class Di extends bl{constructor(){super(...arguments),this.type=F.totalLabel,this.name=F.totalLabel,this.specKey="totalLabel",this.layoutZIndex=St.Label}static getSpecInfo(t,e){var i;const s=[];return(i=e==null?void 0:e.region)===null||i===void 0||i.forEach((a,n)=>{var r;(r=a.seriesIndexes)===null||r===void 0||r.forEach(l=>{const{spec:h}=e.series[l],d=h[this.specKey];d!=null&&d.visible&&s.push({spec:d,type:F.totalLabel,specPath:["series",l,this.specKey],specInfoPath:["component",this.specKey,l],regionIndexes:[n],seriesIndexes:[l]})})}),s}init(t){super.init(t),this._initTextMark(),this._initLabelComponent()}reInit(t){super.reInit(t),this._initTextMark()}_initTextMark(){var t;const e=this._getSeries();if(!((t=e.getSpec().totalLabel)===null||t===void 0)&&t.visible){const i=e.getSeriesMark();if(i){const s=this._createMark({type:"label",name:`${i.name}-total-label`});this._baseMark=i,this._textMark=s,this._initTextMarkStyle()}}}_initTextMarkStyle(){var t;super.initMarkStyleWithSpec(this._textMark,this._spec),this.setMarkStyle(this._textMark,{text:i=>i[xl]},"normal",I.Default);const e=this._getSeries();(t=e.initTotalLabelMarkStyle)===null||t===void 0||t.call(e,this._textMark)}_initLabelComponent(){const t=this._getSeries(),e=this._createMark({type:"component",name:`${t.name}-total-label-component`},{componentType:"label",noSeparateStyle:!0},{support3d:this._spec.support3d});e&&this._marks.addMark(e)}updateLayoutAttribute(){super.updateLayoutAttribute();const t=this._getSeries();this._marks.forEach((e,i)=>{e.getProduct().target(this._baseMark.getProduct()).configure({interactive:!1}).labelStyle(()=>{var s,a;if(this._baseMark){const{offset:n,animation:r,overlap:l}=this._spec,h=this._interactiveConfig(this._spec);return J({textStyle:{pickable:this._spec.interactive===!0},position:Oc(t,this._baseMark.type),x:0,y:0},(a=(s=t.getTotalLabelComponentStyle)===null||s===void 0?void 0:s.call(t,{baseMark:this._baseMark,labelMark:this._textMark}))!==null&&a!==void 0?a:{},Object.assign({offset:n,animation:r,overlap:l,dataFilter:d=>d.filter(c=>c.data[fl])},h))}}).encode(s=>Sl({baseMark:this._baseMark,labelMark:this._textMark,series:t,labelSpec:t.getSpec().totalLabel},s,this._spec.formatMethod)).size(()=>this._regions[0].getLayoutRect())})}compileMarks(){this.getMarks().forEach(t=>{const e=this._regions[0].getGroupMark().getProduct();t.compile({group:e,context:{model:this}})})}getVRenderComponents(){const t=[];return this.getMarks().forEach(e=>{const i=e.getProduct().getGroupGraphicItem();i&&t.push(i)}),t}_getSeries(){return this._option.getSeriesInIndex([this.getSpecPath()[1]])[0]}}Di.type=F.totalLabel,Di.specKey="totalLabel";function Oc(o,t){var e,i;let s;const{direction:a}=o,n={vertical:["top","bottom"],horizontal:["right","left"]},r=(a==="horizontal"?!((e=o.getXAxisHelper())===null||e===void 0)&&e.isInverse():!((i=o.getYAxisHelper())===null||i===void 0)&&i.isInverse())?1:0;switch(t){case"rect":case"symbol":s=n[a][r];break;default:s="top"}return s}const Ec=()=>{vl(),yl(),_n(),X.registerComponent(Di.type,Di,!0)};var tn=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};class Ir extends Es{constructor(){super(...arguments),this.specKey="markPoint",this.layoutZIndex=St.MarkPoint}static _getMarkerCoordinateType(t){const{doPolarProcess:e,doGeoProcess:i}=ls(t);return t.coordinateType==="polar"||e?"polar":t.coordinateType==="geo"||i?"geo":"cartesian"}_createMarkerComponent(){var t,e,i,s,a,n,r,l,h,d,c,u,g,_,p,m,b,x,v,y,f,A,k,T,P,D,B,E;const{itemContent:H={},itemLine:nt={},targetSymbol:Y={}}=this._spec,{text:Z={},symbol:rt,image:Jt,richText:pe}=H,si=tn(H,["text","symbol","image","richText"]),Pt={zIndex:this.layoutZIndex,interactive:(t=this._spec.interactive)===null||t===void 0||t,hover:(e=this._spec.interactive)===null||e===void 0||e,select:(i=this._spec.interactive)===null||i===void 0||i,position:{x:0,y:0},clipInRange:(s=this._spec.clip)!==null&&s!==void 0&&s,itemContent:Object.assign({offsetX:Qa(H.offsetX,this._relativeSeries.getRegion()),offsetY:Qa(H.offsetX,this._relativeSeries.getRegion())},si),targetSymbol:{offset:(a=Y.offset)!==null&&a!==void 0?a:0,visible:(n=Y.visible)!==null&&n!==void 0&&n,size:(r=Y.size)!==null&&r!==void 0?r:20,style:Ut(Y.style,this._markerData)},state:{line:ot((h=(l=this._spec.itemLine.line)===null||l===void 0?void 0:l.state)!==null&&h!==void 0?h:{},this._markerData),lineStartSymbol:ot((c=(d=this._spec.itemLine.startSymbol)===null||d===void 0?void 0:d.state)!==null&&c!==void 0?c:{},this._markerData),lineEndSymbol:ot((g=(u=this._spec.itemLine.endSymbol)===null||u===void 0?void 0:u.state)!==null&&g!==void 0?g:{},this._markerData),symbol:ot((p=(_=this._spec.itemContent.symbol)===null||_===void 0?void 0:_.state)!==null&&p!==void 0?p:{},this._markerData),image:ot((b=(m=this._spec.itemContent.image)===null||m===void 0?void 0:m.state)!==null&&b!==void 0?b:{},this._markerData),text:ot((v=(x=this._spec.itemContent.text)===null||x===void 0?void 0:x.state)!==null&&v!==void 0?v:{},this._markerData),textBackground:ot((f=(y=this._spec.itemContent.text)===null||y===void 0?void 0:y.labelBackground)===null||f===void 0?void 0:f.state,this._markerData),richText:ot((k=(A=this._spec.itemContent.richText)===null||A===void 0?void 0:A.state)!==null&&k!==void 0?k:{},this._markerData),customMark:ot((P=(T=this._spec.itemContent.customMark)===null||T===void 0?void 0:T.state)!==null&&P!==void 0?P:{},this._markerData),targetItem:ot((B=(D=this._spec.targetSymbol)===null||D===void 0?void 0:D.state)!==null&&B!==void 0?B:{},this._markerData)},animation:(E=this._spec.animation)!==null&&E!==void 0&&E,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};rt!=null&&rt.style&&(Pt.itemContent.symbolStyle=z(Ut(rt.style,this._markerData))),Jt!=null&&Jt.style&&(Pt.itemContent.imageStyle=Ut(Jt.style,this._markerData)),Z&&(Pt.itemContent.textStyle=Ds(Z,this._markerData)),pe!=null&&pe.style&&(Pt.itemContent.richTextStyle=Ut(pe.style,this._markerData));const{visible:Fe,line:He={}}=nt,ht=tn(nt,["visible","line"]);return Pt.itemLine=Fe!==!1?Object.assign(Object.assign({},ht),{visible:!0,lineStyle:z(He.style)}):{visible:!1},new ce(Pt)}_markerLayout(){var t,e,i,s,a;const n=this._spec,r=this._markerData,l=this._relativeSeries,{point:h}=this._computePointsAttr(),d=this._getRelativeDataView().latestData,c=r?r.latestData[0]&&r.latestData[0].latestData?r.latestData[0].latestData:r.latestData:d;let u;if(n.clip||!((t=n.itemContent)===null||t===void 0)&&t.confine){const{minX:g,maxX:_,minY:p,maxY:m}=Ls([l.getRegion()]);u={x:g,y:p,width:_-g,height:m-p}}if(this._markerComponent){const g=(e=this._markerComponent.attribute)!==null&&e!==void 0?e:{},_=(s=(i=g.itemContent)===null||i===void 0?void 0:i.textStyle)!==null&&s!==void 0?s:{};this._markerComponent.setAttributes({position:h===void 0?{x:null,y:null}:h,itemContent:Object.assign(Object.assign({},g.itemContent),{textStyle:Object.assign(Object.assign({},_),{text:!((a=this._spec.itemContent.text)===null||a===void 0)&&a.formatMethod?this._spec.itemContent.text.formatMethod(c,d):_.text}),offsetX:Ja(h,g.itemContent.offsetX,this._relativeSeries.getRegion()),offsetY:Ja(h,g.itemContent.offsetY,this._relativeSeries.getRegion())}),limitRect:u,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}}_initDataView(){const t=this._spec,{doXYProcess:e,doPolarProcess:i,doGeoProcess:s}=ls(t);if(!(S(t.coordinate)||e||i||s))return;at(this._option.dataSet,"markerAggregation",Os),at(this._option.dataSet,"markerFilter",Rs);const{options:a}=this._computeOptions(),n=new bt(this._option.dataSet,{name:`${this.type}_${this.id}_data`});n.parse([this._getRelativeDataView()],{type:"dataview"}),n.transform({type:"markerAggregation",options:a}),n.transform({type:"markerFilter",options:this._getAllRelativeSeries()}),n.target.on("change",()=>{this._markerLayout()}),this._markerData=n}}Ir.specKey="markPoint";class Oi extends Ir{constructor(){super(...arguments),this.type=F.markPoint,this.name=F.markPoint,this.coordinateType="cartesian"}_computePointsAttr(){var t;const e=this._spec,i=this._markerData,s=this._relativeSeries,a="x"in e&&"y"in e,n="coordinate"in e,r="position"in e,l=(t=e==null?void 0:e.autoRange)!==null&&t!==void 0&&t;let h;return a?h=Ti(i,s,s,s,l)[0][0]:n?h=Bs(i,s,l,e.coordinatesOffset)[0]:r&&(h=Ps(e.position,s,e.regionRelative)[0]),{point:h}}_computeOptions(){const t=this._spec,{doXYProcess:e}=ls(t),i=S(t.coordinate);let s;return e?s=[this._processSpecByDims([{dim:"x",specValue:t.x},{dim:"y",specValue:t.y}])]:i&&(s=this._processSpecCoo(t)),{options:s}}}Oi.type=F.markPoint,Oi.coordinateType="cartesian";const Rc=()=>{X.registerComponent(Oi.type,Oi),Yh()};class Ei extends ii{constructor(){super(...arguments),this.layoutType="none",this.type=F.brush,this.name=F.brush,this.specKey="brush",this.layoutZIndex=St.Brush,this._linkedSeries=[],this._itemMap={},this._linkedItemMap={},this._inBrushElementsMap={},this._outOfBrushElementsMap={},this._linkedInBrushElementsMap={},this._linkedOutOfBrushElementsMap={},this._needInitOutState=!0,this._cacheInteractiveRangeAttrs=[],this._needDisablePickable=!1,this._releatedAxes=[],this._regionAxisMap={},this._axisDataZoomMap={},this._zoomRecord=[]}init(){const t=this._transformBrushedMarkAttr(this._spec.inBrush),e=this._transformBrushedMarkAttr(this._spec.outOfBrush);this._option.getAllSeries().forEach(i=>{i.getActiveMarks().forEach(s=>{s&&(i.setMarkStyle(s,Object.assign({},t),"inBrush",I.Series),i.setMarkStyle(s,Object.assign({},e),"outOfBrush",I.Series))})})}static getSpecInfo(t){return vs(t,this.specKey,this.type,e=>e.visible!==!1)}created(){super.created(),this.initEvent(),this._bindRegions(),this._bindLinkedSeries(),this._initRegionAxisMap(),this._initAxisDataZoomMap(),this._initNeedOperatedItem()}_extendDataInBrush(t){const e=[];for(const i in t)for(const s in t[i])e.push(Object.assign({},t[i][s].data[0]));return e}_extendDatumOutOfBrush(t){var e;const i=[];for(const s in t)i.push((e=t[s].data)===null||e===void 0?void 0:e[0]);return i}_getBrushInteractiveAttr(t){const e=t.getLayoutStartPoint(),i=t.getLayoutRect(),s=e.x,a=s+i.width,n=e.y,r=n+i.height;return{interactiveRange:{minY:n,maxY:r,minX:s,maxX:a},xRange:[s,a],yRange:[n,r]}}_updateBrushComponent(t,e){const i=this._getBrushInteractiveAttr(t),s=this._brushComponents[e];s.setAttributes(i),this._initMarkBrushState(e,""),s.children[0].removeAllChild(),this._needInitOutState=!0}_createBrushComponent(t,e){var i,s;const a=this._getBrushInteractiveAttr(t),n=new sr(Object.assign(Object.assign(Object.assign({zIndex:this.layoutZIndex,brushStyle:z((i=this._spec)===null||i===void 0?void 0:i.style)},a),this._spec),{disableTriggerEvent:this._option.disableTriggerEvent}));n.id=(s=this._spec.id)!==null&&s!==void 0?s:`brush-${this.id}`,this.getContainer().add(n);const{brushMode:r="single"}=this._spec;this._brushComponents.push(n),this._cacheInteractiveRangeAttrs.push(a),n.addEventListener(ut.drawStart,l=>{this._emitEvent(V.brushStart,t)}),n.addEventListener(ut.moveStart,l=>{this._emitEvent(V.brushStart,t)}),n.addEventListener(ut.drawing,l=>{this._needInitOutState&&r==="single"&&this._initMarkBrushState(e,"outOfBrush"),this._needInitOutState=!1,this._needDisablePickable=!0,this._handleBrushChange(V.brushChange,t,l),this._emitEvent(V.brushChange,t)}),n.addEventListener(ut.moving,l=>{this._handleBrushChange(V.brushChange,t,l),this._emitEvent(V.brushChange,t)}),n.addEventListener(ut.brushClear,l=>{this._initMarkBrushState(e,""),this._needInitOutState=!0,this._needDisablePickable=!1,this._handleBrushChange(V.brushChange,t,l),this._handleBrushChange(V.brushClear,t,l),this._emitEvent(V.brushChange,t),this._emitEvent(V.brushClear,t)}),n.addEventListener(ut.drawEnd,l=>{this._needInitOutState=!0,this._needDisablePickable=!1;const{operateMask:h}=l.detail;this._handleBrushChange(V.brushEnd,t,l);const d=this._extendDataInBrush(this._inBrushElementsMap);!this._spec.zoomWhenEmpty&&d.length>0&&this._setAxisAndDataZoom(h,t),this._emitEvent(V.brushEnd,t)}),n.addEventListener(ut.moveEnd,l=>{const{operateMask:h}=l.detail;this._handleBrushChange(V.brushEnd,t,l);const d=this._extendDataInBrush(this._inBrushElementsMap);!this._spec.zoomWhenEmpty&&d.length>0&&this._setAxisAndDataZoom(h,t),this._emitEvent(V.brushEnd,t)})}_handleBrushChange(t,e,i){const{operateMask:s}=i.detail;this._reconfigItem(s,e),this._reconfigLinkedItem(s,e)}_emitEvent(t,e){this.event.emit(t,{model:this,value:{operateType:t,operateRegion:e,inBrushData:this._extendDataInBrush(this._inBrushElementsMap),outOfBrushData:this._extendDatumOutOfBrush(this._outOfBrushElementsMap),linkInBrushData:this._extendDataInBrush(this._linkedInBrushElementsMap),linkOutOfBrushData:this._extendDatumOutOfBrush(this._linkedOutOfBrushElementsMap),inBrushElementsMap:this._inBrushElementsMap,outOfBrushElementsMap:this._outOfBrushElementsMap,linkedInBrushElementsMap:this._linkedInBrushElementsMap,linkedOutOfBrushElementsMap:this._linkedOutOfBrushElementsMap,zoomRecord:this._zoomRecord}})}_transformBrushedMarkAttr(t){const e={};return t!=null&&t.symbol&&(e.symbolType=t.symbol),t!=null&&t.symbolSize&&(e.size=t.symbolSize),t!=null&&t.color&&(e.fill=t.color),t!=null&&t.colorAlpha&&(e.fillOpacity=t.colorAlpha),Object.assign(Object.assign({},z(t)),e)}_reconfigItem(t,e){this._itemMap[e.id].forEach(i=>{const s=i.getProduct();!s||!s.elements||!s.elements.length||s.elements.forEach(a=>{var n,r,l;const h=a.getGraphicItem(),d=i.id+"_"+a.key;!((n=this._outOfBrushElementsMap)===null||n===void 0)&&n[d]&&this._isBrushContainItem(t,h)?(a.addState("inBrush"),this._inBrushElementsMap[t==null?void 0:t.name]||(this._inBrushElementsMap[t==null?void 0:t.name]={}),this._inBrushElementsMap[t==null?void 0:t.name][d]=a,delete this._outOfBrushElementsMap[d]):!((l=(r=this._inBrushElementsMap)===null||r===void 0?void 0:r[t==null?void 0:t.name])===null||l===void 0)&&l[d]&&!this._isBrushContainItem(t,h)&&(a.removeState("inBrush"),a.addState("outOfBrush"),this._outOfBrushElementsMap[d]=a,delete this._inBrushElementsMap[t.name][d]),h.setAttribute("pickable",!this._needDisablePickable)})})}_reconfigLinkedItem(t,e){const i=e.getLayoutStartPoint(),s=e.getSeries().map(a=>a.id);this._linkedSeries.forEach(a=>{if(!s.includes(a.id)){const n=a.getRegion().getLayoutStartPoint(),r=n.x-i.x,l=n.y-i.y;this._linkedItemMap[a.id].forEach(h=>{const d=h.getProduct();!d||!d.elements||!d.elements.length||d.elements.forEach(c=>{var u,g,_;const p=c.getGraphicItem(),m=h.id+"_"+c.key;!((u=this._linkedOutOfBrushElementsMap)===null||u===void 0)&&u[m]&&this._isBrushContainItem(t,p,{dx:r,dy:l})?(c.addState("inBrush"),this._linkedInBrushElementsMap[t==null?void 0:t.name]||(this._linkedInBrushElementsMap[t==null?void 0:t.name]={}),this._linkedInBrushElementsMap[t==null?void 0:t.name][m]=c,delete this._linkedOutOfBrushElementsMap[m]):!((_=(g=this._linkedInBrushElementsMap)===null||g===void 0?void 0:g[t==null?void 0:t.name])===null||_===void 0)&&_[m]&&!this._isBrushContainItem(t,p,{dx:r,dy:l})&&(c.removeState("inBrush"),c.addState("outOfBrush"),this._linkedOutOfBrushElementsMap[m]=c),p.setAttribute("pickable",!this._needDisablePickable)})})}})}_isBrushContainItem(t,e,i){var s,a,n;if(!(t!=null&&t.globalTransMatrix)||!(!((s=t==null?void 0:t.attribute)===null||s===void 0)&&s.points))return!1;const r=(n=(a=t==null?void 0:t.attribute)===null||a===void 0?void 0:a.points)!==null&&n!==void 0?n:[],{a:l,b:h,c:d,d:c,e:u,f:g}=t.globalTransMatrix,_=(i==null?void 0:i.dx)||0,p=(i==null?void 0:i.dy)||0,m=r.map(y=>({x:l*y.x+d*y.y+u+_,y:h*y.x+c*y.y+g+p}));t.globalAABBBounds.clone().set(t.globalAABBBounds.x1+_,t.globalAABBBounds.y1+p,t.globalAABBBounds.x2+_,t.globalAABBBounds.y2+p);const b=e.globalTransMatrix.e,x=e.globalTransMatrix.f;let v=[];if(e.type==="symbol"){const{size:y=0}=e==null?void 0:e.attribute,f=L(y)[0]/2;return v=[{x:b-f,y:x-f},{x:b+f,y:x-f},{x:b+f,y:x+f},{x:b-f,y:x+f}],da(m,v)}if(e.type==="rect"){const{x1:y,x2:f,y1:A,y2:k}=e==null?void 0:e.AABBBounds,T=Math.abs(y-f),P=Math.abs(A-k);return v=[{x:b,y:x},{x:b+T,y:x},{x:b+T,y:x+P},{x:b,y:x+P}],da(m,v)}return t.globalAABBBounds.intersects(e.globalAABBBounds)}_stateClamp(t){return Math.min(Math.max(0,t),1)}_setAxisAndDataZoom(t,e){var i;if(this._zoomRecord=[],this._spec.zoomAfterBrush){const s=t.AABBBounds;(i=this._regionAxisMap["region_"+e.id])===null||i===void 0||i.forEach(a=>{var n,r;const l=a.layoutOrient==="bottom"||a.layoutOrient==="top",h=(n=this._spec.axisRangeExpand)!==null&&n!==void 0?n:0,{x1:d,x2:c,y1:u,y2:g}=s,_=l?"x":"y",p=l?d:u,m=l?c:g;if(this._axisDataZoomMap[a.id]){const b=this._axisDataZoomMap[a.id],x=b.relatedAxisComponent,v=x.getScale().invert(p-e.getLayoutStartPoint()[_]),y=x.getScale().invert(m-e.getLayoutStartPoint()[_]),f=b.dataToStatePoint(v),A=b.dataToStatePoint(y),k=this._stateClamp(f-h),T=this._stateClamp(A+h);b.setStartAndEnd(Math.min(k,T),Math.max(k,T),["percent","percent"]),this._zoomRecord.push({operateComponent:b,start:k,end:T})}else{const b=a.getScale().range(),x=(r=a.getScale().rangeFactor())!==null&&r!==void 0?r:[0,1],v=j(b)<b[0],y=p-e.getLayoutStartPoint()[_],f=m-e.getLayoutStartPoint()[_],A=v?Math.min(y,f):Math.max(y,f),k=((v?Math.max(y,f):Math.min(y,f))-b[0])/(j(b)-b[0])*(x[1]-x[0])+x[0],T=(A-b[0])/(j(b)-b[0])*(x[1]-x[0])+x[0],P=this._stateClamp(k-h),D=this._stateClamp(T+h);a.getScale().rangeFactor([P,D]),a.effect.scaleUpdate(),this._zoomRecord.push({operateComponent:a,start:P,end:D})}})}}_bindRegions(){S(this._spec.regionId)&&S(this._spec.regionIndex)&&(this._relativeRegions=this._option.getAllRegions()),this._relativeRegions=this._option.getRegionsInUserIdOrIndex(L(this._spec.regionId),L(this._spec.regionIndex))}_bindLinkedSeries(){S(this._spec.brushLinkSeriesId)&&S(this._spec.brushLinkSeriesIndex)||(this._linkedSeries=this._option.getSeriesInUserIdOrIndex(L(this._spec.brushLinkSeriesId),L(this._spec.brushLinkSeriesIndex)))}_initRegionAxisMap(){S(this._spec.axisId)?L(this._spec.axisId).forEach(t=>{this._releatedAxes.push(this._option.getComponentByUserId(t))}):S(this._spec.axisIndex)?L(this._spec.axisIndex).forEach(t=>{this._releatedAxes.push(this._option.getComponentByIndex("axes",t))}):this._releatedAxes=this._option.getComponentsByKey("axes"),this._releatedAxes.forEach(t=>{t==null||t.getRegions().forEach(e=>{this._regionAxisMap["region_"+e.id]?this._regionAxisMap["region_"+e.id].push(t):this._regionAxisMap["region_"+e.id]=[t]})})}_initAxisDataZoomMap(){this._option.getComponentsByKey("dataZoom").forEach(t=>{t.relatedAxisComponent&&(this._axisDataZoomMap[t.relatedAxisComponent.id]=t)})}_initNeedOperatedItem(){const t=this._spec.seriesId,e=this._spec.seriesIndex;this._relativeRegions.forEach(i=>{const s=[];i.getSeries().forEach(a=>{(t&&L(t).includes(a.userId.toString())||e&&L(e).includes(a.getSpecIndex())||!e&&!t)&&s.push(...a.getMarksWithoutRoot()),this._itemMap[i.id]=s})}),this._linkedSeries.forEach(i=>{this._linkedItemMap[i.id]=i.getMarksWithoutRoot()})}_initMarkBrushState(t,e){this._brushComponents.forEach((i,s)=>{s!==t&&i.children[0].removeAllChild()}),this._inBrushElementsMap={},this._outOfBrushElementsMap={},this._linkedInBrushElementsMap={},this._linkedOutOfBrushElementsMap={},this._option.getAllSeries().forEach(i=>{i.getMarksWithoutRoot().forEach(s=>{const a=s.getProduct();!a||!a.elements||!a.elements.length||a.elements.forEach(n=>{const r=s.id+"_"+n.key;n.removeState("inBrush"),n.removeState("outOfBrush"),n.addState(e),this._outOfBrushElementsMap[r]=n,this._linkedOutOfBrushElementsMap[r]=n})})})}initEvent(){}onRender(t){}changeRegions(t){}_getNeedClearVRenderComponents(){return this._brushComponents}_compareSpec(t,e){this._brushComponents&&this._relativeRegions.forEach((s,a)=>{this._updateBrushComponent(s,a)});const i=super._compareSpec(t,e);return Ie(e,t)||(i.reRender=!0,i.reMake=!0),i}onLayoutEnd(t){var e;super.onLayoutEnd(t),!this._option.disableTriggerEvent&&((e=this._spec.visible)===null||e===void 0||e)&&(this._brushComponents?this._relativeRegions.forEach((i,s)=>{this._updateBrushComponent(i,s)}):(this._brushComponents=[],this._relativeRegions.forEach((i,s)=>{this._createBrushComponent(i,s)})))}clearGraphic(){this._brushComponents&&this._brushComponents.forEach(t=>{t._container.incrementalClearChild()})}clear(){if(this._brushComponents){const t=this.getContainer();this._brushComponents.forEach(e=>{e.removeAllChild(),e.releaseBrushEvents(),t&&t.removeChild(e)}),this._brushComponents=null}}}Ei.type=F.brush,Ei.specKey="brush";const Ic=()=>{X.registerComponent(Ei.type,Ei)},wc=[Al,kl,Ml,Tl,we,ze,pr,mr,Dr,Ic,Cl,_c,Bl,Pl,Ll,Dc,Lc,Rc,pc,Dl],zc=On("CommonChart",{type:"common",vchartConstrouctor:Rn},[hc,we,ze,pr,mr,Dr,En,Ec,Rd,Vd,vr,Wd,lc]),Fc=On("LineChart",{type:"line",vchartConstrouctor:Rn},[Ld,En,...wc]),Zc={title:"VChart/Line"};function je(){const t={padding:24,layout:{type:"grid",col:3,row:3,elements:[{modelId:"text",col:0,colSpan:2,row:0},{modelId:"legend",col:2,row:0},{modelId:"humidity",col:1,colSpan:2,row:1},{modelId:"humidity-left",col:0,colSpan:1,row:1},{modelId:"axes-bottom",col:1,colSpan:2,row:2}]},region:[{id:"humidity"}],title:{id:"text",padding:{top:0},text:"自定义标题",textStyle:{lineHeight:24},subtext:"这是副标题这是副标题这是副标题这是副标题这是副标题这是副标题这是副标题",subtextStyle:{lineHeight:24}},legends:{padding:{top:0},visible:!0,orient:"bottom",position:"end",id:"legend",regionId:["humidity"]},series:[{id:"humidity-series",regionId:"humidity",type:"line",seriesField:"type",data:{id:"humidityData"},xField:"date",yField:"value"}],axes:[{id:"humidity-left",regionId:"humidity",orient:"left",...{expand:{max:.2},label:{flush:!0,visible:!0},tick:{visible:!1},forceTickCount:3}},{id:"axes-bottom",regionId:["humidity"],orient:"bottom",label:{firstVisible:!0,lastVisible:!0,visible:!0},tick:{visible:!1},paddingInner:.99,paddingOuter:0}],data:[{id:"humidityData",values:[{date:"周一",value:36,type:"maximum-humidity"},{date:"周二",value:37,type:"maximum-humidity"},{date:"周三",value:38,type:"maximum-humidity"},{date:"周四",value:38,type:"maximum-humidity"},{date:"周五",value:40,type:"maximum-humidity"},{date:"周一",value:21,type:"minimum-humidity"},{date:"周二",value:21,type:"minimum-humidity"},{date:"周三",value:22,type:"minimum-humidity"},{date:"周四",value:23,type:"minimum-humidity"},{date:"周五",value:24,type:"minimum-humidity"}]}]};return ln.createElement(zc,{...t})}function Xe(){const o={title:{text:"多条折线图",subtext:"这是描述"},xField:"year",yField:"value",seriesField:"category",data:{values:[{year:"2010",value:510,category:"Liquid fuel"},{year:"2010",value:481,category:"Solid fuel"},{year:"2010",value:570,category:"Gas flarinl"},{year:"2011",value:513,category:"Liquid fuel"},{year:"2011",value:405,category:"Solid fuel"},{year:"2011",value:164,category:"Gas flarinl"},{year:"2012",value:320,category:"Liquid fuel"},{year:"2012",value:410,category:"Solid fuel"},{year:"2012",value:250,category:"Gas flarinl"},{year:"2013",value:222,category:"Liquid fuel"},{year:"2013",value:512,category:"Solid fuel"},{year:"2013",value:408,category:"Gas flarinl"},{year:"2014",value:428,category:"Liquid fuel"},{year:"2014",value:111,category:"Solid fuel"},{year:"2014",value:568,category:"Gas flarinl"},{year:"2015",value:428,category:"Liquid fuel"},{year:"2015",value:111,category:"Solid fuel"},{year:"2015",value:568,category:"Gas flarinl"}]},legends:{visible:!0,position:"end",orient:"top"},point:{style:{fill:"white",shape:"circle",strokeWidth:1,stroke:{scale:"color",field:"category"}}}};return ln.createElement(Fc,{...o})}je.__docgenInfo={description:"",methods:[],displayName:"Basic"};Xe.__docgenInfo={description:"",methods:[],displayName:"Middle"};var en,sn,an;je.parameters={...je.parameters,docs:{...(en=je.parameters)==null?void 0:en.docs,source:{originalSource:`function Basic() {
  const leftAxesCommonSpec = {
    expand: {
      max: 0.2
    },
    label: {
      flush: true,
      visible: true
    },
    tick: {
      visible: false
    },
    forceTickCount: 3
  };
  const spec: CommonProps = {
    padding: 24,
    layout: {
      type: 'grid',
      col: 3,
      row: 3,
      elements: [{
        modelId: 'text',
        col: 0,
        colSpan: 2,
        row: 0
      }, {
        modelId: 'legend',
        col: 2,
        row: 0
      }, {
        modelId: 'humidity',
        col: 1,
        colSpan: 2,
        row: 1
      }, {
        modelId: 'humidity-left',
        col: 0,
        colSpan: 1,
        row: 1
      }, {
        modelId: 'axes-bottom',
        col: 1,
        colSpan: 2,
        row: 2
      }]
    },
    region: [{
      id: 'humidity'
    }],
    title: {
      id: 'text',
      padding: {
        top: 0
      },
      text: '自定义标题',
      textStyle: {
        lineHeight: 24
      },
      subtext: '这是副标题这是副标题这是副标题这是副标题这是副标题这是副标题这是副标题',
      subtextStyle: {
        lineHeight: 24
      }
    },
    legends: {
      padding: {
        top: 0
      },
      visible: true,
      orient: 'bottom',
      position: 'end',
      id: 'legend',
      regionId: ['humidity']
    },
    series: [{
      id: 'humidity-series',
      regionId: 'humidity',
      type: 'line',
      seriesField: 'type',
      data: {
        id: 'humidityData'
      },
      xField: 'date',
      yField: 'value'
    }],
    axes: [{
      id: 'humidity-left',
      regionId: 'humidity',
      orient: 'left',
      // title: { visible: true, text: 'ES' },
      ...leftAxesCommonSpec
    }, {
      id: 'axes-bottom',
      regionId: ['humidity'],
      orient: 'bottom',
      label: {
        firstVisible: true,
        lastVisible: true,
        visible: true
      },
      tick: {
        visible: false
      },
      paddingInner: 0.99,
      paddingOuter: 0
    }],
    data: [{
      id: 'humidityData',
      values: [{
        date: '周一',
        value: 36,
        type: 'maximum-humidity'
      }, {
        date: '周二',
        value: 37,
        type: 'maximum-humidity'
      }, {
        date: '周三',
        value: 38,
        type: 'maximum-humidity'
      }, {
        date: '周四',
        value: 38,
        type: 'maximum-humidity'
      }, {
        date: '周五',
        value: 40,
        type: 'maximum-humidity'
      }, {
        date: '周一',
        value: 21,
        type: 'minimum-humidity'
      }, {
        date: '周二',
        value: 21,
        type: 'minimum-humidity'
      }, {
        date: '周三',
        value: 22,
        type: 'minimum-humidity'
      }, {
        date: '周四',
        value: 23,
        type: 'minimum-humidity'
      }, {
        date: '周五',
        value: 24,
        type: 'minimum-humidity'
      }]
    }]
  };
  return <Common {...spec} />;
}`,...(an=(sn=je.parameters)==null?void 0:sn.docs)==null?void 0:an.source}}};var nn,rn,on;Xe.parameters={...Xe.parameters,docs:{...(nn=Xe.parameters)==null?void 0:nn.docs,source:{originalSource:`function Middle() {
  const config: LineProps = {
    title: {
      text: '多条折线图',
      subtext: '这是描述'
    },
    xField: 'year',
    yField: 'value',
    seriesField: 'category',
    data: {
      values: [{
        year: '2010',
        value: 510,
        category: 'Liquid fuel'
      }, {
        year: '2010',
        value: 481,
        category: 'Solid fuel'
      }, {
        year: '2010',
        value: 570,
        category: 'Gas flarinl'
      }, {
        year: '2011',
        value: 513,
        category: 'Liquid fuel'
      }, {
        year: '2011',
        value: 405,
        category: 'Solid fuel'
      }, {
        year: '2011',
        value: 164,
        category: 'Gas flarinl'
      }, {
        year: '2012',
        value: 320,
        category: 'Liquid fuel'
      }, {
        year: '2012',
        value: 410,
        category: 'Solid fuel'
      }, {
        year: '2012',
        value: 250,
        category: 'Gas flarinl'
      }, {
        year: '2013',
        value: 222,
        category: 'Liquid fuel'
      }, {
        year: '2013',
        value: 512,
        category: 'Solid fuel'
      }, {
        year: '2013',
        value: 408,
        category: 'Gas flarinl'
      }, {
        year: '2014',
        value: 428,
        category: 'Liquid fuel'
      }, {
        year: '2014',
        value: 111,
        category: 'Solid fuel'
      }, {
        year: '2014',
        value: 568,
        category: 'Gas flarinl'
      }, {
        year: '2015',
        value: 428,
        category: 'Liquid fuel'
      }, {
        year: '2015',
        value: 111,
        category: 'Solid fuel'
      }, {
        year: '2015',
        value: 568,
        category: 'Gas flarinl'
      }]
    },
    legends: {
      visible: true,
      position: 'end',
      orient: 'top'
    },
    point: {
      style: {
        fill: 'white',
        shape: 'circle',
        strokeWidth: 1,
        stroke: {
          scale: 'color',
          field: 'category'
        }
      }
    }
  };
  return <Line {...config} />;
}`,...(on=(rn=Xe.parameters)==null?void 0:rn.docs)==null?void 0:on.source}}};const Nc=["Basic","Middle"];export{je as Basic,Xe as Middle,Nc as __namedExportsOrder,Zc as default};
