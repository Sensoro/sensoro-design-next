import{R as cn}from"./index-RYns6xqu.js";import{Y as us,Z as Yr,_ as qt,$ as Qt,a0 as De,a1 as gs,a2 as A,i as w,a3 as Xr,a4 as Gr,a5 as Ur,a6 as ps,a7 as Fi,a8 as Zr,a9 as js,aa as Ys,ab as Y,e as U,l as W,b as L,ac as se,ad as Le,ae as Rt,af as gi,ag as R,c as E,ah as Nr,ai as Oe,aj as pi,ak as Pe,al as _i,am as $,an as Wr,ao as $r,ap as Ce,aq as ae,a as C,ar as Kr,as as qr,at as Qr,au as S,av as Jr,aw as un,o as kt,ax as to,ay as eo,az as ge,aA as io,aB as so,aC as ao,aD as no,aE as ro,aF as Xs,aG as Gs,aH as _s,aI as oo,aJ as lo,aK as ho,aL as co,aM as uo,aN as Us,aO as et,aP as Ft,aQ as Bt,aR as go,aS as We,aT as po,aU as _o,aV as gn,aW as mo,aX as ye,aY as mi,aZ as vo,a_ as ms,a$ as zi,b0 as yo,b1 as ii,b2 as vi,b3 as Ct,b4 as pn,b5 as bo,b6 as fo,b7 as _n,b8 as X,b9 as bt,ba as Dt,bb as ne,bc as je,bd as Nt,be as xt,bf as lt,bg as $e,E as I,m as z,bh as Hi,bi as St,bj as Ke,bk as Zs,A as ee,bl as q,n as pe,bm as Vi,bn as xo,r as st,bo as vs,F as V,bp as Ee,bq as ft,br as si,H as Pt,bs as qe,bt as mt,bu as So,bv as Ao,bw as mn,bx as F,by as ko,bz as be,bA as Mo,bB as ys,bC as vn,C as P,bD as bs,bE as rt,bF as Se,bG as Vt,bH as hi,bI as yn,bJ as Ns,bK as Ws,bL as $s,bM as To,bN as yi,bO as Ye,bP as Ks,bQ as Qe,bR as bn,bS as qs,bT as fn,bU as xn,bV as Qs,bW as Co,S as yt,bX as Sn,bY as fs,bZ as An,t as kn,u as ji,I as Wt,b_ as Yi,J as Mn,b$ as Tn,c0 as Lo,c1 as Cn,c2 as Po,c3 as Bo,c4 as Do,K as Ln,B as Oo,c5 as Eo,c6 as Io,c7 as ht,c8 as Ro,c9 as Js,ca as ta,cb as ea,cc as ia,w as wo,cd as sa,ce as aa,cf as Pn,cg as na,ch as ra,ci as oa,cj as la,ck as Fo,cl as di,v as Bn,cm as zo,d as vt,cn as Dn,co as On,j as jt,cp as bi,cq as ts,cr as _t,cs as Xt,ct as Ho,cu as Vo,cv as jo,cw as es,cx as Yo,cy as Xo,cz as Go,cA as Gt,cB as re,cC as Uo,p as Zo,cD as No,cE as Wo,cF as $o,cG as ha,cH as da,cI as Ko,cJ as qo,cK as Qo,cL as Jo,cM as ca,cN as ci,cO as tl,cP as fi,cQ as En,cR as el,cS as il,cT as sl,cU as al,cV as nl,cW as rl,cX as ol,cY as In,cZ as ll,c_ as hl,c$ as ua,d0 as ue,d1 as dl,d2 as cl,d3 as ul,d4 as gl,d5 as pl,d6 as _l,d7 as ml,d8 as vl,d9 as yl,da as bl,db as fl,dc as xl,dd as Sl,de as Al,df as Rn,dg as kl,dh as ga,M as Ml,N as Tl,O as Cl,P as Ll,R as Pl,Q as Bl,T as Dl,U as Ol,V as El,W as wn,X as Fn}from"./index--HgL91qy.js";import"./index-BX6J8nRb.js";import"./index-DcfIKM1A.js";import"./index-CpOIycTO.js";const Il=o=>typeof o=="string"&&!isNaN(Number(o))&&!isNaN(parseFloat(o));class Rl extends us{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:0}})}onEnd(){this.target.setTheme({common:{opacity:1}})}onUpdate(t,e,i){this.target.setTheme({common:{opacity:e}})}}class wl extends us{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:1}})}onEnd(){this.target.setTheme({common:{opacity:0}})}onUpdate(t,e,i){this.target.setTheme({common:{opacity:1-e}})}}function Fl(o,t){let e,i,s=o[0].x,a=o[0].y;const n=[o[0]];for(let r=1,l=o.length;r<l;r++)e=o[r].x-s,i=o[r].y-a,e*e+i*i>t&&(s=o[r].x,a=o[r].y,n.push(o[r]));return o[o.length-1].x===s&&o[o.length-1].y===a||n.push(o[o.length-1]),n}function as(o,t,e,i,s){let a=i,n=t;const r=o[t].x,l=o[t].y,h=o[e].x-r,d=o[e].y-l,c=h*h+d*d;let u,g,p,_,m;for(let v=t+1,b=e-1;v<b;v++)_=o[v].x-r,m=o[v].y-l,u=_*d-h*m,g=u*u,p=g/c,p>a&&(a=p,n=v);a>i&&(n-t>2&&as(o,t,n,i,s),s.push(o[n],o[n+1]),e-n>2&&as(o,n,e,i,s))}function zl(o,t){const e=o.length-1,i=[o[0]];return as(o,0,e,t,i),i.push(o[e]),i}function Hl(o,t,e){if(o.length<=10)return o;const i=t!==void 0?t*t:1;return o=zl(o=Fl(o,i),i)}function Vl(o,t){return[o[0]*t,o[1]*t]}function jl(o){const[t,e]=o;return Math.sqrt(t*t+e*e)}function Yl(o){let t=jl(o);return t>0&&(t=1/t),[o[0]*t,o[1]*t]}function Xl(o,t){const[e,i]=o,[s,a]=t,n=Math.sqrt((e*e+i*i)*(s*s+a*a)),r=n&&(e*s+i*a)/n;return Math.acos(Math.min(Math.max(r,-1),1))}function Gl(o,t,e){const i=Xl(o,t),s=Yr(o,t)>=0;return e?s?2*Math.PI-i:i:s?i:2*Math.PI-i}const is=(o,t)=>{const e=Math.atan2(o,t);return e<0?e+2*Math.PI:e};function zn(o,t){const{x1:e,y1:i,x2:s,y2:a}=t,{x1:n,y1:r,x2:l,y2:h}=o.AABBBounds;let d=0,c=0;return n<e&&(d=e-n),r<i&&(c=i-r),l>s&&(d=s-l),h>a&&(c=a-h),{dx:d,dy:c}}function Hn(o,t){const{dx:e,dy:i}=zn(o,t),{dx:s=0,dy:a=0}=o.attribute;e&&o.setAttribute("dx",e+s),i&&o.setAttribute("dy",i+a)}class Vn extends qt{constructor(){super(...arguments),this.name="crosshair"}render(){this.renderCrosshair(this)}}function Ul(){Qt(),De()}function Zl(){Qt(),gs()}Ul();class Xi extends Vn{constructor(t,e){super(e!=null&&e.skipDefault?t:A({},Xi.defaultAttributes,t))}renderCrosshair(t){const{start:e,end:i,lineStyle:s}=this.attribute;return t.createOrUpdateChild("crosshair-line",Object.assign({points:[e,i]},s),"line")}setLocation(t){const{start:e,end:i}=t;this.setAttributes({start:e,end:i})}}Xi.defaultAttributes={lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}};Zl();class Gi extends Vn{constructor(t,e){super(e!=null&&e.skipDefault?t:A({},Gi.defaultAttributes,t))}renderCrosshair(t){const{start:e,end:i,rectStyle:s}=this.attribute;return t.createOrUpdateChild("crosshair-rect",Object.assign({x:e.x,y:e.y,width:i.x-e.x,height:i.y-e.y},s),"rect")}setLocation(t){const{start:e,end:i}=t;this.setAttributes({start:e,end:i})}}Gi.defaultAttributes={rectStyle:{fill:"#b2bacf",opacity:.2}};class Ui extends qt{constructor(t,e){super(e!=null&&e.skipDefault?t:A({},Ui.defaultAttributes,t)),this.name="data-label"}render(){var t;const{dataLabels:e,size:i}=this.attribute;if(!e||e.length===0)return;const{width:s=0,height:a=0,padding:n}=i||{};if(!s||!a||!w(a*s))return;this._componentMap||(this._componentMap=new Map);const r=Ur(s,a,n),l=r.bitmap(),h=new Map,d=this._componentMap;for(let c=0;c<e.length;c++){const u=e[c],g=Xr(u.type)||Gr;if(g){const{baseMarkGroupName:p,type:_}=u,m=(t=u.id)!==null&&t!==void 0?t:`${p}-${_}-${c}`;let v=this._componentMap.get(m);v?(v.setBitmapTool(r),v.setBitmap(l),v.setAttributes(u),h.set(m,v)):(v=new g(u),v.setBitmap(l),v.setBitmapTool(r),this.add(v),h.set(m,v))}}d.forEach((c,u)=>{h.get(u)||this.removeChild(c)}),this._componentMap=h}setLocation(t){this.translateTo(t.x,t.y)}disableAnimation(){this._componentMap.forEach(t=>{t.disableAnimation()})}enableAnimation(){this._componentMap.forEach(t=>{t.enableAnimation()})}}Ui.defaultAttributes={pickable:!1};function xs(){Qt(),De(),ps(),Fi()}function jn(){Qt(),De(),Zr(),Fi()}xs();class zt extends qt{getStartAngle(){return js(this._startAngle)}getEndAngle(){return js(this._endAngle)}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(t,e){super(e!=null&&e.skipDefault?t:A({},zt.defaultAttributes,t)),this.name="segment",this.key="segment",this.lines=[]}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:s,visible:a=!0,multiSegment:n,mainSegmentIndex:r}=this.attribute;if(!a)return;this._computeLineAngle();const l=this._getMainSegmentPoints(),h=this._renderSymbol(t,l,"start"),d=this._renderSymbol(e,l,"end");if(this.startSymbol=h,this.endSymbol=d,n){const c=[...this.attribute.points];if(w(r))c[r]=this._clipPoints(c[r]);else{const u=this._clipPoints(Ys(c));c[0][0]=u[0],c[c.length-1][c[c.length-1].length-1]=u[u.length-1]}c.forEach((u,g)=>{var p,_;const m=Y.line(Object.assign(Object.assign({points:u},U(i)?(p=i[g])!==null&&p!==void 0?p:i[i.length-1]:i),{fill:!1}));m.name=`${this.name}-line`,m.id=this._getNodeId("line"+g),W(s==null?void 0:s.line)||(m.states=U(s.line)?(_=s.line[g])!==null&&_!==void 0?_:s.line[s.line.length-1]:s.line),this.add(m),this.lines.push(m)})}else{let c=Y.line;L(i)[0].cornerRadius&&(c=Y.polygon);const u=c(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},L(i)[0]),{fill:!1,closePath:!1}));u.name=`${this.name}-line`,u.id=this._getNodeId("line"),W(s==null?void 0:s.line)||(u.states=[].concat(s.line)[0]),this.add(u),this.lines.push(u)}}_computeStartRotate(t){return t+Math.PI/2}_computeEndRotate(t){return t+Math.PI/2}_renderSymbol(t,e,i){if(!e.length)return;const{autoRotate:s=!0}=t;let a;if(t&&t.visible){const n=this.getStartAngle(),r=this.getEndAngle(),{state:l}=this.attribute,h=e[0],d=e[e.length-1],{refX:c=0,refY:u=0,refAngle:g=0,style:p,symbolType:_,size:m=12}=t;let v,b;i==="start"?(v={x:h.x+(w(n)?c*Math.cos(n)+u*Math.cos(n-Math.PI/2):0),y:h.y+(w(n)?c*Math.sin(n)+u*Math.sin(n-Math.PI/2):0)},b=this._computeStartRotate(this._startAngle)):(v={x:d.x+(w(r)?c*Math.cos(r)+u*Math.cos(r-Math.PI/2):0),y:d.y+(w(r)?c*Math.sin(r)+u*Math.sin(r-Math.PI/2):0)},b=this._computeEndRotate(this._endAngle)),a=Y.symbol(Object.assign(Object.assign(Object.assign({},v),{symbolType:_,size:m,angle:s?b+g:0,strokeBoundsBuffer:0}),p)),a.name=`${this.name}-${i}-symbol`,a.id=this._getNodeId(`${i}-symbol`),W(l==null?void 0:l.symbol)||(a.states=l.symbol),i==="start"?W(l==null?void 0:l.startSymbol)||(a.states=l.startSymbol):W(l==null?void 0:l.endSymbol)||(a.states=l.endSymbol),this.add(a)}return a}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;const{points:t,multiSegment:e,mainSegmentIndex:i}=this.attribute;let s;return s=e?w(i)?t[i]:Ys(t):t,this._mainSegmentPoints=s,s}_clipPoints(t){const{startSymbol:e={},endSymbol:i={}}=this.attribute;let s=t;if(e.visible){const a=e.clip?e.size||10:0;s=[{x:t[0].x-a/2*(Math.cos(this._startAngle)||0),y:t[0].y-a/2*(Math.sin(this._startAngle)||0)},...s.slice(1)]}if(i.visible){const a=i.clip?i.size||10:0,n={x:t[t.length-1].x-a/2*(Math.cos(this._endAngle)||0),y:t[t.length-1].y-a/2*(Math.sin(this._endAngle)||0)};s=[...s.slice(0,s.length-1),n]}return s}_computeLineAngle(){const t=this._getMainSegmentPoints();if(t.length<=1)return;const e=t[0],i=t[1],s=t[t.length-2],a=t[t.length-1],n=[e.x-i.x,e.y-i.y],r=Math.atan2(n[1],n[0]),l=[a.x-s.x,a.y-s.y],h=Math.atan2(l[1],l[0]);this._startAngle=r,this._endAngle=h}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}}zt.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}};jn();class pa extends zt{constructor(t,e){super(e!=null&&e.skipDefault?t:A({},zt.defaultAttributes,t)),this.name="arc-segment",this.key="arc-segment",this.isReverseArc=!1}getStartAngle(){const t=this.isReverseArc?this._startAngle+Math.PI/2:this._startAngle-Math.PI/2;return t<0?t+2*Math.PI:t>2*Math.PI?t-2*Math.PI:t}getEndAngle(){const t=this.isReverseArc?this._endAngle-Math.PI/2:this._endAngle+Math.PI/2;return t<0?t+2*Math.PI:t>2*Math.PI?t-2*Math.PI:t}getMainSegmentPoints(){return this._mainSegmentPoints}_computeStartRotate(t){return this.isReverseArc?t+Math.PI:t}_computeEndRotate(t){return this.isReverseArc?t:t+Math.PI}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:s,visible:a=!0,radius:n,startAngle:r,endAngle:l,center:h}=this.attribute;if(!a)return;this._startAngle=r,this._endAngle=l,this.isReverseArc=r>l;const d={x:h.x+n*Math.cos(this._startAngle),y:h.y+n*Math.sin(this._startAngle)},c={x:h.x+n*Math.cos(this._endAngle),y:h.y+n*Math.sin(this._endAngle)};this._mainSegmentPoints=[d,c];const u=this._renderSymbol(t,this._mainSegmentPoints,"start"),g=this._renderSymbol(e,this._mainSegmentPoints,"end");this.startSymbol=u,this.endSymbol=g;const p=Y.arc(Object.assign({x:h.x,y:h.y,startAngle:r,endAngle:l,innerRadius:n,outerRadius:n},i));p.name=`${this.name}-line`,p.id=this._getNodeId("arc"),W(s==null?void 0:s.line)||(p.states=[].concat(s.line)[0]),this.add(p),this.line=p}}var gt;(function(o){o.innerView="inner-view",o.axisContainer="axis-container",o.labelContainer="axis-label-container",o.tickContainer="axis-tick-container",o.tick="axis-tick",o.subTick="axis-sub-tick",o.label="axis-label",o.title="axis-title",o.gridContainer="axis-grid-container",o.grid="axis-grid",o.gridRegion="axis-grid-region",o.line="axis-line",o.background="axis-background",o.axisLabelBackground="axis-label-background"})(gt||(gt={}));var Ae;(function(o){o.selected="selected",o.selectedReverse="selected_reverse",o.hover="hover",o.hoverReverse="hover_reverse"})(Ae||(Ae={}));const fe={[Ae.selectedReverse]:{},[Ae.selected]:{},[Ae.hover]:{},[Ae.hoverReverse]:{}},ns={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}};function Yn(o){const t={};return Le(o,e=>{e.type!=="group"&&e.id&&(t[e.id]=e)}),t}function Xn(o,t){return{x:o.x+t[0],y:o.y+t[1]}}function Nl(o,t,e,i,s){const a=[],n=s-i;for(let r=0;r<t;r++){const l=i+r*n/t;a.push(se(o,e,l))}return a}function ke(o,t){let e="";return o.length===0||(o.forEach((i,s)=>{s===0?e=`M${i.x},${i.y}`:e+=`L${i.x},${i.y}`}),t&&(e+="Z")),e}const Gn=(o,t,e)=>{const i=o.target;return i!==e&&i.name&&!W(i.states)?(i.addState(Rt.hover,!0),Le(t,s=>{s!==i&&s.name&&!W(s.states)&&s.addState(Rt.hoverReverse,!0)}),i):e},Un=(o,t,e)=>e&&(Le(t,i=>{i.name&&!W(i.states)&&(i.removeState(Rt.hoverReverse),i.removeState(Rt.hover))}),null),Zn=(o,t,e)=>{const i=o.target;return e===i&&i.hasState(Rt.selected)?(Le(t,s=>{s.name&&!W(s.states)&&(s.removeState(Rt.selectedReverse),s.removeState(Rt.selected))}),null):i.name&&!W(i.states)?(i.addState(Rt.selected,!0),Le(t,s=>{s!==i&&s.name&&!W(s.states)&&s.addState(Rt.selectedReverse,!0)}),i):e};class Wl extends qt{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=t=>{this._lastHover=Gn(t,this.axisContainer,this._lastHover)},this._onUnHover=t=>{this._lastHover=Un(t,this.axisContainer,this._lastHover)},this._onClick=t=>{this._lastSelect=Zn(t,this.axisContainer,this._lastSelect)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(t){const e=gi(this.attribute);A(this.attribute,t);const i=Y.group({x:this.attribute.x,y:this.attribute.y});return this.add(i),this._renderInner(i),this.removeChild(i),this.attribute=e,i.AABBBounds}render(){this._prevInnerView=this._innerView&&Yn(this._innerView),this.removeAllChild(!0),this._innerView=Y.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent()}_bindEvent(){if(this.attribute.disableTriggerEvent)return;const{hover:t,select:e}=this.attribute;t&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),e&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(t){const{title:e,label:i,tick:s,line:a,items:n}=this.attribute,r=Y.group({x:0,y:0,zIndex:1,pickable:!1});if(r.name=gt.axisContainer,r.id=this._getNodeId("container"),r.setMode(this.mode),this.axisContainer=r,t.add(r),a&&a.visible&&this.renderLine(r),n&&n.length&&(this.data=this._transformItems(n[0]),s&&s.visible&&this.renderTicks(r),i&&i.visible)){const l=Y.group({x:0,y:0,pickable:!1});l.name=gt.labelContainer,l.id=this._getNodeId("label-container"),this.axisLabelsContainer=l,r.add(l),n.forEach((h,d)=>{const c=this.renderLabels(l,h,d),u=c.getChildren();this.beforeLabelsOverlap(u,h,c,d,n.length),this.handleLabelsOverlap(u,h,c,d,n.length),this.afterLabelsOverlap(u,h,c,d,n.length);let g=0,p=0,_="center",m="middle";u.forEach(v=>{var b;const y=v.attribute,f=(b=y.angle)!==null&&b!==void 0?b:0,x=v.AABBBounds;let M=x.width(),k=x.height();f&&(M=Math.abs(M*Math.cos(f)),k=Math.abs(k*Math.sin(f))),g=Math.max(g,M),p=Math.max(p,k),_=y.textAlign,m=y.textBaseline}),this.axisLabelLayerSize[d]={width:g,height:p,textAlign:_,textBaseline:m}})}e&&e.visible&&this.renderTitle(r)}renderTicks(t){const e=this.getTickLineItems(),i=Y.group({x:0,y:0,pickable:!1});i.name=gt.tickContainer,i.id=this._getNodeId("tick-container"),t.add(i),e.forEach((a,n)=>{var r;const l=Y.line(Object.assign({},this._getTickLineAttribute("tick",a,n,e)));if(l.name=gt.tick,l.id=this._getNodeId(a.id),W((r=this.attribute.tick)===null||r===void 0?void 0:r.state))l.states=R;else{const h=this.data[n],d=A({},R,this.attribute.tick.state);Object.keys(d).forEach(c=>{E(d[c])&&(d[c]=d[c](h.rawValue,n,h,this.data))}),l.states=d}i.add(l)}),this.tickLineItems=e;const{subTick:s}=this.attribute;if(s&&s.visible){const a=this.getSubTickLineItems();a.length&&a.forEach((n,r)=>{const l=Y.line(Object.assign({},this._getTickLineAttribute("subTick",n,r,e)));if(l.name=gt.subTick,l.id=this._getNodeId(`${r}`),W(s.state))l.states=R;else{const h=A({},R,s.state);Object.keys(h).forEach(d=>{E(h[d])&&(h[d]=h[d](n.value,r,n,e))}),l.states=h}i.add(l)}),this.subTickLineItems=a}}renderLabels(t,e,i){const{dataFilter:s}=this.attribute.label;s&&E(s)&&(e=s(e,i));const a=this._transformItems(e),n=Y.group({x:0,y:0,pickable:!1});return n.name=`${gt.labelContainer}-layer-${i}`,n.id=this._getNodeId(`label-container-layer-${i}`),t.add(n),a.forEach((r,l)=>{var h;const d=this._getLabelAttribute(r,l,a,i),c=Nr(d);if(c.name=gt.label,c.id=this._getNodeId(`layer${i}-label-${r.id}`),W((h=this.attribute.label)===null||h===void 0?void 0:h.state))c.states=R;else{const u=A({},R,this.attribute.label.state);Object.keys(u).forEach(g=>{E(u[g])&&(u[g]=u[g](r,l,a,i))}),c.states=u}n.add(c)}),n}renderTitle(t){const e=this.getTitleAttribute(),i=new Oe(Object.assign({},e));i.name=gt.title,i.id=this._getNodeId("title"),t.add(i)}getVerticalCoord(t,e,i){return Xn(t,this.getVerticalVector(e,i,t))}getTextAlign(t){let e="center";return pi(t[0],0)?pi(t[1],0)?Object.is(t[1],-0)?e="start":Object.is(t[0],-0)&&(e="end"):e="center":t[0]>0?e="start":t[0]<0&&(e="end"),e}getTickLineItems(){const{tick:t}=this.attribute,e=this.data,i=[],{alignWithLabel:s,inside:a=!1,length:n,dataFilter:r}=t;let l=1;return e.length>=2&&(l=e[1].value-e[0].value),(r&&E(r)?r(e):e).forEach(h=>{let d=h.point,c=h.value;if(!s){const g=h.value-l/2;if(this.isInValidValue(g))return;d=this.getTickCoord(g),c=g}const u=this.getVerticalCoord(d,n,a);if(this.mode==="3d"){const g=this.getVerticalVector(n,a,d);let p=0,_=0;Pe(g[0])>Pe(g[1])?p=_i/2*(u.x>d.x?1:-1):_=_i/2*(u.y>d.y?-1:1),i.push({start:d,end:u,value:c,id:`tick-${h.id}`,anchor:[d.x,d.y],alpha:p,beta:_})}else i.push({start:d,end:u,value:c,id:`tick-${h.id}`})}),i}getSubTickLineItems(){const{subTick:t}=this.attribute,e=[],{count:i=4,inside:s=!1,length:a=2}=t,n=this.tickLineItems,r=n.length;if(r>=2)for(let l=0;l<r-1;l++){const h=n[l],d=n[l+1];for(let c=0;c<i;c++){const u=(c+1)/(i+1),g=(1-u)*h.value+u*d.value,p=this.getTickCoord(g),_=this.getVerticalCoord(p,a,s);e.push({start:p,end:_,value:g,id:`sub-tick-${g}`})}}return e}_getTickLineAttribute(t,e,i,s){let a=$(this.attribute,`${t}.style`);const n=this.data[i];a=E(a)?A({},$(ns,`${t}.style`),t==="tick"?a(n.rawValue,i,n,this.data):a(e.value,i,e,s)):a;const{start:r,end:l,anchor:h,alpha:d,beta:c}=e;return Object.assign({points:[r,l],anchor:h,alpha:d,beta:c},a)}_getLabelAttribute(t,e,i,s){var a,n;const{space:r=4,inside:l=!1,formatMethod:h,type:d="text",text:c}=this.attribute.label;let u=r,g=0;!((a=this.attribute.tick)===null||a===void 0)&&a.visible&&this.attribute.tick.inside===l&&(g=this.attribute.tick.length||4),!((n=this.attribute.subTick)===null||n===void 0)&&n.visible&&this.attribute.subTick.inside===l&&(g=Math.max(g,this.attribute.subTick.length||2)),u+=g;const p=this.getRelativeVector(t.point);s>0&&(p[1]===0?u+=(this.axisLabelLayerSize[s-1].height+$(this.attribute,"label.space",4))*s:u+=(this.axisLabelLayerSize[s-1].width+$(this.attribute,"label.space",4))*s);const _=this.getVerticalCoord(t.point,u,l),m=this.getVerticalVector(u||1,l,_),v=h?h(`${t.label}`,t,e,i,s):t.label;let{style:b}=this.attribute.label;b=E(b)?A({},ns.label.style,b(t,e,i,s)):b;const y=this.getLabelAlign(m,l,b.angle);return b=A(y,b),E(b.text)&&(b.text=b.text({label:t.label,value:t.rawValue,index:t.index,layer:s})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(_,m,v,b)),{text:c??v,_originText:t.label,lineHeight:b==null?void 0:b.fontSize,type:d}),b)}getLabelPosition(t,e,i,s){return t}_transformItems(t){const e=[];return t.forEach(i=>{var s;e.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(s=i.id)!==null&&s!==void 0?s:i.label}))}),e}release(){super.release(),this._prevInnerView=null,this._innerView=null}}function $l(o,t,e,i,s){return{x:(o-i)*Math.cos(e)+(t-s)*Math.sin(e)+i,y:(o-i)*Math.sin(e)+(s-t)*Math.cos(e)+s}}function Kl(o){const t=o.AABBBounds;return{x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,centerX:o.attribute.x,centerY:o.attribute.y,angle:o.attribute.angle}}function Nn(o){o.forEach(t=>{if(t.rotatedBounds||!t.attribute.angle)return;const e=Kl(t),i=$l(e.centerX,e.centerY,e.angle,t.attribute.x,t.attribute.y),s=i.x-e.centerX,a=i.y-e.centerY;e.x1+=s,e.x2+=s,e.y1+=a,e.y2+=a,e.centerX+=s,e.centerY+=a,t.rotatedBounds=e})}function ql(o,t){return Wr(o.AABBBounds,t.AABBBounds,!1)&&(!o.rotatedBounds||!t.rotatedBounds||$r(o.rotatedBounds,t.rotatedBounds,!0))}const _a={parity:function(o){return o.filter((t,e)=>e%2?t.setAttribute("opacity",0):1)},greedy:function(o,t){let e;return o.filter((i,s)=>s&&Ss(e,i,t)?i.setAttribute("opacity",0):(e=i,1))}};function Ss(o,t,e){const i=o.AABBBounds,s=t.AABBBounds;return e>Math.max(s.x1-i.x2,i.x1-s.x2,s.y1-i.y2,i.y1-s.y2)&&(!o.rotatedBounds||!t.rotatedBounds||e>Math.max(t.rotatedBounds.x1-o.rotatedBounds.x2,o.rotatedBounds.x1-t.rotatedBounds.x2,t.rotatedBounds.y1-o.rotatedBounds.y2,o.rotatedBounds.y1-t.rotatedBounds.y2))}function ma(o,t){for(let e,i=1,s=o.length,a=o[0];i<s;a=e,++i)if(Ss(a,e=o[i],t))return!0}function Ql(o){const t=o.AABBBounds;return t.width()>1&&t.height()>1}function Jl(o){return o.forEach(t=>t.setAttribute("opacity",1)),o}function th(o,t){if(W(o))return;const e=o.filter(Ql);if(W(e))return;let i;i=Jl(e),Nn(i);const{method:s="parity",separation:a=0}=t,n=E(s)?s:_a[s]||_a.parity;if(i.length>=3&&ma(i,a)){do i=n(i,a);while(i.length>=3&&ma(i,a));if(i.length<3||t.lastVisible){const r=Ce(e);if(!r.attribute.opacity){const l=i.length;if(l>1){r.setAttribute("opacity",1);for(let h=l-1;h>=0&&Ss(i[h],r,a);h--)i[h].setAttribute("opacity",0)}}}}e.forEach(r=>{r.setAttribute("visible",!!r.attribute.opacity)})}function eh(o,t){if(W(o))return;const{orient:e,labelRotateAngle:i=[0,45,90]}=t;if(i.length===0||o.some(n=>!!n.attribute.angle))return;let s=0,a=0;for(i&&i.length>0&&(a=i.length);s<a;){const n=i[s++];if(o.forEach(r=>{r.attribute.angle=ae(n)}),sh(e,o),!ih(o))break}}function ih(o){for(let t=1;t<o.length;t++)if(ql(o[t-1],o[t]))return!0;return!1}function sh(o,t){o!=="bottom"&&o!=="top"||nh(o,t),o!=="left"&&o!=="right"||ah(o,t),Nn(t)}function Zi(o=0){if(o<0)for(;o<0;)o+=2*Math.PI;if(o>0)for(;o>=2*Math.PI;)o-=2*Math.PI;return o}function ah(o,t){t.forEach((e,i)=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},$n(o,e.attribute.angle)),{angle:Zi(e.attribute.angle)}))})}function nh(o,t){t.forEach(e=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},Wn(o,e.attribute.angle)),{angle:Zi(e.attribute.angle)}))})}function Wn(o,t=0){let e=["center","left","left","left","center","right","right","right","left"],i=["top","top","middle","bottom","bottom","bottom","middle","top","top"];o==="top"&&(e=["center","right","right","right","center","left","left","left","right"],i=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);const s=(t=Zi(t))/(.5*Math.PI);let a;return a=s===Math.floor(s)?2*Math.floor(s):2*Math.floor(s)+1,{textAlign:e[a],textBaseline:i[a]}}function $n(o,t=0){let e=["right","right","center","left","center","left","center","right","right"],i=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];o==="right"&&(e=["left","right","right","right","left","left","left","left","right"],i=["middle","bottom","middle","top","top","top","middle","bottom","bottom"]);const s=(t=Zi(t))/(.5*Math.PI);let a;return a=s===Math.floor(s)?2*Math.floor(s):2*Math.floor(s)+1,{textAlign:e[a],textBaseline:i[a]}}function rh(o,t){const{limitLength:e,verticalLimitLength:i,ellipsis:s="...",orient:a,axisLength:n}=t;if(W(o)||!w(e))return;const r=Math.sin(Math.PI/10);o.forEach(l=>{var h;const d=l.attribute.angle,c=!C(d),u=c?Math.cos(d):1,g=c?Math.sin(d):0,p=!c||Math.abs(g)<=r,_=c&&Math.abs(u)<=r,m=a==="top"||a==="bottom";if(m&&(_&&Math.floor(l.AABBBounds.height())<=e||p&&Math.floor(l.AABBBounds.width())<=i))return;const v=l.attribute.direction;if(!m&&(v==="vertical"&&Math.floor(l.AABBBounds.height())<=i||v!=="vertical"&&(p&&Math.floor(l.AABBBounds.width())<=e||_&&Math.floor(l.AABBBounds.height())<=i)))return;let b=null;if(p||_)b=m?p?i:e:v==="vertical"||_?i:e;else if(m){const{x1:y,x2:f}=l.AABBBounds,x=g/u;b=x>0&&y<=n&&e/x+y>n?(n-y)/Math.abs(u):x<0&&f>=0&&e/x+f<0?f/Math.abs(u):Math.abs(e/g)}else b=Math.abs(e/u);w(l.attribute.maxLineWidth)&&(b=w(b)?Math.min(l.attribute.maxLineWidth,b):l.attribute.maxLineWidth),l.setAttributes({maxLineWidth:b,ellipsis:(h=l.attribute.ellipsis)!==null&&h!==void 0?h:s})})}function oh(o,t,e,i,s){if(i==="right"||i==="left"){if(s==="left"){const a=i==="right"?0:-1;o.forEach(n=>{n.setAttributes({x:t+e*a,textAlign:"left"})})}else if(s==="right"){const a=i==="right"?1:0;o.forEach(n=>{n.setAttributes({x:t+e*a,textAlign:"right"})})}else if(s==="center"){const a=i==="right"?1:-1;o.forEach(n=>{n.setAttributes({x:t+.5*e*a,textAlign:"center"})})}}else if(i==="bottom"||i==="top"){if(s==="top"){const a=i==="bottom"?0:-1;o.forEach(n=>{n.setAttributes({y:t+e*a,textBaseline:"top"})})}else if(s==="bottom"){const a=i==="bottom"?1:0;o.forEach(n=>{n.setAttributes({y:t+e*a,textBaseline:"bottom"})})}else if(s==="middle"){const a=i==="bottom"?1:-1;o.forEach(n=>{n.setAttributes({y:t+.5*e*a,textBaseline:"middle"})})}}}class Kn{isInValidValue(t){return t<0||t>1}getTickCoord(t){const{start:e}=this.attribute,i=this.getRelativeVector();return{x:e.x+i[0]*t,y:e.y+i[1]*t}}getRelativeVector(t){const{start:e,end:i}=this.attribute;return[i.x-e.x,i.y-e.y]}getVerticalVector(t,e=!1,i){const{verticalFactor:s=1}=this.attribute,a=this.getRelativeVector(),n=Yl(a),r=[n[1],-1*n[0]];return Vl(r,t*(e?1:-1)*s)}}function lh(){Qt(),De(),qr(),Qr()}function hh(){lh(),gs()}function dh(){Qt(),Kr()}var va=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};hh();class Je extends Wl{constructor(t,e){super(e!=null&&e.skipDefault?t:A({},Je.defaultAttributes,t),e)}_renderInner(t){var e;super._renderInner(t);const{panel:i}=this.attribute;if(i&&i.visible){const s=this.axisContainer,a=s.AABBBounds,n=Y.rect(Object.assign({x:a.x1,y:a.y1,width:a.width(),height:a.height()},i.style));n.name=gt.background,n.id=this._getNodeId("background"),n.states=A({},fe,(e=i.state)!==null&&e!==void 0?e:{}),s.insertBefore(n,s.firstChild)}}renderLine(t){const{start:e,end:i,line:s}=this.attribute,a=s,{startSymbol:n,endSymbol:r,style:l,breakRange:h,breakShape:d,breakShapeStyle:c,state:u}=a,g=va(a,["startSymbol","endSymbol","style","breakRange","breakShape","breakShapeStyle","state"]),p=Object.assign({points:[e,i],startSymbol:n,endSymbol:r,lineStyle:l},g);W(u)||(p.state={line:A({},fe,u),symbol:A({},fe,u)});const _=new zt(p);_.name=gt.line,_.id=this._getNodeId("line"),t.add(_)}getTitleAttribute(){var t,e,i;const s=this.attribute.title,{position:a="middle",space:n=4,textStyle:r={},autoRotate:l=!0,shape:h,background:d,state:c={},maxWidth:u}=s,g=va(s,["position","space","textStyle","autoRotate","shape","background","state","maxWidth"]);let p=.5;a==="start"?p=0:a==="end"&&(p=1);const{verticalFactor:_=1}=this.attribute,m=-1*_,v=this.getTickCoord(p),b=this.getRelativeVector();let y=0;if(!((t=this.attribute.label)===null||t===void 0)&&t.visible&&this.attribute.label.inside===!1){const G=+$(this.attribute,"label.space",4);y+=G;const Q=Object.keys(this.axisLabelLayerSize).length;if(b[1]===0){const Z=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(Z)?y+=Z+(Q-1)*G:y=0}else{if(b[0]===0){const At=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.width():0;isFinite(At)?y+=At+(Q-1)*G:y=0}else Object.keys(this.axisLabelLayerSize).forEach((At,_e)=>{y+=this.axisLabelLayerSize[At].width+(_e>0?G:0)});const Z=this.axisLabelLayerSize[0].textAlign,N=Z==="start"||Z==="left",K=Z==="center",Mt=b[1]>0;y=m===1?Mt?N?y:K?y/2:G:N?G:K?y/2:y:Mt?N?G:K?y/2:y:N?y:K?y/2:G}}let f=0;!((e=this.attribute.tick)===null||e===void 0)&&e.visible&&this.attribute.tick.inside===!1&&(f=this.attribute.tick.length||4),!((i=this.attribute.subTick)===null||i===void 0)&&i.visible&&this.attribute.subTick.inside===!1&&(f=Math.max(f,this.attribute.subTick.length||2));const x=f+y+n,M=this.getVerticalCoord(v,x,!1),k=this.getVerticalVector(x,!1,{x:0,y:0});let D,O,{angle:T}=g;if(D=a==="start"?"start":a==="end"?"end":"center",C(T)&&l){T=Gl(b,[1,0],!0);const{verticalFactor:G=1}=this.attribute;O=-1*G===1?"bottom":"top"}else D=this.getTextAlign(k),O=this.getTextBaseline(k,!1);let B=u;if(C(B)){const{verticalLimitSize:G,verticalMinSize:Q,orient:Z}=this.attribute,N=Math.min(G||1/0,Q||1/0);if(w(N))if(Z==="bottom"||Z==="top")if(T!==Math.PI/2){const K=Math.abs(Math.cos(T??0));B=K<1e-6?1/0:this.attribute.end.x/K}else B=N-x;else if(T&&T!==0){const K=Math.abs(Math.sin(T));B=K<1e-6?1/0:this.attribute.end.y/K}else B=N-x}const H=Object.assign(Object.assign(Object.assign({},M),g),{maxWidth:B,textStyle:Object.assign({textAlign:D,textBaseline:O},r),state:{text:A({},fe,c.text),shape:A({},fe,c.shape),panel:A({},fe,c.background)}});return H.angle=T,h&&h.visible&&(H.shape=Object.assign({visible:!0},h.style),h.space&&(H.space=h.space)),d&&d.visible&&(H.panel=Object.assign({visible:!0},d.style)),H}getTextBaseline(t,e){let i="middle";const{verticalFactor:s=1}=this.attribute,a=(e?1:-1)*s;return pi(t[1],0)?i=!pi(t[0],0)||Object.is(t[0],-0)||Object.is(t[1],-0)?"middle":a===1?"bottom":"top":t[1]>0?i="top":t[1]<0&&(i="bottom"),i}getLabelAlign(t,e,i){const s=this.attribute.orient;if(["top","bottom","right","left"].includes(s)||t[0]===0&&t[1]===0){if(s==="top"||s==="bottom")return Wn(e?s==="bottom"?"top":"bottom":s,i);if(s==="left"||s==="right")return $n(e?s==="left"?"right":"left":s,i)}return{textAlign:this.getTextAlign(t),textBaseline:this.getTextBaseline(t,e)}}beforeLabelsOverlap(t,e,i,s,a){var n,r,l,h;const{flush:d=!1}=this.attribute.label||{};if(d&&t.length){const{orient:c,start:u,end:g}=this.attribute,p=c==="bottom"||c==="top",_=t[0],m=Ce(t),v=p?_.attribute.x>m.attribute.x:_.attribute.y<m.attribute.y;if(p){const b=v?m:_,y=v?_:m,f=u.x,x=g.x,M=b.AABBBounds.x1,k=y.AABBBounds.x2;M<f&&(b.attribute.angle?b.setAttributes({dx:((n=b.attribute.dx)!==null&&n!==void 0?n:0)+f-M}):b.setAttributes({x:f,textAlign:"left"})),k>x&&(y.attribute.angle?y.setAttributes({dx:((r=y.attribute.dx)!==null&&r!==void 0?r:0)+x-k}):y.setAttributes({x,textAlign:"right"}))}else{const b=v?m:_,y=v?_:m,f=b.AABBBounds.y2,x=y.AABBBounds.y1,M=u.y,k=g.y;x<M&&(y.attribute.angle?y.setAttributes({dy:((l=y.attribute.dy)!==null&&l!==void 0?l:0)+M-x}):y.setAttributes({y:M,textBaseline:"top"})),f>k&&(b.attribute.angle?b.setAttributes({dy:((h=b.attribute.dy)!==null&&h!==void 0?h:0)+k-f}):b.setAttributes({y:k,textBaseline:"bottom"}))}}}handleLabelsOverlap(t,e,i,s,a){if(W(t))return;const{verticalLimitSize:n,label:r,orient:l}=this.attribute,h=this._getAxisLabelLimitLength(n,a),{layoutFunc:d,autoRotate:c,autoRotateAngle:u,autoLimit:g,limitEllipsis:p,autoHide:_,autoHideMethod:m,autoHideSeparation:v,lastVisible:b}=r;if(E(d))d(t,e,s,this);else{if(c&&eh(t,{labelRotateAngle:u,orient:l}),g&&w(h)&&h>0){const y=l==="left"||l==="right",f=Math.abs(y?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x),x=y?f/t.length:_||c?1/0:f/t.length;rh(t,{limitLength:h,verticalLimitLength:x,ellipsis:p,orient:l,axisLength:f})}_&&th(t,{orient:l,method:m,separation:v,lastVisible:b})}}afterLabelsOverlap(t,e,i,s,a){const{verticalLimitSize:n,orient:r}=this.attribute,l=r==="bottom"||r==="top",h=i.AABBBounds;let d=l?h.height():h.width();const{verticalMinSize:c}=this.attribute;if(w(c)&&(!w(n)||c<=n)){const u=this._getAxisLabelLimitLength(c,a);let g,p;d=Math.max(d,u),r==="left"?(g=h.x2-d,p=h.y1):r==="right"?(g=h.x1,p=h.y1):r==="top"?(g=h.x1,p=h.y2-d):r==="bottom"&&(g=h.x1,p=h.y1);const _=Y.rect({x:g,y:p,width:l?h.width():d,height:l?d:h.height(),pickable:!1});_.name=gt.axisLabelBackground,_.id=this._getNodeId("axis-label-background"),i.insertBefore(_,i.firstChild)}if(S(this.attribute.label.containerAlign)){let u;r==="left"?u=h.x2:r==="right"?u=h.x1:r==="top"?u=h.y2:r==="bottom"&&(u=h.y1),oh(t,u,d,r,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(t,e){var i,s,a,n,r;const{label:l,title:h,line:d,tick:c}=this.attribute,u=(i=l.space)!==null&&i!==void 0?i:4;let g=t,p=0,_=0;const m=d&&d.visible?(s=d.style.lineWidth)!==null&&s!==void 0?s:1:0,v=c&&c.visible?(a=c.length)!==null&&a!==void 0?a:4:0;if(h&&h.visible&&typeof h.text=="string"){p=Jr(h.text,h.textStyle,(r=(n=this.stage)===null||n===void 0?void 0:n.getTheme())===null||r===void 0?void 0:r.text).height;const b=un(h.padding);_=h.space+b[0]+b[2]}return g&&(g=(g-u-_-p-m-v)/e),g}}Je.defaultAttributes=ns,kt(Je,Kn);class ch extends us{constructor(){super(...arguments),this.mode=to.NORMAL}onBind(){const t=this.target.getInnerView(),e=this.target.getPrevInnerView();e&&(this._newElementAttrMap={},Le(t,i=>{var s,a,n,r,l,h;if(i.type!=="group"&&i.id){const d=e[i.id];if(d){if(!ge(i.attribute,d.attribute)){const c=gi(i.attribute);this._newElementAttrMap[i.id]={state:"update",node:i,attrs:Object.assign(Object.assign({},c),{opacity:(s=c.opacity)!==null&&s!==void 0?s:1,fillOpacity:(a=c.fillOpacity)!==null&&a!==void 0?a:1,strokeOpacity:(n=c.strokeOpacity)!==null&&n!==void 0?n:1})},i.setAttributes(d.attribute)}}else{const c={opacity:(r=i.attribute.opacity)!==null&&r!==void 0?r:1,fillOpacity:(l=i.attribute.fillOpacity)!==null&&l!==void 0?l:1,strokeOpacity:(h=i.attribute.strokeOpacity)!==null&&h!==void 0?h:1};this._newElementAttrMap[i.id]={state:"enter",node:i,attrs:c},i.setAttributes({opacity:0,fillOpacity:0,strokeOpacity:0})}}}))}onStart(){let t=this.duration,e=this.easing;this._newElementAttrMap&&Object.keys(this._newElementAttrMap).forEach(i=>{var s;const{node:a,attrs:n,state:r}=this._newElementAttrMap[i];if(r==="enter"){const{enter:l={}}=(s=this.params)!==null&&s!==void 0?s:{};t=w(l.duration)?l.duration:t,e=l.easing?l.easing:e}a.type==="path"?a.animate({interpolate:(l,h,d,c,u)=>l==="path"&&(u.path=eo(d,c)(h),!0)}).to(n,t,e):a.animate().to(n,t,e)})}onUpdate(t,e,i){}}const oe=o=>o.map((t,e)=>({index:e,value:t}));function qn(o,t,e){return e>Math.max(t.x1-o.x2,o.x1-t.x2,t.y1-o.y2,o.y1-t.y2)}function uh(o,t){for(let e,i=1,s=o.length,a=o[0];i<s;a=e,++i)if(e=o[i],qn(a.AABBBounds,e.AABBBounds,t))return!0;return!1}const ui=(o,t,e,i)=>e<o?Math.max(o-t/2,e):e>o?Math.min(o-t/2,e-t):e<i?e:e-t,Qn=(o,t,e)=>{var i;const{labelStyle:s,axisOrientType:a,labelFlush:n,labelFormatter:r,startAngle:l=0}=e;let h=(i=s.angle)!==null&&i!==void 0?i:0;s.direction==="vertical"&&(h+=ae(90));const d=["bottom","top"].includes(a),c=["left","right"].includes(a);let u=1,g=0;d||(c?(u=0,g=1):l&&(u=Math.cos(l),g=-Math.sin(l)));const p=io(s),_=o.range();return t.map((v,b)=>{var y,f;const x=r?r(v):`${v}`,{width:M,height:k}=p.quickMeasure(x),D=Math.max(M,12),O=Math.max(k,12),T=o.scale(v),B=u*T,H=g*T;let G,Q,Z=B,N=H;n&&d&&b===0?Z=ui(B,D,_[0],_[_.length-1]):n&&d&&b===t.length-1?Z=ui(B,D,_[_.length-1],_[0]):G=(y=s.textAlign)!==null&&y!==void 0?y:"center",G==="right"?Z-=D:G==="center"&&(Z-=D/2),n&&c&&b===0?N=ui(H,O,_[0],_[_.length-1]):n&&c&&b===t.length-1?N=ui(H,O,_[_.length-1],_[0]):Q=(f=s.textBaseline)!==null&&f!==void 0?f:"middle",Q==="bottom"?N-=O:Q==="middle"&&(N-=O/2);const K=new so().set(Z,N,Z+D,N+O);return h&&K.rotate(h,B,H),K})},gh=o=>["bottom","top","z"].includes(o);class ph{nice(t=10,e){var i,s,a,n;const r=this._domain;let l=[],h=null;if(e){const d=ao(r,e);if(l=d.niceMinMax,this._domainValidator=d.domainValidator,h=d.niceType,d.niceDomain)return this._niceDomain=d.niceDomain,this.rescale(),this}else h="all";if(h){const d=no(r.slice(),(s=(i=this.getNiceConfig)===null||i===void 0?void 0:i.call(this))!==null&&s!==void 0?s:{floor:c=>Math.floor(c),ceil:c=>Math.ceil(c)});return h==="min"?d[d.length-1]=(a=l[1])!==null&&a!==void 0?a:d[d.length-1]:h==="max"&&(d[0]=(n=l[0])!==null&&n!==void 0?n:d[0]),this._niceDomain=d,this.rescale(),this}return this}niceMin(){const t=this._domain[this._domain.length-1];this.nice();const e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){const t=this._domain[0];this.nice();const e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}}function ya(o){return t=>-o(-t)}function ba(o=Number.EPSILON){return t=>Math.max(t,o)}function _h(o=Number.EPSILON){return t=>Math.min(t,-o)}class Ni extends ro{constructor(){super(Xs(10),Gs(10)),this.type=_s.Log,this._limit=ba(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return new Ni().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(t){var e;if(t)return this;super.rescale();const i=Xs(this._base),s=Gs(this._base);return((e=this._niceDomain)!==null&&e!==void 0?e:this._domain)[0]<0?(this._logs=ya(i),this._pows=ya(s),this._limit=_h(),this.transformer=oo,this.untransformer=lo):(this._logs=i,this._pows=s,this._limit=ba(),this.transformer=this._logs,this.untransformer=s),this}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._limit(this._clamp(t))));return this._fishEyeTransform?this._fishEyeTransform(i):i}base(t,e){return arguments.length?(this._base=t,this.rescale(e)):this._base}tickFormat(){return ho}d3Ticks(t=10,e){const i=this.domain(),s=this._limit(i[0]),a=this._limit(i[i.length-1]);return co(s,a,t,this._base,this.transformer,this.untransformer,e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return uo(this._limit(e[0]),this._limit(e[e.length-1]),t,this._base,this.transformer,this.untransformer)}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return Us(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return Us(this._limit(e[0]),this._limit(e[e.length-1]),t,this.transformer,this.untransformer)}getNiceConfig(){return{floor:t=>this._pows(Math.floor(this._logs(this._limit(t)))),ceil:t=>Math.abs(t)>=1?Math.ceil(t):this._pows(Math.ceil(this._logs(this._limit(t))))}}}kt(Ni,ph);const As=(o,t)=>{if(!et(o.type))return oe(o.domain());const e=o.range(),i=Math.abs(e[e.length-1]-e[0]);if(i<2)return oe([o.domain()[0]]);const{tickCount:s,forceTickCount:a,tickStep:n,noDecimals:r=!1,labelStyle:l}=t;let h;if(S(n))h=o.stepTicks(n);else if(S(a))h=o.forceTicks(a);else if(t.tickMode==="d3"){const d=E(s)?s({axisLength:i,labelStyle:l}):s;h=o.d3Ticks(d??5,{noDecimals:r})}else{const d=E(s)?s({axisLength:i,labelStyle:l}):s,c=E(t.tickMode)?t.tickMode:void 0;h=o.ticks(d??5,{noDecimals:r,customTicks:c})}if(t.sampling&&(t.coordinateType==="cartesian"||t.coordinateType==="polar"&&t.axisOrientType==="radius")){const{labelGap:d=4,labelFlush:c}=t;let u=Qn(o,h,t).map((p,_)=>({AABBBounds:p,value:h[_]}));for(;u.length>=3&&uh(u,d);)u=mh.parity(u);const g=u.map(p=>p.value);g.length<3&&c&&(g.length>1&&g.pop(),Ce(g)!==Ce(h)&&g.push(Ce(h))),h=g}return oe(h)},mh={parity:function(o){return o.filter((t,e)=>e%2==0)},greedy:function(o,t){let e;return o.filter((i,s)=>(!s||!qn(e.AABBBounds,i.AABBBounds,t))&&(e=i,!0))}},fa=(o,t,e,i)=>Qn(o,t,e).map(s=>i?[s.x1,s.x2,s.width()]:[s.y1,s.y2,s.height()]),xa=(o,t,e=0)=>Math.max(o[0],t[0])-e/2<=Math.min(o[1],t[1])+e/2,Sa=(o,t)=>o[1]<t[0]?t[0]-o[1]:t[1]<o[0]?o[0]-t[1]:0,vh=(o,t)=>{var e;const i=o.domain();if(!i.length)return[];const{tickCount:s,forceTickCount:a,tickStep:n,labelGap:r=4,axisOrientType:l,labelStyle:h}=t,d=gh(l),c=o.range(),u=o.calculateWholeRangeSize();if(u<2)return t.labelLastVisible?oe([i[i.length-1]]):oe([i[0]]);let g;if(S(n))g=o.stepTicks(n);else if(S(a))g=o.forceTicks(a);else if(S(s)){const p=E(s)?s({axisLength:u,labelStyle:h}):s;g=o.ticks(p)}else if(t.sampling){const p=((e=t.labelStyle.fontSize)!==null&&e!==void 0?e:12)+2,_=Ft(c),m=Bt(c);if(i.length<=u/p){const v=(m-_)/i.length,b=fa(o,i,t,d),y=Math.min(...b.map(x=>x[2])),f=yh(i,b,r,t.labelLastVisible,Math.floor(y/v),!1);g=o.stepTicks(f.step),t.labelLastVisible&&(f.delCount&&(g=g.slice(0,g.length-f.delCount)),g.push(i[i.length-1]))}else{const v=[i[0],i[Math.floor(i.length/2)],i[i.length-1]],b=fa(o,v,t,d);let y=null;b.forEach(x=>{y?y[2]<x[2]&&(y=x):y=x});const f=m-_-r>0?Math.ceil(i.length*(r+y[2])/(m-_-r)):i.length-1;g=o.stepTicks(f),!t.labelLastVisible||g.length&&g[g.length-1]===i[i.length-1]||(g.length&&Math.abs(o.scale(g[g.length-1])-o.scale(i[i.length-1]))<y[2]&&(g=g.slice(0,-1)),g.push(i[i.length-1]))}}else g=o.domain();return oe(g)},yh=(o,t,e,i,s,a)=>{let n=0,r=0,l=-1,h=Number.MAX_VALUE;const d=g=>{let p=!0,_=0;do _+g<o.length&&xa(t[_],t[_+g],e)&&(p=!1),_+=g;while(p&&_<o.length);return p},c=go(s,o.length,g=>d(g)?1:-1);let u=c;do if(u>c&&!a&&!d(u))u++;else{if(!i){r=u;break}{const g=o.length-1;let p,_=0;p=o.length%u>0?o.length-o.length%u+u:o.length;do{if(p-=u,p!==g&&!xa(t[p],t[g],e))break;_++}while(p>0);if(p===g){r=u,n=_;break}{const m=Math.floor(o.length/u)-_+1;if(m<l)break;{l=m;const v=Sa(t[p],t[g]),b=p-u>=0?Sa(t[p-u],t[p]):v,y=Math.abs(v-b);if(y<h&&(h=y,r=u,n=_),v<=b)break}}}u++}while(u<=o.length);return{step:r,delCount:n}};function rs(o,t,e,i){let s="";if(!o||t.length===0)return s;const a=t[0],n=We.distancePP(o,a),r=e?0:1;return i?s+=`M${o.x},${o.y-n}A${n},${n},0,0,${r},${o.x},${o.y+n}A${n},${n},0,0,${r},${o.x},${o.y-n}Z`:t.forEach((l,h)=>{h===0?s=`M${l.x},${l.y}`:s+=`A${n},${n},0,0,${r},${l.x},${l.y}`}),s}function bh(o,t,e){const{type:i,closed:s}=e,a=t.slice(0).reverse();let n="",r="";if(i==="line"&&e.smoothLink&&e.center){const l=o[0],h=a[0],d=e.center;n=ke(o,!!s),r=ke(a,!!s);const c=We.distancePP(h,d),u=We.distancePP(l,d);n+=`A${c},${c},0,0,1,${h.x},${h.y}L${h.x},${h.y}`,r+=`A${u},${u},0,0,0,${l.x},${l.y}`}else if(i==="circle"){const{center:l}=e;n=rs(l,o,!1,!!s),r=rs(l,a,!0,!!s)}else i!=="line"&&i!=="polygon"||(n=ke(o,!!s),r=ke(a,!!s));return s?n+=r:(r="L"+r.substring(1),n+=r,n+="Z"),n}class Be extends qt{constructor(){super(...arguments),this.name="axis-grid",this.data=[]}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}render(){this._prevInnerView=this._innerView&&Yn(this._innerView),this.removeAllChild(!0),this._innerView=Y.group({x:0,y:0,pickable:!1}),this.add(this._innerView);const{items:t,visible:e}=this.attribute;t&&t.length&&e!==!1&&(this.data=this._transformItems(t),this._renderGrid(this._innerView))}getVerticalCoord(t,e,i){return Xn(t,this.getVerticalVector(e,i,t))}_transformItems(t){const e=[];return t.forEach(i=>{var s;e.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(s=i.id)!==null&&s!==void 0?s:i.label}))}),e}_renderGrid(t){const{visible:e}=this.attribute.subGrid||{};e&&this._renderGridByType(!0,t),this._renderGridByType(!1,t)}_renderGridByType(t,e){const i=A({},this.attribute,this.getGridAttribute(t)),{type:s,items:a,style:n,closed:r,alternateColor:l,depth:h=0}=i,d=t?`${gt.grid}-sub`:`${gt.grid}`;if(a.forEach((c,u)=>{const{id:g,points:p}=c;let _="";if(s==="line"||s==="polygon")_=ke(p,!!r);else if(s==="circle"){const{center:v}=this.attribute;_=rs(v,p,!1,!!r)}const m=Y.path(Object.assign({path:_,z:h},E(n)?A({},this.skipDefault?null:Be.defaultAttributes.style,n(c,u)):n));m.name=`${d}-line`,m.id=this._getNodeId(`${d}-path-${g}`),e.add(m)}),h&&s==="line"&&a.forEach((c,u)=>{const{id:g,points:p}=c,_=[];_.push(p[0]);const m=p[1].x-p[0].x,v=p[1].y-p[0].y,b=Math.sqrt(m*m+v*v),y=h/b;_.push({x:p[0].x+m*y,y:p[0].y+v*y});const f=ke(_,!!r),x=Pe(_[0].x-_[1].x),M=Pe(_[0].y-_[1].y),k=Y.path(Object.assign({path:f,z:0,alpha:x>M?(p[1].x-p[0].x>0?-1:1)*_i/2:0,beta:x<M?-_i/2:0,anchor3d:x>M?[_[0].x,0]:[0,_[0].y]},E(n)?A({},this.skipDefault?null:Be.defaultAttributes.style,n(c,u)):n));k.name=`${d}-line`,k.id=this._getNodeId(`${d}-path-${g}`),e.add(k)}),a.length>1&&l){const c=U(l)?l:[l,"transparent"],u=g=>c[g%c.length];for(let g=0;g<a.length-1;g++){const[p,_]=[a[g].points,a[g+1].points],m=bh(p,_,i),v=Y.path({path:m,fill:u(g)});v.name=`${d}-region`,v.id=this._getNodeId(`${d}-region-${g}`),e.add(v)}}}_getNodeId(t){return`${this.id}-${t}`}_parseTickSegment(){let t=1;return this.data.length>=2&&(t=this.data[1].value-this.data[0].value),t}_getPointsOfSubGrid(t,e){const i=this.data.length,s=[];return i>=2&&this.data.forEach(a=>{let n=a.value;if(!e){const r=a.value-t/2;if(this.isInValidValue(r))return;n=r}s.push({value:n})}),s}release(){super.release(),this._prevInnerView=null,this._innerView=null}}Be.defaultAttributes={style:{lineWidth:1,stroke:"#999",strokeOpacity:1,lineDash:[4,4]},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#999",strokeOpacity:1,lineDash:[4,4]}}};dh();class Jn extends Be{constructor(t,e){super(e!=null&&e.skipDefault?t:A({},Be.defaultAttributes,t),e)}_getGridPoint(t,e){let i;if(t==="line"){const{length:s}=this.attribute;i=[e,this.getVerticalCoord(e,s,!0)]}else if(t==="circle"||t==="polygon"){const{center:s,sides:a=6,startAngle:n=po,endAngle:r=_o}=this.attribute,l=We.distancePP(s,e);i=Nl(s,a,l,n,r)}return i}getGridAttribute(t){const{type:e,alignWithLabel:i=!0}=this.attribute,s=this._parseTickSegment();let a,n=[];if(t){a=A({},this.attribute,this.attribute.subGrid);const r=[],{count:l=4}=this.attribute.subGrid||{};if(this.data.length>=2){const h=this._getPointsOfSubGrid(s,i);for(let d=0;d<h.length-1;d++){const c=h[d],u=h[d+1];r.push({id:`sub-${d}-0`,points:this._getGridPoint(e,this.getTickCoord(c.value)),datum:{}});for(let g=0;g<l;g++){const p=(g+1)/(l+1),_=(1-p)*c.value+p*u.value,m=this.getTickCoord(_);r.push({id:`sub-${d}-${g+1}`,points:this._getGridPoint(e,m),datum:{}})}d===h.length-2&&r.push({id:`sub-${d}-${l+1}`,points:this._getGridPoint(e,this.getTickCoord(u.value)),datum:{}})}n=r}}else{a=this.attribute;const r=[];this.data.forEach(l=>{let{point:h}=l;if(!i){const d=l.value-s/2;if(this.isInValidValue(d))return;h=this.getTickCoord(d)}r.push({id:l.label,datum:l,points:this._getGridPoint(e,h)})}),n=r}return Object.assign(Object.assign({},a),{items:n})}}kt(Jn,Kn);const Aa="M -0.0544 0.25 C -0.0742 0.25 -0.0901 0.234 -0.0901 0.2143 L -0.0901 -0.1786 C -0.0901 -0.1983 -0.0742 -0.2143 -0.0544 -0.2143 L -0.0187 -0.2143 L -0.0187 -0.5 L 0.017 -0.5 L 0.017 -0.2143 L 0.0527 -0.2143 C 0.0724 -0.2143 0.0884 -0.1983 0.0884 -0.1786 L 0.0884 0.2143 C 0.0884 0.234 0.0724 0.25 0.0527 0.25 L 0.017 0.25 L 0.017 0.5 L -0.0187 0.5 L -0.0187 0.25 L -0.0544 0.25 Z M -0.0187 -0.1429 L -0.0544 -0.1429 L -0.0544 0.1786 L -0.0187 0.1786 L -0.0187 -0.1429 Z M 0.0527 -0.1429 L 0.017 -0.1429 L 0.017 0.1786 L 0.0527 0.1786 L 0.0527 -0.1429 Z",fh={orient:"bottom",showDetail:"auto",brushSelect:!0,zoomLock:!1,minSpan:0,maxSpan:1,delayType:"throttle",delayTime:0,realTime:!0,backgroundStyle:{fill:"white",stroke:"#D1DBEE",lineWidth:1,cornerRadius:2},dragMaskStyle:{fill:"#B0C8F9",fillOpacity:.2},backgroundChartStyle:{area:{visible:!0,stroke:"#D1DBEE",lineWidth:1,fill:"#F6F8FC"},line:{visible:!0,stroke:"#D1DBEE",lineWidth:1}},selectedBackgroundStyle:{fill:"#B0C8F9",fillOpacity:.5},selectedBackgroundChartStyle:{area:{visible:!0,stroke:"#B0C8F9",lineWidth:1,fill:"#fbb934"},line:{visible:!0,stroke:"#fbb934",lineWidth:1}},middleHandlerStyle:{visible:!0,background:{size:8,style:{fill:"white",stroke:"#B0C8F9",cornerRadius:2}},icon:{size:6,fill:"white",stroke:"#B0C8F9",symbolType:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",lineWidth:.5}},startHandlerStyle:{visible:!0,triggerMinSize:0,symbolType:Aa,fill:"white",stroke:"#B0C8F9",lineWidth:.5},endHandlerStyle:{visible:!0,triggerMinSize:0,symbolType:Aa,fill:"white",stroke:"#B0C8F9",lineWidth:.5},startTextStyle:{padding:4,textStyle:{fontSize:10,fill:"#6F6F6F"}},endTextStyle:{padding:4,textStyle:{fontSize:10,fill:"#6F6F6F"}}},Yt={horizontal:{angle:0,strokeBoundsBuffer:0,boundsPadding:2,pickMode:"imprecise",cursor:"ew-resize"},vertical:{angle:Math.PI/180*90,cursor:"ns-resize",boundsPadding:2,pickMode:"imprecise",strokeBoundsBuffer:0}};var ut;(function(o){o.startHandler="startHandler",o.endHandler="endHandler",o.middleHandler="middleHandler",o.background="background"})(ut||(ut={}));function xh(){gn(),gs(),Fi(),mo(),De()}var ka=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};const Sh={debounce:ms,throttle:zi};xh();let tr=class er extends qt{setPropsFromAttrs(){const{start:t,end:e,orient:i,previewData:s,previewPointsX:a,previewPointsY:n,previewPointsX1:r,previewPointsY1:l}=this.attribute;t&&(this.state.start=t),e&&(this.state.end=e);const{width:h,height:d}=this.getLayoutAttrFromConfig();this._spanCache=this.state.end-this.state.start,this._isHorizontal=i==="top"||i==="bottom",this._layoutCache.max=this._isHorizontal?h:d,this._layoutCache.attPos=this._isHorizontal?"x":"y",this._layoutCache.attSize=this._isHorizontal?"width":"height",s&&(this._previewData=s),E(a)&&(this._previewPointsX=a),E(n)&&(this._previewPointsY=n),E(r)&&(this._previewPointsX1=r),E(l)&&(this._previewPointsY1=l)}constructor(t,e){super(e!=null&&e.skipDefault?t:A({},er.defaultAttributes,t)),this.name="dataZoom",this._previewData=[],this._activeState=!1,this._activeCache={startPos:{x:0,y:0},lastPos:{x:0,y:0}},this._layoutCache={attPos:"x",attSize:"width",max:0},this.state={start:0,end:1},this._statePointToData=a=>a,this._onHandlerPointerDown=(a,n)=>{a.stopPropagation(),n==="start"?(this._activeTag=ut.startHandler,this._activeItem=this._startHandlerMask):n==="end"?(this._activeTag=ut.endHandler,this._activeItem=this._endHandlerMask):n==="middleRect"?(this._activeTag=ut.middleHandler,this._activeItem=this._middleHandlerRect):n==="middleSymbol"?(this._activeTag=ut.middleHandler,this._activeItem=this._middleHandlerSymbol):n==="background"&&(this._activeTag=ut.background,this._activeItem=this._background),this._activeState=!0,this._activeCache.startPos=this.eventPosToStagePos(a),this._activeCache.lastPos=this.eventPosToStagePos(a),ye.env==="browser"&&(ye.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),ye.addEventListener("pointerup",this._onHandlerPointerUp)),this.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0})},this._pointerMove=a=>{a.stopPropagation();const{start:n,end:r,brushSelect:l,realTime:h=!0}=this.attribute,d=this.eventPosToStagePos(a),{attPos:c,max:u}=this._layoutCache,g=(d[c]-this._activeCache.lastPos[c])/u;let{start:p,end:_}=this.state;this._activeState&&(this._activeTag===ut.middleHandler?this.moveZoomWithMiddle((this.state.start+this.state.end)/2+g):this._activeTag===ut.startHandler?p+g>_?(p=_,_=p+g,this._activeTag=ut.endHandler):p+=g:this._activeTag===ut.endHandler&&(_+g<p?(_=p,p=_+g,this._activeTag=ut.startHandler):_+=g),this._activeCache.lastPos=d,l&&this.renderDragMask()),p=Math.min(Math.max(p,0),1),_=Math.min(Math.max(_,0),1),n===p&&r===_||(this.setStateAttr(p,_,!0),h&&this._dispatchEvent("change",{start:p,end:_,tag:this._activeTag}))},this._onHandlerPointerMove=this.attribute.delayTime===0?this._pointerMove:Sh[this.attribute.delayType](this._pointerMove,this.attribute.delayTime),this._onHandlerPointerUp=a=>{a.preventDefault();const{start:n,end:r,brushSelect:l,realTime:h=!0}=this.attribute;if(this._activeState&&this._activeTag===ut.background){const d=this.eventPosToStagePos(a);this.backgroundDragZoom(this._activeCache.startPos,d)}this._activeState=!1,l&&this.renderDragMask(),n===this.state.start&&r===this.state.end||(this.setStateAttr(this.state.start,this.state.end,!0),this._dispatchEvent("change",{start:this.state.start,end:this.state.end,tag:this._activeTag})),ye.env==="browser"&&(ye.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),ye.removeEventListener("pointerup",this._onHandlerPointerUp)),this.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.removeEventListener("pointerup",this._onHandlerPointerUp)};const{position:i,showDetail:s}=t;this._activeCache.startPos=i,this._activeCache.lastPos=i,this._showText=s!=="auto"&&s,this.setPropsFromAttrs()}setAttributes(t,e){super.setAttributes(t,e),this.setPropsFromAttrs()}bindEvents(){if(this.attribute.disableTriggerEvent)return void this.setAttribute("childrenPickable",!1);const{showDetail:t,brushSelect:e}=this.attribute;this._startHandlerMask&&this._startHandlerMask.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"start")),this._endHandlerMask&&this._endHandlerMask.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"end")),this._middleHandlerSymbol&&this._middleHandlerSymbol.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"middleSymbol")),this._middleHandlerRect&&this._middleHandlerRect.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"middleRect"));const i=e?"background":"middleRect";this._selectedBackground&&this._selectedBackground.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,i)),e&&this._background&&this._background.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"background")),e&&this._previewGroup&&this._previewGroup.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"background")),this._selectedPreviewGroup&&this._selectedPreviewGroup.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,i)),this.addEventListener("pointerup",this._onHandlerPointerUp),this.addEventListener("pointerupoutside",this._onHandlerPointerUp),t==="auto"&&(this.addEventListener("pointerenter",this._onHandlerPointerEnter),this.addEventListener("pointerleave",this._onHandlerPointerLeave))}dragMaskSize(){const{position:t}=this.attribute,{attPos:e,max:i}=this._layoutCache;return this._activeCache.lastPos[e]-t[e]>i?i+t[e]-this._activeCache.startPos[e]:this._activeCache.lastPos[e]-t[e]<0?t[e]-this._activeCache.startPos[e]:this._activeCache.lastPos[e]-this._activeCache.startPos[e]}setStateAttr(t,e,i){const{zoomLock:s=!1,minSpan:a=0,maxSpan:n=1}=this.attribute,r=e-t;r!==this._spanCache&&(s||r<a||r>n)||(this._spanCache=r,this.state.start=t,this.state.end=e,i&&this.setAttributes({start:t,end:e}))}eventPosToStagePos(t){return this.stage.eventPointTransform(t)}_onHandlerPointerEnter(t){t.stopPropagation(),this._showText=!0,this.renderText()}_onHandlerPointerLeave(t){t.stopPropagation(),this._showText=!1,this.renderText()}backgroundDragZoom(t,e){const{attPos:i,max:s}=this._layoutCache,{position:a}=this.attribute,n=t[i]-a[i],r=e[i]-a[i],l=Math.min(Math.max(Math.min(n,r)/s,0),1),h=Math.min(Math.max(Math.max(n,r)/s,0),1);Math.abs(l-h)<.01?this.moveZoomWithMiddle(l):this.setStateAttr(l,h,!1)}moveZoomWithMiddle(t){let e=t-(this.state.start+this.state.end)/2;e!==0&&(e>0?this.state.end+e>1&&(e=1-this.state.end):e<0&&this.state.start+e<0&&(e=-this.state.start),this.setStateAttr(this.state.start+e,this.state.end+e,!1))}renderDragMask(){const{dragMaskStyle:t}=this.attribute,{position:e,width:i,height:s}=this.getLayoutAttrFromConfig();this._isHorizontal?this._dragMask=this._container.createOrUpdateChild("dragMask",Object.assign({x:mi(this.dragMaskSize()<0?this._activeCache.lastPos.x:this._activeCache.startPos.x,e.x,e.x+i),y:e.y,width:this._activeState&&this._activeTag===ut.background&&Math.abs(this.dragMaskSize())||0,height:s},t),"rect"):this._dragMask=this._container.createOrUpdateChild("dragMask",Object.assign({x:e.x,y:mi(this.dragMaskSize()<0?this._activeCache.lastPos.y:this._activeCache.startPos.y,e.y,e.y+s),width:i,height:this._activeState&&this._activeTag===ut.background&&Math.abs(this.dragMaskSize())||0},t),"rect")}isTextOverflow(t,e,i){if(!e)return!1;if(this._isHorizontal){if(i==="start"){if(e.x1<t.x1)return!0}else if(e.x2>t.x2)return!0}else if(i==="start"){if(e.y1<t.y1)return!0}else if(e.y2>t.y2)return!0;return!1}setTextAttr(t,e){const{startTextStyle:i,endTextStyle:s}=this.attribute,{formatMethod:a}=i,n=ka(i,["formatMethod"]),{formatMethod:r}=s,l=ka(s,["formatMethod"]),{start:h,end:d}=this.state;this._startValue=this._statePointToData(h),this._endValue=this._statePointToData(d);const{position:c,width:u,height:g}=this.getLayoutAttrFromConfig(),p=a?a(this._startValue):this._startValue,_=r?r(this._endValue):this._endValue,m={x1:c.x,y1:c.y,x2:c.x+u,y2:c.y+g};let v,b,y,f;this._isHorizontal?(v={x:c.x+h*u,y:c.y+g/2},b={x:c.x+d*u,y:c.y+g/2},y={textAlign:this.isTextOverflow(m,t,"start")?"left":"right",textBaseline:"middle"},f={textAlign:this.isTextOverflow(m,e,"end")?"right":"left",textBaseline:"middle"}):(v={x:c.x+u/2,y:c.y+h*g},b={x:c.x+u/2,y:c.y+d*g},y={textAlign:"center",textBaseline:this.isTextOverflow(m,t,"start")?"top":"bottom"},f={textAlign:"center",textBaseline:this.isTextOverflow(m,e,"end")?"bottom":"top"}),this._startText=this.maybeAddLabel(this._container,A({},n,{text:p,x:v.x,y:v.y,visible:this._showText,pickable:!1,childrenPickable:!1,textStyle:y}),`data-zoom-start-text-${c}`),this._endText=this.maybeAddLabel(this._container,A({},l,{text:_,x:b.x,y:b.y,visible:this._showText,pickable:!1,childrenPickable:!1,textStyle:f}),`data-zoom-end-text-${c}`)}renderText(){let t=null,e=null;this.setTextAttr(t,e),t=this._startText.AABBBounds,e=this._endText.AABBBounds,this.setTextAttr(t,e),t=this._startText.AABBBounds,e=this._endText.AABBBounds;const{x1:i,x2:s,y1:a,y2:n}=t,{dx:r=0,dy:l=0}=this.attribute.startTextStyle;if(new vo().set(i,a,s,n).intersects(e)){const h=this.attribute.orient==="bottom"||this.attribute.orient==="right"?-1:1;this._isHorizontal?this._startText.setAttribute("dy",l+h*Math.abs(e.y1-e.y2)):this._startText.setAttribute("dx",r+h*Math.abs(e.x1-e.x2))}else this._isHorizontal?this._startText.setAttribute("dy",l):this._startText.setAttribute("dx",r)}getLayoutAttrFromConfig(){var t,e,i,s,a,n;if(this._layoutAttrFromConfig)return this._layoutAttrFromConfig;const{position:r,size:l,orient:h,middleHandlerStyle:d={},startHandlerStyle:c={},endHandlerStyle:u={},backgroundStyle:g={}}=this.attribute,{width:p,height:_}=l,m=(e=(t=d.background)===null||t===void 0?void 0:t.size)!==null&&e!==void 0?e:10;let v,b,y;d.visible?this._isHorizontal?(v=p,b=_-m,y={x:r.x,y:r.y+m}):(v=p-m,b=_,y={x:r.x+(h==="left"?m:0),y:r.y}):(v=p,b=_,y=r);const f=(i=c.size)!==null&&i!==void 0?i:this._isHorizontal?b:v,x=(s=u.size)!==null&&s!==void 0?s:this._isHorizontal?b:v;return c.visible&&(this._isHorizontal?(v-=(f+x)/2,y={x:y.x+f/2,y:y.y}):(b-=(f+x)/2,y={x:y.x,y:y.y+f/2})),b+=(a=g.lineWidth/2)!==null&&a!==void 0?a:1,v+=(n=g.lineWidth/2)!==null&&n!==void 0?n:1,this._layoutAttrFromConfig={position:y,width:v,height:b},this._layoutAttrFromConfig}render(){var t,e,i,s,a,n,r,l,h,d,c,u,g,p,_,m,v,b,y,f,x,M,k,D,O,T,B,H,G,Q,Z,N,K,Mt;this._layoutAttrFromConfig=null;const{orient:At,backgroundStyle:_e,backgroundChartStyle:Ot={},selectedBackgroundStyle:we={},selectedBackgroundChartStyle:Fe={},middleHandlerStyle:ot={},startHandlerStyle:Jt={},endHandlerStyle:te={},brushSelect:ai,zoomLock:ct}=this.attribute,{start:pt,end:Tt}=this.state,{position:j,width:tt,height:nt}=this.getLayoutAttrFromConfig(),ni=(t=Jt.triggerMinSize)!==null&&t!==void 0?t:40,ri=(e=te.triggerMinSize)!==null&&e!==void 0?e:40,J=this.createOrUpdateChild("dataZoom-container",{},"group");if(this._container=J,this._background=J.createOrUpdateChild("background",Object.assign(Object.assign({x:j.x,y:j.y,width:tt,height:nt,cursor:ai?"crosshair":"auto"},_e),{pickable:!ct&&((i=_e.pickable)===null||i===void 0||i)}),"rect"),!((s=Ot.line)===null||s===void 0)&&s.visible&&this.setPreviewAttributes("line",J),!((a=Ot.area)===null||a===void 0)&&a.visible&&this.setPreviewAttributes("area",J),ai&&this.renderDragMask(),this._isHorizontal?this._selectedBackground=J.createOrUpdateChild("selectedBackground",Object.assign(Object.assign({x:j.x+pt*tt,y:j.y,width:(Tt-pt)*tt,height:nt,cursor:ai?"crosshair":"move"},we),{pickable:!ct&&((n=Fe.pickable)===null||n===void 0||n)}),"rect"):this._selectedBackground=J.createOrUpdateChild("selectedBackground",Object.assign(Object.assign({x:j.x,y:j.y+pt*nt,width:tt,height:(Tt-pt)*nt,cursor:ai?"crosshair":"move"},we),{pickable:!ct&&((r=we.pickable)===null||r===void 0||r)}),"rect"),!((l=Fe.line)===null||l===void 0)&&l.visible&&this.setSelectedPreviewAttributes("line",J),!((h=Fe.area)===null||h===void 0)&&h.visible&&this.setSelectedPreviewAttributes("area",J),this._isHorizontal){if(ot.visible){const Ht=((d=ot.background)===null||d===void 0?void 0:d.size)||10;this._middleHandlerRect=J.createOrUpdateChild("middleHandlerRect",Object.assign(Object.assign({x:j.x+pt*tt,y:j.y-Ht,width:(Tt-pt)*tt,height:Ht},(c=ot.background)===null||c===void 0?void 0:c.style),{pickable:!ct&&((p=(g=(u=ot.background)===null||u===void 0?void 0:u.style)===null||g===void 0?void 0:g.pickable)===null||p===void 0||p)}),"rect"),this._middleHandlerSymbol=J.createOrUpdateChild("middleHandlerSymbol",Object.assign(Object.assign({x:j.x+(pt+Tt)/2*tt,y:j.y-Ht/2,strokeBoundsBuffer:0,angle:0,symbolType:(m=(_=ot.icon)===null||_===void 0?void 0:_.symbolType)!==null&&m!==void 0?m:"square"},ot.icon),{pickable:!ct&&((v=ot.icon.pickable)===null||v===void 0||v)}),"symbol")}this._startHandler=J.createOrUpdateChild("startHandler",Object.assign(Object.assign(Object.assign({x:j.x+pt*tt,y:j.y+nt/2,size:nt,symbolType:(b=Jt.symbolType)!==null&&b!==void 0?b:"square"},Yt.horizontal),Jt),{pickable:!ct&&((y=Jt.pickable)===null||y===void 0||y)}),"symbol"),this._endHandler=J.createOrUpdateChild("endHandler",Object.assign(Object.assign(Object.assign({x:j.x+Tt*tt,y:j.y+nt/2,size:nt,symbolType:(f=te.symbolType)!==null&&f!==void 0?f:"square"},Yt.horizontal),te),{pickable:!ct&&((x=te.pickable)===null||x===void 0||x)}),"symbol");const oi=Math.max(this._startHandler.AABBBounds.width(),ni),li=Math.max(this._startHandler.AABBBounds.height(),ni),me=Math.max(this._endHandler.AABBBounds.width(),ri),ve=Math.max(this._endHandler.AABBBounds.height(),ri);this._startHandlerMask=J.createOrUpdateChild("startHandlerMask",Object.assign(Object.assign({x:j.x+pt*tt-oi/2,y:j.y+nt/2-li/2,width:oi,height:li,fill:"white",fillOpacity:0,zIndex:999},Yt.horizontal),{pickable:!ct}),"rect"),this._endHandlerMask=J.createOrUpdateChild("endHandlerMask",Object.assign(Object.assign({x:j.x+Tt*tt-me/2,y:j.y+nt/2-ve/2,width:me,height:ve,fill:"white",fillOpacity:0,zIndex:999},Yt.horizontal),{pickable:!ct}),"rect")}else{if(ot.visible){const Ht=((M=ot.background)===null||M===void 0?void 0:M.size)||10;this._middleHandlerRect=J.createOrUpdateChild("middleHandlerRect",Object.assign(Object.assign({x:At==="left"?j.x-Ht:j.x+tt,y:j.y+pt*nt,width:Ht,height:(Tt-pt)*nt},(k=ot.background)===null||k===void 0?void 0:k.style),{pickable:!ct&&((T=(O=(D=ot.background)===null||D===void 0?void 0:D.style)===null||O===void 0?void 0:O.pickable)===null||T===void 0||T)}),"rect"),this._middleHandlerSymbol=J.createOrUpdateChild("middleHandlerSymbol",Object.assign(Object.assign({x:At==="left"?j.x-Ht/2:j.x+tt+Ht/2,y:j.y+(pt+Tt)/2*nt,angle:Math.PI/180*90,symbolType:(H=(B=ot.icon)===null||B===void 0?void 0:B.symbolType)!==null&&H!==void 0?H:"square",strokeBoundsBuffer:0},ot.icon),{pickable:!ct&&((Q=(G=ot.icon)===null||G===void 0?void 0:G.pickable)===null||Q===void 0||Q)}),"symbol")}this._startHandler=J.createOrUpdateChild("startHandler",Object.assign(Object.assign(Object.assign({x:j.x+tt/2,y:j.y+pt*nt,size:tt,symbolType:(Z=Jt.symbolType)!==null&&Z!==void 0?Z:"square"},Yt.vertical),Jt),{pickable:!ct&&((N=Jt.pickable)===null||N===void 0||N)}),"symbol"),this._endHandler=J.createOrUpdateChild("endHandler",Object.assign(Object.assign(Object.assign({x:j.x+tt/2,y:j.y+Tt*nt,size:tt,symbolType:(K=te.symbolType)!==null&&K!==void 0?K:"square"},Yt.vertical),te),{pickable:!ct&&((Mt=te.pickable)===null||Mt===void 0||Mt)}),"symbol");const oi=Math.max(this._startHandler.AABBBounds.width(),ni),li=Math.max(this._startHandler.AABBBounds.height(),ni),me=Math.max(this._endHandler.AABBBounds.width(),ri),ve=Math.max(this._endHandler.AABBBounds.height(),ri);this._startHandlerMask=J.createOrUpdateChild("startHandlerMask",Object.assign(Object.assign({x:j.x+tt/2+oi/2,y:j.y+pt*nt-li/2,width:ve,height:me,fill:"white",fillOpacity:0,zIndex:999},Yt.vertical),{pickable:!ct}),"rect"),this._endHandlerMask=J.createOrUpdateChild("endHandlerMask",Object.assign(Object.assign({x:j.x+tt/2+me/2,y:j.y+Tt*nt-ve/2,width:ve,height:me,fill:"white",fillOpacity:0,zIndex:999},Yt.vertical),{pickable:!ct}),"rect")}this._showText&&this.renderText()}computeBasePoints(){const{orient:t}=this.attribute,{position:e,width:i,height:s}=this.getLayoutAttrFromConfig();let a,n;return this._isHorizontal?(a=[{x:e.x,y:e.y+s}],n=[{x:e.x+i,y:e.y+s}]):t==="left"?(a=[{x:e.x+i,y:e.y}],n=[{x:e.x+i,y:e.y+s}]):(a=[{x:e.x,y:e.y+s}],n=[{x:e.x,y:e.y}]),{basePointStart:a,basePointEnd:n}}simplifyPoints(t){var e;if(t.length>1e4){const i=(e=this.attribute.tolerance)!==null&&e!==void 0?e:this._previewData.length/1e4;return Hl(t,i)}return t}getPreviewLinePoints(){let t=this._previewData.map(s=>({x:this._previewPointsX&&this._previewPointsX(s),y:this._previewPointsY&&this._previewPointsY(s)}));if(t.length===0)return t;t=this.simplifyPoints(t);const{basePointStart:e,basePointEnd:i}=this.computeBasePoints();return e.concat(t).concat(i)}getPreviewAreaPoints(){let t=this._previewData.map(s=>({x:this._previewPointsX&&this._previewPointsX(s),y:this._previewPointsY&&this._previewPointsY(s),x1:this._previewPointsX1&&this._previewPointsX1(s),y1:this._previewPointsY1&&this._previewPointsY1(s)}));if(t.length===0)return t;t=this.simplifyPoints(t);const{basePointStart:e,basePointEnd:i}=this.computeBasePoints();return e.concat(t).concat(i)}setPreviewAttributes(t,e){this._previewGroup||(this._previewGroup=e.createOrUpdateChild("previewGroup",{pickable:!1},"group")),t==="line"?this._previewLine=this._previewGroup.createOrUpdateChild("previewLine",{},"line"):this._previewArea=this._previewGroup.createOrUpdateChild("previewArea",{curveType:"basis"},"area");const{backgroundChartStyle:i={}}=this.attribute;t==="line"&&this._previewLine.setAttributes(Object.assign({points:this.getPreviewLinePoints(),curveType:"basis",pickable:!1},i.line)),t==="area"&&this._previewArea.setAttributes(Object.assign({points:this.getPreviewAreaPoints(),curveType:"basis",pickable:!1},i.area))}setSelectedPreviewAttributes(t,e){this._selectedPreviewGroupClip||(this._selectedPreviewGroupClip=e.createOrUpdateChild("selectedPreviewGroupClip",{pickable:!1},"group"),this._selectedPreviewGroup=this._selectedPreviewGroupClip.createOrUpdateChild("selectedPreviewGroup",{},"group")),t==="line"?this._selectedPreviewLine=this._selectedPreviewGroup.createOrUpdateChild("selectedPreviewLine",{},"line"):this._selectedPreviewArea=this._selectedPreviewGroup.createOrUpdateChild("selectedPreviewArea",{curveType:"basis"},"area");const{selectedBackgroundChartStyle:i={}}=this.attribute,{start:s,end:a}=this.state,{position:n,width:r,height:l}=this.getLayoutAttrFromConfig();this._selectedPreviewGroupClip.setAttributes({x:this._isHorizontal?n.x+s*r:n.x,y:this._isHorizontal?n.y:n.y+s*l,width:this._isHorizontal?(a-s)*r:r,height:this._isHorizontal?l:(a-s)*l,clip:!0,pickable:!1}),this._selectedPreviewGroup.setAttributes({x:-(this._isHorizontal?n.x+s*r:n.x),y:-(this._isHorizontal?n.y:n.y+s*l),width:this._isHorizontal?(a-s)*r:r,height:this._isHorizontal?l:(a-s)*l,pickable:!1}),t==="line"&&this._selectedPreviewLine.setAttributes(Object.assign({points:this.getPreviewLinePoints(),curveType:"basis",pickable:!1},i.line)),t==="area"&&this._selectedPreviewArea.setAttributes(Object.assign({points:this.getPreviewAreaPoints(),curveType:"basis",pickable:!1},i.area))}maybeAddLabel(t,e,i){let s=this.find(a=>a.name===i,!0);return s?s.setAttributes(e):(s=new Oe(e),s.name=i),t.add(s),s}setStartAndEnd(t,e){const{start:i,end:s}=this.attribute;S(t)&&S(e)&&(t!==this.state.start||e!==this.state.end)&&(this.state.start=t,this.state.end=e,i===this.state.start&&s===this.state.end||(this.setStateAttr(t,e,!0),this._dispatchEvent("change",{start:t,end:e,tag:this._activeTag})))}setPreviewData(t){this._previewData=t}setText(t,e){e==="start"?this._startText.setAttribute("text",t):this._endText.setAttribute("text",t)}getStartValue(){return this._startValue}getEndTextValue(){return this._endValue}getMiddleHandlerSize(){var t,e,i,s;const{middleHandlerStyle:a={}}=this.attribute,n=(e=(t=a.background)===null||t===void 0?void 0:t.size)!==null&&e!==void 0?e:10,r=(s=(i=a.icon)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:10;return Math.max(n,...L(r))}setPreviewPointsX(t){E(t)&&(this._previewPointsX=t)}setPreviewPointsY(t){E(t)&&(this._previewPointsY=t)}setPreviewPointsX1(t){E(t)&&(this._previewPointsX1=t)}setPreviewPointsY1(t){E(t)&&(this._previewPointsY1=t)}setStatePointToData(t){E(t)&&(this._statePointToData=t)}};tr.defaultAttributes=fh;var os;(function(o){o.start="start",o.startTop="startTop",o.startBottom="startBottom",o.insideStart="insideStart",o.insideStartTop="insideStartTop",o.insideStartBottom="insideStartBottom",o.middle="middle",o.insideMiddleTop="insideMiddleTop",o.insideMiddleBottom="insideMiddleBottom",o.end="end",o.endTop="endTop",o.endBottom="endBottom",o.insideEnd="insideEnd",o.insideEndTop="insideEndTop",o.insideEndBottom="insideEndBottom"})(os||(os={}));var ls;(function(o){o.left="left",o.right="right",o.top="top",o.bottom="bottom",o.middle="middle",o.insideLeft="insideLeft",o.insideRight="insideRight",o.insideTop="insideTop",o.insideBottom="insideBottom"})(ls||(ls={}));var xi;(function(o){o.arcInnerStart="arcInnerStart",o.arcInnerEnd="arcInnerEnd",o.arcInnerMiddle="arcInnerMiddle",o.arcOuterStart="arcOuterStart",o.arcOuterEnd="arcOuterEnd",o.arcOuterMiddle="arcOuterMiddle",o.center="center"})(xi||(xi={}));var hs;(function(o){o.top="top",o.bottom="bottom",o.middle="middle",o.insideTop="insideTop",o.insideBottom="insideBottom",o.insideMiddle="insideMiddle"})(hs||(hs={}));function ks(){Qt(),gn()}function Ah(){ks(),xs()}function kh(){ks(),ps()}function Mh(){ks(),xs(),jn(),Fi(),yo(),De()}class Ms extends qt{constructor(){super(...arguments),this.name="marker",this._onHover=t=>{this._lastHover=Gn(t,this._container,this._lastHover)},this._onUnHover=t=>{this._lastHover=Un(t,this._container,this._lastHover)},this._onClick=t=>{this._lastSelect=Zn(t,this._container,this._lastSelect)}}transAnimationConfig(){var t,e,i;if(this.attribute.animation!==!1){const s=ii(this.attribute.animation)?this.attribute.animation:{};this._animationConfig={enter:A({},this.defaultUpdateAnimation,s,(t=this.attribute.animationEnter)!==null&&t!==void 0?t:{}),exit:A({},this.defaultExitAnimation,s,(e=this.attribute.animationExit)!==null&&e!==void 0?e:{}),update:A({},this.defaultUpdateAnimation,s,(i=this.attribute.animationUpdate)!==null&&i!==void 0?i:{})}}}setAttribute(t,e,i){super.setAttribute(t,e,i),t==="visible"&&this.render()}_bindEvent(){var t,e,i;if(!this.attribute.interactive)return;const{hover:s,select:a}=this.attribute;s&&((t=this._container)===null||t===void 0||t.addEventListener("pointermove",this._onHover),(e=this._container)===null||e===void 0||e.addEventListener("pointerout",this._onUnHover)),a&&((i=this._container)===null||i===void 0||i.addEventListener("pointerdown",this._onClick))}_releaseEvent(){var t,e,i;(t=this._container)===null||t===void 0||t.removeEventListener("pointermove",this._onHover),(e=this._container)===null||e===void 0||e.removeEventListener("pointerout",this._onUnHover),(i=this._container)===null||i===void 0||i.removeEventListener("pointerdown",this._onClick)}_initContainer(){var t,e;const{limitRect:i={},clipInRange:s}=this.attribute;let a;if(s){const n=Y.group(Object.assign(Object.assign({},i),{clip:!0,pickable:!1}));a=Y.group({x:-((t=i.x)!==null&&t!==void 0?t:0),y:-((e=i.y)!==null&&e!==void 0?e:0),pickable:!1}),n.add(a),this._containerClip=n,this.add(n)}else a=Y.group({x:0,y:0,pickable:!1}),this.add(a);a.name="marker-container",this._container=a}_updateContainer(){var t,e;const{limitRect:i={},clipInRange:s}=this.attribute;this._containerClip&&this._containerClip.setAttributes(Object.assign({},i)),this._container.setAttributes({x:s?-((t=i.x)!==null&&t!==void 0?t:0):0,y:s?-((e=i.y)!==null&&e!==void 0?e:0):0})}render(){var t;this.transAnimationConfig(),this.setAttribute("pickable",!1);const e=(t=this.attribute.visible)===null||t===void 0||t;this.attribute.interactive===!1&&this.setAttribute("childrenPickable",!1),e&&this.isValidPoints()?this._container?(this._updateContainer(),this.updateMarker(),this.markerAnimate("update")):(this._initContainer(),this.initMarker(this._container),this.markerAnimate("enter")):(this.markerAnimate("exit"),this._container=null,this.removeAllChild(!0)),this._releaseEvent(),this._bindEvent()}release(){this.markerAnimate("exit"),super.release(),this._releaseEvent(),this._container=null}}function it(o,t,e,i){var s,a,n,r,l;if(!o)return;(s=o==null?void 0:o.animates)===null||s===void 0||s.forEach(c=>c.stop("end"));const h=(n=(a=o.attribute)===null||a===void 0?void 0:a.fillOpacity)!==null&&n!==void 0?n:1,d=(l=(r=o.attribute)===null||r===void 0?void 0:r.strokeOpacity)!==null&&l!==void 0?l:1;o.setAttributes({fillOpacity:0,strokeOpacity:0}),o.animate().wait(t).to({fillOpacity:h,strokeOpacity:d},e,i)}function ir(o,t,e,i){o&&(it(o.startSymbol,t,e,i),o.lines.forEach(s=>it(s,t,e,i)),it(o.line,t,e,i),it(o.endSymbol,t,e,i))}function Ts(o,t,e,i){o&&(it(o.getTextShape(),t,e,i),it(o.getBgRect(),t,e,i))}function wt(o,t,e,i){var s,a,n,r;o&&(o.setAttributes({fillOpacity:(a=(s=o.attribute)===null||s===void 0?void 0:s.fillOpacity)!==null&&a!==void 0?a:1,strokeOpacity:(r=(n=o.attribute)===null||n===void 0?void 0:n.strokeOpacity)!==null&&r!==void 0?r:1}),o.animate().wait(t).to({fillOpacity:0,strokeOpacity:0},e,i))}function sr(o,t,e,i){o&&(wt(o.startSymbol,t,e,i),o.lines.forEach(s=>wt(s,t,e,i)),wt(o.line,t,e,i),wt(o.endSymbol,t,e,i))}function Cs(o,t,e,i){o&&(wt(o.getTextShape(),t,e,i),wt(o.getBgRect(),t,e,i))}function Ma(o,t,e,i,s){const a=.1*e,n=.7*e,r=.1*e,l=.1*e;it(o.startSymbol,i,a,s),o.lines.forEach(h=>h.setAttribute("clipRange",0)),o.lines.forEach((h,d)=>{const c=n/o.lines.length;h.animate().wait(i+a+d*c).to({clipRange:1},c,s)}),it(o.endSymbol,i+a+n,r,s),it(t.getTextShape(),i+a+n+r,l,s),it(t.getBgRect(),i+a+n+r,l,s)}function Ta(o,t,e,i,s){ir(o,i,e,s),Ts(t,i,e,s)}function Ca(o,t,e,i,s){it(o,i,e,s),Ts(t,i,e,s)}function La(o,t,e,i,s,a){var n;ir(o,s,i,a),it(t,s,i,a),!((n=e.getTextShape)===null||n===void 0)&&n.call(e)?Ts(e,s,i,a):it(e,s,i,a)}function Th(o,t,e,i,s){sr(o,i,e,s),Cs(t,i,e,s)}function Ch(o,t,e,i,s){wt(o,i,e,s),Cs(t,i,e,s)}function Lh(o,t,e,i,s,a){var n;sr(o,s,i,a),wt(t,s,i,a),!((n=e.getTextShape)===null||n===void 0)&&n.call(e)?Cs(e,s,i,a):wt(e,s,i,a)}function Pa(o,t,e,i,s,a){var n;const r=.1*i,l=.65*i,h=.05*i,d=.1*i,c=.1*i;it(o.startSymbol,s,r,a),o.lines.forEach(u=>u.setAttribute("clipRange",0)),o.lines.forEach((u,g)=>{const p=l/o.lines.length;u.animate().wait(s+r+g*p).to({clipRange:1},p,a)}),it(t,s+r+l,h,a),it(o.endSymbol,s+r+l+h,d,a),!((n=e.getTextShape)===null||n===void 0)&&n.call(e)?(it(e.getTextShape(),s+r+l+h+d,c,a),it(e.getBgRect(),s+r+l+d,c,a)):it(e,s+r+l+d,c,a)}function Ph(o,t,e,i){const{enter:s,update:a,exit:n}=e;if(i==="enter"){const{type:r,duration:l,delay:h,easing:d}=s;r==="clipIn"?Ma(o,t,l,h,d):r==="fadeIn"&&Ta(o,t,l,h,d)}else if(i==="update"){const{type:r,duration:l,delay:h,easing:d}=a;r==="clipIn"?Ma(o,t,l,h,d):r==="fadeIn"&&Ta(o,t,l,h,d)}else if(i==="exit"){const{duration:r,delay:l,easing:h}=n;Th(o,t,r,l,h)}}function Bh(o,t,e,i){const{enter:s,update:a,exit:n}=e;if(i==="enter"){const{type:r,duration:l,delay:h,easing:d}=s;r==="fadeIn"&&Ca(o,t,l,h,d)}else if(i==="update"){const{type:r,duration:l,delay:h,easing:d}=a;r==="fadeIn"&&Ca(o,t,l,h,d)}else if(i==="exit"){const{duration:r,delay:l,easing:h}=n;Ch(o,t,r,l,h)}}function Dh(o,t,e,i){const[s,a]=o,{enter:n,update:r,exit:l}=e;if(i==="enter"){const{type:h,duration:d,delay:c,easing:u}=n;h==="fadeIn"?La(s,a,t,d,c,u):h==="callIn"&&Pa(s,a,t,d,c,u)}else if(i==="update"){const{type:h,duration:d,delay:c,easing:u}=r;h==="fadeIn"?La(s,a,t,d,c,u):h==="callIn"&&Pa(s,a,t,d,c,u)}else if(i==="exit"){const{duration:h,delay:d,easing:c}=l;Lh(s,a,t,h,d,c)}}const Oh={type:"clipIn",duration:500,easing:"linear",delay:0},Eh={type:"fadeIn",duration:500,easing:"linear",delay:0},Ih={type:"callIn",duration:500,easing:"linear",delay:0},Ls={type:"fadeOut",duration:500,easing:"linear",delay:0};class Rh extends Ms{constructor(){super(...arguments),this.name="markCommonLine",this.defaultUpdateAnimation=Oh,this.defaultExitAnimation=Ls}getLine(){return this._line}getLabel(){return this._label}setLabelPos(){const{label:t={},limitRect:e}=this.attribute,{position:i,confine:s,autoRotate:a}=t,n=this.getPointAttrByPosition(i),r=i.toString().toLocaleLowerCase().includes("start")?this._line.getStartAngle()||0:this._line.getEndAngle()||0;if(this._label.setAttributes(Object.assign(Object.assign({},n.position),{angle:a?this.getRotateByAngle(n.angle):0,textStyle:Object.assign(Object.assign({},this.getTextStyle(i,r,a)),t.textStyle)})),e&&s){const{x:l,y:h,width:d,height:c}=e;Hn(this._label,{x1:l,y1:h,x2:l+d,y2:h+c})}}initMarker(t){const{label:e,state:i}=this.attribute,s=this.createSegment();s.name="mark-common-line-line",this._line=s,t.add(s);const a=new Oe(Object.assign(Object.assign({},e),{state:{panel:A({},R,i==null?void 0:i.labelBackground),text:A({},R,i==null?void 0:i.label)}}));a.name="mark-common-line-label",this._label=a,t.add(a),this.setLabelPos()}updateMarker(){const{label:t,state:e}=this.attribute;this.setLineAttributes(),this._label&&(this._label.setAttributes(Object.assign(Object.assign({dx:0,dy:0},t),{state:{panel:A({},R,e==null?void 0:e.labelBackground),text:A({},R,e==null?void 0:e.label)}})),this.setLabelPos())}}const Lt=.001,wh={interactive:!0,startSymbol:{visible:!1,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},endSymbol:{visible:!0,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},label:{position:os.end,refX:0,refY:0,refAngle:0,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}},Ba={postiveXAxis:{start:{textAlign:"left",textBaseline:"middle"},startTop:{textAlign:"left",textBaseline:"bottom"},startBottom:{textAlign:"left",textBaseline:"top"},insideStart:{textAlign:"right",textBaseline:"middle"},insideStartTop:{textAlign:"right",textBaseline:"bottom"},insideStartBottom:{textAlign:"right",textBaseline:"top"},middle:{textAlign:"center",textBaseline:"middle"},insideMiddleTop:{textAlign:"center",textBaseline:"bottom"},insideMiddleBottom:{textAlign:"center",textBaseline:"top"},end:{textAlign:"left",textBaseline:"middle"},endTop:{textAlign:"left",textBaseline:"bottom"},endBottom:{textAlign:"left",textBaseline:"top"},insideEnd:{textAlign:"right",textBaseline:"middle"},insideEndTop:{textAlign:"right",textBaseline:"bottom"},insideEndBottom:{textAlign:"right",textBaseline:"top"}},negativeXAxis:{start:{textAlign:"right",textBaseline:"middle"},startTop:{textAlign:"right",textBaseline:"bottom"},startBottom:{textAlign:"right",textBaseline:"top"},insideStart:{textAlign:"left",textBaseline:"middle"},insideStartTop:{textAlign:"left",textBaseline:"bottom"},insideStartBottom:{textAlign:"left",textBaseline:"top"},middle:{textAlign:"center",textBaseline:"middle"},insideMiddleTop:{textAlign:"center",textBaseline:"bottom"},insideMiddleBottom:{textAlign:"center",textBaseline:"top"},end:{textAlign:"right",textBaseline:"middle"},endTop:{textAlign:"right",textBaseline:"bottom"},endBottom:{textAlign:"right",textBaseline:"top"},insideEnd:{textAlign:"left",textBaseline:"middle"},insideEndTop:{textAlign:"left",textBaseline:"bottom"},insideEndBottom:{textAlign:"left",textBaseline:"top"}}};xi.arcOuterMiddle;const Fh={interactive:!0,label:{position:ls.right,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},areaStyle:{fill:"#b2bacf",visible:!0}};xi.arcOuterMiddle;const zh={left:{textAlign:"right",textBaseline:"middle"},insideLeft:{textAlign:"left",textBaseline:"middle"},right:{textAlign:"left",textBaseline:"middle"},insideRight:{textAlign:"right",textBaseline:"middle"},top:{textAlign:"center",textBaseline:"bottom"},insideTop:{textAlign:"center",textBaseline:"top"},bottom:{textAlign:"center",textBaseline:"top"},insideBottom:{textAlign:"center",textBaseline:"bottom"},middle:{textAlign:"center",textBaseline:"middle"}},Hh={interactive:!0,targetSymbol:{visible:!1,offset:0,style:{symbolType:"circle",size:20,fill:!1,stroke:"rgba(46, 47, 50)"}},itemLine:{visible:!0,decorativeLine:{visible:!1,length:30},startSymbol:{visible:!0,clip:!0,symbolType:"circle",size:20,style:{fill:!1,stroke:"rgba(46, 47, 50)"}},endSymbol:{visible:!1,clip:!0,symbolType:"triangle",size:12,style:{fill:!1,stroke:"rgba(46, 47, 50)"}},lineStyle:{stroke:"#000",lineWidth:1}},itemContent:{type:"text",position:"middle",refX:10,symbolStyle:{symbolType:"star",fill:"rgb(48, 115, 242)",fillOpacity:.8,size:20},textStyle:{dx:0,dy:0},imageStyle:{width:80,height:80},richTextStyle:{width:100,height:100}}},Da={postiveXAxis:{top:{textAlign:"left",textBaseline:"bottom"},bottom:{textAlign:"left",textBaseline:"top"},middle:{textAlign:"left",textBaseline:"middle"},insideTop:{textAlign:"right",textBaseline:"bottom"},insideBottom:{textAlign:"right",textBaseline:"top"},insideMiddle:{textAlign:"right",textBaseline:"middle"}},negativeXAxis:{top:{textAlign:"right",textBaseline:"bottom"},bottom:{textAlign:"right",textBaseline:"top"},middle:{textAlign:"right",textBaseline:"middle"},insideTop:{textAlign:"left",textBaseline:"bottom"},insideBottom:{textAlign:"left",textBaseline:"top"},insideMiddle:{textAlign:"left",textBaseline:"middle"}}};Ah();function Vh(){le._animate=Ph}class le extends Rh{markerAnimate(t){le._animate&&this._animationConfig&&le._animate(this._line,this._label,this._animationConfig,t)}constructor(t,e){super(e!=null&&e.skipDefault?t:A({},le.defaultAttributes,t)),this.name="markLine"}getPointAttrByPosition(t){var e;const{label:i={}}=this.attribute,{refX:s=0,refY:a=0}=i,n=this._line.getMainSegmentPoints(),r=(e=this._line.getEndAngle())!==null&&e!==void 0?e:0,l=r,h=s*Math.cos(l)+a*Math.cos(l-Math.PI/2),d=s*Math.sin(l)+a*Math.sin(l-Math.PI/2);return t.includes("start")||t.includes("Start")?{position:{x:n[0].x+h,y:n[0].y+d},angle:l}:t.includes("middle")||t.includes("Middle")?{position:{x:(n[0].x+n[n.length-1].x)/2+h,y:(n[0].y+n[n.length-1].y)/2+d},angle:l}:{position:{x:n[n.length-1].x+h,y:n[n.length-1].y+d},angle:l}}getRotateByAngle(t){var e;return(vi(t)?t:t-Math.PI)+((e=this.attribute.label.refAngle)!==null&&e!==void 0?e:0)}getTextStyle(t,e,i){return Ct(Math.abs(e),Math.PI/2,Lt)||Ct(Math.abs(e),3*Math.PI/2,Lt)?pn(i,e,t):vi(e)?Ba.postiveXAxis[t]:Ba.negativeXAxis[t]}createSegment(){const{points:t,startSymbol:e,endSymbol:i,lineStyle:s,mainSegmentIndex:a,multiSegment:n,state:r}=this.attribute;return new zt({points:t,startSymbol:e,endSymbol:i,lineStyle:s,mainSegmentIndex:a,multiSegment:n,pickable:!1,state:{line:A({},R,r==null?void 0:r.line),startSymbol:A({},R,r==null?void 0:r.lineStartSymbol),endSymbol:A({},R,r==null?void 0:r.lineEndSymbol)}})}setLineAttributes(){const{points:t,startSymbol:e,endSymbol:i,lineStyle:s,mainSegmentIndex:a,multiSegment:n,state:r}=this.attribute;this._line&&this._line.setAttributes({points:t,startSymbol:e,endSymbol:i,lineStyle:s,mainSegmentIndex:a,multiSegment:n,state:{line:A({},R,r==null?void 0:r.line),startSymbol:A({},R,r==null?void 0:r.lineStartSymbol),endSymbol:A({},R,r==null?void 0:r.lineEndSymbol)}})}isValidPoints(){const{points:t}=this.attribute;if(!t||t.length<2)return!1;let e=!0;return t.forEach(i=>{if(i.length)i.forEach(s=>{w(s.x)&&w(s.y)||(e=!1)});else if(!w(i.x)||!w(i.y))return void(e=!1)}),e}}le.defaultAttributes=wh;kh();function jh(){he._animate=Bh}class he extends Ms{markerAnimate(t){he._animate&&this._animationConfig&&he._animate(this._area,this._label,this._animationConfig,t)}getArea(){return this._area}getLabel(){return this._label}constructor(t,e){super(e!=null&&e.skipDefault?t:A({},he.defaultAttributes,t)),this.name="markArea",this.defaultUpdateAnimation=Eh,this.defaultExitAnimation=Ls}getPointAttrByPosition(t){const{x1:e,x2:i,y1:s,y2:a}=this._area.AABBBounds;return t.includes("left")||t.includes("Left")?{x:e,y:(s+a)/2}:t.includes("right")||t.includes("Right")?{x:i,y:(s+a)/2}:t.includes("top")||t.includes("Top")?{x:(e+i)/2,y:s}:t.includes("bottom")||t.includes("Bottom")?{x:(e+i)/2,y:a}:{x:(e+i)/2,y:(s+a)/2}}setLabelPos(){var t;if(this._label&&this._area){const{label:e={}}=this.attribute,i=(t=e.position)!==null&&t!==void 0?t:"middle",s=this.getPointAttrByPosition(i);if(this._label.setAttributes(Object.assign(Object.assign({},s),{textStyle:Object.assign(Object.assign({},zh[i]),e.textStyle)})),this.attribute.limitRect&&e.confine){const{x:a,y:n,width:r,height:l}=this.attribute.limitRect;Hn(this._label,{x1:a,y1:n,x2:a+r,y2:n+l})}}}initMarker(t){const{points:e,label:i,areaStyle:s,state:a}=this.attribute,n=Y.polygon(Object.assign({points:e},s));n.states=A({},R,a==null?void 0:a.area),n.name="mark-area-polygon",this._area=n,t.add(n);const r=new Oe(Object.assign(Object.assign({},i),{state:{panel:A({},R,a==null?void 0:a.labelBackground),text:A({},R,a==null?void 0:a.label)}}));r.name="mark-area-label",this._label=r,t.add(r),this.setLabelPos()}updateMarker(){const{points:t,label:e,areaStyle:i,state:s}=this.attribute;this._area&&(this._area.setAttributes(Object.assign({points:t},i)),this._area.states=A({},R,s==null?void 0:s.area)),this._label&&this._label.setAttributes(Object.assign(Object.assign({dx:0,dy:0},e),{state:{panel:A({},R,s==null?void 0:s.labelBackground),text:A({},R,s==null?void 0:s.label)}})),this.setLabelPos()}isValidPoints(){const{points:t}=this.attribute;if(!t||t.length<3)return!1;let e=!0;return t.forEach(i=>{w(i.x)&&w(i.y)||(e=!1)}),e}}he.defaultAttributes=Fh;Mh();function Yh(){de._animate=Dh}class de extends Ms{markerAnimate(t){de._animate&&this._animationConfig&&de._animate([this._line,this._decorativeLine],this._item,this._animationConfig,t)}constructor(t,e){super(e!=null&&e.skipDefault?t:A({},de.defaultAttributes,t)),this.name="markPoint",this.defaultUpdateAnimation=Ih,this.defaultExitAnimation=Ls,this._isArcLine=!1,this._isStraightLine=!1}setLabelPos(){}getTextAlignAttr(t,e,i,s,a){return Ct(Math.abs(s),Math.PI/2,Lt)||Ct(Math.abs(s),3*Math.PI/2,Lt)?pn(t,s,a):vi(s)?Da.postiveXAxis[a]:Da.negativeXAxis[a]}setItemAttributes(t,e,i,s,a){var n,r;if(!t)return;const{autoRotate:l=!0,refX:h=0,refY:d=0,refAngle:c=0,textStyle:u={},richTextStyle:g={},imageStyle:p={},position:_=hs.middle}=e,{state:m}=this.attribute,v=((n=this._line)===null||n===void 0?void 0:n.getEndAngle())||0,b=h*Math.cos(v)+d*Math.cos(v-Math.PI/2),y=h*Math.sin(v)+d*Math.sin(v-Math.PI/2);if(a==="text"){const x=s.x-i.x,M=s.y-i.y;t.setAttributes(Object.assign(Object.assign({},u),{textStyle:Object.assign(Object.assign({},this.getTextAlignAttr(l,x,M,v,(r=e.position)!==null&&r!==void 0?r:"end")),u.textStyle),state:{panel:A({},R,m==null?void 0:m.textBackground),text:A({},R,m==null?void 0:m.text)}}))}else a==="richText"?(t.setAttributes({dx:this.getItemDx(t,_,g)+(g.dx||0),dy:this.getItemDy(t,_,g)+(g.dy||0)}),t.states=A({},R,m==null?void 0:m.richText)):a==="image"&&(t.setAttributes({dx:this.getItemDx(t,_,p)+(p.dx||0),dy:this.getItemDy(t,_,p)+(p.dy||0)}),t.states=A({},R,m==null?void 0:m.image));const f=vi(v)?v:v-Math.PI;t.setAttributes({x:s.x+(b||0),y:s.y+(y||0),angle:l&&f+c})}getItemDx(t,e,i){var s,a;const n=(a=(s=t==null?void 0:t.AABBBounds)===null||s===void 0?void 0:s.width())!==null&&a!==void 0?a:(i==null?void 0:i.width)||0;return e.includes("inside")?-n:0}getItemDy(t,e,i){var s,a;const n=(a=(s=t==null?void 0:t.AABBBounds)===null||s===void 0?void 0:s.height())!==null&&a!==void 0?a:(i==null?void 0:i.height)||0;return e.includes("top")||e.includes("Top")?-n:e.includes("middle")||e.includes("Middle")?-n/2:0}initItem(t,e,i){const{state:s}=this.attribute,{type:a="text",symbolStyle:n,richTextStyle:r,imageStyle:l,renderCustomCallback:h}=t;let d;return a==="symbol"?(d=Y.symbol(Object.assign(Object.assign({},i),n)),d.states=A({},R,s==null?void 0:s.symbol)):a==="text"?d=new Oe(Object.assign(Object.assign({},i),{state:{panel:A({},R,s==null?void 0:s.textBackground),text:A({},R,s==null?void 0:s.text)}})):a==="richText"?(d=Y.richtext(Object.assign(Object.assign({},i),r)),d.states=A({},R,s==null?void 0:s.richText)):a==="image"?(d=Y.image(Object.assign(Object.assign({},i),l)),d.states=A({},R,s==null?void 0:s.image)):a==="custom"&&h&&(d=h(),d.states=A({},R,s==null?void 0:s.customMark)),d.name=`mark-point-${a}`,this.setItemAttributes(d,t,e,i,a),d}getItemLineAttr(t,e,i){let s=[],a={x:0,y:0},n=0,r=0,l=0;const{type:h="type-s",arcRatio:d=.8}=t,c=i.x-e.x,u=i.y-e.y;if(this._isStraightLine=Ct(c,0,Lt)||Ct(u,0,Lt),this._isArcLine){const{x:g,y:p}=e,{x:_,y:m}=i,v=(g+_)/2,b=(p+m)/2,y=p===m?0:-(g-_)/(p-m),f=v+d*(m>p?-1:1)*v,x=(M=>y*(M-v)+b)(f);r=is(p-x,g-f),l=is(m-x,_-f),a={x:f,y:x},d>0?l<r&&(l+=2*Math.PI):r<l&&(r+=2*Math.PI),n=Math.sqrt((f-g)*(f-g)+(x-p)*(x-p))}else s=h!=="type-do"||this._isStraightLine?h!=="type-po"||this._isStraightLine?h!=="type-op"||this._isStraightLine?[e,i]:[e,{x:e.x,y:i.y},i]:[e,{x:i.x,y:e.y},i]:[e,{x:(e.x+i.x)/2,y:i.y},i];return s=bo(s),{points:s,center:a,radius:n,startAngle:r,endAngle:l}}reDrawLine(t,e){this._line.release();const{startSymbol:i,endSymbol:s,lineStyle:a,type:n="type-s"}=t,{state:r}=this.attribute,l=this._isArcLine?pa:zt;this._container.removeChild(this._line),this._line=new l(Object.assign(Object.assign({},e),{pickable:!1,startSymbol:i,endSymbol:s,lineStyle:a,visible:t.visible,state:{line:A({},R,r==null?void 0:r.line),startSymbol:A({},R,r==null?void 0:r.lineStartSymbol),endSymbol:A({},R,r==null?void 0:r.lineEndSymbol)}})),this._container.add(this._line)}setItemLineAttr(t,e,i){if(this._line){const{startSymbol:s,endSymbol:a,lineStyle:n,type:r="type-s"}=t,{state:l}=this.attribute,h=this.getItemLineAttr(t,e,i);this._isArcLine&&this._line.key==="arc-segment"||!this._isArcLine&&this._line.key==="segment"?this._line.setAttributes(Object.assign(Object.assign({},h),{startSymbol:s,endSymbol:a,lineStyle:n,visible:t.visible,state:{line:A({},R,l==null?void 0:l.line),startSymbol:A({},R,l==null?void 0:l.lineStartSymbol),endSymbol:A({},R,l==null?void 0:l.lineEndSymbol)}})):this.reDrawLine(t,h)}}getDecorativeLineAttr(t){var e;const i=((e=t==null?void 0:t.decorativeLine)===null||e===void 0?void 0:e.length)||10,s=this._line.getEndAngle()||0;return{startPointOffsetX:i/2*Math.cos(s-Math.PI/2),startPointOffsetY:i/2*Math.sin(s-Math.PI/2),endPointOffsetX:-i/2*Math.cos(s-Math.PI/2),endPointOffsetY:-i/2*Math.sin(s-Math.PI/2)}}setDecorativeLineAttr(t,e,i){var s;if(this._decorativeLine){const{lineStyle:a}=t,{startPointOffsetX:n,startPointOffsetY:r,endPointOffsetX:l,endPointOffsetY:h}=this.getDecorativeLineAttr(t);this._decorativeLine.setAttributes(Object.assign(Object.assign({points:[{x:e.x+n,y:e.y+r},{x:e.x+l,y:e.y+h}]},a),{visible:i})),this._decorativeLine.states=A({},R,(s=this.attribute.state)===null||s===void 0?void 0:s.line)}}setTargetItemAttributes(t,e){var i,s;this._targetItem&&(this._targetItem.setAttributes(Object.assign({x:e.x,y:e.y,visible:(i=t.visible)!==null&&i!==void 0&&i,size:t.size},t.style)),this._targetItem.states=A({},R,(s=this.attribute.state)===null||s===void 0?void 0:s.targetItem))}setAllOfItemsAttr(t,e){var i;const{position:s,itemLine:a={},itemContent:n={},limitRect:r,targetSymbol:l}=this.attribute,{type:h="text",confine:d}=n;if(r&&d){const{x:c,y:u,width:g,height:p}=r,{dx:_,dy:m}=zn(this._item,{x1:c,y1:u,x2:c+g,y2:u+p});e.x=e.x+_,e.y=e.y+m}this.setTargetItemAttributes(l,s),this.setItemLineAttr(a,t,e),this.setItemAttributes(this._item,n,t,e,h),this.setDecorativeLineAttr(a,e,(i=a.decorativeLine)===null||i===void 0?void 0:i.visible)}computeNewPositionAfterTargetItem(t){var e,i;const{itemContent:s={},targetSymbol:a}=this.attribute,{offsetX:n=0,offsetY:r=0}=s,{offset:l=0,style:h,visible:d=!1,size:c}=a,u=d?(i=(e=h.size)!==null&&e!==void 0?e:c)!==null&&i!==void 0?i:20:0,g=is(r,n);return{newPosition:{x:t.x+(u/2+l)*Math.cos(g),y:t.y+(u/2+l)*Math.sin(g)},newItemPosition:{x:t.x+(u/2+l)*Math.cos(g)+n,y:t.y+(u/2+l)*Math.sin(g)+r}}}initMarker(t){const{position:e,itemContent:i={},itemLine:s}=this.attribute,{type:a="type-s",arcRatio:n=.8}=s,{offsetX:r=0,offsetY:l=0}=i;this._isStraightLine=Ct(r,0,Lt)||Ct(l,0,Lt),this._isArcLine=a==="type-arc"&&n!==0&&!this._isStraightLine;const{newPosition:h,newItemPosition:d}=this.computeNewPositionAfterTargetItem(e),c=new(this._isArcLine?pa:zt)({points:[],pickable:!1,center:{x:0,y:0},radius:0,startAngle:0,endAngle:0});c.name="mark-point-line",this._line=c,t.add(c);const u=Y.line({points:[]});u.name="mark-point-decorativeLine",this._decorativeLine=u,t.add(u);const g=Y.symbol({});g.name="mark-point-targetItem",this._targetItem=g,t.add(this._targetItem);const p=this.initItem(i,h,d);this._item=p,t.add(p),this.setAllOfItemsAttr(h,d)}updateMarker(){const{position:t,itemContent:e={},itemLine:i}=this.attribute,{type:s="text"}=e,{type:a="type-s",arcRatio:n=.8}=i,{offsetX:r=0,offsetY:l=0}=e;this._isStraightLine=Ct(r,0,Lt)||Ct(l,0,Lt);const h=a==="type-arc"&&n!==0&&!this._isStraightLine,{newPosition:d,newItemPosition:c}=this.computeNewPositionAfterTargetItem(t);h!==this._isArcLine?(this._isArcLine=h,this.reDrawLine(i,{points:[{x:0,y:0}],pickable:!1,center:{x:0,y:0},radius:0,startAngle:0,endAngle:0})):this._isArcLine=h,this.setItemAttributes(this._item,e,d,c,s),this.setAllOfItemsAttr(d,c)}isValidPoints(){const{position:t}=this.attribute;return!(!w(t.x)||!w(t.y))}}de.defaultAttributes=Hh;var dt;(function(o){o.drawStart="drawStart",o.drawEnd="drawEnd",o.drawing="drawing",o.moving="moving",o.moveStart="moveStart",o.moveEnd="moveEnd",o.brushClear="brushClear"})(dt||(dt={}));const It={trigger:"pointerdown",updateTrigger:"pointermove",endTrigger:"pointerup",resetTrigger:"pointerupoutside",hasMask:!0,brushMode:"single",brushType:"rect",brushStyle:{fill:"#B0C8F9",fillOpacity:.2,stroke:"#B0C8F9",strokeWidth:2},brushMoved:!0,removeOnClick:!0,delayType:"throttle",delayTime:10,interactiveRange:{y1:-1/0,y2:1/0,x1:-1/0,x2:1/0}},Xh=5;function Gh(){Qt(),ps()}const Uh={debounce:ms,throttle:zi};Gh();let ar=class nr extends qt{constructor(t,e){super(e!=null&&e.skipDefault?t:A({},nr.defaultAttributes,t)),this.name="brush",this._activeDrawState=!1,this._cacheDrawPoints=[],this._isDrawedBeforeEnd=!1,this._activeMoveState=!1,this._operatingMaskMoveDx=0,this._operatingMaskMoveDy=0,this._operatingMaskMoveRangeX=[-1/0,1/0],this._operatingMaskMoveRangeY=[-1/0,1/0],this._brushMaskAABBBoundsDict={},this._onBrushStart=i=>{var s;if(this._outOfInteractiveRange(i))return;i.stopPropagation();const a=(s=this.attribute.brushMoved)===null||s===void 0||s;this._activeMoveState=a&&this._isPosInBrushMask(i),this._activeDrawState=!this._activeMoveState,this._activeDrawState&&this._initDraw(i),this._activeMoveState&&this._initMove(i)},this._onBrushing=i=>{this._outOfInteractiveRange(i)||((this._activeDrawState||this._activeMoveState)&&i.stopPropagation(),this._activeDrawState&&this._drawing(i),this._activeMoveState&&this._moving(i))},this._onBrushingWithDelay=this.attribute.delayTime===0?this._onBrushing:Uh[this.attribute.delayType](this._onBrushing,this.attribute.delayTime),this._onBrushEnd=i=>{var s;if(!this._activeDrawState&&!this._activeMoveState)return;i.preventDefault();const{removeOnClick:a=!0}=this.attribute;this._activeDrawState&&!this._isDrawedBeforeEnd&&a?(!((s=this._operatingMask)===null||s===void 0)&&s._AABBBounds.empty()&&this._dispatchEvent(dt.brushClear,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:i}),this._container.incrementalClearChild(),this._brushMaskAABBBoundsDict={}):(this._activeDrawState&&this._dispatchEvent(dt.drawEnd,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:i}),this._activeMoveState&&this._dispatchEvent(dt.moveEnd,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:i})),this._activeDrawState=!1,this._activeMoveState=!1,this._isDrawedBeforeEnd=!1,this._operatingMask&&this._operatingMask.setAttribute("pickable",!1)}}_bindBrushEvents(){if(this.attribute.disableTriggerEvent)return;const{trigger:t=It.trigger,updateTrigger:e=It.updateTrigger,endTrigger:i=It.endTrigger,resetTrigger:s=It.resetTrigger}=this.attribute;this.stage.addEventListener(t,this._onBrushStart),this.stage.addEventListener(e,this._onBrushingWithDelay),this.stage.addEventListener(i,this._onBrushEnd),this.stage.addEventListener(s,this._onBrushEnd)}_isPosInBrushMask(t){const e=this.eventPosToStagePos(t),i=this._container.getChildren();for(let s=0;s<i.length;s++){const{points:a=[],dx:n=0,dy:r=0}=i[s].attribute,l=a.map(h=>({x:h.x+n,y:h.y+r}));if(fo(l,e.x,e.y))return this._operatingMask=i[s],!0}return!1}_initDraw(t){const{brushMode:e}=this.attribute,i=this.eventPosToStagePos(t);this._cacheDrawPoints=[i],this._isDrawedBeforeEnd=!1,e==="single"&&(this._brushMaskAABBBoundsDict={},this._container.incrementalClearChild()),this._addBrushMask(),this._dispatchEvent(dt.drawStart,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:t})}_initMove(t){var e,i;this._cacheMovePoint=this.eventPosToStagePos(t),this._operatingMaskMoveDx=(e=this._operatingMask.attribute.dx)!==null&&e!==void 0?e:0,this._operatingMaskMoveDy=(i=this._operatingMask.attribute.dy)!==null&&i!==void 0?i:0;const{interactiveRange:s}=this.attribute,{minY:a=-1/0,maxY:n=1/0,minX:r=-1/0,maxX:l=1/0}=s,{x1:h,x2:d,y1:c,y2:u}=this._operatingMask.globalAABBBounds,g=r-h,p=l-d,_=a-c,m=n-u;this._operatingMaskMoveRangeX=[g,p],this._operatingMaskMoveRangeY=[_,m],this._operatingMask.setAttribute("pickable",!0),this._dispatchEvent(dt.moveStart,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:t})}_drawing(t){var e,i;const s=this.eventPosToStagePos(t),{sizeThreshold:a=Xh,brushType:n}=this.attribute,r=this._cacheDrawPoints.length;if(r>0){const g=(e=this._cacheDrawPoints[this._cacheDrawPoints.length-1])!==null&&e!==void 0?e:{};if(s.x===g.x&&s.y===g.y)return}n==="polygon"||r<=1?this._cacheDrawPoints.push(s):this._cacheDrawPoints[r-1]=s;const l=this._computeMaskPoints();this._operatingMask.setAttribute("points",l);const{x1:h=0,x2:d=0,y1:c=0,y2:u=0}=(i=this._operatingMask)===null||i===void 0?void 0:i._AABBBounds;this._isDrawedBeforeEnd=!this._operatingMask._AABBBounds.empty()&&(Math.abs(d-h)>a||Math.abs(c-u)>a),this._isDrawedBeforeEnd&&(this._brushMaskAABBBoundsDict[this._operatingMask.name]=this._operatingMask.AABBBounds,this._dispatchEvent(dt.drawing,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:t}))}_moving(t){const e=this._cacheMovePoint,i=this.eventPosToStagePos(t);if(i.x===(e==null?void 0:e.x)&&i.y===(e==null?void 0:e.y))return;const s=i.x-e.x,a=i.y-e.y,n=Math.min(this._operatingMaskMoveRangeX[1],Math.max(this._operatingMaskMoveRangeX[0],s))+this._operatingMaskMoveDx,r=Math.min(this._operatingMaskMoveRangeY[1],Math.max(this._operatingMaskMoveRangeY[0],a))+this._operatingMaskMoveDy;this._operatingMask.setAttributes({dx:n,dy:r}),this._brushMaskAABBBoundsDict[this._operatingMask.name]=this._operatingMask.AABBBounds,this._dispatchEvent(dt.moving,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:t})}_computeMaskPoints(){const{brushType:t,xRange:e=[0,0],yRange:i=[0,0]}=this.attribute;let s=[];const a=this._cacheDrawPoints[0],n=this._cacheDrawPoints[this._cacheDrawPoints.length-1];return s=t==="rect"?[a,{x:n.x,y:a.y},n,{x:a.x,y:n.y}]:t==="x"?[{x:a.x,y:i[0]},{x:n.x,y:i[0]},{x:n.x,y:i[1]},{x:a.x,y:i[1]}]:t==="y"?[{x:e[0],y:a.y},{x:e[0],y:n.y},{x:e[1],y:n.y},{x:e[1],y:a.y}]:gi(this._cacheDrawPoints),s}_addBrushMask(){var t;const{brushStyle:e,hasMask:i}=this.attribute,s=Y.polygon(Object.assign(Object.assign({points:gi(this._cacheDrawPoints),cursor:"move",pickable:!1},e),{opacity:i?(t=e.opacity)!==null&&t!==void 0?t:1:0}));s.name=`brush-${Date.now()}`,this._operatingMask=s,this._container.add(s),this._brushMaskAABBBoundsDict[s.name]=s.AABBBounds}_outOfInteractiveRange(t){const{interactiveRange:e}=this.attribute,{minY:i=-1/0,maxY:s=1/0,minX:a=-1/0,maxX:n=1/0}=e,r=this.eventPosToStagePos(t);return r.x>n||r.x<a||r.y>s||r.y<i}eventPosToStagePos(t){return this.stage.eventPointTransform(t)}render(){this._bindBrushEvents();const t=this.createOrUpdateChild("brush-container",{},"group");this._container=t}releaseBrushEvents(){const{delayType:t="throttle",delayTime:e=0,trigger:i=It.trigger,updateTrigger:s=It.updateTrigger,endTrigger:a=It.endTrigger,resetTrigger:n=It.resetTrigger}=this.attribute;this.stage.removeEventListener(i,this._onBrushStart),this.stage.removeEventListener(s,this._onBrushingWithDelay),this.stage.removeEventListener(a,this._onBrushEnd),this.stage.removeEventListener(n,this._onBrushEnd)}};ar.defaultAttributes=It;function ss(o){return function(t){let e;return e=U(o)?o.reduce((i,s)=>i==null?void 0:i[s],t):t==null?void 0:t[o],e}}class rr extends _n{parseAddition(t){return super.parseAddition(t),this.scale(t.scale),this}scale(t){if(this.spec.scale){const i=X(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this.detach(i),this.spec.scale=void 0}const e=X(t)?this.view.getScaleById(t):t;return this.spec.scale=e,this.attach(e),this._updateComponentEncoders(),this.commit(),this}getScale(){return X(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale}}const Zh=(o,t,e,i)=>{var s,a,n,r;const l=(a=(s=t==null?void 0:t.components)===null||s===void 0?void 0:s.axis)!==null&&a!==void 0?a:{};if(!o)return A({},l,e??{});const h=[((r=(n=o.tickData)===null||n===void 0?void 0:n.call(o,i))!==null&&r!==void 0?r:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}))];return A({},l,{items:h},e??{})},Nh=(o,t,e,i)=>{var s,a,n,r;const l=(a=(s=t==null?void 0:t.components)===null||s===void 0?void 0:s.circleAxis)!==null&&a!==void 0?a:{};if(!o)return A({},l,e??{});const h=[((r=(n=o.tickData)===null||n===void 0?void 0:n.call(o,i))!==null&&r!==void 0?r:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}))];return A({},l,{items:h},e??{})},or=(o,t,e,i,s,a)=>{var n;const r=o.getCoordinateAxisPosition();s&&s.position==="auto"&&(s.position=e?"content":r);const l=o.getCoordinateAxisPoints(i);if(l){const c={start:l[0],end:l[1],verticalFactor:(r==="top"||r==="left"?-1:1)*(e?-1:1)*(!((n=o.getSpec().range)===null||n===void 0)&&n.reversed?-1:1)};if(a&&t.type==="polar"){const u=t.angle();c.center=t.origin(),c.startAngle=u[0],c.endAngle=u[1]}return c}const h=t.radius(),d=t.angle();return{center:t.origin(),radius:h[1],innerRadius:h[0],inside:e,startAngle:d[0],endAngle:d[1]}};class lr extends rr{constructor(t,e,i){super(t,bt.axis,e),this.spec.componentType=bt.axis,this.mode=i}parseAddition(t){return super.parseAddition(t),this.axisType(t.axisType),this.tickCount(t.tickCount),this.inside(t.inside),this.baseValue(t.baseValue),this}scale(t){return super.scale(t),this._axisComponentType=null,this}axisType(t){return this.spec.axisType=t,this._axisComponentType=null,this._prepareRejoin(),this.commit(),this}addGraphicItem(t,e){const i=A({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},t),s=Dt.createGraphicComponent(this._getAxisComponentType(),i,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(i,e,s)}tickCount(t){const e=X(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return e&&e.tickCount(t),this.setFunctionSpec(t,"tickCount")}inside(t){return this.setFunctionSpec(t,"inside")}baseValue(t){return this.setFunctionSpec(t,"baseValue")}getAxisComponentType(){return this._axisComponentType}_updateComponentEncoders(){const t=X(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale,e=Object.assign({update:{}},this.spec.encode),i=Object.keys(e).reduce((s,a)=>{const n=e[a];return n&&(s[a]={callback:(r,l,h)=>{var d,c;const u=this.spec.skipTheme?null:this.view.getCurrentTheme();let g=je(n,r,l,h);const p=Nt(this.spec.inside,h,r,l),_=Nt(this.spec.baseValue,h,r,l),m=(d=t==null?void 0:t.getCoordinate)===null||d===void 0?void 0:d.call(t);m&&(g=Object.assign(or(t,m,p,_,this.spec.layout),g));const v=(c=t==null?void 0:t.getScale)===null||c===void 0?void 0:c.call(t),b=Nt(this.spec.tickCount,h,r,l);switch(this._getAxisComponentType()){case ne.lineAxis:return Zh(v,u,g,b);case ne.circleAxis:return Nh(v,u,g,b)}return g}}),s},{});this._encoders=i}_getAxisComponentType(){var t;if(this._axisComponentType)return this._axisComponentType;let e=this.spec.axisType;if(C(e)){const i=X(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;e=!((t=i==null?void 0:i.getCoordinate)===null||t===void 0)&&t.call(i)?i.getCoordinateAxisPoints()?"line":"circle":"line"}return this._axisComponentType=e==="circle"?ne.circleAxis:ne.lineAxis,this._axisComponentType}}lr.componentType=bt.axis;const Wi=()=>{Dt.registerGraphicComponent(ne.lineAxis,(o,t)=>new Je(o,t)),Dt.registerComponent(bt.axis,lr)},Wh=(o,t,e,i,s,a={})=>{var n;const r=(n=a.components)===null||n===void 0?void 0:n.dataLabel,l=o.map((h,d)=>{var c,u,g,p,_;const m=Object.assign(Object.assign({},s),{labelIndex:d}),v=(c=Nt(i,m,h))!==null&&c!==void 0?c:{},{components:b={}}=a;let y={};switch(h.markType){case xt.line:case xt.area:y=v.type==="line"?b.lineLabel:v.type==="area"?b.areaLabel:b.lineDataLabel;break;case xt.rect:case xt.rect3d:case xt.interval:y=b.rectLabel;break;case xt.symbol:case xt.circle:case xt.cell:y=b.symbolLabel;break;case xt.arc:case xt.arc3d:y=b.arcLabel;break;case xt.polygon:case xt.path:default:y=b.pointLabel}const f=(u=v.data)!==null&&u!==void 0?u:[],x=(p=(g=y==null?void 0:y.data)===null||g===void 0?void 0:g[0])!==null&&p!==void 0?p:{};f&&f.length>0?f.forEach((k,D)=>{if(h.elements[D]){const O=je(e,k,h.elements[D],m);A(k,x,O)}}):h.elements.forEach(k=>{if(k.getGraphicItem().releaseStatus!=="willRelease")if(h.isCollectionMark())k.getDatum().forEach(D=>{const O=je(e,D,k,m);f.push(A({},x,O))});else{const D=je(e,k.getDatum(),k,m),O=A({},x,D);f.push(O)}});const M=(_=h.graphicItem)===null||_===void 0?void 0:_.name;return A({},y,{data:f,baseMarkGroupName:M,getBaseMarks:()=>h.elements.map(k=>k.getGraphicItem())},v??{})}).filter(h=>!C(h));return A({},r,{size:t,dataLabels:l})};let hr=class extends _n{constructor(t,e){super(t,bt.label,e),this.spec.componentType=bt.label}parseAddition(t){return super.parseAddition(t),this.labelStyle(t.labelStyle),this.size(t.size),this.target(t.target),this}labelStyle(t){return this.setFunctionSpec(t,"labelStyle")}size(t){return this.setFunctionSpec(t,"size")}target(t){if(this.spec.target){const e=L(this.spec.target).map(i=>X(i)?this.view.getMarkById(i):i);this.detach(e)}if(this.spec.target=t,t){const e=L(t).map(i=>X(i)?this.view.getMarkById(i):i);this.attach(e)}return this.commit(),this}_updateComponentEncoders(){const t=Object.assign({update:{}},this.spec.encode),e=Object.keys(t).reduce((i,s)=>{const a=t[s];return a&&(i[s]={callback:(n,r,l)=>{var h,d,c,u;const g=L(this.spec.target).map(v=>X(v)?this.view.getMarkById(v):v),p=(d=(h=this.group)===null||h===void 0?void 0:h.getGroupGraphicItem)===null||d===void 0?void 0:d.call(h);let _=Nt(this.spec.size,l);_||(_=p?{width:(c=p.attribute.width)!==null&&c!==void 0?c:p.AABBBounds.width(),height:(u=p.attribute.height)!==null&&u!==void 0?u:p.AABBBounds.height()}:{width:1/0,height:1/0});const m=this.spec.skipTheme?null:this.view.getCurrentTheme();return Wh(g,_,a,this.spec.labelStyle,l,m)}}),i},{});this._encoders=e}};hr.componentType=bt.label;const dr=()=>{Dt.registerGraphicComponent(bt.label,o=>new Ui(o)),Dt.registerComponent(bt.label,hr)},$h=(o,t,e,i)=>{var s,a,n,r;const l=(a=(s=t==null?void 0:t.components)===null||s===void 0?void 0:s.grid)!==null&&a!==void 0?a:{};if(!o)return A({},l,e??{});const h=((r=(n=o.tickData)===null||n===void 0?void 0:n.call(o,i))!==null&&r!==void 0?r:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}));return A({},l,{items:h},e??{})},Kh=(o,t,e,i)=>{var s,a,n,r;const l=(a=(s=t==null?void 0:t.components)===null||s===void 0?void 0:s.circleGrid)!==null&&a!==void 0?a:{};if(!o)return A({},l,e??{});const h=((r=(n=o.tickData)===null||n===void 0?void 0:n.call(o,i))!==null&&r!==void 0?r:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}));return A({},l,{items:h},e??{})};class cr extends rr{constructor(t,e,i){super(t,bt.grid,e),this.spec.componentType=bt.grid,this.mode=i}parseAddition(t){return super.parseAddition(t),this.target(t.target),this.gridType(t.gridType),this.gridShape(t.gridShape),this}scale(t){return super.scale(t),this._gridComponentType=null,this}gridType(t){return this.spec.gridType=t,this._gridComponentType=null,this._prepareRejoin(),this.commit(),this}gridShape(t){return this.spec.gridShape=t,this.commit(),this}target(t){if(this.spec.target){const i=X(this.spec.target)?this.view.getMarkById(this.spec.target):this.spec.target;this.detach(i)}this.spec.target=t;const e=X(t)?this.view.getMarkById(t):t;return this.attach(e),this._targetAxis=e,this._gridComponentType=null,this._updateComponentEncoders(),this.commit(),this}tickCount(t){const e=X(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return e&&e.tickCount(t),this.setFunctionSpec(t,"tickCount")}inside(t){return this.setFunctionSpec(t,"inside")}baseValue(t){return this.setFunctionSpec(t,"baseValue")}addGraphicItem(t,e){const i=A({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},t),s=Dt.createGraphicComponent(this._getGridComponentType(),i,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(i,e,s)}_updateComponentEncoders(){const t=Object.assign({update:{}},this.spec.encode),e=Object.keys(t).reduce((i,s)=>{const a=t[s];return a&&(i[s]={callback:(n,r,l)=>{var h,d,c,u;const g=this.spec.skipTheme?null:this.view.getCurrentTheme();let p,_=je(a,n,r,l);const m=Nt(this.spec.baseValue,l,n,r);if(this._targetAxis){const y=(h=this._targetAxis.getSpec())===null||h===void 0?void 0:h.scale;p=X(y)?this.view.getScaleById(y):y;const f=this._targetAxis.elements[0];if(f)switch(this._getGridComponentType()){case lt.lineAxisGrid:_=Object.assign({x:f.getGraphicAttribute("x"),y:f.getGraphicAttribute("y"),start:f.getGraphicAttribute("start"),end:f.getGraphicAttribute("end"),verticalFactor:(d=f.getGraphicAttribute("verticalFactor"))!==null&&d!==void 0?d:1},_);break;case lt.circleAxisGrid:_=Object.assign({x:f.getGraphicAttribute("x"),y:f.getGraphicAttribute("y"),center:f.getGraphicAttribute("center"),radius:f.getGraphicAttribute("radius"),innerRadius:f.getGraphicAttribute("innerRadius"),inside:f.getGraphicAttribute("inside"),startAngle:f.getGraphicAttribute("startAngle"),endAngle:f.getGraphicAttribute("endAngle")},_)}}else{p=X(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;const y=Nt(this.spec.inside,l,n,r),f=(c=p==null?void 0:p.getCoordinate)===null||c===void 0?void 0:c.call(p);f&&(_=Object.assign(or(p,f,y,m,this.spec.layout,!0),_))}this._getGridComponentType()===lt.lineAxisGrid&&(_=this.spec.gridShape!=="line"&&this.spec.gridShape?Object.assign({center:_.start,closed:!0},_,{type:this.spec.gridShape}):Object.assign({},_,{type:"line"}));const v=(u=p==null?void 0:p.getScale)===null||u===void 0?void 0:u.call(p),b=Nt(this.spec.tickCount,l,n,r);switch(this._getGridComponentType()){case lt.lineAxisGrid:return $h(v,g,_,b);case lt.circleAxisGrid:return Kh(v,g,_,b)}return _}}),i},{});this._encoders=e}_getGridComponentType(){var t;if(this._gridComponentType)return this._gridComponentType;if(this.spec.gridType)this.spec.gridType==="circle"?this._gridComponentType=lt.circleAxisGrid:this._gridComponentType=lt.lineAxisGrid;else if(this._targetAxis)switch(this._targetAxis.getAxisComponentType()){case ne.circleAxis:this._gridComponentType=lt.circleAxisGrid;break;case ne.lineAxis:default:this._gridComponentType=lt.lineAxisGrid}else if(this.spec.scale){const e=X(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this._gridComponentType=!((t=e==null?void 0:e.getCoordinate)===null||t===void 0)&&t.call(e)?e.getCoordinateAxisPoints()?lt.lineAxisGrid:lt.circleAxisGrid:lt.lineAxisGrid}else this._gridComponentType=lt.lineAxisGrid;return this._gridComponentType}}cr.componentType=bt.grid;const $i=()=>{Dt.registerGraphicComponent(lt.lineAxisGrid,(o,t)=>new Jn(o,t)),Dt.registerComponent(bt.grid,cr)};function ur(o){return o.reduce((t,e)=>t+e,0)}function qh(o){return o.length===0?0:ur(o)/o.length}const Qh={min:Ft,max:Bt,average:qh,sum:ur};function Jh(o,t,e,i){const s=Math.floor(t.length/o),a=[],n=t.length;let r,l,h,d=0,c=0;a[c++]=d;for(let u=1;u<n-1;u+=s){const g=Math.min(u+s,n-1),p=Math.min(u+2*s,n),_=(p+g)/2;let m=0;for(let x=g;x<p;x++){const M=t[x][i];Number.isNaN(M)||(m+=M)}m/=p-g;const v=u,b=Math.min(u+s,n),y=u-1,f=t[d][i];r=-1,h=v;for(let x=v;x<b;x++){const M=t[x][i];Number.isNaN(i)||(l=Math.abs((y-_)*(M-f)-(y-x)*(m-f)),l>r&&(r=l,h=x))}a[c++]=h,d=h}return a[c-1]!==n-1&&(a[c++]=n-1),a.map(u=>e?t[u].i:u)}function Ki(o,t,e,i,s){let a=Math.floor(t.length/o);const n=[],r=t.length;let l=0,h=[];n.push(l),t[l][s]=t[l][s];for(let d=1;d<r-1;d+=a){a>r-d&&(a=r-d,h.length=a),h=[];for(let u=0;u<a;u++)h.push(t[d+u][s]);const c=Qh[i](h);l=Math.min(Math.round(d+h.length/2)||0,r-1),t[l][s]=c,n.push(l)}return n.map(d=>e?t[d].i:d)}function td(o,t,e,i){return Ki(o,t,e,"min",i)}function ed(o,t,e,i){return Ki(o,t,e,"max",i)}function id(o,t,e,i){return Ki(o,t,e,"average",i)}function sd(o,t,e,i){return Ki(o,t,e,"sum",i)}const ad=(o,t)=>{let e=o.size;const i=o.factor||1;if(Array.isArray(e)&&(e=Math.floor(e[1]-e[0])),e*=i,e<=0)return[];if(t.length<=e)return t;if(o.skipfirst)return t.slice(0,1);const{mode:s,yfield:a,groupBy:n}=o,r=a??"y";let l=Jh;if(s==="min"?l=td:s==="max"?l=ed:s==="average"?l=id:s==="sum"&&(l=sd),t.length){const h={};if(n){for(let c=0,u=t.length;c<u;c++){const g=t[c],p=g[n];h[p]?h[p].push({[r]:g[r],i:c}):(h[p]=[],h[p].push({[r]:g[r],i:c}))}let d=[];return Object.keys(h).forEach(c=>{const u=h[c];if(u.length<=e){const g=u.map(p=>p.i);d=d.concat(g)}else{const g=l(e,u,!0,r);d=d.concat(g),u.forEach(p=>t[p.i][r]=p[r])}}),d.sort((c,u)=>c-u),d.map(c=>t[c])}return l(e,t,!1,r).map(d=>t[d])}return[]};function nd(o){return o.forEach(t=>{t.getGraphicAttribute($e)&&(t.setGraphicAttribute("visible",!0),t.setGraphicAttribute($e,!1))}),o}function rd(o,t,e,i){if(i){let s=-1/0,a=0;const n=C(t);let r=t;o.forEach(l=>{if(l.getGraphicAttribute("visible")===!1)return;const h=l.getGraphicAttribute("size")/2,d=l.getGraphicAttribute("x");n&&(r=(h+a)*e),Math.abs(d-s)<r+a+h?l.getGraphicAttribute("forceShow")||(l.setGraphicAttribute($e,!0),l.setGraphicAttribute("visible",!1)):s=d,a=h})}}function od(o,t,e,i){if(i){let s=-1/0,a=0;const n=C(t);let r=t;o.forEach(l=>{if(l.getGraphicAttribute("visible")===!1)return;const h=l.getGraphicAttribute("size")/2,d=l.getGraphicAttribute("y");n&&(r=(h+a)*e),Math.abs(d-s)<r+a+h?l.getGraphicAttribute("forceShow")||(l.setGraphicAttribute($e,!0),l.setGraphicAttribute("visible",!1)):s=d,a=h})}}function ld(o,t,e,i){if(i){let a=-1/0,n=0,r=0;const l=C(t);let h=t;o.forEach(d=>{if(d.getGraphicAttribute("visible")===!1)return;const c=d.getGraphicAttribute("size")/2,u=d.getGraphicAttribute("x"),g=d.getGraphicAttribute("y");l&&(h=(c+n)*e),r=(-1/0-u)**2+(a-g)**2,r<(h+n+c)**2?d.getGraphicAttribute("forceShow")||(d.setGraphicAttribute($e,!0),d.setGraphicAttribute("visible",!1)):a=g,n=c})}}const hd=(o,t)=>{if(!t||t.length===0)return;let{radius:e}=o;C(e)&&t[0].mark.markType==="symbol"&&(e=!0);const{direction:i,delta:s,deltaMul:a=1,groupBy:n}=o,r=l=>{nd(l);const h=o.sort?l.slice().sort((d,c)=>d.getGraphicAttribute("x")-c.getGraphicAttribute("x")):l;i===0?ld(h,s,a,e):i===1?rd(h,s,a,e):od(h,s,a,e)};if(n){const l=t.reduce((h,d)=>{const c=d.getDatum()[n];return h[c]?h[c].push(d):h[c]=[d],h},{});Object.keys(l).forEach(h=>{r(l[h])})}else r(t);return t},Ps=()=>{Dt.registerTransform("sampling",{transform:ad,markPhase:"afterEncode"},!0)},gr=()=>{Dt.registerTransform("markoverlap",{transform:hd,markPhase:"afterEncode"},!0)},pr="monotone",dd="linear",cd="bevel",ie={point:{name:"point",type:"symbol"},line:{name:"line",type:"line"}};class _r{addSamplingCompile(){if(this._spec.sampling){const{width:t,height:e}=this._region.getLayoutRect(),i=[],s=this._fieldY,a=this._fieldX;i.push({type:"sampling",size:this._direction==="horizontal"?e:t,factor:this._spec.samplingFactor,yfield:this._direction==="horizontal"?a[0]:s[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(i)}}addOverlapCompile(){var t;if(this._spec.markOverlap){const e=[];e.push({type:"markoverlap",direction:this._direction==="horizontal"&&this.coordinate==="cartesian"?2:1,delta:this._spec.pointDis,deltaMul:this._spec.pointDisMul,groupBy:this._seriesField}),(t=this._symbolMark)===null||t===void 0||t.getProduct().transform(e)}}reCompileSampling(){this._spec.sampling&&this.compile()}initLineMark(t,e){var i,s;return this._lineMark=this._createMark(ie.line,{defaultMorphElementKey:this.getDimensionField()[0],groupKey:this._seriesField,isSeriesMark:e==null||e,progressive:t,customShape:(i=this._spec.line)===null||i===void 0?void 0:i.customShape,stateSort:(s=this._spec.line)===null||s===void 0?void 0:s.stateSort}),this._lineMark}initLineMarkStyle(t,e){var i,s;const a=this._lineMark;if(a){if(this.setMarkStyle(a,{stroke:this.getColorAttribute()},"normal",I.Series),this._invalidType!=="zero"&&this.setMarkStyle(a,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",I.Series),this.event.on(z.viewDataStatisticsUpdate,{filter:n=>n.model===this},()=>{this.encodeDefined(a,"defined")}),this.coordinate==="polar")this.setMarkStyle(a,{lineJoin:cd,curveType:dd,closePath:!0},"normal",I.Series);else{const n=e??((s=(i=this.getSpec().line)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.curveType),r=n===pr?t==="horizontal"?"monotoneY":"monotoneX":n;this.setMarkStyle(a,{curveType:r},"normal",I.Built_In)}this.setMarkStyle(a,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",I.Series)}return a}_getEventElement(t,e=!1){let i=[];return t.dimensionInfo.some(s=>(s.data.some(a=>a.series===this&&(i=a.datum,!0)),!i.length)),i}_dimensionTrigger(t){const e=this._getEventElement(t);switch(t.action){case"enter":this._symbolActiveMark.getDataView().parse(e),this._symbolActiveMark.getData().updateData(!1);break;case"leave":this._symbolActiveMark.getDataView().parse([]),this._symbolActiveMark.getData().updateData(!1)}}initSymbolMark(t,e){const i=this._spec.point||{};if(i.visible!==!1&&(this._symbolMark=this._createMark(ie.point,{morph:Hi(this._spec,ie.point.name),defaultMorphElementKey:this.getDimensionField()[0],groupKey:this._seriesField,progressive:t,isSeriesMark:!!e,customShape:i.customShape,stateSort:i.stateSort})),this._spec.activePoint===!0){const s=new St(this._option.dataSet,{name:`${Ke}_series_${this.id}_active_point`});s.parse([]),this._symbolActiveMark=this._createMark({name:`active_point_${this.id}`,type:"symbol"},{morph:!1,groupKey:this._seriesField,isSeriesMark:!1,dataView:s,parent:this._region.getInteractionMark(),customShape:i.customShape,stateSort:i.stateSort}),this._symbolActiveMark.setVisible(!1)}return this._symbolMark}initSymbolMarkStyle(){const t=this._symbolMark;if(!t)return this._initSymbolActiveMarkAlone(),t;if(this._initSymbolMark(t),this._symbolActiveMark&&this._symbolMark.stateStyle.dimension_hover){this._symbolActiveMark.setVisible(!0),this.event.on(Zs.dimensionHover,this._dimensionTrigger.bind(this));for(const e in this._symbolMark.stateStyle){this._symbolActiveMark.stateStyle[e]={};for(const i in this._symbolMark.stateStyle[e])this._symbolActiveMark.stateStyle[e][i]={style:null,level:I.Series,referer:t}}this._symbolActiveMark.state.changeStateInfo({stateValue:ee.STATE_DIMENSION_HOVER,filter:()=>!0})}return t}_initSymbolMark(t){t&&(this.setMarkStyle(t,{fill:this.getColorAttribute()},"normal",I.Series),this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)},"normal",I.Series),this.event.on(z.viewDataStatisticsUpdate,{filter:e=>e.model===this},()=>{this.encodeDefined(t,"visible")}),this.setMarkStyle(t,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",I.Series))}_initSymbolActiveMarkAlone(){var t,e;const i=this._symbolActiveMark;i&&(this._initSymbolMark(i),i&&(!((e=(t=this._spec[ie.point.name])===null||t===void 0?void 0:t.state)===null||e===void 0)&&e.dimension_hover)&&(i.setVisible(!0),this.event.on(Zs.dimensionHover,this._dimensionTrigger.bind(this)),this.initMarkStyleWithSpec(i,q({},this._spec[ie.point.name],{visible:!0})),this._symbolActiveMark.state.changeStateInfo({stateValue:ee.STATE_DIMENSION_HOVER,filter:()=>!0})))}initLabelMarkStyle(t){var e;t&&(((e=t.getTarget())===null||e===void 0?void 0:e.type)!=="symbol"&&t.setRule("line-data"),this.setMarkStyle(t,{fill:this.getColorAttribute(),text:i=>i[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null}),this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)},"normal",I.Series),this.event.on(z.viewDataStatisticsUpdate,{filter:i=>i.model===this},()=>{this.encodeDefined(t,"visible")}))}initLineLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this.getSeriesField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null})}encodeDefined(t,e){var i,s,a,n;if(!t)return;const r=this._isFieldAllValid();if(this._invalidType==="zero"||r){if(((s=(i=t.stateStyle.normal)===null||i===void 0?void 0:i[e])===null||s===void 0?void 0:s.style)===!0)return;this.setMarkStyle(t,{[e]:!0},"normal",I.Series)}else{if(((n=(a=t.stateStyle.normal)===null||a===void 0?void 0:a[e])===null||n===void 0?void 0:n.style)!==!0)return;this.setMarkStyle(t,{[e]:this._getInvalidDefined.bind(this)},"normal",I.Series)}t.getProduct()&&t.compileEncode()}_isFieldAllValid(){const t=this.getViewDataStatistics(),e=this.getStackValueField();return!!(t&&t.latestData&&e)&&t.latestData[e]&&t.latestData[e].allValid}}const ud=Object.assign(Object.assign({},pe),ie);class Bs extends Vi{_transformLabelSpec(t){var e,i,s;((e=t.point)===null||e===void 0?void 0:e.visible)!==!1&&((s=(i=t.point)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.visible)!==!1?this._addMarkLabelSpec(t,"point"):this._addMarkLabelSpec(t,"line"),this._addMarkLabelSpec(t,"line","lineLabel","initLineLabelMarkStyle",void 0,!0)}}function Oa(o){return o.length===2&&w(o[0])&&w(o[1])&&o[1]>=o[0]}function Ea(o,t){const e=t[1]-t[0],i=t[1]*t[0]<0;let s=t[0]<=0?0-t[0]:0,a=t[1]>0?t[1]-0:0;e===0?t[0]<0?(s=1,a=0):t[0]>0&&(s=0,a=1):(s/=e,a/=e);const n=o.getDomainSpec();return{total:e,negative:s,positive:a,includeZero:i,domain:t,extendable_min:!w(n.min),extendable_max:!w(n.max)}}function Ia(o,t){const{positive:e,negative:i,extendable_min:s,extendable_max:a,domain:n}=o,{positive:r,negative:l,extendable_min:h,extendable_max:d,domain:c}=t;if(r>0){if(!h)return!1;let u=i/e;a&&(u=i/Math.max(e,r),n[1]=-n[0]/u),c[0]=-c[1]*u}else if(l>0){if(!d)return!1;let u=e/i;s&&(u=e/Math.max(i,i),n[0]=-n[1]/u),c[1]=-c[0]*u}return!0}function Ra(o,t){const{extendable_min:e,extendable_max:i,domain:s}=o,{positive:a,negative:n,domain:r}=t;return(a!==0||n!==0)&&!(a>0&&!i)&&!(n>0&&!e)&&(s[0]=r[0],s[1]=r[1],!0)}function wa(o,t){const{positive:e,negative:i,extendable_max:s,domain:a}=o,{positive:n,negative:r,extendable_min:l,domain:h}=t;if(s&&l){const d=Math.max(i,r)/Math.max(e,n);a[1]=-a[0]/d,h[0]=-h[1]*d}else if(l){const d=i/e;h[0]=-h[1]*d}else{if(!s)return!1;{const d=r/n;a[1]=-a[0]/d}}return!0}function Fa(o,t){const{extendable_min:e,domain:i}=o,{extendable_max:s,domain:a}=t;return!(!e||!s)&&(i[0]=-i[1],a[1]=-a[0],!0)}const gd=(o,t)=>{var e,i,s,a,n,r;const l=o.getScale(),h=t.getScale();if(!l||!h)return;const d=(s=(i=(e=o).getDomainAfterSpec)===null||i===void 0?void 0:i.call(e))!==null&&s!==void 0?s:[0,1],c=(r=(n=(a=t).getDomainAfterSpec)===null||n===void 0?void 0:n.call(a))!==null&&r!==void 0?r:[0,1];if(!(d&&c&&Oa(d)&&Oa(c)))return;const u=Ea(o,d),g=Ea(t,c),{positive:p,negative:_,extendable_min:m,extendable_max:v,includeZero:b}=u,{positive:y,negative:f,extendable_min:x,extendable_max:M,includeZero:k}=g;if(p===0&&_===0){if(!Ra(u,g))return}else if(y===0&&f===0){if(!Ra(g,u))return}else if(b||k)if(b&&!k){if(!Ia(u,g))return}else if(k&&!b){if(!Ia(g,u))return}else{if(_===f)return;if(_>f){if(!wa(u,g))return}else if(!wa(g,u))return}else{if(_===0&&y===0){if(!Fa(u,g))return}else if(f===0&&p===0&&!Fa(g,u))return;if(_===0&&f===0)if(d[0]===0&&c[0]>0){if(!x)return;c[0]=0}else{if(!(c[0]===0&&d[0]>0)||!m)return;d[0]=0}if(p===0&&y===0)if(d[1]===0&&c[1]>0){if(!M)return;c[1]=0}else{if(!(c[1]===0&&d[1]>0)||!v)return;d[1]=0}}l.domain(d),h.domain(c)},pd=(o,t)=>{var e,i,s,a,n;if(!o)return o;const r=(e=t==null?void 0:t.targetAxis)===null||e===void 0?void 0:e.call(t);if(!r)return o;const l=(i=t==null?void 0:t.currentAxis)===null||i===void 0?void 0:i.call(t);if(!l)return o;const h=(s=l.getTickData())===null||s===void 0?void 0:s.getDataView();if(!h||!h.transformsArr.find(b=>b.type.includes("ticks")))return o;const d=l.getScale();if(!d)return o;const c=(n=(a=r.getTickData())===null||a===void 0?void 0:a.getDataView())===null||n===void 0?void 0:n.latestData;if(!(c!=null&&c.length))return o;const u=r.getScale();if(!u)return o;const g=u.domain(),p=g[1]-g[0];if(p===0)return o;const _=d.domain(),m=_[1]-_[0];if(p===0)return o;const v=c.map(b=>{const y=(b.value-g[0])/p;return m*y+_[0]});return oe(v)};class ti extends xo{constructor(){super(ti.type),this.type="AxisSyncPlugin"}_checkEnableSync(t){if(!et(t.getScale().type))return!1;const e=t.getSpec().sync;return!!(e!=null&&e.axisId)&&e}_getTargetAxis(t,e){const i=t.getOption().getChart().getComponentByUserId(e.axisId);return i!=null&&i.type.startsWith("cartesianAxis")?i:null}onInit(t,e){const i=this._checkEnableSync(e);if(!i||!i.zeroAlign)return;const s=this._getTargetAxis(e,i);s&&e.event.on(z.scaleDomainUpdate,{filter:({model:a})=>a.id===e.id||a.id===s.id},()=>{gd(s,e)})}onDidCompile(t,e){const i=this._checkEnableSync(e);if(!i)return;const s=this._getTargetAxis(e,i);if(s&&i.tickAlign){st(e.getOption().dataSet,"tickAlign",pd);const a={targetAxis:()=>s,currentAxis:()=>e};e.addTransformToTickData({type:"tickAlign",options:a,level:Number.MAX_SAFE_INTEGER},!1)}}}ti.pluginType="component",ti.type="AxisSyncPlugin";const _d=o=>o;var md=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};class mr extends Ee{getOrient(){return this._orient}getScale(){return this._scale}getScales(){return this._scales}getTickData(t=0){return this._tickData[t]}get visible(){return this._visible}getInverse(){return this._inverse}getCoordinateType(){return this._coordinateType}constructor(t,e){var i;super(t,e),this.specKey="axes",this._scales=[],this._tickData=[],this._visible=!0,this._tick=void 0,this._visible=(i=t.visible)===null||i===void 0||i,this._coordinateType="none"}_getNeedClearVRenderComponents(){return[]}getVRenderComponents(){var t,e,i,s;return[(e=(t=this._axisMark)===null||t===void 0?void 0:t.getProduct())===null||e===void 0?void 0:e.getGroupGraphicItem(),(s=(i=this._gridMark)===null||i===void 0?void 0:i.getProduct())===null||s===void 0?void 0:s.getGroupGraphicItem()].filter(S)}created(){var t,e,i,s,a,n,r,l,h,d,c,u,g,p,_,m,v;if(super.created(),this.setSeriesAndRegionsFromSpec(),this.initEvent(),this.initScales(),this.updateSeriesScale(),this._shouldComputeTickData()&&this._initData(),this._visible){const b=this._createMark({type:"component",name:`axis-${this.getOrient()}`},{componentType:this.getOrient()==="angle"?"circleAxis":"axis",mode:this._spec.mode,noSeparateStyle:!0,skipTheme:!0});if(this._axisMark=b,b.setZIndex(this.layoutZIndex),S(this._spec.id)&&b.setUserId(this._spec.id),this._marks.addMark(b),(t=this._spec.grid)===null||t===void 0?void 0:t.visible){const y=this._createMark({type:"component",name:`axis-${this.getOrient()}-grid`},{componentType:this.getOrient()==="angle"?lt.circleAxisGrid:lt.lineAxisGrid,mode:this._spec.mode,noSeparateStyle:!0,skipTheme:!0});y.setZIndex((n=(s=(i=(e=this._spec.grid)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.zIndex)!==null&&s!==void 0?s:(a=this._spec.grid)===null||a===void 0?void 0:a.zIndex)!==null&&n!==void 0?n:ft.Axis_Grid),y.setInteractive(!1),this._marks.addMark(y),this._gridMark=y}if(si(this._spec.interactive)&&this._marks.forEach(y=>y.setInteractive(this._spec.interactive)),this._option.animation!==!1&&$(this._option.getChart().getSpec(),"animation")!==!1&&this._spec.animation===!0){const y=Pt((r=V.getAnimationInKey("axis"))===null||r===void 0?void 0:r(),{appear:(h=(l=this._spec.animationAppear)!==null&&l!==void 0?l:$(this._option.getChart().getSpec(),"animationAppear.axis"))!==null&&h!==void 0?h:$(this._option.getChart().getSpec(),"animationAppear"),disappear:(c=(d=this._spec.animationDisappear)!==null&&d!==void 0?d:$(this._option.getChart().getSpec(),"animationDisappear.axis"))!==null&&c!==void 0?c:$(this._option.getChart().getSpec(),"animationDisappear"),enter:(g=(u=this._spec.animationEnter)!==null&&u!==void 0?u:$(this._option.getChart().getSpec(),"animationEnter.axis"))!==null&&g!==void 0?g:$(this._option.getChart().getSpec(),"animationEnter"),exit:(_=(p=this._spec.animationExit)!==null&&p!==void 0?p:$(this._option.getChart().getSpec(),"animationExit.axis"))!==null&&_!==void 0?_:$(this._option.getChart().getSpec(),"animationExit"),update:(v=(m=this._spec.animationUpdate)!==null&&m!==void 0?m:$(this._option.getChart().getSpec(),"animationUpdate.axis"))!==null&&v!==void 0?v:$(this._option.getChart().getSpec(),"animationUpdate")});y.enter&&(y.update[0].customParameters={enter:y.enter[0]}),this._marks.forEach(f=>f.setAnimationConfig(y))}}}_shouldComputeTickData(){return this.getVisible()||this._spec.forceInitTick}_initData(){const t=this._initTickDataSet(this._tickTransformOption());t.target.addListener("change",this._forceLayout.bind(this)),this._tickData=[new qe(this._option,t)]}collectData(t,e){const i=[];return mt(this._regions,s=>{var a;let n=this.collectSeriesField(t,s);if(n=U(n)?et(this._scale.type)?n:[n[0]]:[n],t||(this._dataFieldText=s.getFieldAlias(n[0])),n){const r=s.getViewData();if(e)n.forEach(l=>{i.push(s.getRawDataStatisticsByField(l,!1))});else if(r&&r.latestData&&r.latestData.length){const l=(a=s.getViewDataStatistics)===null||a===void 0?void 0:a.call(s);n.forEach(h=>{var d;!((d=l==null?void 0:l.latestData)===null||d===void 0)&&d[h]&&i.push(l.latestData[h])})}}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),i}isSeriesDataEnable(){let t=!0;return mt(this._regions,e=>{var i;U((i=e.getViewDataStatistics())===null||i===void 0?void 0:i.latestData)&&(t=!1)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t}setSeriesAndRegionsFromSpec(){const{seriesId:t,seriesIndex:e,regionId:i,regionIndex:s}=this._spec;S(t)&&(this._seriesUserId=L(t)),S(i)&&(this._regionUserId=L(i)),S(e)&&(this._seriesIndex=L(e)),S(s)&&(this._regionIndex=L(s)),this._regions=this._option.getRegionsInUserIdOrIndex(this._regionUserId,this._regionIndex),this.layout.layoutBindRegionID=this._regions.map(a=>a.id)}getBindSeriesFilter(){return{userId:this._seriesUserId,specIndex:this._seriesIndex}}initEvent(){this.event.on(z.scaleUpdate,{filter:({model:e})=>(e==null?void 0:e.id)===this.id},this.effect.scaleUpdate.bind(this));const t=So(this._regions,{userId:this._seriesUserId,specIndex:this._seriesIndex}).map(e=>e.getViewDataStatistics()).filter(e=>!!e);t.length>1?this._option.dataSet.multipleDataViewAddListener(t,"change",()=>{this.updateScaleDomain()}):t.length===1&&t[0].target.addListener("change",()=>{this.updateScaleDomain()}),mt(this._regions,e=>{e.event.on(z.rawDataUpdate,{filter:({model:i})=>(i==null?void 0:i.id)===e.id},()=>{this._clearRawDomain()})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}updateScaleDomain(){}_clearRawDomain(){}onLayoutEnd(t){this.updateScaleRange(),this.event.emit(z.scaleUpdate,{model:this,value:"range"}),super.onLayoutEnd(t)}computeData(t){!this._tickData||!this._tickData.length||t!=="force"&&ge(this._scale.range(),[0,1])||this._tickData.forEach(e=>{e.getDataView().reRunAllTransform(),e.updateData()})}initScales(){this._scales=[this._scale];const t=[];if(mt(this._regions,e=>{const i=e.getGroups();i&&t.push(i)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t.length!==0){const e=Bt(t.map(i=>i.fields.length));for(let i=1;i<e;i++){const s=this._scale.clone();this._scales.push(s)}}}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake?i:(i.reRender=!0,(e==null?void 0:e.type)!==(t==null?void 0:t.type)?(i.reMake=!0,i):(i.reMake=["grid","subGrid","tick","subTick","label","domainLine","title"].some(s=>{var a,n;return((a=e==null?void 0:e[s])===null||a===void 0?void 0:a.visible)!==((n=t==null?void 0:t[s])===null||n===void 0?void 0:n.visible)}),i))}_delegateAxisContainerEvent(t){t.listenerCount("*")===0&&t.addEventListener("*",(e,i)=>this._delegateEvent(t,e,i))}_getAxisAttributes(){const t=this._spec,e={orient:this.getOrient(),select:this._option.disableTriggerEvent!==!0&&t.select,hover:this._option.disableTriggerEvent!==!0&&t.hover};if(t.domainLine&&t.domainLine.visible?e.line=Ao(t.domainLine):e.line={visible:!1},t.label&&t.label.visible){const i=mn(t.label,["style","formatMethod","state"]);e.label=i,t.label.style&&(e.label.style=E(t.label.style)?(s,a,n,r)=>{var l;const h=t.label.style(s.rawValue,a,s,n,r);return F(q({},(l=this._theme.label)===null||l===void 0?void 0:l.style,h))}:F(t.label.style)),(t.label.formatMethod||t.label.formatter)&&(e.label.formatMethod=this._getLabelFormatMethod()),t.label.state&&(e.label.state=ko(t.label.state))}else e.label={visible:!1};if(t.tick&&t.tick.visible?(e.tick={visible:t.tick.visible,length:t.tick.tickSize,inside:t.tick.inside,alignWithLabel:t.tick.alignWithLabel,dataFilter:t.tick.dataFilter},t.tick.style&&(e.tick.style=E(t.tick.style)?(i,s,a,n)=>{var r;const l=t.tick.style(i,s,a,n);return F(q({},(r=this._theme.tick)===null||r===void 0?void 0:r.style,l))}:F(t.tick.style)),t.tick.state&&(e.tick.state=be(t.tick.state))):e.tick={visible:!1},t.subTick&&t.subTick.visible?(e.subTick={visible:t.subTick.visible,length:t.subTick.tickSize,inside:t.subTick.inside,count:t.subTick.tickCount},t.subTick.style&&(e.subTick.style=E(t.subTick.style)?(i,s,a,n)=>{var r;const l=t.subTick.style(i,s,a,n);return F(q({},(r=this._theme.subTick)===null||r===void 0?void 0:r.style,l))}:F(t.subTick.style)),t.subTick.state&&(e.subTick.state=be(t.subTick.state))):e.subTick={visible:!1},t.title&&t.title.visible){const i=t.title,{autoRotate:s,angle:a,style:n={},background:r,state:l,shape:h}=i,d=md(i,["autoRotate","angle","style","background","state","shape"]);let c,u=a;t.orient!=="left"&&t.orient!=="right"||s&&C(u)&&(u=t.orient==="left"?-90:90,c=Mo[t.orient]),e.title=Object.assign(Object.assign({},d),{autoRotate:!1,angle:u?ae(u):null,textStyle:q({},c,F(n)),pickable:n.pickable!==!1,childrenPickable:n.pickable!==!1,state:{}}),h&&h.visible?(e.title.shape=Object.assign(Object.assign({},h),{style:F(h.style)}),h.state&&(e.title.state.shape=be(h.state))):e.title.shape={visible:!1},r&&r.visible?(e.title.background=Object.assign(Object.assign({},r),{style:F(r.style)}),r.state&&(e.title.state.background=be(r.state))):e.title.background={visible:!1},l&&(e.title.state.text=be(l))}else e.title={visible:!1};return t.background&&t.background.visible?(e.panel={visible:!0},t.background.style&&(e.panel.style=F(t.background.style)),t.background.state&&(e.panel.state=be(t.background.state))):e.panel={visible:!1},e}_getGridAttributes(){const t=this._spec;return{alternateColor:t.grid.alternateColor,alignWithLabel:t.grid.alignWithLabel,style:E(t.grid.style)?()=>(e,i)=>{var s,a;const n=t.grid.style((s=e.datum)===null||s===void 0?void 0:s.rawValue,i,e.datum);return F(q({},(a=this._theme.grid)===null||a===void 0?void 0:a.style,n))}:F(t.grid.style),subGrid:t.subGrid.visible===!1?{visible:!1}:{type:"line",visible:t.subGrid.visible,alternateColor:t.subGrid.alternateColor,style:F(t.subGrid.style)}}}_getLabelFormatMethod(){const{formatMethod:t,formatter:e}=this._spec.label,{formatFunc:i}=ys(t,e);return i?(s,a,n)=>i(a.rawValue,a,e):null}_initTickDataSet(t,e=0){vn(this._option.dataSet,"scale",_d);const i=this.registerTicksTransform();return new St(this._option.dataSet,{name:`${this.type}_${this.id}_ticks_${e}`}).parse(this._scales[e],{type:"scale"}).transform({type:i,options:t},!1)}_tickTransformOption(){const t=this._tick||{},e=this._spec.label||{},{tickCount:i,forceTickCount:s,tickStep:a,tickMode:n}=t,{style:r,formatMethod:l,minGap:h}=e;return{sampling:this._spec.sampling!==!1,tickCount:i,forceTickCount:s,tickStep:a,tickMode:n,axisOrientType:this._orient,coordinateType:this._coordinateType,labelStyle:r,labelFormatter:l,labelGap:h}}addTransformToTickData(t,e){this._tickData.forEach(i=>{var s;(s=i==null?void 0:i.getDataView())===null||s===void 0||s.transform(t,e)})}dataToPosition(t){return this._scale.scale(t)}}mr.specKey="axes";const qi=()=>{vs(),V.registerAnimation("axis",()=>({appear:{custom:Rl},update:{custom:ch},exit:{custom:wl}}))};var za=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};const vd=[ti];class Si extends mr{getOrient(){return this._orient}set autoIndentOnce(t){this._autoIndentOnce=t}getScales(){return this._scales}constructor(t,e){super(t,e),this.type=P.cartesianAxis,this.name=P.cartesianAxis,this._defaultBandPosition=.5,this._defaultBandInnerPadding=.1,this._defaultBandOuterPadding=.3,this.layoutType="region-relative",this.layoutZIndex=ft.Axis,this.layoutLevel=bs.Axis,this._orient="left",this._autoIndentOnce=!1,this._hasAutoIndent=!1,this._scales=[],this._tick=void 0,this._layoutCache={width:0,height:0,_lastComputeOutBounds:{x1:0,x2:0,y1:0,y2:0}},this._innerOffset={top:0,bottom:0,left:0,right:0},this.effect={scaleUpdate:i=>{this.computeData(i==null?void 0:i.value),mt(this._regions,s=>{const a=this.getOrient();rt(a)?s.setXAxisHelper(this.axisHelper()):Se(a)?s.setYAxisHelper(this.axisHelper()):Vt(a)&&s.setZAxisHelper(this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._transformLayoutPosition=i=>{let{x:s,y:a}=i;return w(s)&&(s+=+(this._orient==="left")*this.getLayoutRect().width),w(a)&&(a+=+(this._orient==="top")*this.getLayoutRect().height),{x:s,y:a}},this._transformLayoutRect=i=>{if(!this._visible)return i;const s=this._latestBounds.clone().translate(-this.getLayoutStartPoint().x,-this.getLayoutStartPoint().y);switch(this._layout.layoutOrient){case"left":this._layout.layoutRectLevelMap.width===hi&&(i.width=s.x1<0?-s.x1:0);break;case"right":this._layout.layoutRectLevelMap.width===hi&&(i.width=s.x2>0?s.x2:0);break;case"top":this._layout.layoutRectLevelMap.height===hi&&(i.height=s.y1<0?-s.y1:0);break;case"bottom":this._layout.layoutRectLevelMap.height===hi&&(i.height=s.y2>0?s.y2:0)}return i.width=Math.ceil(i.width),i.height=Math.ceil(i.height),this._layout.setRectInSpec(this._layoutCacheProcessing(i))},this._updateAxisLayout=()=>{const i=this.getLayoutStartPoint(),s=this._getUpdateAttribute(!1),{grid:a}=s,n=za(s,["grid"]),r=this._axisMark.getProduct(),l=q({x:i.x,y:i.y},this._axisStyle,n);r.encode(l),this._gridMark&&this._gridMark.getProduct().encode(q({x:i.x,y:i.y},this._getGridAttributes(),a))},this._fixAxisOnZero=()=>{const{onZero:i,visible:s}=this._spec.domainLine;if(this.visible&&i&&s!==!1){const{onZeroAxisId:a,onZeroAxisIndex:n}=this._spec.domainLine,r=this._option.getComponentsByKey("axes"),l=rt(this.getOrient()),h=c=>{var u;return(l?!rt(c.getOrient()):rt(c.getOrient()))&&et(c.getScale().type)&&(c.getTickData()?(u=c.getTickData().getLatestData())===null||u===void 0?void 0:u.find(g=>g.value===0):c.getScale().domain()[0]<=0&&c.getScale().domain()[1]>=0)},d=r.filter(c=>h(c));if(d.length){let c;if(S(a))c=d.find(u=>u.id===a);else if(S(n)){const u=r[n];h(u)&&(c=u)}else c=d[0];if(c){const u=this._axisMark.getProduct(),g=c.valueToPosition(0);l?u.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dy:this._orient==="bottom"?-(c.getScale().range()[0]-g):g})}):u.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dx:this._orient==="left"?g:-(c.getScale().range()[1]-g)})})}}}},this._orient=yn(t,["z"]),Vt(this._orient)&&(this.layoutType="absolute"),this._dataSet=e.dataSet,this._coordinateType="cartesian"}static getSpecInfo(t){const e=t[this.specKey];if(!e)return null;const i=t.direction==="horizontal";if(!U(e)){if(!Ns(e))return null;const{axisType:r,componentName:l}=Ws(e,i);return e.type=r,[{spec:e,specPath:[this.specKey],specInfoPath:["component",this.specKey,0],type:l}]}let s=!0;if(e.filter(r=>r.orient==="z")[0]){const r=e.filter(h=>h.orient==="bottom")[0],l=e.filter(h=>Se(h.orient))[0];s=e.length===3&&r&&l}let a=e.map((r,l)=>({spec:r,index:l}));s||(a=a.filter(({spec:r})=>r.orient!=="z"));const n=[];return a.forEach(({spec:r,index:l})=>{if(!Ns(r))return;const{axisType:h,componentName:d}=Ws(r,i);r.type=h,n.push({spec:r,specPath:[this.specKey,l],specInfoPath:["component",this.specKey,l],type:d})}),n}static createComponent(t,e){const{spec:i}=t,s=za(t,["spec"]),a=V.getComponentInKey(s.type);return a?new a(i,Object.assign(Object.assign({},e),s)):(e.onError(`Component ${s.type} not found`),null)}initLayout(){super.initLayout(),this._layout.autoIndent=this._spec.autoIndent!==!1,this._layout.layoutOrient=this._orient}setLayout3dBox(t){this.layout3dBox=t}updateScaleRange(){let t=!1;const{width:e,height:i}=this.getLayoutRect(),{left:s,right:a,top:n,bottom:r}=this._innerOffset;let l=[];rt(this.getOrient())?w(e)&&(l=this._inverse?[e-a,s]:[s,e-a]):Vt(this.getOrient())?w(e)&&(l=this._inverse?[e-a,s]:[s,e-a],this._scale.range(l)):w(i)&&(l=this._inverse?[n,i-r]:[i-r,n]);const[h,d]=this._scale.range();return l[0]===h&&l[1]===d||(t=!0,this._scale.range(l)),t}init(t){var e;super.init(t),(e=this.pluginService)===null||e===void 0||e.load(vd.map(i=>new i)),this.callPlugin(i=>{this.pluginService&&i.onInit&&i.onInit(this.pluginService,this)})}setAttrFromSpec(){var t;if(super.setAttrFromSpec(),this.visible){rt(this.getOrient())?$s(this._spec.maxHeight)&&(this._spec.maxHeight="30%"):$s(this._spec.maxWidth)&&(this._spec.maxWidth="30%");const i=this._getAxisAttributes();i.label.formatMethod=this._getLabelFormatMethod(),i.verticalFactor=this.getOrient()==="top"||this.getOrient()==="right"?-1:1,this._axisStyle=i}this._tick=this._spec.tick;const e=(t=this._option.getChart())===null||t===void 0?void 0:t.getSpec();this._inverse=To(this._spec,(e==null?void 0:e.direction)==="horizontal")}onLayoutStart(t,e,i){if(super.onLayoutStart(t,e,i),!Vt(this.getOrient())&&this._spec.innerOffset){const s=this._spec;Se(this.getOrient())?["top","bottom"].forEach(a=>{this._innerOffset[a]=yi(s.innerOffset[a],e.height,e)}):["left","right"].forEach(a=>{this._innerOffset[a]=yi(s.innerOffset[a],e.width,e)})}}getSeriesStatisticsField(t){let e;return e=rt(this.getOrient())?t.fieldX:Vt(this.getOrient())?t.fieldZ:t.fieldY,et(this._scale.type)?e:[e[0]]}_tickTransformOption(){var t,e,i;return Object.assign(Object.assign({},super._tickTransformOption()),{noDecimals:(t=this._tick)===null||t===void 0?void 0:t.noDecimals,labelLastVisible:(e=this._spec.label)===null||e===void 0?void 0:e.lastVisible,labelFlush:(i=this._spec.label)===null||i===void 0?void 0:i.flush})}axisHelper(){return{isContinuous:et(this._scale.type),dataToPosition:this.dataToPosition.bind(this),getScale:(t=0)=>this._scales[t],getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>this._inverse===!0,getSpec:()=>this._spec}}afterCompile(){var t;const e=(t=this._axisMark)===null||t===void 0?void 0:t.getProduct();e&&e.addEventListener(Ye.AFTER_ELEMENT_ENCODE,()=>{if(this._isLayout===!1&&(rt(this.getOrient())?this.callPlugin(i=>{this.pluginService&&i.onDidLayoutHorizontal&&i.onDidLayoutHorizontal(this.pluginService,this)}):this.callPlugin(i=>{this.pluginService&&i.onDidLayoutVertical&&i.onDidLayoutVertical(this.pluginService,this)}),this._delegateAxisContainerEvent(e.getGroupGraphicItem()),this._unitText)){const{x:i,y:s}=this.getLayoutStartPoint(),a=rt(this._orient)?{x:Bt(this._scale.range())+i,y:s}:{x:i,y:Ft(this._scale.range())+s};this._unitText.setAttributes(a)}}),this.callPlugin(i=>{this.pluginService&&i.onDidCompile&&i.onDidCompile(this.pluginService,this)})}onRender(t){}changeRegions(t){}update(t){}resize(t){}collectScale(){const t=[];return mt(this._regions,e=>{t.push(this.getOrient()==="left"||this.getOrient()==="right"?e.scaleY:e.scaleX)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t}collectSeriesField(t,e){var i,s;let a;return a=t>0?(s=(i=e.getGroups())===null||i===void 0?void 0:i.fields)===null||s===void 0?void 0:s[t]:rt(this.getOrient())?e.getSpec().x2Field?[...e.fieldX,e.fieldX2]:e.fieldX:Vt(this.getOrient())?e.fieldZ:e.getSpec().y2Field?[...e.fieldY,e.fieldY2]:e.fieldY,a}updateSeriesScale(){const t=this.getOrient();mt(this._regions,e=>{rt(t)?(e.setScaleX(this._scale),e.setXAxisHelper(this.axisHelper())):Se(t)?(e.setScaleY(this._scale),e.setYAxisHelper(this.axisHelper())):Vt(t)&&(e.setScaleZ(this._scale),e.setZAxisHelper(this.axisHelper()))},{userId:this._seriesUserId,specIndex:this._seriesIndex})}getBoundsInRect(t){var e;let i={x1:0,y1:0,x2:0,y2:0};if(!this._visible)return i;this._verticalLimitSize=rt(this.getOrient())?t.height:t.width,this.setLayoutRect(t),!this.updateScaleRange()&&U((e=this.getTickData())===null||e===void 0?void 0:e.getLatestData())||this.computeData("range");const s={skipLayout:!1},a=rt(this.getOrient());this.pluginService&&(a?this.callPlugin(l=>{l.onWillLayoutHorizontal&&l.onWillLayoutHorizontal(this.pluginService,s,this)}):this.callPlugin(l=>{l.onWillLayoutVertical&&l.onWillLayoutVertical(this.pluginService,s,this)}));const n=this._axisMark.getProduct();let r=!1;if(!s.skipLayout){const l=this._getUpdateAttribute(!0),h=n.getGroupGraphicItem(),d=q(Object.assign({},this.getLayoutStartPoint()),this._axisStyle,l,{line:{visible:!1}}),c=h.getBoundsWithoutRender(d);r=!0,this._latestBounds=c,isFinite(c.width())&&(i=this._appendAxisUnit(c,a))}return r||(this._latestBounds=n.getBounds()),i}_getTitleLimit(t){var e,i,s,a,n;if(this._spec.title.visible&&C((e=this._spec.title.style)===null||e===void 0?void 0:e.maxLineWidth)){const r=(n=(s=(i=this._axisStyle.title)===null||i===void 0?void 0:i.angle)!==null&&s!==void 0?s:(a=this._spec.title.style)===null||a===void 0?void 0:a.angle)!==null&&n!==void 0?n:0;if(t){const d=this.getLayoutRect().width,c=Math.abs(Math.cos(r));return c<1e-6?1/0:d/c}const l=this.getLayoutRect().height,h=Math.abs(Math.sin(r));return h<1e-6?1/0:l/h}return null}_getUpdateAttribute(t){var e;let i=0,s=0;if(!t){const v=this.getRegions();let{x:b,y}=v[0].getLayoutStartPoint(),f=b+v[0].getLayoutRect().width,x=y+v[0].getLayoutRect().height;for(let M=1;M<v.length;M++){const k=v[M],{x:D,y:O}=k.getLayoutStartPoint(),{width:T,height:B}=k.getLayoutRect();b=Math.min(b,D),f=Math.max(f,T+D),y=Math.min(y,O),x=Math.max(x,B+O)}i=Math.abs(x-y),s=Math.abs(f-b)}const{width:a,height:n}=this.getLayoutRect(),r=rt(this._orient),l=Se(this._orient),h=Vt(this._orient);let d={x:0,y:0},c=0,u=0;const g=this.layout3dBox?this.layout3dBox.length:0;if(r?(d={x:a,y:0},c=i,u=a):l&&(d={x:0,y:n},c=s,u=n),h){const v=(e=this.directionStr)!==null&&e!==void 0?e:"r2l",b=this.layout3dBox?this.layout3dBox.width:0;let y=[0,0],f=-Math.PI/2,x=0;v==="l2r"&&(x=this.layout3dBox.length,y=[0,0,0],f=Math.PI/2);const M=this.getLabelItems(a),k={start:{x:0,y:0},end:{x:g,y:0},z:x,alpha:f,anchor3d:y,title:{text:this._spec.title.text||this._dataFieldText,maxWidth:this._getTitleLimit(r)},items:M};return t||(k.grid={type:"line",start:{x:0,y:0},end:{x:g,y:0},items:M[0],verticalFactor:this._axisStyle.verticalFactor,depth:b,length:i,z:x,alpha:f,anchor3d:y}),k}let p=r?this.layout.minHeight:this.layout.minWidth;(r&&this._layout.layoutRectLevelMap.height===Ks||l&&this._layout.layoutRectLevelMap.width===Ks)&&(p=this._verticalLimitSize);const _=this.getLabelItems(u),m={start:{x:0,y:0},end:d,title:{text:this._spec.title.text||this._dataFieldText,maxWidth:this._getTitleLimit(r)},items:_,verticalLimitSize:this._verticalLimitSize,verticalMinSize:p};return t||(m.grid={type:"line",start:{x:0,y:0},end:d,items:_[0],verticalFactor:this._axisStyle.verticalFactor,depth:g,length:c}),m}getLabelItems(t){var e;const i=(e=this.getTickData())===null||e===void 0?void 0:e.getLatestData();return i&&i.length?[i.map(s=>{const a=this._getNormalizedValue([s.value],t);return Qe(s.value,a)}).filter(s=>s.value>=0&&s.value<=1)]:[]}initEvent(){super.initEvent(),this.visible&&(this.event.on(z.layoutEnd,this._updateAxisLayout),this.event.on(z.layoutEnd,this._fixAxisOnZero),this.event.on(z.layoutRectUpdate,()=>{this._clearLayoutCache()}))}_getNormalizedValue(t,e){return e===0?0:this.dataToPosition(t)/e}_layoutCacheProcessing(t){return["width","height"].forEach(e=>{t[e]<this._layoutCache[e]?t[e]=this._layoutCache[e]:this._layoutCache[e]=t[e]}),this._autoIndentOnce&&this._hasAutoIndent?["x1","x2","y1","y2"].forEach(e=>{this.layout.getLastComputeOutBounds()[e]=this._layoutCache._lastComputeOutBounds[e]}):(this._hasAutoIndent=!0,["x1","x2","y1","y2"].forEach(e=>{this.layout.getLastComputeOutBounds()[e]<this._layoutCache._lastComputeOutBounds[e]?this.layout.getLastComputeOutBounds()[e]=this._layoutCache._lastComputeOutBounds[e]:this._layoutCache._lastComputeOutBounds[e]=this.layout.getLastComputeOutBounds()[e]})),t}_clearLayoutCache(){this._hasAutoIndent=!1,this._layoutCache.width=0,this._layoutCache.height=0,this._layoutCache._lastComputeOutBounds={x1:0,x2:0,y1:0,y2:0}}onDataUpdate(){this._clearLayoutCache()}_appendAxisUnit(t,e){var i;if(this._spec.unit&&this._spec.unit.visible){const{text:s,style:a}=this._spec.unit;let n,r;const{x:l,y:h}=this.getLayoutStartPoint();e?(n={x:Bt(this._scale.range())+l,y:h},r={textAlign:"left",textBaseline:"middle"}):(n={x:l,y:Ft(this._scale.range())+h},r={textAlign:this._orient==="left"?"left":"right",textBaseline:"bottom"}),r=Object.assign(Object.assign(Object.assign({},r),a),{x:n.x,y:n.y,text:s}),this._unitText?this._unitText.setAttributes(r):(this._unitText=bn(r),this._unitText.name="axis-unit",(i=this.getContainer())===null||i===void 0||i.add(this._unitText));const d=this._unitText.AABBBounds;e?(t.x2+=d.x2>t.x2?d.x2-t.x2:0,t.y2+=d.y2>t.y2?d.y2-t.y2:0):(t.x1+=d.x1<t.x1?d.x1-t.x1:0,t.y1+=d.y1<t.y1?d.y1-t.y1:0)}return t}_getNeedClearVRenderComponents(){return this._unitText?[this._unitText]:[]}}Si.type=P.cartesianAxis,Si.specKey="axes";const yd=Math.sqrt(50),bd=Math.sqrt(10),fd=Math.sqrt(2);class vr{constructor(){this._extend={},this.niceLabelFormatter=null}setExtraAttrFromSpec(){S(this._spec.nice)&&(this._nice=this._spec.nice),S(this._spec.zero)&&(this._zero=this._spec.zero),this._expand=this._spec.expand,this._domain=qs(this._spec)}transformScaleDomain(){this.setScaleNice()}setLinearScaleNice(){var t;if(!this._nice)return!1;let e=5;const i=this._spec.tick||{};if(w(i.forceTickCount))e=i.forceTickCount;else if(E(i.tickCount)){const n=this._scale.range();let r=Math.abs(n[n.length-1]-n[0]);r===1&&this._option&&(r=rt(this._orient)?this._option.getChartViewRect().width:this._option.getChartViewRect().height),e=i.tickCount({axisLength:r,labelStyle:this._spec.label&&this._spec.label.style})}else e=w(i.tickCount)?i.tickCount:5;this._spec.niceType==="accurateFirst"&&(e=Math.max(5,e));const{min:s,max:a}=(t=this._domain)!==null&&t!==void 0?t:{};return C(s)&&C(a)&&C(this._softMaxValue)&&C(this._softMinValue)?this._scale.nice(e):(S(s)||S(this._softMinValue))&&C(a)&&C(this._softMaxValue)?this._scale.niceMax(e):!(!C(s)||!C(this._softMinValue)||!S(a)&&!S(this._softMaxValue))&&this._scale.niceMin(e)}setLogScaleNice(){var t;if(!this._nice)return!1;const{min:e,max:i}=(t=this._domain)!==null&&t!==void 0?t:{};return C(e)&&C(i)&&C(this._softMaxValue)&&C(this._softMinValue)?this._scale.nice():(S(e)||S(this._softMinValue))&&C(i)&&C(this._softMaxValue)?this._scale.niceMax():!(!C(e)||!C(this._softMinValue)||!S(i)&&!S(this._softMaxValue))&&this._scale.niceMin()}setScaleNice(){return this._spec.type==="log"?this.setLogScaleNice():this.setLinearScaleNice()}dataToPosition(t,e){return this.valueToPosition(t[0])}valueToPosition(t){return this._scale.scale(t)}computeLinearDomain(t){const e=[];return t.length?t.forEach(i=>{const{min:s,max:a}=i;e[0]=e[0]===void 0?s:Math.min(e[0],s),e[1]=e[1]===void 0?a:Math.max(e[1],a)}):(e[0]=0,e[1]=0),this.setSoftDomainMinMax(e),this.expandDomain(e),this.includeZero(e),this.setDomainMinMax(e),e}expandDomain(t){if(!this._expand)return;let e=t[0],i=t[t.length-1];e===i&&(i===0?i=1:i>0?e=0:i<0&&(i=0)),S(this._expand.min)&&(t[0]=e-(i-e)*this._expand.min),S(this._expand.max)&&(t[t.length-1]=i+(i-e)*this._expand.max)}niceDomain(t){const{min:e,max:i}=qs(this._spec);if(S(e)||S(i)||this._spec.type!=="linear")return t;if(Math.abs(Ft(t)-Bt(t))<=1e-12){let s=t[0];const a=s>=0?1:-1;if(s=Math.abs(s),s<1)t[0]=0,t[1]=1;else{let n=s/5;const r=Math.floor(Math.log(n)/Math.LN10),l=n/Math.pow(10,r);n=(l>=yd?10:l>=bd?5:l>=fd?2:1)*Math.pow(10,r),t[0]=0,t[1]=10*n}a<0&&(t.reverse(),t[0]*=-1,t[1]*=-1)}return t}includeZero(t){this._zero&&(t[0]=Math.min(t[0],0),t[t.length-1]=Math.max(t[t.length-1],0))}setExtendDomain(t,e){if(e===void 0)return void delete this._extend[t];this._extend[t]=e;const i=this._scale.domain();this.extendDomain(i),this.includeZero(i),this.setDomainMinMax(i),this.niceDomain(i),this._scale.domain(i,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this.event.emit(z.scaleUpdate,{model:this,value:"domain"})}extendDomain(t){let e;const i=t.length-1,s=t[0]-t[i]>0,a=s?i:0,n=s?0:i;for(const r in this._extend)e=this._extend[r],e>t[n]&&(t[n]=e),e<t[a]&&(t[a]=e)}getDomainSpec(){return this._domain}setDomainMinMax(t){if(!this._domain)return;const{min:e,max:i}=this._domain;S(e)&&(t[0]=e),S(i)&&(t[1]=i)}setSoftDomainMinMax(t){const{softMin:e,softMax:i}=this._spec;if(S(e)){let s=E(e)?e(t):e;C(s)&&(s=t[0]),s<=t[0]&&(t[0]=s,this._softMinValue=s)}if(S(i)){let s=E(i)?i(t):i;C(s)&&(s=t[1]),s>=t[1]&&(t[1]=s),this._softMaxValue=s}}setZero(t){this._zero!==t&&(this._zero=t,this.updateScaleDomain())}updateScaleDomain(){if(!this.isSeriesDataEnable())return;const t=this.collectData(),e=this.computeLinearDomain(t);this.updateScaleDomainByModel(e)}updateScaleDomainByModel(t){t=t??this._scale.domain(),this.extendDomain(t),this.includeZero(t),this.setDomainMinMax(t),this.niceDomain(t),this._scale.domain(t,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this._updateNiceLabelFormatter(t),this._domainAfterSpec=this._scale.domain(),this.event.emit(z.scaleDomainUpdate,{model:this}),this.event.emit(z.scaleUpdate,{model:this,value:"domain"})}getDomainAfterSpec(){return this._domainAfterSpec}_updateNiceLabelFormatter(t){const e=Math.abs(t[1]-t[0]),i=Math.max(-Math.floor(Math.log10(e)),0)+2,s=Math.pow(10,i);this.niceLabelFormatter=a=>w(+a)?Math.round(+a*s)/s:a}}class ce extends Si{constructor(){super(...arguments),this.type=P.cartesianLinearAxis,this._zero=!0,this._nice=!0,this._extend={},this._scale=new fn}setAttrFromSpec(){super.setAttrFromSpec(),this.setExtraAttrFromSpec()}initScales(){var t,e;super.initScales();const i=[0,1];S((t=this._domain)===null||t===void 0?void 0:t.min)&&(i[0]=this._domain.min),S((e=this._domain)===null||e===void 0?void 0:e.max)&&(i[1]=this._domain.max),this._scale.domain(i)}computeDomain(t){return this.computeLinearDomain(t)}axisHelper(){const t=super.axisHelper();return t.setExtendDomain=this.setExtendDomain.bind(this),t.valueToPosition=this.valueToPosition.bind(this),t}registerTicksTransform(){const t=`${this.type}-ticks`;return st(this._option.dataSet,t,As),t}}ce.type=P.cartesianLinearAxis,ce.specKey="axes",kt(ce,vr);const Ie=()=>{Wi(),$i(),qi(),V.registerComponent(ce.type,ce)};class xd{constructor(){this._rawDomainIndex=[]}_initData(){var t;if(this._spec.showAllGroupLayers&&this._scales.length>1)for(let e=0;e<this._scales.length;e++){const i=((t=this._spec.layers)!==null&&t!==void 0?t:[])[this._scales.length-1-e]||{};if(i.visible!==!1&&i.tickCount!==0&&i.forceTickCount!==0){const s=this._initTickDataSet(Object.assign(Object.assign({},this._tickTransformOption()),i),e);s.target.addListener("change",this._forceLayout.bind(this));const a=new qe(this._option,s);this._tickData.push(a),this._tickDataMap||(this._tickDataMap={}),this._tickDataMap[e]=a}}else{const e=this._initTickDataSet(this._tickTransformOption());e.target.addListener("change",this._forceLayout.bind(this));const i=new qe(this._option,e);this._tickData=[i],this._tickDataMap={0:i}}}dataToPosition(t,e={}){var i,s;if(t.length===0||this._scales.length===0)return 0;const{position:a,bandScale:n}=this.getPosition(t);return a+n.bandwidth()*((s=(i=e.bandPosition)!==null&&i!==void 0?i:this._spec.bandPosition)!==null&&s!==void 0?s:this._defaultBandPosition)}valueToPosition(t){return this._scale.scale(t)}updateGroupScaleRange(){let t=this._scale;this._scales.forEach((e,i)=>{i>0&&(e.range([0,t.bandwidth()]),t=e)})}getPosition(t){let e=0,i=this._scale;if(this._scales.length===1||t.length===1)e=this.valueToPosition(t[0]);else{const s=Math.min(t.length,this._scales.length);for(let a=0;a<s;a++)e+=this._scales[a].scale(t[a]);i=this._scales[s-1]}return{position:e,bandScale:i}}calcScales(t,e){var i,s;const{bandPadding:a,paddingInner:n,paddingOuter:r}=this._spec,l=U(a),h=U(n),d=U(r);for(let c=0;c<this._scales.length;c++){const u=l?a[c]:a,g=h?n[c]:n,p=d?r[c]:r;this._scales[c].paddingInner((i=g??u)!==null&&i!==void 0?i:t,!0).paddingOuter((s=p??u)!==null&&s!==void 0?s:e,!0)}}computeBandDomain(t){if(!t.length)return[];if(t.length===1)return t[0].values;const e=new Set;for(let i=0;i<t.length;i++)for(let s=0;s<t[i].values.length;s++)e.add(t[i].values[s]);return Array.from(e)}updateScaleDomain(){var t;if(!this.isSeriesDataEnable())return;!(!((t=this._rawDomainIndex)===null||t===void 0)&&t.length)&&this._scales.length&&this._updateRawDomain();const e=this._spec.domain;for(let i=0;i<this._scales.length;i++)if(e&&e.length&&i===0)this._scales[i].domain(e);else{const s=this.collectData(i),a=this.computeBandDomain(s);this._scales[i].domain(a.sort((n,r)=>this._rawDomainIndex[i][n]-this._rawDomainIndex[i][r]))}this.transformScaleDomain(),this.event.emit(z.scaleDomainUpdate,{model:this}),this.event.emit(z.scaleUpdate,{model:this,value:"domain"})}getLabelItems(t){const e=[];let i=[];return this._scales.forEach((s,a)=>{var n;const r=this._tickDataMap[a],l=(n=r==null?void 0:r.getLatestData())===null||n===void 0?void 0:n.length,h=l?r.getLatestData().map(d=>d.value):s.domain();if(h&&h.length)if(i&&i.length){const d=[],c=[];i.forEach(u=>{h.forEach(g=>{const p=L(u).concat(g);if(c.push(p),l){const _=Qe(g,this._getNormalizedValue(p,t));d.push(_)}})}),l&&e.push(d.filter(u=>u.value>=0&&u.value<=1)),i=c}else h.forEach(d=>{i.push(d)}),l&&e.push(r.getLatestData().map(d=>Qe(d.value,this._getNormalizedValue([d.value],t))).filter(d=>d.value>=0&&d.value<=1))}),e.reverse()}_updateRawDomain(){this._rawDomainIndex=[];const t=this._spec.domain;for(let e=0;e<this._scales.length;e++)if(t&&t.length&&e===0)this._scales[e].domain(t);else{const i=this.collectData(e,!0),s=this.computeBandDomain(i);this._rawDomainIndex[e]={},s.forEach((a,n)=>this._rawDomainIndex[e][a]=n)}}_clearRawDomain(){this._rawDomainIndex=[]}}class Xe extends Si{constructor(){super(...arguments),this.type=P.cartesianBandAxis,this._scale=new xn}computeDomain(t){return this.computeBandDomain(t)}updateScaleRange(){const t=super.updateScaleRange();return this.updateGroupScaleRange(),t}initScales(){super.initScales(),this.calcScales(this._defaultBandInnerPadding,this._defaultBandOuterPadding)}axisHelper(){const t=(e=0)=>this._scales[e];return{isContinuous:!1,dataToPosition:this.dataToPosition.bind(this),getScale:t,getBandwidth:(e=0)=>t(e).bandwidth(),getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>this._inverse,getSpec:()=>this._spec}}registerTicksTransform(){const t=`${this.type}-ticks`;return st(this._option.dataSet,t,vh),t}transformScaleDomain(){this.updateFixedWholeLength()}updateFixedWholeLength(){if(this._scale){const{bandSize:t,maxBandSize:e,minBandSize:i}=this._getOuterBandSizeFromSpec();if(t&&this._scale.bandwidth(t),e&&this._scale.maxBandwidth(e),i&&this._scale.minBandwidth(i),this._scale.isBandwidthFixed()&&this._spec.autoRegionSize&&(t||e)){const s=Qs(this._scale.domain().length,t??e,this._scale.paddingInner(),this._scale.paddingOuter());["bottom","top"].includes(this._orient)?this._regions.forEach(a=>a.setMaxWidth(s)):["left","right"].includes(this._orient)&&this._regions.forEach(a=>a.setMaxHeight(s))}}}_getOuterBandSizeFromSpec(){var t;let{bandSize:e,maxBandSize:i,minBandSize:s,bandSizeLevel:a=0}=this._spec;const{gap:n,extend:r=0}=(t=this._spec.bandSizeExtend)!==null&&t!==void 0?t:{};a=Math.min(a,this._scales.length-1);for(let l=a;l>0;l--){const h=this._scales[l],d=h.domain(),c=h.paddingInner(),u=h.paddingOuter(),g=p=>{const _=l===a?r:0;return C(n)||l<a?Qs(d.length,p,c,u)+_:(p+(X(n)?p*(Number(n.substring(0,n.length-1))/100):n))*d.length/(this._scales[l-1].paddingInner()+1)+_};S(e)&&(e=g(e)),S(i)&&(i=g(i)),S(s)&&(s=g(s))}return{bandSize:e,maxBandSize:i,minBandSize:s}}}Xe.type=P.cartesianBandAxis,Xe.specKey="axes",kt(Xe,xd);const Re=()=>{Wi(),$i(),qi(),V.registerComponent(Xe.type,Xe)};class Ai extends ce{constructor(){super(...arguments),this.type=P.cartesianTimeAxis,this._zero=!1,this.effect={scaleUpdate:t=>{this.computeData(t==null?void 0:t.value),mt(this._regions,e=>{rt(this.getOrient())?e.setXAxisHelper(this.axisHelper()):e.setYAxisHelper(this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}}}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._tick=q({},this._spec.tick,(t=this._spec.layers)===null||t===void 0?void 0:t[0])}_initData(){var t;if(super._initData(),(t=this._spec.layers)===null||t===void 0?void 0:t[1]){const e=new St(this._option.dataSet,{name:`${this.type}_${this.id}_layer_1_ticks`}).parse(this._scale,{type:"scale"}).transform({type:`${this.type}-ticks`,options:Object.assign(Object.assign({},this._tickTransformOption()),{tickCount:this._spec.layers[1].tickCount,forceTickCount:this._spec.layers[1].forceTickCount,tickStep:this._spec.layers[1].tickStep})},!1);this._layerTickData=new qe(this._option,e)}}computeData(t){super.computeData(t),this._layerTickData&&(this._layerTickData.getDataView().reRunAllTransform(),this._layerTickData.updateData())}_getLabelFormatMethod(){var t,e,i,s,a,n,r,l;const h=Co.getInstance(),d=((e=(t=this._spec.layers)===null||t===void 0?void 0:t[1])===null||e===void 0?void 0:e.timeFormat)||"%Y%m%d",c=(((s=(i=this._spec.layers)===null||i===void 0?void 0:i[1])===null||s===void 0?void 0:s.timeFormatMode)||"local")==="local"?h.timeFormat:h.timeUTCFormat,u=((n=(a=this._spec.layers)===null||a===void 0?void 0:a[0])===null||n===void 0?void 0:n.timeFormat)||"%Y%m%d",g=(((l=(r=this._spec.layers)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.timeFormatMode)||"local")==="local"?h.timeFormat:h.timeUTCFormat;return(p,_,m,v,b)=>{var y;let f;return f=b===0?g(u,p):c(d,p),!((y=this._spec.label)===null||y===void 0)&&y.formatMethod?this._spec.label.formatMethod(f,_):f}}getLabelItems(t){var e,i;const s=[],a=(e=this.getTickData())===null||e===void 0?void 0:e.getLatestData();a&&a.length&&s.push(a.map(r=>Qe(r.value,this._getNormalizedValue([r.value],t))));const n=(i=this._layerTickData)===null||i===void 0?void 0:i.getLatestData();return n&&n.length&&s.push(n.map(r=>Qe(r.value,this._getNormalizedValue([r.value],t)))),s}registerTicksTransform(){const t=`${this.type}-ticks`;return st(this._option.dataSet,t,As),t}transformScaleDomain(){}}Ai.type=P.cartesianTimeAxis,Ai.specKey="axes";const yr=()=>{Wi(),$i(),qi(),V.registerComponent(Ai.type,Ai)};class Ge extends ce{constructor(){super(...arguments),this.type=P.cartesianLogAxis,this._zero=!1,this._scale=new Ni}initScales(){var t;super.initScales(),this._scale.base((t=this._spec.base)!==null&&t!==void 0?t:10),this._scale.clamp(!0,null,!1)}registerTicksTransform(){const t=`${this.type}-ticks`;return st(this._option.dataSet,t,As),t}transformScaleDomain(){}}Ge.type=P.cartesianLogAxis,Ge.specKey="axes",kt(Ge,vr);const br=()=>{Wi(),$i(),qi(),V.registerComponent(Ge.type,Ge)};class Me extends ji{constructor(){super(...arguments),this.type=yt.line,this.transformerConstructor=Bs,this._sortDataByAxis=!1}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}initMark(){var t;const e={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},i=(t=this._spec.seriesMark)!==null&&t!==void 0?t:"line";this.initLineMark(e,i==="line"),this.initSymbolMark(e,i==="point")}initTooltip(){super.initTooltip();const{dimension:t,group:e,mark:i}=this._tooltipHelper.activeTriggerSet;this._lineMark&&(t.add(this._lineMark),e.add(this._lineMark)),this._symbolMark&&(i.add(this._symbolMark),e.add(this._symbolMark))}initMarkStyle(){this.initLineMarkStyle(this._direction),this.initSymbolMarkStyle()}initAnimation(){var t,e,i,s;const a={direction:this.direction},n=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;if(this._lineMark.setAnimationConfig(Pt((i=V.getAnimationInKey("line"))===null||i===void 0?void 0:i(a,n),Wt("line",this._spec,this._markAttributeContext))),this._symbolMark){const r=Yi(this);this._symbolMark.setAnimationConfig(Pt((s=V.getAnimationInKey("scaleInOut"))===null||s===void 0?void 0:s(),Wt("point",this._spec,this._markAttributeContext),r))}}onLayoutEnd(t){super.onLayoutEnd(t),this.reCompileSampling()}getSeriesStyle(t){var e;const i=((e=this._spec)===null||e===void 0?void 0:e.seriesMark)!=="point";return s=>{var a,n;return i&&s==="fill"&&(s="stroke"),(n=(a=this._seriesMark)===null||a===void 0?void 0:a.getAttribute(s,t))!==null&&n!==void 0?n:void 0}}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._lineMark,this._symbolMark]}}Me.type=yt.line,Me.mark=ud,Me.transformerConstructor=Bs,kt(Me,_r);const fr=()=>{Ps(),gr(),Sn(),fs(),An(),kn(),Re(),Ie(),V.registerSeries(Me.type,Me)};class Sd extends Mn{needAxes(){return!0}_isValidSeries(t){return!this.seriesType||t===this.seriesType}_getDefaultSeriesSpec(t){const e=Object.assign(Object.assign({},super._getDefaultSeriesSpec(t)),{xField:t.xField,yField:t.yField,zField:t.zField,seriesField:t.seriesField,seriesStyle:t.seriesStyle,direction:t.direction,stack:t.stack,percent:t.percent,stackOffsetSilhouette:t.stackOffsetSilhouette,totalLabel:t.totalLabel,sortDataByAxis:t.sortDataByAxis}),i=this.seriesType;return i&&(e.type=i,e[i]=t[i]),e}transformSpec(t){super.transformSpec(t);const e=this._getDefaultSeriesSpec(t);t.series&&t.series.length!==0?t.series.forEach(i=>{this._isValidSeries(i.type)&&Object.keys(e).forEach(s=>{s in i||(i[s]=e[s])})}):t.series=[e],this._transformAxisSpec(t)}_setDefaultXAxisSpec(t){return{orient:"bottom"}}_setDefaultYAxisSpec(t){return{orient:"left"}}_setDefaultZAxisSpec(t){return{orient:"z"}}_transformAxisSpec(t){if(this.needAxes()){t.axes||(t.axes=[]);const e={x:!1,y:!1,z:!1};t.axes.forEach(i=>{const{orient:s}=i;let a=null;s!=="top"&&s!=="bottom"||(e.x=!0,a=this._setDefaultXAxisSpec(t)),s!=="left"&&s!=="right"||(e.y=!0,a=this._setDefaultYAxisSpec(t)),s==="z"&&(e.z=!0,a=this._setDefaultZAxisSpec(t)),a&&Object.keys(a).forEach(n=>{C(i[n])&&(i[n]=a[n])}),$(i,"trimPadding")&&q(i,Tn(this.type,t))}),e.x||t.axes.push(this._setDefaultXAxisSpec(t)),e.y||t.axes.push(this._setDefaultYAxisSpec(t)),t.zField&&!e.z&&t.axes.push(this._setDefaultZAxisSpec(t))}}}class xr extends Sd{_getDefaultSeriesSpec(t){var e;return Object.assign(Object.assign({},super._getDefaultSeriesSpec(t)),{point:t.point,line:t.line,seriesMark:(e=t.seriesMark)!==null&&e!==void 0?e:"line",activePoint:t.activePoint,sampling:t.sampling,samplingFactor:t.samplingFactor,pointDis:t.pointDis,pointDisMul:t.pointDisMul,markOverlap:t.markOverlap,lineLabel:t.lineLabel})}transformSpec(t){super.transformSpec(t),Lo(t)}}const Ad=(o,t)=>{const e={nodes:{}},{fields:i}=t;if(!(i!=null&&i.length))return e;const s=i.length-1;let a,n,r=e;return o.forEach(l=>{l.latestData.forEach(h=>{r=e;for(let d=0;d<i.length;d++){const c=i[d],u=h[c];if(C(u))break;r.groupField=c,r.nodes[u]||(d===s?r.nodes[u]={values:[]}:(a={nodes:{}},r.nodes[u]=a)),d===s?(n=r.nodes[u],n.values.push(h)):r=r.nodes[u]}})}),e};class kd{constructor(t,e){this.stackRegion=({model:i})=>{var s;const a=i.getSeries();if(!a.some(d=>d.getStack()))return;const n=a.some(d=>{var c,u;return(u=(c=d.getSpec())===null||c===void 0?void 0:c.totalLabel)===null||u===void 0?void 0:u.visible}),r=n||a.some(d=>d.getPercent()),l=a.some(d=>d.getStackOffsetSilhouette()),h=Cn(i,!0);for(const d in h)for(const c in h[d].nodes)Po(h[d].nodes[c],i.getStackInverse(),r,n);if(l)for(const d in h)for(const c in h[d].nodes)Bo(h[d].nodes[c]);n&&i.getSeries().forEach(d=>{const c=d.getStackData(),u=d.getStackValue(),g=d.getStackValueField();c&&g&&Do(h[u],g)}),!((s=this._options)===null||s===void 0)&&s.afterStackRegion&&this._options.afterStackRegion(i,h)},this._chart=t,this._options=e}init(){this._chart.getAllRegions().forEach(t=>{t.event.on(z.regionSeriesDataFilterOver,{filter:({model:e})=>(e==null?void 0:e.id)===t.id},this.stackRegion)})}stackAll(){this._chart.getAllRegions().forEach(t=>{this.stackRegion({model:t})})}}class Sr{_beforeInit(){this._dataSet&&st(this._dataSet,"stackSplit",Ad)}_initStack(){this._stack=new kd(this),this._stack.init()}}let Te=class extends Ln{constructor(){super(...arguments),this.transformerConstructor=xr,this.type="line",this.seriesType=yt.line}};Te.type="line",Te.seriesType=yt.line,Te.transformerConstructor=xr,kt(Te,Sr);const Md=()=>{fr(),V.registerChart(Te.type,Te)};class Td extends Oo{constructor(){super(...arguments),this._getSeriesStyle=(t,e,i)=>{var s,a,n,r;for(const l of L(e)){let h=(s=this.series.getSeriesStyle(t))===null||s===void 0?void 0:s(l);if(h!==!1||l!=="fill"&&l!=="stroke"||(h=l==="fill"?(n=(a=this.series.getSeriesStyle(t))===null||a===void 0?void 0:a("stroke"))===null||n===void 0?void 0:n[0]:(r=this.series.getSeriesStyle(t))===null||r===void 0?void 0:r("fill")),S(h))return h}return i}}}const Cd=Object.assign(Object.assign(Object.assign({},pe),ie),{area:{name:"area",type:"area"}}),Ld=()=>{Eo(),An(),kn()};class Ar extends Bs{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(t){var e,i,s;super._transformLabelSpec(t),this._addMarkLabelSpec(t,"area","areaLabel","initLineLabelMarkStyle",void 0,!0),((e=t.point)===null||e===void 0?void 0:e.visible)!==!1&&((s=(i=t.point)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.visible)!==!1||this._addMarkLabelSpec(t,"area")}_transformSpecAfterMergingTheme(t,e,i){var s,a,n,r,l;super._transformSpecAfterMergingTheme(t,e,i);const{area:h={},line:d={},seriesMark:c}=t,u=h.visible!==!1&&((s=h.style)===null||s===void 0?void 0:s.visible)!==!1,g=d.visible!==!1&&((a=d.style)===null||a===void 0?void 0:a.visible)!==!1;h.support3d=!(!h.support3d&&!d.support3d),h.zIndex=S(h.zIndex)||S(d.zIndex)?Math.max((n=h.zIndex)!==null&&n!==void 0?n:0,(r=d.zIndex)!==null&&r!==void 0?r:0):void 0,h.style&&delete h.style.stroke,h.state&&Object.keys(h.state).forEach(m=>{"style"in h.state[m]?delete h.state[m].style.stroke:delete h.state[m].stroke});let p=h,_=d;(c==="line"||g&&!u)&&(p=d,_=h),h.style=q({},_.style,p.style),h.state=q({},_.state,p.state),u||(h.style.fill=!1),g||(h.style.stroke=!1),h.interactive===!1&&(h.style.fillPickable=!1),d.interactive===!1&&(d.style.strokePickable=!1),h.interactive=!(!h.interactive&&(l=d.interactive)!==null&&l!==void 0&&!l),h.visible=!(!u&&!g),t.area=h,t.line=d}}class Ut extends ji{constructor(){super(...arguments),this.type=yt.area,this.transformerConstructor=Ar,this._sortDataByAxis=!1}initMark(){var t,e;const i={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},s=this._spec.area||{},a=s.visible!==!1&&((t=s.style)===null||t===void 0?void 0:t.visible)!==!1,n=(e=this._spec.seriesMark)!==null&&e!==void 0?e:"area";this._areaMark=this._createMark(Ut.mark.area,{groupKey:this._seriesField,defaultMorphElementKey:this.getDimensionField()[0],progressive:i,isSeriesMark:a&&n!=="point",customShape:s.customShape,stateSort:s.stateSort}),this.initSymbolMark(i,n==="point")}initMarkStyle(){this.initAreaMarkStyle(),this.initSymbolMarkStyle()}initAreaMarkStyle(){var t,e,i,s,a;const n=(i=(e=(t=this.getSpec().area)===null||t===void 0?void 0:t.style)===null||e===void 0?void 0:e.curveType)!==null&&i!==void 0?i:(a=(s=this.getSpec().line)===null||s===void 0?void 0:s.style)===null||a===void 0?void 0:a.curveType,r=n===pr?this._direction==="horizontal"?"monotoneY":"monotoneX":n,l=this._areaMark;l&&(this._direction==="horizontal"?this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),x1:h=>{var d,c;return ht(this.dataToPositionX1(h),(c=(d=this._xAxisHelper)===null||d===void 0?void 0:d.getScale)===null||c===void 0?void 0:c.call(d,0))},y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null,orient:this._direction},"normal",I.Series):this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),y1:h=>{var d,c;return ht(this.dataToPositionY1(h),(c=(d=this._yAxisHelper)===null||d===void 0?void 0:d.getScale)===null||c===void 0?void 0:c.call(d,0))},y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",I.Series),this.setMarkStyle(l,{fill:this.getColorAttribute(),stroke:this.getColorAttribute()},"normal",I.Series),this._invalidType!=="zero"&&this.setMarkStyle(l,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",I.Series),this.setMarkStyle(l,{curveType:r},"normal",I.Built_In),Object.keys(l.stateStyle).forEach(h=>{l.stateStyle[h].stroke&&l.setPostProcess("stroke",d=>[d,!1,!1,!1],h)}))}initAnimation(){var t,e,i,s;const a={direction:this.direction},n=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;if(this._lineMark&&this._lineMark.setAnimationConfig(Pt((e=V.getAnimationInKey("line"))===null||e===void 0?void 0:e(a,n),Wt("line",this._spec,this._markAttributeContext))),this._areaMark&&this._areaMark.setAnimationConfig(Pt((i=V.getAnimationInKey("area"))===null||i===void 0?void 0:i(a,n),Wt("area",this._spec,this._markAttributeContext))),this._symbolMark){const r=Yi(this);this._symbolMark.setAnimationConfig(Pt((s=V.getAnimationInKey("scaleInOut"))===null||s===void 0?void 0:s(),Wt("point",this._spec,this._markAttributeContext),r))}}initTooltip(){this._tooltipHelper=new Td(this);const{dimension:t,group:e,mark:i}=this._tooltipHelper.activeTriggerSet;this._areaMark&&(t.add(this._areaMark),e.add(this._areaMark)),this._lineMark&&(t.add(this._lineMark),e.add(this._lineMark)),this._symbolMark&&(i.add(this._symbolMark),e.add(this._symbolMark))}viewDataStatisticsUpdate(t){super.viewDataStatisticsUpdate(t),this.encodeDefined(this._areaMark,"defined")}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._areaMark,this._symbolMark,this._lineMark]}onLayoutEnd(t){super.onLayoutEnd(t),this.reCompileSampling()}getSeriesStyle(t){return e=>{var i,s,a,n,r;const l=(i=this._spec.seriesMark)!==null&&i!==void 0?i:"area";let h=(a=(s=this._seriesMark)===null||s===void 0?void 0:s.getAttribute(e,t))!==null&&a!==void 0?a:void 0;return e!=="fill"||h&&l!=="line"||(e="stroke",h=(r=(n=this._seriesMark)===null||n===void 0?void 0:n.getAttribute(e,t))!==null&&r!==void 0?r:void 0),e==="stroke"&&U(h)?h[0]:h}}}Ut.type=yt.area,Ut.mark=Cd,Ut.transformerConstructor=Ar,kt(Ut,_r);const Pd=()=>{Ps(),gr(),Sn(),Io(),fs(),Ld(),Re(),Ie(),V.registerSeries(Ut.type,Ut)};function kr(o,t=!0){return(e,i,s)=>{const a=o.direction==="vertical"?o.yField:o.xField,n=e==null?void 0:e[a];return o.direction==="vertical"?{overall:t&&o.growFrom(),orient:n>0?"negative":"positive"}:{overall:!!t&&o.growFrom(),orient:n>0?"positive":"negative"}}}const Mr=(o,t=!0)=>({type:o.direction==="horizontal"?"growWidthIn":"growHeightIn",options:kr(o,t)}),Ha=(o,t=!0)=>({type:o.direction==="horizontal"?"growWidthOut":"growHeightOut",options:kr(o,t)}),Bd={type:"fadeIn"},Dd={type:"growCenterIn"};function Od(o,t){if(t===!1)return{};switch(t){case"fadeIn":return Bd;case"scaleIn":return Dd;default:return Mr(o)}}const Ed=()=>{V.registerAnimation("bar",(o,t)=>({appear:Od(o,t),enter:Mr(o,!1),exit:Ha(o,!1),disappear:Ha(o)}))},Id=Object.assign(Object.assign({},pe),{bar:{name:"bar",type:"rect"},barBackground:{name:"barBackground",type:"rect"}});Object.assign(Object.assign({},pe),{bar3d:{name:"bar3d",type:"rect3d"}});function Tr(o,t,e){var i,s;if(o.values.length>0){let a;if(o.sortDatums.length){let n=o.sortDatums;t&&(n=o.sortDatums.slice().reverse());for(let r=0;r<n.length;r++)a=Va(n[r].datum,a,n[r].series,e,(s=(i=n[r].series[e.axisHelper]).getScale)===null||s===void 0?void 0:s.call(i,0),r===0)}else{let n=o.series;t&&(n=n.slice().reverse()),n.forEach(({s:r,values:l},h)=>{var d,c;const u=(c=(d=r[e.axisHelper]).getScale)===null||c===void 0?void 0:c.call(d,0);for(let g=0;g<l.length;g++){const p=l[t?l.length-1-g:g];a=Va(p,a,r,e,u,g===0&&h===0)}})}}for(const a in o.nodes)Tr(o.nodes[a],t,e)}function Va(o,t,e,i,s,a){const n=e.getSpec().barMinHeight,r=e[i.axisHelper].isInverse(),l=ht(e[i.startMethod](o),s);let h=ht(e[i.endMethod](o),s);a&&(t=l);let d=Math.abs(l-h);d<n&&(d=n);let c=1;return h<l?c=-1:h===l&&(c=i.isVertical?r?1:-1:r?-1:1),h=t+c*d,o[i.start]=t,o[i.end]=h,h}class Cr extends Vi{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(t){this._addMarkLabelSpec(t,"bar")}}class $t extends ji{constructor(){super(...arguments),this.type=yt.bar,this._barMarkName="bar",this._barMarkType="rect",this.transformerConstructor=Cr,this._bandPosition=0,this._getBarXStart=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),t[Js]):this._spec.barMinHeight?this._calculateRectPosition(t,!1):ht(this._dataToPosX(t),e),this._getBarXEnd=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),t[ta]):ht(this._dataToPosX1(t),e),this._getBarYStart=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),t[ea]):this._spec.barMinHeight?this._calculateRectPosition(t,!0):ht(this._dataToPosY(t),e),this._getBarYEnd=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),t[ia]):ht(this._dataToPosY1(t),e),this._getBarBackgroundXStart=t=>{const e=t.range();return Math.min(e[0],e[e.length-1])},this._getBarBackgroundXEnd=t=>{const e=t.range();return Math.max(e[0],e[e.length-1])},this._getBarBackgroundYStart=t=>{const e=t.range();return Math.min(e[0],e[e.length-1])},this._getBarBackgroundYEnd=t=>{const e=t.range();return Math.max(e[0],e[e.length-1])},this._getBarBackgroundPositionXEncoder=()=>{var t;return(t=this._barBackgroundPositionXEncoder)===null||t===void 0?void 0:t.bind(this)},this._setBarBackgroundPositionXEncoder=t=>{this._barBackgroundPositionXEncoder=t.bind(this)},this._getBarBackgroundPositionYEncoder=()=>{var t;return(t=this._barBackgroundPositionYEncoder)===null||t===void 0?void 0:t.bind(this)},this._setBarBackgroundPositionYEncoder=t=>{this._barBackgroundPositionYEncoder=t.bind(this)}}initMark(){var t,e;const i={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold};this._initBarBackgroundMark(i),this._barMark=this._createMark(Object.assign(Object.assign({},$t.mark.bar),{name:this._barMarkName,type:this._barMarkType}),{morph:Hi(this._spec,this._barMarkName),defaultMorphElementKey:this.getDimensionField()[0],groupKey:this._seriesField,isSeriesMark:!0,progressive:i,customShape:(t=this._spec.bar)===null||t===void 0?void 0:t.customShape,stateSort:(e=this._spec.bar)===null||e===void 0?void 0:e.stateSort})}_initBarBackgroundMark(t){this._spec.barBackground&&this._spec.barBackground.visible&&(this._barBackgroundMark=this._createMark($t.mark.barBackground,{dataView:this._barBackgroundViewData.getDataView(),dataProductId:this._barBackgroundViewData.getProductId(),progressive:t,customShape:this._spec.barBackground.customShape,stateSort:this._spec.barBackground.stateSort}))}initMarkStyle(){this._barMark&&this.setMarkStyle(this._barMark,{fill:this.getColorAttribute()},"normal",I.Series)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null})}initTooltip(){super.initTooltip();const{mark:t,group:e}=this._tooltipHelper.activeTriggerSet;this._barMark&&(t.add(this._barMark),e.add(this._barMark))}_statisticViewData(){var t,e;super._statisticViewData();const i=(t=this._spec.barBackground)!==null&&t!==void 0?t:{};if(!i.visible)return;const s=this._getRelatedComponentSpecInfo("axes").some(n=>n.type===P.cartesianBandAxis);let a;if(st(this._option.dataSet,"addVChartProperty",wo),s){const n=([r],{scaleDepth:l})=>{var h,d;let c=[{}];const u=this.getDimensionField(),g=C(l)?u.length:Math.min(u.length,l);for(let p=0;p<g;p++){const _=u[p],m=(h=r.latestData[_])===null||h===void 0?void 0:h.values;if(!(m!=null&&m.length))continue;const v=[],b=(d=this._spec.dataKey)!==null&&d!==void 0?d:Bn;for(let y=0;y<m.length;y++)for(let f=0;f<c.length;f++)v.push(Object.assign(Object.assign({},c[f]),{[_]:m[y],[b]:m[y]}));c=v}return c};st(this._option.dataSet,"dimensionItems",n),a=new St(this._option.dataSet).parse([this._viewDataStatistics],{type:"dataview"}).transform({type:"dimensionItems",options:{scaleDepth:C(i.fieldLevel)?void 0:i.fieldLevel+1}},!1).transform({type:"addVChartProperty",options:{beforeCall:sa.bind(this),call:aa}},!1),(e=this._viewDataStatistics)===null||e===void 0||e.target.addListener("change",a.reRunAllTransform)}else{const n=([l])=>{const h=[],[d,c]=this.getDimensionContinuousField(),u={};return r.latestData.forEach(g=>{const p=`${g[d]}-${g[c]}`;u[p]||(u[p]={[d]:g[d],[c]:g[c]},h.push(u[p]))}),h};st(this._option.dataSet,"dimensionItems",n);const r=this.getViewData();a=new St(this._option.dataSet).parse([r],{type:"dataview"}).transform({type:"dimensionItems"},!1).transform({type:"addVChartProperty",options:{beforeCall:sa.bind(this),call:aa}},!1),r==null||r.target.addListener("change",a.reRunAllTransform)}this._barBackgroundViewData=new Pn(this._option,a)}init(t){var e,i;super.init(t),this.direction==="vertical"?((e=this._xAxisHelper)===null||e===void 0?void 0:e.getScale(0).type)==="band"?this.initBandRectMarkStyle():this.initLinearRectMarkStyle():((i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale(0).type)==="band"?this.initBandRectMarkStyle():this.initLinearRectMarkStyle()}_shouldDoPreCalculate(){const t=this.getRegion();return this.getStack()&&t.getSeries().filter(e=>e.type===this.type&&e.getSpec().barMinHeight).length}_calculateStackRectPosition(t){const e=this.getRegion();if(e._bar_series_position_calculated)return;let i,s,a,n,r;e._bar_series_position_calculated=!0,t?(i=ia,s=ea,a="_dataToPosY1",n="_dataToPosY",r="_yAxisHelper"):(i=ta,s=Js,a="_dataToPosX1",n="_dataToPosX",r="_xAxisHelper");const l=Cn(e,!1,h=>h.type===this.type);for(const h in l)for(const d in l[h].nodes)Tr(l[h].nodes[d],e.getStackInverse(),{isVertical:t,start:i,end:s,startMethod:a,endMethod:n,axisHelper:r})}_calculateRectPosition(t,e){var i,s;let a,n,r;e?(a="_dataToPosY1",n="_dataToPosY",r="_yAxisHelper"):(a="_dataToPosX1",n="_dataToPosX",r="_xAxisHelper");const l=(s=(i=this[r]).getScale)===null||s===void 0?void 0:s.call(i,0),h=this[r].isInverse(),d=this._spec.barMinHeight,c=ht(this[a](t),l),u=ht(this[n](t),l);let g=Math.abs(c-u);g<d&&(g=d);let p=1;return u<c?p=-1:u===c&&(p=e?h?1:-1:h?-1:1),c+p*g}_dataToPosX(t){return this.dataToPositionX(t)}_dataToPosX1(t){return this.dataToPositionX1(t)}_dataToPosY(t){return this.dataToPositionY(t)}_dataToPosY1(t){return this.dataToPositionY1(t)}initBandRectMarkStyle(){var t,e,i,s;const a=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),n=(s=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0);this.direction==="horizontal"?this.setMarkStyle(this._barMark,{x:r=>this._getBarXStart(r,a),x1:r=>this._getBarXEnd(r,a),y:r=>this._getPosition(this.direction,r),height:()=>this._getBarWidth(this._yAxisHelper),width:()=>{},y1:()=>{}},"normal",I.Series):this.setMarkStyle(this._barMark,{y:r=>this._getBarYStart(r,n),y1:r=>this._getBarYEnd(r,n),x:r=>this._getPosition(this.direction,r),width:()=>this._getBarWidth(this._xAxisHelper),x1:()=>{},height:()=>{}},"normal",I.Series),this._initStackBarMarkStyle(),this._initBandBarBackgroundMarkStyle()}_initStackBarMarkStyle(){var t,e,i,s;if(!this._spec.stackCornerRadius)return;const a=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),n=(s=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0);this._barMark.setClip(()=>{const r=[];return this._forEachStackGroup(l=>{let h=1/0,d=-1/0,c=!1,u=1/0,g=-1/0;l.values.forEach(_=>{const m=_[na],v=_[ra],b=_[oa],y=_[la];h=Math.min(h,m,v),d=Math.max(d,m,v),S(b)&&S(y)&&(c=!0,u=Math.min(u,b,y),g=Math.max(g,b,y))});const p=Object.assign(Object.assign(Object.assign({},l.values[0]),{[na]:h,[ra]:d}),c?{[oa]:u,[la]:g}:void 0);r.push(Fo(Object.assign(Object.assign({},this.direction==="horizontal"?{x:this._getBarXStart(p,a),x1:this._getBarXEnd(p,a),y:this._getPosition(this.direction,p),height:this._getBarWidth(this._yAxisHelper)}:{y:this._getBarYStart(p,n),y1:this._getBarYEnd(p,n),x:this._getPosition(this.direction,p),width:this._getBarWidth(this._xAxisHelper)}),{cornerRadius:this._spec.stackCornerRadius,fill:!0})))}),r})}initLinearRectMarkStyle(){var t,e,i,s;const a=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),n=(s=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0);if(this.direction==="horizontal"){const r=S(this._fieldY2)?{y:l=>ht(this._dataToPosY(l),n),y1:l=>ht(this._dataToPosY1(l),n)}:{y:l=>ht(this._dataToPosY(l)-this._getBarWidth(this._yAxisHelper)/2,n),height:l=>this._getBarWidth(this._yAxisHelper)};this.setMarkStyle(this._barMark,Object.assign({x:l=>this._getBarXStart(l,a),x1:l=>this._getBarXEnd(l,a)},r),"normal",I.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign({x:()=>this._getBarBackgroundXStart(a),x1:()=>this._getBarBackgroundXEnd(a)},r),"normal",I.Series)}else{const r=S(this._fieldX2)?{x:l=>ht(this._dataToPosX(l),a),x1:l=>ht(this._dataToPosX1(l),a)}:{x:l=>ht(this._dataToPosX(l)-this._getBarWidth(this._xAxisHelper)/2,a),width:l=>this._getBarWidth(this._xAxisHelper)};this.setMarkStyle(this._barMark,Object.assign(Object.assign({},r),{y:l=>this._getBarYStart(l,n),y1:l=>this._getBarYEnd(l,n)}),"normal",I.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign(Object.assign({},r),{y:()=>this._getBarBackgroundYStart(n),y1:()=>this._getBarBackgroundYEnd(n)}),"normal",I.Series)}}_initBandBarBackgroundMarkStyle(){var t,e,i,s,a;if(!this._barBackgroundMark)return;const n=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),r=(s=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0),l=(a=this._spec.barBackground)!==null&&a!==void 0?a:{},h=C(l.fieldLevel)?void 0:l.fieldLevel+1;this.direction==="horizontal"?this.setMarkStyle(this._barBackgroundMark,{x:()=>this._getBarBackgroundXStart(n),x1:()=>this._getBarBackgroundXEnd(n),y:d=>this._getPosition(this.direction,d,h,"barBackground"),height:()=>this._getBarWidth(this._yAxisHelper,h),width:()=>{},y1:()=>{}},"normal",I.Series):this.setMarkStyle(this._barBackgroundMark,{x:d=>this._getPosition(this.direction,d,h,"barBackground"),y:()=>this._getBarBackgroundYStart(r),y1:()=>this._getBarBackgroundYEnd(r),width:()=>this._getBarWidth(this._xAxisHelper,h),x1:()=>{},height:()=>{}},"normal",I.Series)}initAnimation(){var t,e;const i={yField:this._fieldY[0],xField:this._fieldX[0],direction:this.direction,growFrom:()=>{var n,r;return this.direction==="horizontal"?(n=this._xAxisHelper)===null||n===void 0?void 0:n.getScale(0).scale(0):(r=this._yAxisHelper)===null||r===void 0?void 0:r.getScale(0).scale(0)}},s=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset,a=Yi(this);this._barMark.setAnimationConfig(Pt((e=V.getAnimationInKey("bar"))===null||e===void 0?void 0:e(i,s),Wt(this._barMarkName,this._spec,this._markAttributeContext),a))}_getBarWidth(t,e){var i,s;const a=this._groups?this._groups.fields.length:1,n=C(e)?a:Math.min(a,e),r=(s=(i=t.getBandwidth)===null||i===void 0?void 0:i.call(t,n-1))!==null&&s!==void 0?s:6,l=this._spec.barWidth!==void 0&&n===a,h=this._spec.barMinWidth!==void 0,d=this._spec.barMaxWidth!==void 0;let c=r;return l&&(c=di(this._spec.barWidth,r)),h&&(c=Math.max(c,di(this._spec.barMinWidth,r))),d&&(c=Math.min(c,di(this._spec.barMaxWidth,r))),c}_getPosition(t,e,i,s){var a,n,r,l,h;let d,c,u;t==="horizontal"?(d=this.getYAxisHelper(),c="height",u=s==="barBackground"?this.dataToBarBackgroundPositionY.bind(this):this.dataToPositionY.bind(this)):(d=this.getXAxisHelper(),c="width",u=s==="barBackground"?this.dataToBarBackgroundPositionX.bind(this):this.dataToPositionX.bind(this));const g=d.getScale(0),p=this._groups?this._groups.fields.length:1,_=C(i)?p:Math.min(p,i),m=(n=(a=d.getBandwidth)===null||a===void 0?void 0:a.call(d,_-1))!==null&&n!==void 0?n:6,v=_===p?this._barMark.getAttribute(c,e):m;if(_>1&&S(this._spec.barGapInGroup)){const y=this._groups.fields,f=L(this._spec.barGapInGroup);let x=0,M=0;for(let k=y.length-1;k>=1;k--){const D=y[k],O=(l=(r=d.getScale(k))===null||r===void 0?void 0:r.domain())!==null&&l!==void 0?l:[],T=O.length,B=di((h=f[k-1])!==null&&h!==void 0?h:Ce(f),m),H=O.indexOf(e[D]);k===y.length-1?(x+=T*v+(T-1)*B,M+=H*(v+B)):(M+=H*(x+B),x+=x+(T-1)*B)}return g.scale(e[y[0]])+d.getBandwidth(0)/2-x/2+M}const b=et(g.type||"band");return u(e,_)+.5*(m-v)+(b?-m/2:0)}dataToBarBackgroundPositionX(t,e){return this._dataToPosition(t,this._xAxisHelper,this.fieldX,e,this._getBarBackgroundPositionXEncoder,this._setBarBackgroundPositionXEncoder)}dataToBarBackgroundPositionY(t,e){return this._dataToPosition(t,this._yAxisHelper,this.fieldY,e,this._getBarBackgroundPositionYEncoder,this._setBarBackgroundPositionYEncoder)}onLayoutEnd(t){super.onLayoutEnd(t),this.getRegion()._bar_series_position_calculated=!1,this._spec.sampling&&this.compile()}compile(){if(super.compile(),this._spec.sampling){const{width:t,height:e}=this._region.getLayoutRect(),i=[],s=this._fieldY,a=this._fieldX;i.push({type:"sampling",size:this._direction==="horizontal"?e:t,factor:this._spec.samplingFactor,yfield:this._direction==="horizontal"?a[0]:s[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(i)}}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._barMark]}compileData(){var t;super.compileData(),(t=this._barBackgroundViewData)===null||t===void 0||t.compile()}fillData(){var t,e;super.fillData(),(e=(t=this._barBackgroundViewData)===null||t===void 0?void 0:t.getDataView())===null||e===void 0||e.reRunAllTransform()}viewDataUpdate(t){var e,i,s;super.viewDataUpdate(t),(i=(e=this._barBackgroundViewData)===null||e===void 0?void 0:e.getDataView())===null||i===void 0||i.reRunAllTransform(),(s=this._barBackgroundViewData)===null||s===void 0||s.updateData()}release(){var t;super.release(),(t=this._barBackgroundViewData)===null||t===void 0||t.release(),this._barBackgroundViewData=null}}$t.type=yt.bar,$t.mark=Id,$t.transformerConstructor=Cr;const Rd=()=>{Ps(),Ro(),Ed(),Re(),Ie(),V.registerSeries($t.type,$t)},ja=10,wd=[10,20],Fd=_s.Linear,Ya="circle",zd=_s.Ordinal,Hd=["circle","square","triangle","diamond","star"],Vd=(o,t)=>t==="fadeIn"?{type:"fadeIn"}:{type:"scaleIn"},jd=()=>{V.registerAnimation("scatter",(o,t)=>Object.assign({appear:Vd(0,t)},zo))},Yd=Object.assign(Object.assign({},pe),{point:{name:"point",type:"symbol"}});class Lr extends Vi{_transformLabelSpec(t){this._addMarkLabelSpec(t,"point")}}class Kt extends ji{constructor(){super(...arguments),this.type=yt.scatter,this.transformerConstructor=Lr,this._invalidType="zero"}setAttrFromSpec(){super.setAttrFromSpec(),this._size=this._spec.size,this._sizeField=this._spec.sizeField,this._shape=this._spec.shape,this._shapeField=this._spec.shapeField}_getSeriesAttribute(t,e,{defaultScaleType:i,defaultRange:s},a){var n,r,l,h;if(E(e))return e;if(U(e)){if(C(t))return(n=this._option)===null||n===void 0||n.onError(`${a}Field is required.`),e;if(i!=="ordinal"&&e.length>2)return(r=this._option)===null||r===void 0||r.onError(`${a} length is invalid, specify up to 2 ${a}s.`),e;const d=`${Ke}_series_scatter_${this.id}_scale_${a}`;return this._option.globalScale.registerModelScale({id:d,type:i,domain:[{dataId:this._rawData.name,fields:[t]}],range:e}),{scale:d,field:t}}if(ii(e)){if(C(t))return(l=this._option)===null||l===void 0||l.onError(`${a}Field is required.`),e;const d=`${Ke}_series_scatter_${this.id}_scale_${a}`,c=Object.assign({id:d,type:i,domain:[{dataId:this._rawData.name,fields:[t]}],range:s},e);return this._option.globalScale.registerModelScale(c),{scale:c.id,field:t}}return(h=this._option)===null||h===void 0||h.onError(`${a} attribute is invalid.`),e}getSizeAttribute(t,e){return C(e)?ja:vt(e)?e:X(e)&&Il(e)?parseFloat(e):this._getSeriesAttribute(t,e,{defaultScaleType:Fd,defaultRange:wd},"size")}getShapeAttribute(t,e){return C(e)?Ya:X(e)?e:this._getSeriesAttribute(t,e,{defaultScaleType:zd,defaultRange:Hd},"shape")}initMark(){var t,e;const i={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold};this._symbolMark=this._createMark(Kt.mark.point,{morph:Hi(this._spec,Kt.mark.point.name),defaultMorphElementKey:this.getDimensionField()[0],groupKey:this._seriesField,progressive:i,isSeriesMark:!0,customShape:(t=this._spec.point)===null||t===void 0?void 0:t.customShape,stateSort:(e=this._spec.point)===null||e===void 0?void 0:e.stateSort})}initMarkStyle(){this.initSymbolMarkStyle()}initAnimation(){var t,e,i;const s=Yi(this),a=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._symbolMark.setAnimationConfig(Pt((i=V.getAnimationInKey("scatter"))===null||i===void 0?void 0:i({},a),Wt("point",this._spec,this._markAttributeContext),s))}initSymbolMarkStyle(){const t=this._symbolMark;t&&(this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)}),this.setMarkStyle(t,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null,fill:this.getColorAttribute(),size:vt(this._size)||E(this._size)?this._size:ja,symbolType:X(this._shape)||E(this._shape)?this._shape:Ya},ee.STATE_NORMAL,I.Series),(S(this._sizeField)||S(this._size))&&this.setMarkStyle(t,{size:this.getSizeAttribute(this._sizeField,this._size)},ee.STATE_NORMAL,I.User_Mark),(S(this._shapeField)||S(this._shape))&&this.setMarkStyle(t,{symbolType:this.getShapeAttribute(this._shapeField,this._shape)},ee.STATE_NORMAL,I.User_Mark))}initTooltip(){super.initTooltip(),this._symbolMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._symbolMark)}viewDataStatisticsUpdate(t){super.viewDataStatisticsUpdate(t);const e=[this.getDimensionField()[0],this.getStackValueField()].every(i=>{var s,a,n;return i&&((n=(a=(s=this.getViewDataStatistics())===null||s===void 0?void 0:s.latestData)===null||a===void 0?void 0:a[i])===null||n===void 0?void 0:n.allValid)});this._invalidType==="zero"||e?this.setMarkStyle(this._symbolMark,{visible:!0},"normal",I.Series):this.setMarkStyle(this._symbolMark,{visible:this._getInvalidDefined.bind(this)},"normal",I.Series),this._symbolMark.getProduct()&&this._symbolMark.compileEncode()}initLabelMarkStyle(t){t&&(this._labelMark=t,this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null},ee.STATE_NORMAL,I.Series),this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)},ee.STATE_NORMAL,I.Series))}handleZoom(t){var e,i;this.getMarksWithoutRoot().forEach(a=>{const n=a.getProduct();!n||!n.elements||!n.elements.length||n.elements.forEach((r,l)=>{const h=r.getGraphicItem(),d=r.getDatum(),c=this.dataToPosition(d);c&&h&&h.translateTo(c.x,c.y)})});const s=(i=(e=this._labelMark)===null||e===void 0?void 0:e.getComponent())===null||i===void 0?void 0:i.getProduct();s&&s.evaluate(null,null)}handlePan(t){var e,i;this.getMarksWithoutRoot().forEach(a=>{const n=a.getProduct();!n||!n.elements||!n.elements.length||n.elements.forEach((r,l)=>{const h=r.getGraphicItem(),d=r.getDatum(),c=this.dataToPosition(d);c&&h&&h.translateTo(c.x,c.y)})});const s=(i=(e=this._labelMark)===null||e===void 0?void 0:e.getComponent())===null||i===void 0?void 0:i.getProduct();s&&s.evaluate(null,null)}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._symbolMark]}}Kt.type=yt.scatter,Kt.mark=Yd,Kt.transformerConstructor=Lr;const Xd=()=>{fs(),jd(),Re(),Ie(),V.registerSeries(Kt.type,Kt)},xe={debounce:ms,throttle:zi};class Gd{constructor(){this._isGestureListener=!1}initZoomable(t,e=bi["desktop-browser"]){this._eventObj=t,this._renderMode=e,this._gestureController=this._option.getChart().getVGrammarView().renderer._gestureController,this._isGestureListener=Dn(this._renderMode)||On(this._renderMode),jt(this._renderMode)&&(this._clickEnable=!0,this._zoomableTrigger=new(this._getZoomTriggerEvent("trigger")))}_getZoomTriggerEvent(t){return jt(this._renderMode)[t]}_zoomEventDispatch(t,e,i){if(!this._isGestureListener&&!t.event)return;const s=this._isGestureListener?t:t.event.clone();this._zoomableTrigger.parserZoomEvent(s);const{zoomDelta:a,zoomX:n,zoomY:r}=s;if(C(a)||!ts({x:n,y:r},this._getRegionOrSeriesLayout(e)))return;let l={};i&&(l=i({zoomDelta:a,zoomX:n,zoomY:r},s)),this._eventObj.emit("zoom",Object.assign(Object.assign({scale:s.zoomDelta,scaleCenter:{x:s.zoomX,y:s.zoomY}},l),{model:this}))}_getRegionOrSeriesLayout(t){t.type!=="region"&&(t=t.getRegion());const{x:e,y:i,width:s,height:a}=t.layout.getLayout();return{x1:e,y1:i,x2:e+s,y2:i+a}}_bindZoomEventAsRegion(t,e,i,s){var a,n;const r=(a=s==null?void 0:s.delayType)!==null&&a!==void 0?a:"throttle",l=(n=s==null?void 0:s.delayTime)!==null&&n!==void 0?n:0,h=this._isGestureListener?this._gestureController:t,d=this._isGestureListener?[this._getZoomTriggerEvent("zoom")]:[this._getZoomTriggerEvent("zoom"),{level:_t.chart,consume:!0}],c=this._isGestureListener?[this._getZoomTriggerEvent("zoomEnd")]:[this._getZoomTriggerEvent("zoomEnd"),{level:_t.chart,consume:!1}];h.on(...c,xe[r](u=>{this._zoomableTrigger.clearZoom()},l)),h.on(...d,xe[r](u=>{this._zoomEventDispatch(u,e,i)},l))}initZoomEventOfSeries(t,e,i){this._option.disableTriggerEvent||jt(this._renderMode)&&this._bindZoomEventAsRegion(t.event,t,e,i)}initZoomEventOfRegions(t,e,i,s){this._option.disableTriggerEvent||jt(this._renderMode)&&t.forEach(a=>{e?a.getSeries().forEach(n=>{e(n)&&this._bindZoomEventAsRegion(n.event,n,i,s)}):this._bindZoomEventAsRegion(this._eventObj,a,i,s)})}_scrollEventDispatch(t,e,i){let s=!1;if(!this._isGestureListener&&(!t.event||this._option.disableTriggerEvent))return s;const a=this._isGestureListener?t:t.event;this._zoomableTrigger.parserScrollEvent(a);const{scrollX:n,scrollY:r,canvasX:l,canvasY:h}=a;return C(n)&&C(r)||ts({x:l,y:h},this._getRegionOrSeriesLayout(e))&&(i&&(s=i({scrollX:n,scrollY:r},a)),this._eventObj.emit("scroll",{scrollX:n,scrollY:r,model:this})),s}_bindScrollEventAsRegion(t,e,i,s){var a,n;const r=(a=s==null?void 0:s.delayType)!==null&&a!==void 0?a:"throttle",l=(n=s==null?void 0:s.delayTime)!==null&&n!==void 0?n:0,h=this._isGestureListener?this._gestureController:t,d=this._isGestureListener?[this._getZoomTriggerEvent("scroll")]:[this._getZoomTriggerEvent("scroll"),{level:_t.chart,consume:!0}],c=this._isGestureListener?[this._getZoomTriggerEvent("scrollEnd")]:[this._getZoomTriggerEvent("scrollEnd"),{level:_t.chart,consume:!1}];h.on(...c,xe[r](u=>{this._zoomableTrigger.clearScroll()},l)),h.on(...d,xe[r](u=>this._scrollEventDispatch(u,e,i),l))}initScrollEventOfSeries(t,e,i){jt(this._renderMode)&&this._bindScrollEventAsRegion(t.event,t,e,i)}initScrollEventOfRegions(t,e,i,s){this._option.disableTriggerEvent||jt(this._renderMode)&&t.forEach(a=>{e?a.getSeries().forEach(n=>{e(n)&&this._bindScrollEventAsRegion(n.event,n,i,s)}):this._bindScrollEventAsRegion(this._eventObj,a,i,s)})}_bindDragEventAsRegion(t,e,i,s){t.on(this._getZoomTriggerEvent("start"),{level:_t.chart},a=>{if(!a.event)return;const{event:n}=a;ts({x:n.canvasX,y:n.canvasY},this._getRegionOrSeriesLayout(e))&&this._handleDrag(a,i,s)}),t.on("click",{level:_t.chart},()=>!this._clickEnable)}initDragEventOfSeries(t,e,i){this._option.disableTriggerEvent||jt(this._renderMode)&&t.event.on(this._getZoomTriggerEvent("start"),{level:_t.model,filter:({model:s})=>(s==null?void 0:s.id)===t.id},s=>{this._handleDrag(s,e,i)})}initDragEventOfRegions(t,e,i,s){this._option.disableTriggerEvent||jt(this._renderMode)&&t.forEach(a=>{e?a.getSeries().forEach(n=>{e(n)&&(n.event.on(this._getZoomTriggerEvent("start"),{level:_t.model,filter:({model:r})=>(r==null?void 0:r.id)===n.id},r=>{this._handleDrag(r,i)}),n.event.on("click",{level:_t.model,filter:({model:r})=>(r==null?void 0:r.id)===n.id},()=>!this._clickEnable))}):this._bindDragEventAsRegion(this._eventObj,a,i,s)})}_handleDrag(t,e,i){var s,a,n;if(this._option.disableTriggerEvent||(this._clickEnable=!1,!this._zoomableTrigger.parserDragEvent(t.event)))return;const r=(s=i==null?void 0:i.delayType)!==null&&s!==void 0?s:"throttle",l=(a=i==null?void 0:i.delayTime)!==null&&a!==void 0?a:0,h=(n=i==null?void 0:i.realTime)===null||n===void 0||n,d=this._getZoomTriggerEvent("move"),c=this._getZoomTriggerEvent("end"),u=t.event;let g=u.canvasX,p=u.canvasY,_=u.canvasX,m=u.canvasY;const v=xe[r](y=>{this._clickEnable=!0;const f=y.event,x=[f.canvasX-_,f.canvasY-m];_=f.canvasX,m=f.canvasY,!h&&e&&e(x,y.event),this._eventObj.emit("panend",{delta:x,model:this}),this._zoomableTrigger.pointerId=null,this._eventObj.off(d,{level:_t.chart,source:Xt.chart},b),this._eventObj.off(c,{level:_t.chart,source:Xt.window},v),this._eventObj.allow(c)},l),b=xe[r](y=>{if(!this._zoomableTrigger.parserDragEvent(y.event))return;this._clickEnable=!1,this._eventObj.prevent(c,v);const f=y.event,x=[f.canvasX-g,f.canvasY-p];g=f.canvasX,p=f.canvasY,h&&e&&e(x,y.event),this._eventObj.emit("panmove",{delta:x,model:this})},l);this._eventObj.on(d,{level:_t.chart,source:Xt.chart},b),this._eventObj.on(c,{level:_t.chart,source:Xt.chart},v)}}const Xa={rect:Ga,symbol:Pr,arc:Ua,point:$d,"line-data":Zd,stackLabel:Qd,line:Za,area:Za,rect3d:Ga,arc3d:Ua,treemap:Jd,venn:tc};function Ud(o,t){var e;const{labelSpec:i}=t;i.overlap&&!ii(i.overlap)&&(i.overlap={});const s=(e=Xa[o])!==null&&e!==void 0?e:Xa.point;return t.series.type===yt.sankey?ec(t):s(t)}function Ds(o,t,e,i){var s;const{labelMark:a,series:n}=o,r={text:t[n.getMeasureField()[0]],data:t,textType:(s=o.labelSpec.textType)!==null&&s!==void 0?s:"text"},l=Object.keys(a.stateStyle.normal);for(const h of l){const d=a.getAttribute(h,t);r[h]=d}if(n.type!==yt.sankey){const{formatFunc:h,args:d}=ys(e,i,r.text,t);h&&(r.text=h(...d,{series:n}))}return r}function Qi(o){return E(o)?t=>o(t.data):o}function Pr(o){var t,e,i;const{series:s,labelSpec:a}=o,n=s.direction==="horizontal"?"right":"top",r=(t=Qi(a.position))!==null&&t!==void 0?t:n;let l;return l=a.overlap!==!1&&{strategy:(i=(e=a.overlap)===null||e===void 0?void 0:e.strategy)!==null&&i!==void 0?i:Nd(),avoidBaseMark:r!=="center"},{position:r,overlap:l}}function Zd(o){const t=Pr(o);return si(t.overlap)||(t.overlap.avoidBaseMark=!1),t}function Nd(){return[{type:"position",position:["top","bottom","right","left","top-right","top-left","bottom-left","bottom-right"]}]}function Ga(o){var t,e,i,s,a,n;const{series:r,labelSpec:l={}}=o,h=(t=Qi(l.position))!==null&&t!==void 0?t:"outside",d=(e=r.direction)!==null&&e!==void 0?e:"vertical",c=r.direction==="horizontal"?(i=r.getXAxisHelper())===null||i===void 0?void 0:i.isInverse():(s=r.getYAxisHelper())===null||s===void 0?void 0:s.isInverse();let u,g=h;X(h)&&h==="outside"&&(g=_=>{const{data:m}=_,v=r.getMeasureField()[0],b=(m==null?void 0:m[v])>=0&&c||(m==null?void 0:m[v])<0&&!c?1:0;return{vertical:["top","bottom"],horizontal:["right","left"]}[d][b]}),u=l.overlap!==!1&&{strategy:(n=(a=l.overlap)===null||a===void 0?void 0:a.strategy)!==null&&n!==void 0?n:Wd(r)};let p=!1;return X(h)&&h.includes("inside")&&(p=!0),{position:g,overlap:u,smartInvert:p}}function Wd(o){return[{type:"position",position:t=>{var e,i;const{data:s}=t,a=o.getMeasureField()[0];return(o.direction==="horizontal"?!((e=o.getXAxisHelper())===null||e===void 0)&&e.isInverse():!((i=o.getYAxisHelper())===null||i===void 0)&&i.isInverse())?(s==null?void 0:s[a])>=0?o.direction==="horizontal"?["left","inside-left"]:["bottom","inside-bottom"]:o.direction==="horizontal"?["right","inside-right"]:["top","inside-top"]:(s==null?void 0:s[a])>=0?o.direction==="horizontal"?["right","inside-right"]:["top","inside-top"]:o.direction==="horizontal"?["left","inside-left"]:["bottom","inside-bottom"]}}]}function $d(o){const{labelSpec:t}=o;let e;return e=t.overlap!==!1&&{avoidBaseMark:!1},{position:"center",overlap:e}}function Ua(o){var t;const{labelSpec:e}=o,i=(t=Qi(e.position))!==null&&t!==void 0?t:"outside",s=i;let a;return a=e.smartInvert?e.smartInvert:X(i)&&i.includes("inside"),{position:s,smartInvert:a}}function Kd(o,t,e,i){return t.direction==="horizontal"?e==="middle"?.5*(t.totalPositionX(o,"end")+t.totalPositionY(o,"start")):e==="max"?t.totalPositionX(o,o.end>=o.start?"end":"start")+i:e==="min"?t.totalPositionX(o,o.end>=o.start?"start":"end")-i:t.totalPositionX(o,"end")+(o.end>=o.start?i:-i):t.totalPositionX(o,"index",.5)}function qd(o,t,e,i){return t.direction==="horizontal"?t.totalPositionY(o,"index",.5):e==="middle"?.5*(t.totalPositionY(o,"end")+t.totalPositionY(o,"start")):e==="max"?t.totalPositionY(o,o.end>=o.start?"end":"start")-i:e==="min"?t.totalPositionY(o,o.end>=o.start?"start":"end")+i:t.totalPositionY(o,"end")+(o.end>=o.start?-i:i)}function Qd(o,t,e){const i=o.series,s=o.labelSpec||{},a=i.getTotalData();return{customLayoutFunc:n=>n.map(r=>{const l=s.position||"withChange",h=s.offset||0,d=t?t(r.data):r.data,c=Ds(o,d,s.formatMethod);return c.x=Kd(d,i,l,h),c.y=qd(d,i,l,h),i.direction==="horizontal"?c.textAlign=l==="middle"?"center":l==="withChange"&&d.end-d.start>=0||l==="max"?"left":"right":c.textBaseline=l==="middle"?l:l==="withChange"&&d.end-d.start>=0||l==="max"?"bottom":"top",e==null||e(r,d,c),bn(Object.assign(Object.assign({},c),{id:r.id}))}),dataFilter:n=>{const r=[];return a.forEach(l=>{const h=n.find(d=>{var c;return l.index===((c=d.data)===null||c===void 0?void 0:c[i.getDimensionField()[0]])});h&&(h.data=l,r.push(h))}),r},overlap:{strategy:[]}}}function Jd(o){return{customLayoutFunc:(t,e)=>e,overlap:!1}}function tc(o){return{customLayoutFunc:(t,e)=>e,smartInvert:!0}}function Za(o){var t,e,i,s;const{labelSpec:a,series:n}=o,r=(i=(e=(t=n.getViewDataStatistics)===null||t===void 0?void 0:t.call(n).latestData)===null||e===void 0?void 0:e[n.getSeriesField()])===null||i===void 0?void 0:i.values,l=r?r.map((h,d)=>({[n.getSeriesField()]:h,index:d})):[];return{position:(s=a.position)!==null&&s!==void 0?s:"end",data:l}}function ec(o){var t,e,i;const{series:s,labelSpec:a={}}=o,n=(t=Qi(a.position))!==null&&t!==void 0?t:"outside",r=s.direction;let l,h=n;return X(n)&&(r==="vertical"?h=n==="inside-start"?d=>"inside-left":n==="inside-middle"?d=>"center":n==="inside-end"?d=>"inside-right":d=>"bottom":n==="inside-start"?h=d=>"inside-left":n==="inside-middle"?h=d=>"center":n==="inside-end"?h=d=>"inside-right":n==="outside"&&(h=d=>"right")),l=a.overlap!==!1&&(!X(n)||!n.includes("inside"))&&{strategy:(i=(e=a.overlap)===null||e===void 0?void 0:e.strategy)!==null&&i!==void 0?i:ic(s)},{position:h,overlap:l,smartInvert:!1,offset:0,syncState:!0}}function ic(o){return[{type:"position",position:t=>o.direction==="horizontal"?["right","left"]:["bottom","top"]}]}class sc extends Ho{constructor(){super(...arguments),this.coordinate="polar",this._outerRadius=Vo,this._innerRadius=0,this._angleField=[],this._radiusField=[],this._sortDataByAxis=!1}get outerRadius(){return this._outerRadius}get innerRadius(){return this._innerRadius}getAngleField(){return this._angleField}setAngleField(t){return this._angleField=S(t)?L(t):[],this._angleField}getRadiusField(){return this._radiusField}setRadiusField(t){return this._radiusField=S(t)?L(t):[],this._radiusField}get innerRadiusField(){return this._innerRadiusField}setInnerRadiusField(t){return this._innerRadiusField=L(t),this._innerRadiusField}get radiusScale(){return this._radiusScale}setRadiusScale(t){return this._radiusScale=t,t}get angleScale(){return this._angleScale}setAngleScale(t){return this._angleScale=t,t}get angleAxisHelper(){return this._angleAxisHelper}set angleAxisHelper(t){this._angleAxisHelper=t,this.onAngleAxisHelperUpdate()}get radiusAxisHelper(){return this._radiusAxisHelper}set radiusAxisHelper(t){this._radiusAxisHelper=t,this.onRadiusAxisHelperUpdate()}get sortDataByAxis(){return this._sortDataByAxis}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this),this._markAttributeContext.getCenter=()=>this.angleAxisHelper.center(),this._markAttributeContext.getLayoutRadius=()=>this._computeLayoutRadius()}valueToPosition(t,e){if(C(t)||C(e)||!this.angleAxisHelper||!this.radiusAxisHelper)return{x:Number.NaN,y:Number.NaN};const i=this.angleAxisHelper.dataToPosition(L(t)),s=this.radiusAxisHelper.dataToPosition(L(e));return this.angleAxisHelper.coordToPoint({angle:i,radius:s})}dataToPosition(t,e){return t&&this.angleAxisHelper&&this.radiusAxisHelper?e&&!this.isDatumInViewData(t)?null:this.valueToPosition(this.getDatumPositionValues(t,this._angleField),this.getDatumPositionValues(t,this._radiusField)):null}dataToPositionX(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.x}dataToPositionY(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.y}dataToPositionZ(t){return 0}positionToData(t){}radiusToData(t){}angleToData(t){}getStatisticFields(){var t,e;const i=[];return!((t=this.radiusAxisHelper)===null||t===void 0)&&t.getScale&&this._radiusField.forEach(s=>{const a={key:s,operations:[]};et(this.radiusAxisHelper.getScale(0).type)?a.operations=["max","min"]:a.operations=["values"],i.push(a)}),!((e=this.angleAxisHelper)===null||e===void 0)&&e.getScale&&this._angleField.forEach(s=>{const a={key:s,operations:[]};et(this.angleAxisHelper.getScale(0).type)?a.operations=["max","min"]:a.operations=["values"],i.push(a)}),i}setAttrFromSpec(){super.setAttrFromSpec(),S(this._spec.outerRadius)&&(this._outerRadius=this._spec.outerRadius),S(this._spec.radius)&&(this._outerRadius=this._spec.radius),S(this._spec.innerRadius)&&(this._innerRadius=this._spec.innerRadius),S(this._spec.sortDataByAxis)&&(this._sortDataByAxis=this._spec.sortDataByAxis===!0)}onRadiusAxisHelperUpdate(){this.onMarkPositionUpdate()}onAngleAxisHelperUpdate(){this.onMarkPositionUpdate()}afterInitMark(){super.afterInitMark()}_computeLayoutRadius(){const t=this._angleAxisHelper||this._radiusAxisHelper;if(t)return t.layoutRadius();const{width:e,height:i}=this._region.getLayoutRect();return Math.min(e/2,i/2)}initEvent(){super.initEvent(),this.sortDataByAxis&&this.event.on(z.scaleDomainUpdate,{filter:t=>{var e;return t.model.id===((e=this._angleAxisHelper)===null||e===void 0?void 0:e.getAxisId())}},()=>{this._sortDataInAxisDomain()})}_sortDataInAxisDomain(){var t,e;!((e=(t=this.getViewData())===null||t===void 0?void 0:t.latestData)===null||e===void 0)&&e.length&&jo(this.angleAxisHelper,this._angleField[0],this.getViewData().latestData)}getInvalidCheckFields(){const t=[];return this.angleAxisHelper.isContinuous&&this._angleField.forEach(e=>{t.push(e)}),this.radiusAxisHelper.isContinuous&&this._radiusField.forEach(e=>{t.push(e)}),t}}function Na(o){return Xo(o)?Number.parseFloat(o):0}const ac=(o,t)=>{const e=o.map(T=>Object.assign({},T));if(!e||e.length===0)return e;const{asStartAngle:i,asEndAngle:s,asMiddleAngle:a,asRadian:n,asRatio:r,asQuadrant:l,asK:h,showAllZero:d,supportNegative:c}=t,u=t.angleField(),g=t.startAngle(),p=t.endAngle(),_=t.minAngle(),m=(T,B,H)=>{T[i]=B,T[s]=B+H,T[a]=B+H/2,T[n]=H,T[l]=Go(B+H/2)};let v=0,b=-1/0,y=!0;for(let T=0;T<e.length;T++){const B=c?Math.abs(Na(e[T][u])):Na(e[T][u]);v+=B,b=Math.max(B,b),y&&B!==0&&(y=!1),e[T][es]=B}const f=e.map(T=>Number(T[u])),x=p-g;let M=g,k=x,D=0;const O=Yo(f);if(e.forEach((T,B)=>{const H=T[es],G=v?H/v:0;let Q=G*x;Q<_?(Q=_,k-=_):D+=H;const Z=M,N=M+Q;T[r]=G,T[h]=b?H/b:0,T._percent_=O[B],m(T,Z,Q),M=N}),k<x)if(k<=.001){const T=x/e.length;e.forEach((B,H)=>{m(B,g+H*T,T)})}else{const T=k/D;M=g,e.forEach(B=>{const H=B[n]===_?_:B[es]*T;m(B,M,H),M+=H})}if(v!==0&&(e[e.length-1][s]=p),y&&d){const T=x/e.length;e.forEach((B,H)=>{m(B,g+H*T,T)})}return e};function Ji(o,t,e){return(i,s,a)=>t?o.growField==="radius"?{overall:0}:{overall:o.growFrom(i,s,e)}:{overall:!1}}const Wa=o=>({type:o.growField==="radius"?"growRadiusIn":"growAngleIn",options:Ji(o,!0,Gt.appear)}),nc={type:"fadeIn"},rc=o=>({type:o.growField==="radius"?"growRadiusIn":"growAngleIn",easing:"linear",options:Ji(o,!0,Gt.enter)}),oc=o=>({type:o.growField==="radius"?"growRadiusOut":"growAngleOut",easing:"linear",options:Ji(o,!0,Gt.exit)}),lc=o=>({type:o.growField==="radius"?"growRadiusOut":"growAngleOut",options:Ji(o,!0,Gt.exit)});function Br(o,t){if(t===!1)return{};switch(t){case"fadeIn":return nc;case"growRadius":return Wa(Object.assign(Object.assign({},o),{growField:"radius"}));default:return Wa(Object.assign(Object.assign({},o),{growField:"angle"}))}}const hc=()=>{V.registerAnimation("pie",(o,t)=>({appear:Br(o,t),enter:rc(o),exit:oc(o),disappear:lc(o)}))},dc=()=>{V.registerAnimation("emptyCircle",(o,t)=>({appear:Br(o,t)}))};function cc(o,t){var e,i,s,a;const n=(i=(e=t.options)===null||e===void 0?void 0:e.distance)!==null&&i!==void 0?i:10,r=w(t.duration)?t.duration/2:1e3,l=(s=t.options.easing)!==null&&s!==void 0?s:"cubicOut";return{oneByOne:t.oneByOne,loop:(a=t.loop)!==null&&a!==void 0&&a,timeSlices:[{duration:r,effects:{easing:l,channel:{x:{from:h=>o.getAttribute("x",h),to:h=>o.getAttribute("x",h)+se({x:0,y:0},n,h[re]).x},y:{from:h=>o.getAttribute("y",h),to:h=>o.getAttribute("y",h)+se({x:0,y:0},n,h[re]).y}}}},{duration:r,effects:{easing:l,channel:{x:{to:h=>o.getAttribute("x",h),from:h=>o.getAttribute("x",h)+se({x:0,y:0},n,h[re]).x},y:{to:h=>o.getAttribute("y",h),from:h=>o.getAttribute("y",h)+se({x:0,y:0},n,h[re]).y}}}}]}}const uc=Object.assign(Object.assign({},pe),{pie:{name:"pie",type:"arc"},labelLine:{name:"labelLine",type:"path"}});Object.assign(Object.assign({},pe),{pie3d:{name:"pie3d",type:"arc3d"},labelLine:{name:"labelLine",type:"path"}});class Dr extends Vi{_transformLabelSpec(t){this._addMarkLabelSpec(t,"pie")}_mergeThemeToSpec(t,e){const i=this._theme;let s=t;if(this._shouldMergeThemeToSpec()){const a=this._getDefaultSpecFromChart(e);s=q({},this._theme,a,t);const n=(r,l)=>q({},r==="inside"?this._theme.innerLabel:this._theme.outerLabel,l);U(s.label)?s.label=s.label.map(r=>n(r.position,r)):s.label=n(s.label.position,s.label)}return{spec:s,theme:i}}_getDefaultSpecFromChart(t){var e;const i=(e=super._getDefaultSpecFromChart(t))!==null&&e!==void 0?e:{},{centerX:s,centerY:a}=t;return S(s)&&(i.centerX=s),S(a)&&(i.centerY=a),Object.keys(i).length>0?i:void 0}}const gc=`${Ke}_LABEL_VISIBLE`,pc=(o,t,e,i=0,s=0*Math.PI)=>{if(vt(o))return o;if(E(o))return o(t(),e());const a=t();return o==="auto"&&a.width>0&&a.height>0?Uo(a,e(),i,s):Math.min(a.width/2,a.height/2)};class ei extends sc{constructor(){super(...arguments),this.transformerConstructor=Dr,this._pieMarkName="pie",this._pieMarkType="arc",this.getCenter=()=>{var t,e,i,s;const{width:a,height:n}=this._region.getLayoutRect();return{x:(e=(t=this._spec)===null||t===void 0?void 0:t.centerX)!==null&&e!==void 0?e:a/2,y:(s=(i=this._spec)===null||i===void 0?void 0:i.centerY)!==null&&s!==void 0?s:n/2}},this._startAngle=No,this._endAngle=Wo,this._pieMark=null,this._labelMark=null,this._labelLineMark=null,this._emptyArcMark=null,this.dataToCentralPosition=t=>{const e=t[re];if(C(e))return null;const i=this.computeDatumRadius(t),s=this.computeDatumInnerRadius(t),a=this.computeCenter(t);return se(a,(i+s)/2,e)}}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.getCenter=()=>({x:()=>this.getCenter().x,y:()=>this.getCenter().y}),this._markAttributeContext.startAngleScale=t=>this.startAngleScale(t),this._markAttributeContext.endAngleScale=t=>this.endAngleScale(t)}setAttrFromSpec(){var t,e,i,s,a,n;super.setAttrFromSpec(),this._centerOffset=(t=this._spec.centerOffset)!==null&&t!==void 0?t:0,this._cornerRadius=(e=this._spec.cornerRadius)!==null&&e!==void 0?e:0;const r=$o(S(this._spec.startAngle)?ae(this._spec.startAngle):this._startAngle,S(this._spec.endAngle)?ae(this._spec.endAngle):this._endAngle);this._startAngle=r.startAngle,this._endAngle=r.endAngle,this._padAngle=S(this._spec.padAngle)?ae(this._spec.padAngle):0,this.setAngleField(this._spec.valueField||this._spec.angleField),this._spec.categoryField&&this.setSeriesField(this._spec.categoryField),this._radiusField=[],this._specAngleField=this._angleField.slice(),this._specRadiusField=[],this._showEmptyCircle=(s=(i=this._spec.emptyPlaceholder)===null||i===void 0?void 0:i.showEmptyCircle)!==null&&s!==void 0&&s,this._showAllZero=(a=this._spec.showAllZero)!==null&&a!==void 0&&a,this._supportNegative=(n=this._spec.supportNegative)!==null&&n!==void 0&&n}initData(){super.initData();const t=this.getViewData();if(!t)return;st(this._dataSet,"pie",ac),t.transform({type:"pie",options:{angleField:()=>this._angleField[0],startAngle:()=>this._startAngle,endAngle:()=>this._endAngle,minAngle:()=>S(this._spec.minAngle)?ae(this._spec.minAngle):0,asStartAngle:ha,asEndAngle:da,asRatio:Ko,asMiddleAngle:re,asRadian:qo,asQuadrant:Qo,asK:Jo,showAllZero:this._showAllZero,supportNegative:this._supportNegative}},!1);const e=new St(this._dataSet,{name:`${Ke}_series_${this.id}_viewDataLabel`});e.parse([this.getViewData()],{type:"dataview"}),this._viewDataLabel=new Pn(this._option,e)}initMark(){var t,e;this._pieMark=this._createMark(Object.assign(Object.assign({},ei.mark.pie),{name:this._pieMarkName,type:this._pieMarkType}),{morph:Hi(this._spec,this._pieMarkName),defaultMorphElementKey:this._seriesField,key:Bn,groupKey:this._seriesField,skipBeforeLayouted:!0,isSeriesMark:!0,customShape:(t=this._spec.pie)===null||t===void 0?void 0:t.customShape,stateSort:(e=this._spec.pie)===null||e===void 0?void 0:e.stateSort}),this._emptyArcMark=this._createMark({name:"emptyCircle",type:"arc"},{dataView:!1})}startAngleScale(t){return ss(ha)(t)}endAngleScale(t){return ss(da)(t)}_computeLayoutRadius(){return pc(this._spec.layoutRadius,this.getLayoutRect,this.getCenter,this._startAngle,this._endAngle)}initMarkStyle(){const t={x:()=>this.getCenter().x,y:()=>this.getCenter().y,fill:this.getColorAttribute(),outerRadius:ca(this._outerRadius)?this._outerRadius:()=>this._computeLayoutRadius()*this._outerRadius,innerRadius:ca(this._innerRadius)?this._innerRadius:()=>this._computeLayoutRadius()*this._innerRadius,cornerRadius:()=>this._computeLayoutRadius()*this._cornerRadius,startAngle:s=>this.startAngleScale(s),endAngle:s=>this.endAngleScale(s),padAngle:this._padAngle,centerOffset:this._centerOffset},e=this._pieMark;e&&this.setMarkStyle(e,t,"normal",I.Series);const i=this._emptyArcMark;i&&this.setMarkStyle(i,Object.assign(Object.assign({},t),{visible:()=>this._showEmptyCircle&&this.getViewData().latestData.length===0}),"normal",I.Series)}initInteraction(){this._parseInteractionConfig(this._pieMark?[this._pieMark]:[])}initTooltip(){super.initTooltip(),this._pieMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._pieMark)}initMarkStyleWithSpec(t,e,i){if(super.initMarkStyleWithSpec(t,e,i),t.name===this._pieMarkName){const s=this.getSpec()[t.name];if(s)for(const a in s.state||{})this.setMarkStyle(t,this.generateRadiusStyle(s.state[a]),a,I.User_Mark)}t.name==="emptyCircle"&&this.setMarkStyle(t,this.generateRadiusStyle(e.style),"normal",I.User_Mark)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{visible:ss(gc).bind(this),text:e=>e[this.getDimensionField()[0]],fill:this.getColorAttribute(),z:this.dataToPositionZ.bind(this)})}afterInitMark(){super.afterInitMark()}initEvent(){var t;super.initEvent(),(t=this._viewDataLabel.getDataView())===null||t===void 0||t.target.addListener("change",this.viewDataLabelUpdate.bind(this))}initGroups(){}onLayoutEnd(t){this._viewDataLabel.getDataView().reRunAllTransform(),this.onMarkPositionUpdate(),super.onLayoutEnd(t)}getDimensionField(){return this._seriesField?[this._seriesField]:[]}getMeasureField(){return this._specAngleField}viewDataLabelUpdate(){this.event.emit(z.viewDataLabelUpdate,{model:this}),this._viewDataLabel.updateData()}generateRadiusStyle(t){if(!t)return;const e={};return t.outerRadius&&(e.outerRadius=()=>this._computeLayoutRadius()*t.outerRadius),t.innerRadius&&(e.innerRadius=()=>this._computeLayoutRadius()*t.innerRadius),t.cornerRadius&&(e.cornerRadius=()=>this._computeLayoutRadius()*t.cornerRadius),e}computeCenter(t){return{x:this._pieMark.getAttribute("x",t,"normal"),y:this._pieMark.getAttribute("y",t,"normal")}}getRadius(t="normal"){var e,i,s,a,n,r,l;const h=t==="normal"?(s=(i=this.getSpec()[((e=this._pieMark)===null||e===void 0?void 0:e.name)||"pie"])===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.outerRadius:(l=(r=(n=this.getSpec()[((a=this._pieMark)===null||a===void 0?void 0:a.name)||"pie"])===null||n===void 0?void 0:n.state)===null||r===void 0?void 0:r[t])===null||l===void 0?void 0:l.outerRadius;return h??this._outerRadius}getInnerRadius(t="normal"){var e,i,s,a,n,r,l;const h=t==="normal"?(s=(i=this.getSpec()[((e=this._pieMark)===null||e===void 0?void 0:e.name)||"pie"])===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.innerRadius:(l=(r=(n=this.getSpec()[((a=this._pieMark)===null||a===void 0?void 0:a.name)||"pie"])===null||n===void 0?void 0:n.state)===null||r===void 0?void 0:r[t])===null||l===void 0?void 0:l.innerRadius;return h??this._innerRadius}computeRadius(t,e){return this._computeLayoutRadius()*t*(C(e)?1:e)+this._centerOffset}computeDatumRadius(t,e){return this._computeLayoutRadius()*this.getRadius(e)+this._centerOffset}_compareSpec(t,e,i){i=i??{data:!0};const s=["centerX","centerY","centerOffset","radius","innerRadius","cornerRadius","startAngle","endAngle","padAngle"];s.forEach(n=>{i[n]=!0});const a=super._compareSpec(t,e,i);return t=t??{},s.some(n=>t[n]!==e[n])&&(a.reRender=!0,a.change=!0),a}computeDatumInnerRadius(t,e){return this._computeLayoutRadius()*this.getInnerRadius(e)+this._centerOffset}dataToPosition(t,e){const i=t[re];if(C(i)||e&&!this.isDatumInViewData(t))return null;const s=this.computeDatumRadius(t),a=this.computeCenter(t);return se(a,s,i)}initAnimation(){var t,e,i;const s={growFrom:(n,r,l)=>{var h;if(l===Gt.appear)return this._startAngle;if(l===Gt.disappear)return this._endAngle;const d=[Gt.disappear,Gt.exit],c=r.mark.elements,u=n,g=u==null?void 0:u[ci];if(c.find(_=>{var m;return((m=_.data[0])===null||m===void 0?void 0:m[ci])<g})===void 0)return this._startAngle;if(c.find(_=>{var m;return((m=_.data[0])===null||m===void 0?void 0:m[ci])>g})===void 0)return this._endAngle;const p=[...c].reverse().find(_=>{var m;return((m=_.data[0])===null||m===void 0?void 0:m[ci])<g});return d.includes(l)?(h=p==null?void 0:p.getNextGraphicAttributes())===null||h===void 0?void 0:h.endAngle:p==null?void 0:p.getGraphicAttribute("endAngle",!0)}},a=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;if(this._pieMark){const n=Pt((e=V.getAnimationInKey("pie"))===null||e===void 0?void 0:e(s,a),Wt("pie",this._spec,this._markAttributeContext));n.normal&&n.normal.type&&(n.normal=cc(this._pieMark,n.normal)),this._pieMark.setAnimationConfig(n)}if(this._emptyArcMark){const n=Pt((i=V.getAnimationInKey("emptyCircle"))===null||i===void 0?void 0:i(s,a??"fadeIn"));this._emptyArcMark.setAnimationConfig(n)}}getDefaultShapeType(){return"circle"}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}_noAnimationDataKey(t,e){return e}getActiveMarks(){return[this._pieMark]}}ei.transformerConstructor=Dr,ei.mark=uc;class ds extends ei{constructor(){super(...arguments),this.type=yt.pie}}ds.type=yt.pie;const _c=()=>{Zo(),hc(),dc(),V.registerSeries(ds.type,ds)};class Or extends Mn{_getDefaultSeriesSpec(t){const e=super._getDefaultSeriesSpec(t);return delete e.data,e}_transformAxisSpec(t){t.axes&&t.autoBandSize&&t.series.forEach((e,i)=>{var s;if(e.type==="bar"){const a=this._findBandAxisBySeries(e,i,t.axes);if(a&&!a.bandSize&&!a.maxBandSize&&!a.minBandSize){const n=ii(e.autoBandSize)&&(s=e.autoBandSize.extend)!==null&&s!==void 0?s:0,{barMaxWidth:r,barMinWidth:l,barWidth:h,barGapInGroup:d}=e;this._applyAxisBandSize(a,n,{barMaxWidth:r,barMinWidth:l,barWidth:h,barGapInGroup:d})}}})}transformSpec(t){if(super.transformSpec(t),t.series&&t.series.length){const e=this._getDefaultSeriesSpec(t);t.series.forEach(i=>{this._isValidSeries(i.type)&&Object.keys(e).forEach(s=>{s in i||(i[s]=e[s])})})}t.axes&&t.axes.length&&t.axes.forEach(e=>{$(e,"trimPadding")&&q(e,Tn(this.type,t))}),this._transformAxisSpec(t)}}let Ue=class extends Ln{constructor(){super(...arguments),this.transformerConstructor=Or,this.type="common"}};Ue.type="common",Ue.transformerConstructor=Or,kt(Ue,Sr);const mc=()=>{V.registerChart(Ue.type,Ue)},$a=12;function vc(o){return o===bi["desktop-browser"]||o===bi["desktop-miniApp"]?{click:"pointertap",hover:"pointermove",hoverOut:"pointerleave",clickOut:"pointerleave"}:Dn(o)||On(o)?{click:"tap",hover:["pointerdown","pointermove"],hoverOut:"pointerleave",clickOut:"pointerleave"}:null}var Ka;(function(o){o[o.ALL=3]="ALL",o[o.HORIZONTAL=2]="HORIZONTAL",o[o.VERTICAL=1]="VERTICAL"})(Ka||(Ka={}));var qa=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};const yc={x:["top","bottom"],y:["left","right"],category:["angle"],value:["radius"]};class Er extends Ee{get enableRemain(){return this.triggerOff==="none"}constructor(t,e){super(t,e),this.specKey="crosshair",this.layoutType="none",this.gridZIndex=ft.CrossHair_Grid,this.labelZIndex=ft.CrossHair,this.trigger="hover",this._handleIn=i=>{if(!this._option)return;const{x:s,y:a}=this.calculateTriggerPoint(i);this.showDefault=!1,this._layoutCrosshair(s,a);const n=this._getNeedClearVRenderComponents();this._hasActive=n.some(r=>r&&r.attribute.visible!==!1)},this._handleClickInEvent=i=>{if(!this._hasActive||!this._spec.lockAfterClick||this._clickLock)return this._clickLock?(this._clickLock=!1,void this._handleOutEvent()):void(this._onlyLockClick||(this._handleIn(i),vt(this.triggerOff)&&(this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{this._handleOutEvent()},this.triggerOff))));this._clickLock=!0},this._handleHoverInEvent=zi(i=>{this._clickLock||this._handleIn(i)},10),this._handleOutEvent=()=>{this.enableRemain||this._clickLock||!this._hasActive||(this.clearOutEvent(),this.hide())},this._handleTooltipShow=i=>{const s=i.tooltipData;if(i.isEmptyTooltip||!s||!s.length)return void this._handleTooltipHideOrRelease();if(ii(this._spec.followTooltip)&&this._spec.followTooltip[i.activeType]===!1)return void this._handleTooltipHideOrRelease();const{x:a,y:n}=this.calculateTriggerPoint(i);this.showDefault=!1,this._layoutCrosshair(a,n,s,i.activeType);const r=this._getNeedClearVRenderComponents();this._hasActive=r.some(l=>l&&l.attribute.visible!==!1)},this._handleTooltipHideOrRelease=()=>{this.clearOutEvent(),this.hide()},this.enable=!0,this.showDefault=!0}_getLimitBounds(){var t,e;if(!this._limitBounds){const{width:i,height:s}=(e=(t=this._option.globalInstance.getChart())===null||t===void 0?void 0:t.getViewRect())!==null&&e!==void 0?e:{width:0,height:0};this._limitBounds={x1:0,y1:0,x2:i,y2:s}}return this._limitBounds}_showDefaultCrosshair(){this.showDefault&&this._showDefaultCrosshairBySpec()}setAttrFromSpec(){super.setAttrFromSpec(),this._parseCrosshairSpec()}created(){super.created(),this._initEvent()}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake||ge(e,t)||(i.reRender=!0,i.reMake=!0),i}_initEvent(){if(!this._option.disableTriggerEvent)if(this._spec.followTooltip)this._registerTooltipEvent();else{const t=this._getTriggerEvent();t&&t.forEach(e=>{this._registerEvent(e.in,!1,e.click),e.out&&this._registerEvent(e.out,!0)})}}_registerEvent(t,e,i){const s=e?this._handleOutEvent:i?this._handleClickInEvent:this._handleHoverInEvent,a=e?{level:_t.chart}:{source:Xt.chart};U(t)?t.forEach(n=>{this.event.on(n,a,s)}):this.event.on(t,a,s)}_eventOff(t,e,i){const s=e?this._handleOutEvent:i?this._handleClickInEvent:this._handleHoverInEvent;U(t)?t.forEach(a=>{this.event.off(a,s)}):this.event.off(t,s)}updateLayoutAttribute(){this._limitBounds=null,this._showDefaultCrosshair()}calculateTriggerPoint(t){const{event:e}=t,i=this._option.getCompiler().getStage().getLayer(void 0),s={x:e.viewX,y:e.viewY};return i.globalTransMatrix.transformPoint({x:e.viewX,y:e.viewY},s),{x:s.x-this.getLayoutStartPoint().x,y:s.y-this.getLayoutStartPoint().y}}_getTriggerEvent(){const{mode:t=bi["desktop-browser"]}=this._option,e=vc(t);if(e){const i=L(this.trigger||"hover"),s=n=>n==="click"?this.triggerOff==="none"?null:e.clickOut:e.hoverOut;this._spec.lockAfterClick&&!i.includes("click")?(i.push("click"),this._onlyLockClick=!0):this._onlyLockClick=!1;const a=[];return i.forEach(n=>{a.push({click:n==="click",in:e[n],out:s(n)})}),a}return null}_registerTooltipEvent(){this.event.on(z.tooltipHide,{source:Xt.chart},this._handleTooltipHideOrRelease),this.event.on(z.tooltipShow,{source:Xt.chart},this._handleTooltipShow),this.event.on(z.tooltipRelease,{source:Xt.chart},this._handleTooltipHideOrRelease)}_getAxisInfoByField(t){var e,i;const s=(i=(e=this._option).getComponentsByKey)===null||i===void 0?void 0:i.call(e,"axes");if(!(s!=null&&s.length))return null;let a=$(this._spec,`${t}Field.bindingAxesIndex`);if(a||(a=[],s.forEach((g,p)=>{yc[t].includes(g.getOrient())&&a.push(p)})),!a.length)return null;const n=new Map;let r=1/0,l=1/0,h=-1/0,d=-1/0;const{x:c,y:u}=this.getLayoutStartPoint();return a.forEach(g=>{r=1/0,l=1/0,h=-1/0,d=-1/0;const p=s.find(_=>_.getSpecIndex()===g);p&&(p.getRegions().forEach(_=>{const{x:m,y:v}=_.getLayoutStartPoint();r=Math.min(r,m-c),l=Math.min(l,v-u),h=Math.max(h,m+_.getLayoutRect().width-c),d=Math.max(d,v+_.getLayoutRect().height-u)}),n.set(g,{x1:r,y1:l,x2:h,y2:d,axis:p}))}),n}changeRegions(t){}onLayoutEnd(t){const e=this._regions[0];this.setLayoutRect(e.getLayoutRect()),this.setLayoutStartPosition(e.getLayoutStartPoint()),super.onLayoutEnd(t)}onRender(t){}_releaseEvent(){this.clearOutEvent();const t=this._getTriggerEvent();t&&t.forEach(e=>{this._eventOff(e.in,!1,e.click),e.out&&this._eventOff(e.out,!0)})}_parseCrosshairSpec(){this._parseFieldInfo();const{trigger:t,triggerOff:e,labelZIndex:i,gridZIndex:s}=this._spec;t&&(this.trigger=t),(e==="none"||vt(e)&&e>0)&&(this.triggerOff=e),i!==void 0&&(this.labelZIndex=i),s!==void 0&&(this.gridZIndex=s)}_parseField(t,e){var i,s,a;const n={},{line:r={},label:l={},visible:h}=t;if(n.visible=h,n.type=r.type||"line",r.visible===!1)n.style={visible:!1};else{const d=r.style||{},{stroke:c,fill:u,lineWidth:g}=d,p=d,{strokeOpacity:_,fillOpacity:m,opacity:v}=p,b=qa(p,["strokeOpacity","fillOpacity","opacity"]),y=n.type==="line";let f=y?_:m;if(vt(v)&&(f=(f??1)*v),n.style=Object.assign({opacity:f,pickable:!1,visible:!0},b),y)n.style.stroke=c||u,n.style.lineWidth=$(r,"width",g||2);else{n.style.fill=u||c,!((a=(s=(i=this._spec[e])===null||i===void 0?void 0:i.line)===null||s===void 0?void 0:s.style)===null||a===void 0)&&a.stroke&&(n.style.stroke=this._spec[e].line.style.stroke);const x=$(r,"width");if(typeof x=="string"){const M=parseInt(x.substring(0,x.length-1),10)/100;n.style.sizePercent=M}else typeof x!="number"&&typeof x!="function"||(n.style.size=x)}}if(l.visible){const d=l.labelBackground||{},c=l.style||{},u=d.style||{},{fill:g="rgba(47, 59, 82, 0.9)",stroke:p,outerBorder:_}=u,m=qa(u,["fill","stroke","outerBorder"]);n.label={visible:!0,formatMethod:l.formatMethod,formatter:l.formatter,minWidth:d.minWidth,maxWidth:d.maxWidth,padding:d.padding,textStyle:Object.assign(Object.assign({fontSize:14,pickable:!1},c),{fill:c.fill||"#fff",stroke:$(c,"stroke")}),panel:(si(d.visible)?d.visible:d)?Object.assign({visible:!0,pickable:!1,fill:g,stroke:p,outerBorder:Object.assign({stroke:g,distance:0,lineWidth:3},_)},m):{visible:!1},zIndex:this.labelZIndex,childrenPickable:!1,pickable:!1}}else n.label={visible:!1};return n}_filterAxisByPoint(t,e,i){return t&&t.forEach(s=>{const a=s.axis;if(tl(s,e,i)&&t.delete(a.getSpecIndex()),a.type.startsWith("polarAxis")){const n=a.getCenter(),r=a.getInnerRadius(),l=a.getOuterRadius(),h=We.distancePP({x:e,y:i},n);(h>l||h<r)&&t.delete(a.getSpecIndex())}}),t}clearOutEvent(){this._timer&&(clearTimeout(this._timer),this._timer=null),this._clickLock&&(this._clickLock=null),this._hasActive&&(this._hasActive=null)}}Er.specKey="crosshair";class ki extends Er{static getSpecInfo(t){const e=t[this.specKey];if(C(e))return;if(!U(e))return e.xField&&e.xField.visible!==!1||e.yField&&e.yField.visible!==!1?[{spec:e,specPath:[this.specKey],specInfoPath:["component",this.specKey,0],type:P.cartesianCrosshair}]:void 0;const i=[];return e.forEach((s,a)=>{(s.xField&&s.xField.visible!==!1||s.yField&&s.yField.visible!==!1)&&i.push({spec:s,specPath:[this.specKey,a],specInfoPath:["component",this.specKey,a],type:P.cartesianCrosshair})}),i}constructor(t,e){super(t,e),this.type=P.cartesianCrosshair,this.name=P.cartesianCrosshair,this._currValueX=new Map,this._currValueY=new Map}_showDefaultCrosshairBySpec(){const{xField:t,yField:e}=this._spec;if(t!=null&&t.visible&&t.defaultSelect){const{axisIndex:i,datum:s}=t.defaultSelect;this._defaultCrosshair(i,s,1)}if(e!=null&&e.visible&&e.defaultSelect){const{axisIndex:i,datum:s}=e.defaultSelect;this._defaultCrosshair(i,s,2)}}_defaultCrosshair(t,e,i){const s=this._option.getComponentsByKey("axes").find(a=>a.getSpecIndex()===t);s&&(i===1?(this._currValueX.clear(),this._currValueX.set(t,{axis:s,value:e})):(this._currValueY.clear(),this._currValueY.set(t,{axis:s,value:e})),this.layoutByValue(i))}_findAllAxisContains(t,e){const i=this._getAxisInfoByField("x"),s=this._getAxisInfoByField("y");return{xAxisMap:this._filterAxisByPoint(i,t,e),yAxisMap:this._filterAxisByPoint(s,t,e)}}_getValueAt(t,e){return t.getScale().invert(e)}clearAxisValue(){this._currValueX.clear(),this._currValueY.clear()}setAxisValue(t,e){rt(e.getOrient())?this._currValueX.set(e.getSpecIndex(),{value:t,axis:e}):this._currValueY.set(e.getSpecIndex(),{value:t,axis:e})}_getAllAxisValues(t,e,i,s){let a=!1;return t.forEach(n=>{fi(n.axis.getScale().type)&&(a?this.enable=!1:a=!0)}),!!this.enable&&(t.forEach((n,r)=>{const l=n.axis;i.set(r,{value:this._getValueAt(l,e-(s?l.getLayoutStartPoint().x-this.getLayoutStartPoint().x:l.getLayoutStartPoint().y-this.getLayoutStartPoint().y)),axis:l})}),!0)}_layoutCrosshair(t,e,i,s){var a;let n=t,r=e;if(i&&i.length){if(s==="dimension"){const d=i[0],c=d.data.findIndex(g=>g.datum.length>0);let u;if(c>-1){const g=d.data[c];u=g.series.dataToPosition(g.datum[0])}(S(d.dimType)?d.dimType==="y":Se((a=d==null?void 0:d.axis)===null||a===void 0?void 0:a.getOrient()))?r=u==null?void 0:u.y:n=u==null?void 0:u.x}else if(s==="mark"){const d=i[0],c=d.series.dataToPosition(d.datum[0]);n=c==null?void 0:c.x,r=c==null?void 0:c.y}}const{xAxisMap:l,yAxisMap:h}=this._findAllAxisContains(n,r);if(l&&l.size===0||h&&h.size===0){if(this.enableRemain)return;this.hide()}else this._currValueX.clear(),this._currValueY.clear(),l&&l.size&&this._getAllAxisValues(l,n,this._currValueX,!0),h&&h.size&&this._getAllAxisValues(h,r,this._currValueY,!1),this.layoutByValue(3)}hide(){this._xCrosshair&&this._xCrosshair.hideAll(),this._xTopLabel&&this._xTopLabel.hideAll(),this._xBottomLabel&&this._xBottomLabel.hideAll(),this._yCrosshair&&this._yCrosshair.hideAll(),this._yLeftLabel&&this._yLeftLabel.hideAll(),this._yRightLabel&&this._yRightLabel.hideAll()}layoutByValue(t=3){if(!this.enable)return;const e=En(this._regions,"cartesian");if(!e)return;const{x:i,y:s,offsetWidth:a,offsetHeight:n,bandWidth:r,bandHeight:l}=el(t,e,this.getLayoutStartPoint(),this._currValueX,this._currValueY,this._xHair,this._yHair,this.enableRemain,this._cacheXCrossHairInfo,this._cacheYCrossHairInfo);this.enableRemain&&(i&&(this._cacheXCrossHairInfo=Object.assign(Object.assign({},i),{_isCache:!0})),s&&(this._cacheYCrossHairInfo=Object.assign(Object.assign({},s),{_isCache:!0}))),i&&this._layoutVertical(i,r,a),s&&this._layoutHorizontal(s,l,n)}_layoutVertical(t,e,i){var s,a;if(t._isCache&&this.enableRemain||!this._xHair)return;const{x:n,topPos:r,height:l,top:h,bottom:d,visible:c}=t;if(c){const u=this._xHair.type,g=il(this._xHair,t,e,i);if(this._updateCrosshair("x",u,g),h.visible){const p=Object.assign(Object.assign(Object.assign({x:n+e/2,y:r},h),this._xHair.label),{textStyle:Object.assign(Object.assign({},(s=this._xHair.label)===null||s===void 0?void 0:s.textStyle),{textAlign:"center",textBaseline:"bottom"}),zIndex:this.labelZIndex,visible:!0});this._updateCrosshairLabel(this._xTopLabel,p,_=>{_.name="crosshair-x-top-label",this._xTopLabel=_})}else this._xTopLabel&&this._xTopLabel.hideAll();if(d.visible){const p=Object.assign(Object.assign(Object.assign({x:n+e/2,y:r+l},d),this._xHair.label),{textStyle:Object.assign(Object.assign({},(a=this._xHair.label)===null||a===void 0?void 0:a.textStyle),{textAlign:"center",textBaseline:"top"}),zIndex:this.labelZIndex,visible:!0});this._updateCrosshairLabel(this._xBottomLabel,p,_=>{_.name="crosshair-x-bottom-label",this._xBottomLabel=_})}else this._xBottomLabel&&this._xBottomLabel.hideAll()}}_layoutHorizontal(t,e,i){var s,a;if(t._isCache&&this.enableRemain||!this._yHair)return;const{leftPos:n,width:r,y:l,left:h,right:d,visible:c}=t;if(c){const u=this._yHair.type,g=sl(this._yHair,t,e,i);if(this._updateCrosshair("y",u,g),h.visible){const p=Object.assign(Object.assign(Object.assign({x:n,y:l+e/2},h),this._yHair.label),{textStyle:Object.assign(Object.assign({},(s=this._yHair.label)===null||s===void 0?void 0:s.textStyle),{textAlign:"right",textBaseline:"middle"}),zIndex:this.labelZIndex});this._updateCrosshairLabel(this._yLeftLabel,p,_=>{_.name="crosshair-y-left-label",this._yLeftLabel=_})}else this._yLeftLabel&&this._yLeftLabel.hideAll();if(d.visible){const p=Object.assign(Object.assign(Object.assign({x:n+r,y:l+e},d),this._yHair.label),{textStyle:Object.assign(Object.assign({},(a=this._yHair.label)===null||a===void 0?void 0:a.textStyle),{textAlign:"left",textBaseline:"middle"}),zIndex:this.labelZIndex});this._updateCrosshairLabel(this._yRightLabel,p,_=>{_.name="crosshair-y-right-label",this._yRightLabel=_})}else this._yRightLabel&&this._yRightLabel.hideAll()}}_parseFieldInfo(){const{xField:t,yField:e}=this._spec;t&&t.visible&&(this._xHair=this._parseField(t,"xField")),e&&e.visible&&(this._yHair=this._parseField(e,"yField"))}_updateCrosshair(t,e,i){const s=this.getContainer();let a;if(a=t==="x"?this._xCrosshair:this._yCrosshair,a)a.setAttributes(i);else{const n=t==="x"?this._xHair.style:this._yHair.style;e==="line"?a=new Xi(Object.assign(Object.assign({},i),{lineStyle:n,zIndex:this.gridZIndex+1,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1})):e==="rect"&&(a=new Gi(Object.assign(Object.assign({},i),{rectStyle:n,zIndex:this.gridZIndex,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1}))),s==null||s.add(a),t==="x"?this._xCrosshair=a:this._yCrosshair=a}}_updateCrosshairLabel(t,e,i){const s=this.getContainer();t?t.setAttributes(e):(i(t=new Oe(e)),s==null||s.add(t)),al(t,this._getLimitBounds())}_getNeedClearVRenderComponents(){return[this._xCrosshair,this._xTopLabel,this._xBottomLabel,this._yCrosshair,this._yLeftLabel,this._yRightLabel]}}ki.specKey="crosshair",ki.type=P.cartesianCrosshair;const Ir=()=>{V.registerComponent(ki.type,ki)},bc=(o,t)=>{const{getNewDomain:e,isContinuous:i,field:s}=t,a=s(),n=e();if(C(n)||C(a))return o;if(n.length===0)return[];const r={};n.forEach(h=>{r[h]||(r[h]=1)});let l=null;return l=i()?h=>h[a]>=n[0]&&h[a]<=n[1]:h=>r[h[a]+""]||r[h[a]],o.filter(l)},fc=(o,t)=>{const{stateFields:e,valueFields:i,dataCollection:s}=t.input,{stateField:a,valueField:n}=t.output,r={},l=[];return s.forEach((h,d)=>{var c;if(C(e[d]))return;const u=(c=h.getFields())===null||c===void 0?void 0:c[e[d]];u&&u.lockStatisticsByDomain&&u.domain.forEach(g=>{r[g]=0}),h.latestData.forEach(g=>{L(e[d]).forEach(p=>{C(g[p])||(C(r[g[p]])&&(r[g[p]]=0),C(i[d])||(r[g[p]]+=isNaN(parseFloat(g[i[d]]))?1:parseFloat(g[i[d]])))})})}),Object.keys(r).forEach((h,d)=>{const c={[a]:h};n&&(c[n]=r[h]),l.push(c)}),l};class Os extends Ee{get relatedAxisComponent(){return this._relatedAxisComponent}setStartAndEnd(t,e,i=["percent","percent"]){const[s="percent",a="percent"]=i,n=s==="percent"?t:this.dataToStatePoint(t),r=a==="percent"?e:this.dataToStatePoint(e);this._handleChange(n,r,!0)}enableInteraction(){this._activeRoam=!0}disableInteraction(){this._activeRoam=!1}zoomIn(t){this._handleChartZoom({zoomDelta:1.2,zoomX:t==null?void 0:t.x,zoomY:t==null?void 0:t.y})}zoomOut(t){this._handleChartZoom({zoomDelta:.8,zoomX:t==null?void 0:t.x,zoomY:t==null?void 0:t.y})}_handleChange(t,e,i){var s,a;(a=(s=this._spec)===null||s===void 0?void 0:s.zoomLock)!==null&&a!==void 0&&a||e-t!==this._spanCache&&(e-t<this._minSpan||e-t>this._maxSpan)?this._shouldChange=!1:(this._shouldChange=!0,this._spanCache=e-t)}_isReverse(){const t=this._relatedAxisComponent;if(!t)return!1;const e=t.getScale();return e.range()[0]>e.range()[1]&&(!t.getInverse()||this._isHorizontal)}_updateRangeFactor(t){const e=this._relatedAxisComponent.getScale(),i=this._isReverse(),s=i?[1-this._end,1-this._start]:[this._start,this._end];if(i)switch(t){case"startHandler":e.rangeFactorEnd(s[1]);break;case"endHandler":e.rangeFactorStart(s[0]);break;default:e.rangeFactorStart(s[0],!0),e.rangeFactorEnd(s[1])}else switch(t){case"startHandler":e.rangeFactorStart(s[0]);break;case"endHandler":e.rangeFactorEnd(s[1]);break;default:e.rangeFactorEnd(s[1],!0),e.rangeFactorStart(s[0])}const a=e.rangeFactor();a?(this._start=i?1-a[1]:a[0],this._end=i?1-a[0]:a[1]):(this._start=0,this._end=1)}get visible(){return this._visible}constructor(t,e){super(t,e),this.layoutType="none",this._orient="left",this._cacheVisibility=void 0,this._dataUpdating=!1,this._shouldChange=!0,this._stateField="x",this._activeRoam=!0,this._zoomAttr={enable:!0,rate:1,focus:!0},this._dragAttr={enable:!0,rate:1,reverse:!0},this._scrollAttr={enable:!0,rate:1,reverse:!0},this.effect={onZoomChange:i=>{var s,a;const n=this._relatedAxisComponent;if(n&&this._filterMode==="axis"){const r=n.getScale(),l=n.getSpec();this._auto&&this._getAxisBandSize(l)&&this._spec.ignoreBandSize&&(r.bandwidth("auto"),r.maxBandwidth("auto"),r.minBandwidth("auto")),this._updateRangeFactor(i),this._auto&&((a=(s=this._component)===null||s===void 0?void 0:s.setStartAndEnd)===null||a===void 0||a.call(s,this._start,this._end)),n.effect.scaleUpdate()}else mt(this._regions,r=>{var l;(l=r.getViewData())===null||l===void 0||l.markRunning()},{userId:this._seriesUserId,specIndex:this._seriesIndex}),mt(this._regions,r=>{r.reFilterViewData()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._visible=!0,this._handleStateChange=(i,s,a)=>{var n,r;return this._startValue=i,this._endValue=s,this._newDomain=this._parseDomainFromState(this._startValue,this._endValue),(r=(n=this.effect).onZoomChange)===null||r===void 0||r.call(n,a),!0},this._handleChartZoom=i=>{var s,a;if(!this._activeRoam)return;const{zoomDelta:n,zoomX:r,zoomY:l}=i,{x:h,y:d}=this._regions[0].getLayoutStartPoint(),{width:c,height:u}=this._regions[0].getLayoutRect(),g=Math.abs(this._start-this._end),p=(a=(s=this._spec.roamZoom)===null||s===void 0?void 0:s.rate)!==null&&a!==void 0?a:1;if(g>=1&&n<1||g<=.01&&n>1)return;const _=this._isHorizontal?r:l,m=g*(n-1)*p;let v=m/2,b=m/2;if(_){const x=this._isHorizontal?h:d,M=this._isHorizontal?c:u;v=Math.abs(x-_)/Math.abs(M-x)*m,b=Math.abs(M-_)/Math.abs(M-x)*m}const y=mi(this._start+v,0,1),f=mi(this._end-b,0,1);this._handleChange(Math.min(y,f),Math.max(y,f),!0)},this._handleChartScroll=(i,s)=>{var a;if(!this._activeRoam)return!1;const{scrollX:n,scrollY:r}=i;let l=this._isHorizontal?n:r;const h=this._isHorizontal?Pe(n/r)>=.5:Pe(r/n)>=.5;this._scrollAttr.reverse||(l=-l),h&&this._handleChartMove(l,(a=this._scrollAttr.rate)!==null&&a!==void 0?a:1);const d=this._start!==0&&this._end!==1;return h&&d},this._handleChartDrag=(i,s)=>{var a;if(!this._activeRoam)return;const[n,r]=i;let l=this._isHorizontal?n:r;this._dragAttr.reverse&&(l=-l),this._handleChartMove(l,(a=this._dragAttr.rate)!==null&&a!==void 0?a:1)},this._handleChartMove=(i,s)=>{const a=this._isHorizontal?this.getLayoutRect().width:this.getLayoutRect().height;if(Math.abs(i)>=1e-6){if(i>0&&this._end<1){const n=Math.min(1-this._end,i/a)*s;this._handleChange(this._start+n,this._end+n,!0)}else if(i<0&&this._start>0){const n=Math.max(-this._start,i/a)*s;this._handleChange(this._start+n,this._end+n,!0)}}return!1},this._orient=yn(t),this._isHorizontal=nl(this._orient)==="horizontal"}created(){super.created(),this._setAxisFromSpec(),this._setRegionsFromSpec(),this._initEvent(),this._initData(),this._initStateScale(),this._setStateFromSpec()}initLayout(){super.initLayout(),this._layout&&(this._layout.layoutOrient=this._orient)}_setAxisFromSpec(){if(S(this._spec.axisId)?this._relatedAxisComponent=this._option.getComponentByUserId(this._spec.axisId):S(this._spec.axisIndex)&&(this._relatedAxisComponent=this._option.getComponentByIndex("axes",this._spec.axisIndex)),C(this._spec.field)&&!this._relatedAxisComponent){const t=this._option.getComponentsByKey("axes"),e=t.find(i=>i._orient===this._orient);if(e)this._relatedAxisComponent=e;else{const i=t.find(s=>!et(s.getScale().type));this._relatedAxisComponent=i}}this._relatedAxisComponent&&this._filterMode==="axis"&&(this._relatedAxisComponent.autoIndentOnce=!0)}_setRegionsFromSpec(){var t,e;this._regions=this._relatedAxisComponent?this._relatedAxisComponent.getRegions():this._option.getAllRegions();const i=this._relatedAxisComponent?(e=(t=this._relatedAxisComponent).getBindSeriesFilter)===null||e===void 0?void 0:e.call(t):null;if(S(i)&&(S(i.userId)&&(this._seriesUserId=L(i.userId)),S(i.specIndex)&&(this._seriesIndex=L(i.specIndex))),S(this._spec.seriesId)){const s=L(this._spec.seriesId);this._seriesUserId?this._seriesUserId=this._seriesUserId.filter(a=>s.includes(a)):this._seriesUserId=s}if(S(this._spec.seriesIndex)){const s=L(this._spec.seriesIndex);this._seriesIndex?this._seriesIndex=this._seriesIndex.filter(a=>s.includes(a)):this._seriesIndex=s}if(S(this._spec.regionIndex)){const s=this._option.getRegionsInIndex(L(this._spec.regionIndex));this._regions=this._regions.filter(a=>s.includes(a))}else if(S(this._spec.regionId)){const s=L(this._spec.regionId);this._regions=s.length?this._regions.filter(a=>s.includes(a.id)):[]}}onDataUpdate(){var t;const e=this._computeDomainOfStateScale(et(this._stateScale.type));this._stateScale.domain(e,!1),this._handleChange(this._start,this._end,!0),this._spec.auto&&(this._dataUpdating=!0,(t=this.getChart())===null||t===void 0||t.setLayoutTag(!0,null,!1))}_computeDomainOfStateScale(t){if(this._spec.customDomain)return this._spec.customDomain;const e=this._data.getLatestData().map(i=>i[this._stateField]);if(t){const i=e.map(s=>1*s);return e.length?[Ft(i),Bt(i)]:[-1/0,1/0]}return e}_initEvent(){this._initCommonEvent()}_initData(){const t=[],e=[],i=[];if(this._relatedAxisComponent){const n={};mt(this._regions,r=>{var l,h;const d=r.coordinate==="cartesian"?r.getXAxisHelper():r.coordinate==="polar"?r.angleAxisHelper:null,c=r.coordinate==="cartesian"?r.getYAxisHelper():r.coordinate==="polar"?r.radiusAxisHelper:null;if(!d||!c)return;const u=d.getAxisId()===this._relatedAxisComponent.id?d:c.getAxisId()===this._relatedAxisComponent.id?c:this._isHorizontal?d:c,g=u===d?c:d,p=et(g.getScale(0).type);t.push(r.getRawData());const _=r.getSpec(),m=L(_.xField),v=L(_.yField),b=r.coordinate==="cartesian"?m[0]:(l=_.angleField)!==null&&l!==void 0?l:_.categoryField,y=r.coordinate==="cartesian"?v[0]:(h=_.radiusField)!==null&&h!==void 0?h:_.valueField;if(n[r.id]=r.type==="link"?"from_xField":u===d?b:y,e.push(n[r.id]),this._valueField){const f=r.type==="link"?"from_yField":g===d?b:y;i.push(p?f:null)}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),this._originalStateFields=n}else mt(this._regions,n=>{t.push(n.getRawData()),e.push(this._field),this._valueField&&i.push(this._spec.valueField)},{userId:this._seriesUserId,specIndex:this._seriesIndex});const{dataSet:s}=this._option;vn(s,"dataview",rl),st(s,"dataFilterComputeDomain",fc);const a=new St(s,{name:`${this.type}_${this.id}_data`});a.transform({type:"dataFilterComputeDomain",options:{input:{dataCollection:t,stateFields:e,valueFields:i},output:{stateField:this._stateField,valueField:this._valueField}}},!1),this._data=new qe(this._option,a),a.reRunAllTransform(),s.multipleDataViewAddListener(t,"change",this._handleDataCollectionChange.bind(this))}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._spec.roamZoom===!0||this._spec.roamZoom?this._zoomAttr=A({},this._zoomAttr,this._spec.roamZoom):this._zoomAttr.enable=!1,this._spec.roamDrag===!0||this._spec.roamDrag?this._dragAttr=A({},this._dragAttr,this._spec.roamDrag):this._dragAttr.enable=!1,this._spec.roamScroll===!0||this._spec.roamScroll?this._scrollAttr=A({},this._scrollAttr,this._spec.roamScroll):this._scrollAttr.enable=!1,this._field=this._spec.field,this._width=this._computeWidth(),this._height=this._computeHeight(),this._visible=(t=this._spec.visible)===null||t===void 0||t}_statePointToData(t){const e=this._stateScale,i=e.domain();if(et(e.type))return this._isReverse()?i[0]+(i[1]-i[0])*(1-t):i[0]+(i[1]-i[0])*t;let s=e.range();this._isReverse()&&(s=s.slice().reverse());const a=s[0]+(s[1]-s[0])*t;return e.invert(a)}dataToStatePoint(t){const e=this._stateScale,i=e.scale(t);let s=e.range();return!this._isHorizontal&&et(e.type)&&(s=s.slice().reverse()),(i-s[0])/(s[1]-s[0])}_modeCheck(t,e){return t==="start"?e==="percent"&&this._spec.start||e==="value"&&this._spec.startValue:e==="percent"&&this._spec.end||e==="value"&&this._spec.endValue}_setStateFromSpec(){var t,e;let i,s;if(this._auto=!!this._spec.auto,this._spec.rangeMode){const[a,n]=this._spec.rangeMode;this._modeCheck("start",a)&&this._modeCheck("end",n)&&(i=a==="percent"?this._spec.start:this.dataToStatePoint(this._spec.startValue),s=n==="percent"?this._spec.end:this.dataToStatePoint(this._spec.endValue))}else i=this._spec.start?this._spec.start:this._spec.startValue?this.dataToStatePoint(this._spec.startValue):0,s=this._spec.end?this._spec.end:this._spec.endValue?this.dataToStatePoint(this._spec.endValue):1;this._startValue=this._statePointToData(i),this._endValue=this._statePointToData(s),this._start=i,this._end=s,this._minSpan=(t=this._spec.minSpan)!==null&&t!==void 0?t:0,this._maxSpan=(e=this._spec.maxSpan)!==null&&e!==void 0?e:1,et(this._stateScale.type)&&this._stateScale.domain()[0]!==this._stateScale.domain()[1]&&(this._spec.minValueSpan&&(this._minSpan=this._spec.minValueSpan/(this._stateScale.domain()[1]-this._stateScale.domain()[0])),this._spec.maxValueSpan&&(this._maxSpan=this._spec.maxValueSpan/(this._stateScale.domain()[1]-this._stateScale.domain()[0]))),this._minSpan=Math.max(0,this._minSpan),this._maxSpan=Math.min(this._maxSpan,1),this._relatedAxisComponent&&this._filterMode==="axis"||this._start===0&&this._end===1||(this._newDomain=this._parseDomainFromState(this._startValue,this._endValue))}_parseFieldOfSeries(t){var e;return(e=this._originalStateFields)===null||e===void 0?void 0:e[t.id]}_initStateScale(){const t=[0,1];if(this._relatedAxisComponent){const e=this._relatedAxisComponent.getScale(),i=et(e.type),s=this._computeDomainOfStateScale(i);if(this._stateScale=e.clone(),i){const a=s.map(n=>1*n);this._stateScale.domain(s.length?[Ft(a),Bt(a)]:[0,1],!0).range(t)}else this._stateScale.domain(s,!0).range(t)}else this._stateScale=new xn,this._stateScale.domain(this._computeDomainOfStateScale(),!0).range(t)}init(t){super.init(t),this._addTransformToSeries(),this._start===0&&this._end===1||this.effect.onZoomChange()}_addTransformToSeries(){this._relatedAxisComponent&&this._filterMode==="axis"||(st(this._option.dataSet,"dataFilterWithNewDomain",bc),mt(this._regions,t=>{t.addViewDataFilter({type:"dataFilterWithNewDomain",options:{getNewDomain:()=>this._newDomain,field:()=>{var e;return(e=this._field)!==null&&e!==void 0?e:this._parseFieldOfSeries(t)},isContinuous:()=>et(this._stateScale.type)},level:ol.dataZoomFilter})},{userId:this._seriesUserId,specIndex:this._seriesIndex}))}onRender(t){}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake||ge(e,t)||(i.reRender=!0,i.reMake=!0),i}reInit(t){super.reInit(t),this._marks.forEach(e=>{e.getMarks().forEach(i=>{this.initMarkStyleWithSpec(i,this._spec[i.name])})})}changeRegions(){}update(t){}resize(t){}_parseDomainFromState(t,e){if(et(this._stateScale.type))return[Math.min(e,t),Math.max(e,t)];const i=this._stateScale.domain(),s=i.indexOf(t),a=i.indexOf(e);return i.slice(Math.min(s,a),Math.max(s,a)+1)}_initCommonEvent(){var t,e,i,s,a,n,r;const l={delayType:(e=(t=this._spec)===null||t===void 0?void 0:t.delayType)!==null&&e!==void 0?e:"throttle",delayTime:S((i=this._spec)===null||i===void 0?void 0:i.delayType)?(a=(s=this._spec)===null||s===void 0?void 0:s.delayTime)!==null&&a!==void 0?a:30:0,realTime:(r=(n=this._spec)===null||n===void 0?void 0:n.realTime)===null||r===void 0||r};this._zoomAttr.enable&&this.initZoomEventOfRegions(this._regions,null,this._handleChartZoom,l),this._scrollAttr.enable&&this.initScrollEventOfRegions(this._regions,null,this._handleChartScroll,l),this._dragAttr.enable&&this.initDragEventOfRegions(this._regions,null,this._handleChartDrag,l)}updateLayoutAttribute(){this._visible&&this._createOrUpdateComponent(),super.updateLayoutAttribute()}onLayoutStart(t,e,i){super.onLayoutStart(t,e,i);const s=this._autoUpdate(t),a=this._isHorizontal?"height":"width";this.layout.setLayoutRect({[a]:s?this[`_${a}`]:0},{[a]:I.Built_In}),this._dataUpdating=!1}getBoundsInRect(t){const e={x1:this.getLayoutStartPoint().x,y1:this.getLayoutStartPoint().y,x2:0,y2:0};return this._isHorizontal?(e.y2=e.y1+this._height,e.x2=e.x1+t.width):(e.x2=e.x1+this._width,e.y2=e.y1+t.height),e}hide(){var t;(t=this._component)===null||t===void 0||t.hideAll()}show(){var t;(t=this._component)===null||t===void 0||t.showAll()}_getAxisBandSize(t){const e=t==null?void 0:t.bandSize,i=t==null?void 0:t.maxBandSize,s=t==null?void 0:t.minBandSize;if(e||s||i)return{bandSize:e,maxBandSize:i,minBandSize:s}}_autoUpdate(t){var e,i,s,a,n,r;if(!this._auto)return this._cacheVisibility=void 0,!0;const l=this._relatedAxisComponent,h=l==null?void 0:l.getSpec(),d=l==null?void 0:l.getScale(),c=this._getAxisBandSize(h);if(!this._dataUpdating&&fi(d.type)&&(t==null?void 0:t.height)===((e=this._cacheRect)===null||e===void 0?void 0:e.height)&&(t==null?void 0:t.width)===((i=this._cacheRect)===null||i===void 0?void 0:i.width)&&this._fixedBandSize===(c==null?void 0:c.bandSize))return this._cacheVisibility;let u=!0;if(this._isHorizontal&&(t==null?void 0:t.width)!==((s=this._cacheRect)===null||s===void 0?void 0:s.width)?d.range(l.getInverse()?[t.width,0]:[0,t.width]):(t==null?void 0:t.height)!==((a=this._cacheRect)===null||a===void 0?void 0:a.height)&&d.range(l.getInverse()?[0,t.height]:[t.height,0]),this._cacheRect={width:t==null?void 0:t.width,height:t==null?void 0:t.height},this._fixedBandSize=c==null?void 0:c.bandSize,fi(d.type)){c&&(this._start||this._end)&&(this.type===P.scrollBar&&(this._start=0,this._end=1),this._updateRangeFactor());const[g,p]=(n=d.rangeFactor())!==null&&n!==void 0?n:[];u=(!C(g)||!C(p))&&!(g===0&&p===1)}else{const[g,p]=(r=d.rangeFactor())!==null&&r!==void 0?r:[this._start,this._end];u=!(g===0&&p===1)}return this.setStartAndEnd(this._start,this._end),u?this.show():this.hide(),this._cacheVisibility=u,u}_getNeedClearVRenderComponents(){return[this._component]}}kt(Os,Gd);class Rr extends In{_mergeThemeToSpec(t,e){const i=this._theme;let s=t;if(this._shouldMergeThemeToSpec()){const a=r=>{const l=q({selectedBackgroundChart:{line:{},area:{}}},this._theme,r),{selectedBackgroundChart:h={}}=r,{line:d,area:c}=h;return d&&d.visible!==!1&&(l.selectedBackgroundChart.line.style=Object.assign(Object.assign({},l.selectedBackgroundChart.line.style),{visible:!0})),c&&c.visible!==!1&&(l.selectedBackgroundChart.area.style=Object.assign(Object.assign({},l.selectedBackgroundChart.area.style),{visible:!0})),l},n=t;s=U(n)?n.map(r=>a(r)):a(n)}return this._adjustPadding(s),{spec:s,theme:i}}}class Ze extends Os{static getSpecInfo(t){const e=t[this.specKey];if(C(e))return;if(!U(e))return[{spec:e,specPath:[this.specKey],specInfoPath:["component",this.specKey,0],type:P.dataZoom}];const i=[];return e.forEach((s,a)=>{i.push({spec:s,specPath:[this.specKey,a],specInfoPath:["component",this.specKey,a],type:P.dataZoom})}),i}constructor(t,e){var i;super(t,e),this.type=P.dataZoom,this.name=P.dataZoom,this.transformerConstructor=Rr,this.specKey="dataZoom",this.layoutZIndex=ft.DataZoom,this.layoutLevel=bs.DataZoom,this.layoutType="region-relative",this._isReverseCache=!1,this._dataToPositionX=s=>{const a=this._orient==="left"?this._middleHandlerSize:0,n=this._isHorizontal?this._startHandlerSize/2:0,r=this._isHorizontal?this._stateScale:this._valueScale,l=this._isHorizontal?this._stateField:this._valueField;return r.scale(s[l])+this.getLayoutStartPoint().x+a+n},this._dataToPositionX2=s=>{const a=this._orient==="left"?this._middleHandlerSize:0,n=this._isHorizontal?this._startHandlerSize/2:0,r=this._isHorizontal?this._stateScale:this._valueScale,l=r.domain()[0];return r.scale(l)+this.getLayoutStartPoint().x+a+n},this._dataToPositionY=s=>{const a=this._isHorizontal?this._middleHandlerSize:0,n=this._isHorizontal?0:this._startHandlerSize/2,r=this._isHorizontal?this._valueScale:this._stateScale,l=this._isHorizontal?this._valueField:this._stateField;return r.scale(s[l])+this.getLayoutStartPoint().y+a+n},this._dataToPositionY2=s=>{const a=this._isHorizontal?this._middleHandlerSize:0,n=this._isHorizontal?0:this._startHandlerSize/2,r=this._isHorizontal?this._valueScale:this._stateScale,l=r.domain()[0];return r.scale(l)+this.getLayoutStartPoint().y+a+n},this._valueField="y",this._filterMode=(i=t.filterMode)!==null&&i!==void 0?i:"filter"}created(){super.created(),this._initValueScale()}setAttrFromSpec(){var t,e,i,s,a,n,r,l,h,d;super.setAttrFromSpec(),si(this._spec.roam)&&(this._zoomAttr.enable=this._spec.roam,this._dragAttr.enable=this._spec.roam,this._scrollAttr.enable=this._spec.roam),(this._zoomAttr.enable||this._dragAttr.enable||this._scrollAttr.enable)&&this.initZoomable(this.event,this._option.mode),this._backgroundSize=(e=(t=this._spec.background)===null||t===void 0?void 0:t.size)!==null&&e!==void 0?e:30,this._middleHandlerSize=this._computeMiddleHandlerSize(),this._width=this._computeWidth(),this._height=this._computeHeight(),C((a=(s=(i=this._spec)===null||i===void 0?void 0:i.startHandler)===null||s===void 0?void 0:s.style)===null||a===void 0?void 0:a.size)&&(this._spec.startHandler.style.size=this._isHorizontal?this._height-this._middleHandlerSize:this._width-this._middleHandlerSize),C((l=(r=(n=this._spec)===null||n===void 0?void 0:n.endHandler)===null||r===void 0?void 0:r.style)===null||l===void 0?void 0:l.size)&&(this._spec.endHandler.style.size=this._isHorizontal?this._height-this._middleHandlerSize:this._width-this._middleHandlerSize);const c=(h=this._spec.startHandler.style.visible)===null||h===void 0||h,u=(d=this._spec.endHandler.style.visible)===null||d===void 0||d;this._startHandlerSize=c?this._spec.startHandler.style.size:0,this._endHandlerSize=u?this._spec.endHandler.style.size:0}onLayoutEnd(t){this._updateScaleRange(),this._isReverse()&&!this._isReverseCache&&(this._isReverseCache=this._isReverse(),this.effect.onZoomChange()),this._cacheVisibility!==!1&&super.onLayoutEnd(t)}_initValueScale(){const t=this._computeDomainOfValueScale();if(t){const e=new fn;e.domain(t),this._valueScale=e}}_updateScaleRange(){var t,e;const i=this._startHandlerSize+this._endHandlerSize;if(!this._stateScale||!this._valueScale)return;let s;const a=this._isHorizontal?this.getLayoutRect().width-i:this.getLayoutRect().height-i,n=(e=(t=this._relatedAxisComponent)===null||t===void 0?void 0:t.getScale().range())!==null&&e!==void 0?e:[this._startHandlerSize/2,a+this._startHandlerSize/2];this._isHorizontal?(s=this._visible?[this._startHandlerSize/2,this._computeWidth()-i+this._startHandlerSize/2]:n,this._stateScale.range(s),this._valueScale.range([this._computeHeight()-this._middleHandlerSize,0])):this.layoutOrient==="left"?(s=this._visible?[this._startHandlerSize/2,this._computeHeight()-i+this._startHandlerSize/2]:n,this._stateScale.range(s),this._valueScale.range([this._computeWidth()-this._middleHandlerSize,0])):(s=this._visible?[this._startHandlerSize/2,this._computeHeight()-i+this._startHandlerSize/2]:n,this._stateScale.range(s),this._valueScale.range([0,this._computeWidth()-this._middleHandlerSize])),this._component&&this._cacheVisibility!==!1&&this._component.setAttributes({size:{width:this._computeWidth(),height:this._computeHeight()},position:{x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y}})}_computeDomainOfValueScale(){const t=this._data.getLatestData().map(i=>i[this._valueField]),e=t.map(i=>1*i);return t.length?[Ft(e),Bt(e)]:null}_computeMiddleHandlerSize(){var t,e,i,s;let a=0;if(!((e=(t=this._spec)===null||t===void 0?void 0:t.middleHandler)===null||e===void 0)&&e.visible){const n=(i=this._spec.middleHandler.icon.style.size)!==null&&i!==void 0?i:8,r=(s=this._spec.middleHandler.background.size)!==null&&s!==void 0?s:40;a+=Math.max(n,r)}return a}_computeWidth(){return this._visible===!1?0:vt(this._spec.width)?this._spec.width:this._isHorizontal?this.getLayoutRect().width:this._backgroundSize+this._middleHandlerSize}_computeHeight(){return this._visible===!1?0:vt(this._spec.height)?this._spec.height:this._isHorizontal?this._backgroundSize+this._middleHandlerSize:this.getLayoutRect().height-(this._startHandlerSize+this._endHandlerSize)/2}_isScaleValid(t){if(!t||!t.domain())return!1;const e=t.domain();return(!et(t.type)||e[0]!==e[1])&&(!fi(t.type)||ll(e).length!==1)}_getAttrs(t){var e,i,s,a,n;const r=(e=this._spec)!==null&&e!==void 0?e:{};return Object.assign({zIndex:this.layoutZIndex,start:this._start,end:this._end,position:{x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y},orient:this._orient,size:{width:this.getLayoutRect().width,height:this.getLayoutRect().height},showDetail:r.showDetail,brushSelect:(i=r.brushSelect)!==null&&i!==void 0&&i,zoomLock:(s=r.zoomLock)!==null&&s!==void 0&&s,minSpan:this._minSpan,maxSpan:this._maxSpan,delayType:r.delayType,delayTime:S(r.delayType)?(a=r.delayTime)!==null&&a!==void 0?a:30:0,realTime:(n=r.realTime)===null||n===void 0||n,previewData:t&&this._data.getLatestData(),previewPointsX:t&&this._dataToPositionX,previewPointsY:t&&this._dataToPositionY,tolerance:this._spec.tolerance},this._getComponentAttrs(t))}_createOrUpdateComponent(){if(this._visible){const t=this._isHorizontal?this._stateScale:this._valueScale,e=this._isHorizontal?this._valueScale:this._stateScale,i=this._isScaleValid(t)&&this._isScaleValid(e)&&this._spec.showBackgroundChart!==!1,s=this._getAttrs(i);if(this._component)this._component.setAttributes(s);else{const a=this.getContainer();this._component=new tr(s),this._isHorizontal?i&&this._component.setPreviewPointsY1(this._dataToPositionY2):i&&this._component.setPreviewPointsX1(this._dataToPositionX2),this._component.setStatePointToData(n=>this._statePointToData(n)),this._component.addEventListener("change",n=>{const{start:r,end:l,tag:h}=n.detail;this._handleChange(r,l,void 0,h)}),a.add(this._component),this._updateScaleRange()}}}_handleChange(t,e,i,s){if(super._handleChange(t,e,i),this._shouldChange){i&&this._component&&this._component.setStartAndEnd(t,e),this._start=t,this._end=e;const a=this._statePointToData(t),n=this._statePointToData(e);(E(this._spec.updateDataAfterChange)?this._spec.updateDataAfterChange(t,e,a,n):this._handleStateChange(a,n,s))&&this.event.emit(z.dataZoomChange,{model:this,value:{filterData:this._filterMode!=="axis",start:t,end:e,startValue:this._startValue,endValue:this._endValue,newDomain:this._newDomain}})}}_handleDataCollectionChange(){var t;const e=this._data.getDataView();if(e.reRunAllTransform(),(t=this._component)===null||t===void 0||t.setPreviewData(e.latestData),this._valueScale){const i=this._computeDomainOfValueScale();i&&this._valueScale.domain(i)}}_getComponentAttrs(t){var e,i,s,a,n,r,l,h,d,c,u;const{middleHandler:g={},startText:p={},endText:_={},backgroundChart:m={},selectedBackgroundChart:v={}}=this._spec;return{backgroundStyle:F((e=this._spec.background)===null||e===void 0?void 0:e.style),startHandlerStyle:F((i=this._spec.startHandler)===null||i===void 0?void 0:i.style),middleHandlerStyle:g.visible?{visible:!0,icon:F((s=g.icon)===null||s===void 0?void 0:s.style),background:{size:(a=g.background)===null||a===void 0?void 0:a.size,style:F((n=g.background)===null||n===void 0?void 0:n.style)}}:{visible:!1},endHandlerStyle:F((r=this._spec.endHandler)===null||r===void 0?void 0:r.style),startTextStyle:{padding:p.padding,formatMethod:this._getHandlerTextFormatMethod(p),textStyle:F(p.style)},endTextStyle:{padding:_.padding,formatMethod:this._getHandlerTextFormatMethod(_),textStyle:F(_.style)},selectedBackgroundStyle:F(this._spec.selectedBackground.style),dragMaskStyle:F((l=this._spec.dragMask)===null||l===void 0?void 0:l.style),backgroundChartStyle:t?{line:q(F((h=m.line)===null||h===void 0?void 0:h.style),{fill:!1}),area:Object.assign({curveType:"basis",visible:!0},F((d=m.area)===null||d===void 0?void 0:d.style))}:{line:{visible:!1},area:{visible:!1}},selectedBackgroundChartStyle:t?{line:q(F((c=v.line)===null||c===void 0?void 0:c.style),{fill:!1}),area:Object.assign({curveType:"basis",visible:!0},F((u=v.area)===null||u===void 0?void 0:u.style))}:{line:{visible:!1},area:{visible:!1}},disableTriggerEvent:this._option.disableTriggerEvent}}_getHandlerTextFormatMethod(t){const{formatMethod:e,formatter:i}=t,{formatFunc:s}=ys(e,i);return s?a=>s(a,{label:a},i):void 0}_getNeedClearVRenderComponents(){return[this._component]}clear(){if(this._component){const t=this.getContainer();this._component.removeAllChild(),t&&t.removeChild(this._component),this._component=null}super.clear()}}Ze.type=P.dataZoom,Ze.transformerConstructor=Rr,Ze.specKey="dataZoom";const xc=()=>{V.registerComponent(Ze.type,Ze)};class Mi extends Os{static getSpecInfo(t){const e=t[this.specKey];if(C(e))return;if(!U(e))return[{spec:e,specPath:[this.specKey],specInfoPath:["component",this.specKey,0],type:P.scrollBar}];const i=[];return e.forEach((s,a)=>{i.push({spec:s,specPath:[this.specKey,a],specInfoPath:["component",this.specKey,a],type:P.scrollBar})}),i}constructor(t,e){var i;super(t,e),this.type=P.scrollBar,this.name=P.scrollBar,this.specKey="scrollBar",this.layoutZIndex=ft.DataZoom,this.layoutLevel=bs.DataZoom,this.layoutType="region-relative",this._filterMode=(i=t.filterMode)!==null&&i!==void 0?i:"axis"}setAttrFromSpec(){super.setAttrFromSpec(),si(this._spec.roam)&&(this._zoomAttr.enable=!1,this._dragAttr.enable=this._spec.roam,this._scrollAttr.enable=this._spec.roam),(this._zoomAttr.enable||this._dragAttr.enable||this._scrollAttr.enable)&&this.initZoomable(this.event,this._option.mode)}onLayoutEnd(t){var e,i;this._updateScaleRange(),(i=(e=this.effect).onZoomChange)===null||i===void 0||i.call(e),super.onLayoutEnd(t)}_updateScaleRange(){this._component&&this._component.setAttributes({x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y,width:this.getLayoutRect().width,height:this.getLayoutRect().height})}_computeWidth(){return vt(this._spec.width)?this._spec.width:this._isHorizontal?this.getLayoutRect().width:$a}_computeHeight(){return vt(this._spec.height)?this._spec.height:this._isHorizontal?$a:this.getLayoutRect().height}_getAttrs(){var t,e,i,s,a,n;return Object.assign({zIndex:this.layoutZIndex,x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y,width:this.getLayoutRect().width,height:this.getLayoutRect().height,range:[this._start,this._end],direction:this._isHorizontal?"horizontal":"vertical",delayType:(t=this._spec)===null||t===void 0?void 0:t.delayType,delayTime:S((e=this._spec)===null||e===void 0?void 0:e.delayType)?(s=(i=this._spec)===null||i===void 0?void 0:i.delayTime)!==null&&s!==void 0?s:30:0,realTime:(n=(a=this._spec)===null||a===void 0?void 0:a.realTime)===null||n===void 0||n},this._getComponentAttrs())}_createOrUpdateComponent(){const t=this._getAttrs();if(this._component)this._component.setAttributes(t);else{const e=this.getContainer();this._component=new hl(t),this._component.addEventListener("scrollDrag",i=>{const s=i.detail.value;this._handleChange(s[0],s[1])}),e.add(this._component)}}_handleChange(t,e,i){super._handleChange(t,e,i);const s=ua(this._start,t)&&ua(this._end,e);if(this._shouldChange&&!s){i&&this._component&&this._component.setAttribute("range",[t,e]),this._start=t,this._end=e;const a=this._statePointToData(t),n=this._statePointToData(e);(E(this._spec.updateDataAfterChange)?this._spec.updateDataAfterChange(t,e,a,n):this._handleStateChange(this._statePointToData(t),this._statePointToData(e)))&&this.event.emit(z.scrollBarChange,{model:this,value:{filterData:this._filterMode!=="axis",start:this._start,end:this._end,startValue:this._startValue,endValue:this._endValue,newDomain:this._newDomain}})}}_handleDataCollectionChange(){}_initCommonEvent(){super._initCommonEvent(),this._component&&this._component.on("scrollDrag",t=>{const e=t.detail.value;this._handleChange(e[0],e[1])})}_getComponentAttrs(){const{rail:t,slider:e,innerPadding:i}=this._spec,s={};return C(i)||(s.padding=i),W(t==null?void 0:t.style)||(s.railStyle=F(t.style)),W(e==null?void 0:e.style)||(s.sliderStyle=F(e.style)),s.disableTriggerEvent=this._option.disableTriggerEvent,s}_getNeedClearVRenderComponents(){return[this._component]}}Mi.type=P.scrollBar,Mi.specKey="scrollBar";const Sc=()=>{V.registerComponent(Mi.type,Mi)},Ac=["sum","average","min","max","variance","standardDeviation","median"];var kc=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};function Ti(o,t,e){if(!e)return!1;const i=o.map(n=>1*n),s=Ft(i),a=Bt(i);return t<s||t>a}function Qa(o,t,e,i,s,a){var n,r;const{relativeSeries:l}=i;let h;return vt(o.x)&&Ti(t,o.x,e)&&((r=l==null?void 0:(n=l.getXAxisHelper()).setExtendDomain)===null||r===void 0||r.call(n,"marker_xAxis_extend",o.x)),h=ue(o.x)?Ci(o.x,s)+a.x:l.getXAxisHelper().dataToPosition([o.x])+a.x,h}function Ja(o,t,e,i,s,a){var n,r;const{relativeSeries:l}=i;let h;return vt(o.y)&&Ti(t,o.y,e)&&((r=(n=l.getYAxisHelper())===null||n===void 0?void 0:n.setExtendDomain)===null||r===void 0||r.call(n,"marker_yAxis_extend",o.y)),h=ue(o.y)?Ci(o.y,s)+a.y:l.getYAxisHelper().dataToPosition([o.y])+a.y,h}function Ci(o,t){return Number(o.substring(0,o.length-1))*t/100}function ze(o){return Ac.includes(o)}function Li(o,t,e,i,s){const a=t.getRegion(),n=a.getLayoutStartPoint(),r=e.getRegion(),l=r.getLayoutStartPoint(),h=Math.abs(Math.min(n.x,l.x)-Math.max(n.x+a.getLayoutRect().width,l.x+r.getLayoutRect().width)),d=Math.abs(Math.min(n.y,l.y)-Math.max(n.y+a.getLayoutRect().height,l.y+r.getLayoutRect().height)),c={relativeSeries:i,startRelativeSeries:t,endRelativeSeries:e},u=[],g=o.latestData[0]&&o.latestData[0].latestData?o.latestData[0].latestData:o.latestData,p=i.getXAxisHelper().getScale(0).domain(),_=i.getYAxisHelper().getScale(0).domain();return g.forEach(m=>{const v=S(m.x),b=S(m.y);if(v&&b){const y=Qa(m,p,s,c,h,n),f=Ja(m,_,s,c,d,n);u.push([{x:y,y:f}])}else if(v){const y=Qa(m,p,s,c,h,n),f=Math.max(n.y+a.getLayoutRect().height,l.y+r.getLayoutRect().height),x=Math.min(n.y,l.y);u.push([{x:y,y:f},{x:y,y:x}])}else if(b){const y=Math.min(n.x,l.x),f=Ja(m,_,s,c,d,n),x=Math.max(n.x+a.getLayoutRect().width,l.x+r.getLayoutRect().width);u.push([{x:y,y:f},{x,y:f}])}}),u}function Es(o,t,e,i){const s=[],a=o.latestData[0]&&o.latestData[0].latestData?o.latestData[0].latestData:o.latestData,n=U(i);return a.forEach((r,l)=>{var h,d,c,u;const g=r!=null&&r.getRefRelativeSeries?r.getRefRelativeSeries():t,p=g.getRegion(),_=p.getLayoutStartPoint(),{width:m,height:v}=p.getLayoutRect();let b=0,y=0;if(i){const D=n?i[l]:i,O=D.x,T=D.y;O&&(b=ue(O)?Number(O.substring(0,O.length-1))*m/100:O),T&&(y=ue(T)?Number(T.substring(0,T.length-1))*v/100:T)}const f=g.getXAxisHelper().getScale(0).domain(),x=g.getYAxisHelper().getScale(0).domain(),M=L(r.x),k=L(r.y);M.length===1&&vt(M[0])&&Ti(f,M[0],e)&&((d=(h=g.getXAxisHelper())===null||h===void 0?void 0:h.setExtendDomain)===null||d===void 0||d.call(h,"marker_xAxis_extend",M[0])),k.length===1&&vt(k[0])&&Ti(x,k[0],e)&&((u=(c=g.getYAxisHelper())===null||c===void 0?void 0:c.setExtendDomain)===null||u===void 0||u.call(c,"marker_yAxis_extend",k[0])),s.push({x:g.getXAxisHelper().dataToPosition(M)+_.x+b,y:g.getYAxisHelper().dataToPosition(k)+_.y+y})}),s}function tn(o,t,e){let{x:i,y:s}=o;return ue(i)&&(i=Ci(i,t)),ue(s)&&(s=Ci(s,e)),{x:i,y:s}}function Is(o,t,e){let i;if(i=E(o)?L(o(t.getData().getLatestData(),t)):L(o),e){const n=t.getRegion(),{x:r,y:l}=n.getLayoutStartPoint(),{width:h,height:d}=n.getLayoutRect();return i.map(c=>{let{x:u,y:g}=tn(c,h,d);return u+=r,g+=l,{x:u,y:g}})}const{width:s,height:a}=t.getOption().getChart().getViewRect();return i.map(n=>tn(n,s,a))}function Rs(o){let t=1/0,e=-1/0,i=1/0,s=-1/0;return o.forEach(a=>{const n=a.getLayoutStartPoint(),r=a.getLayoutRect();n.x<t&&(t=n.x),n.x+r.width>e&&(e=n.x+r.width),n.y<i&&(i=n.y),n.y+r.height>s&&(s=n.y+r.height)}),{minX:t,maxX:e,minY:i,maxY:s}}function ws(o,t){const{labelBackground:e={},style:i,shape:s}=o,a=kc(o,["labelBackground","style","shape"]);if(o.visible!==!1){const n=a;return s!=null&&s.visible?n.shape=Object.assign({visible:!0},F(s.style)):n.shape={visible:!1},e.visible!==!1?(n.panel=Object.assign({visible:!0,customShape:e.customShape},Zt(F(e.style),t)),S(e.padding)&&(n.padding=un(e.padding))):(n.panel={visible:!1},n.padding=0),i&&(n.textStyle=Zt(F(i),t)),n}return{visible:!1}}function at(o,t){for(const e in o)E(o[e])&&(o[e]=o[e](t));return o}function Zt(o,t){return E(o)?o(t):o}function en(o,t){return E(o)?o(t):o}function sn(o,t,e){return S(o)?t==="regionLeft"?e.getLayoutStartPoint().x-o.x:t==="regionRight"?e.getLayoutStartPoint().x+e.getLayoutRect().width-o.x:t==="regionTop"?e.getLayoutStartPoint().y-o.y:t==="regionBottom"?e.getLayoutStartPoint().y+e.getLayoutRect().height-o.y:t:t}function Pi(o){const t="x"in o,e="y"in o,i="x1"in o,s="y1"in o,a="angle"in o,n="radius"in o,r="angle1"in o,l="radius1"in o;return{doXProcess:t&&!e&&!s,doXYY1Process:t&&e&&s,doYProcess:e&&!t&&!i,doYXX1Process:e&&t&&i,doXYProcess:t&&e&&i&&s,doAngleProcess:a&&!r&&!n&&!l,doRadiusProcess:n&&!l&&!a&&!r,doAngRadRad1Process:a&&!r&&n&&l,doRadAngAng1Process:n&&a&&r&&!l,doRadAngProcess:a&&n&&r&&l,doCoordinatesProcess:"coordinates"in o&&(!("process"in o)||"process"in o&&"xy"in o.process)}}function Bi(o){const t="x"in o,e="x1"in o,i="y"in o,s="y1"in o,a="angle"in o,n="radius"in o,r="angle1"in o,l="radius1"in o;return{doXProcess:t&&e&&!i&&!s,doYProcess:i&&s&&!t&&!e,doXYProcess:t&&e&&i&&s,doAngleProcess:a&&r&&!n&&!l,doRadiusProcess:n&&l&&!a&&!r,doRadAngProcess:a&&n&&r&&l,doCoordinatesProcess:"coordinates"in o}}function cs(o){return{doXYProcess:S(o.x)&&S(o.y),doPolarProcess:S(o.angle)&&S(o.radius),doGeoProcess:S(o.areaName)}}function Mc(o,t,e,i=0){const s=[],a=o.y-t.y,n=o.x-t.x;switch(e){case"top":s.push(o),s.push({x:o.x,y:a>0?o.y-i-Math.abs(a):o.y-i}),s.push({x:t.x,y:a>0?t.y-i:t.y-i-Math.abs(a)}),s.push(t);break;case"bottom":s.push(o),s.push({x:o.x,y:a<0?o.y+i+Math.abs(a):o.y+i}),s.push({x:t.x,y:a<0?t.y+i:t.y+i+Math.abs(a)}),s.push(t);break;case"left":s.push(o),s.push({x:n>0?o.x-i-Math.abs(n):o.x-i,y:o.y}),s.push({x:n>0?t.x-i:t.x-i-Math.abs(n),y:t.y}),s.push(t);break;case"right":s.push(o),s.push({x:n>0?o.x+i:o.x+i+Math.abs(n),y:o.y}),s.push({x:n>0?t.x+i+Math.abs(n):t.x+i,y:t.y}),s.push(t)}return s}function Tc(o,t,e,i=0){const s=o.y-t.y,a=o.x-t.x;return e==="bottom"?{dx:a>0?-a/2:Math.abs(a/2),dy:s>0?i:Math.abs(s)+i}:e==="top"?{dx:a>0?-Math.abs(a/2):+Math.abs(a/2),dy:s>0?-(Math.abs(s)+i):-i}:e==="left"?{dx:a>0?-a-i:-i,dy:s>0?-s/2:Math.abs(s/2)}:e==="right"?{dx:a>0?i:Math.abs(a)+i,dy:s>0?-s/2:Math.abs(s/2)}:{}}var Cc=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};const Lc=(o,t)=>{const e=o[0].latestData;return cl(e,t.field)},Pc=(o,t)=>{const e=o[0].latestData;return ul(e,t.field)};function Bc(o,t){const e=o[0].latestData;return gl(e,t.field)}function Dc(o,t){const e=o[0].latestData;return pl(e,t.field)}function Oc(o,t){const e=o[0].latestData;return _l(e,t.field)}function Ec(o,t){const e=o[0].latestData;return ml(e,t.field)}function Ic(o,t){const e=o[0].latestData;return vl(e,t.field)}function Fs(o,t){let e;if(t.coordinates){const s=t,{coordinates:a,coordinateType:n,getSeriesByIdOrIndex:r}=s,l=Cc(s,["coordinates","coordinateType","getSeriesByIdOrIndex"]);let h,d;if(E(a)){const c=t.getRelativeSeries();h=a(c.getData().getLatestData(),c)}else h=a;h=L(h),e=h.map(c=>{const u=r(c.refRelativeSeriesId,c.refRelativeSeriesIndex);if(n==="cartesian"){const{xField:g,yField:p}=u.getSpec(),{xFieldDim:_,xFieldIndex:m,yFieldDim:v,yFieldIndex:b}=c;let y=g;S(m)&&(y=L(g)[m]),_&&L(g).includes(_)&&(y=_);let f=p;S(b)&&(f=L(p)[b]),v&&L(p).includes(v)&&(f=v),d=Object.assign({x:void 0,y:void 0},l),X(c[y])&&ze(c[y])?d.x={field:y,aggrType:c[y]}:d.x=L(y).map(x=>c[x]),X(c[f])&&ze(c[f])?d.y={field:f,aggrType:c[f]}:d.y=L(f).map(x=>c[x])}else if(n==="polar"){const{valueField:g,categoryField:p}=u.getSpec(),{angleFieldDim:_,angleFieldIndex:m}=c;let v=p;S(m)&&(v=L(p)[m]),_&&L(p).includes(_)&&(v=_);const b=g;d=Object.assign({angle:void 0,radius:void 0},l),X(c[v])&&ze(c[v])?d.angle={field:v,aggrType:c[v]}:d.angle=L(v).map(y=>c[y]),X(c[b])&&ze(c[b])?d.radius={field:b,aggrType:c[b]}:d.radius=L(b).map(y=>c[y])}return d.getRefRelativeSeries=()=>u,d})}else e=t;const i=[];return e.forEach(s=>{const a={x:null,y:null,angle:null,radius:null,areaName:null};if(S(s.x)){const n=s.x;U(n)?a.x=n.map(r=>Et(r,o,s)):a.x=Et(n,o,s)}if(S(s.y)){const n=s.y;U(n)?a.y=n.map(r=>Et(r,o,s)):a.y=Et(n,o,s)}if(S(s.angle)){const n=s.angle;U(n)?a.angle=n.map(r=>Et(r,o,s)):a.angle=Et(n,o,s)}if(S(s.radius)){const n=s.radius;U(n)?a.radius=n.map(r=>Et(r,o,s)):a.radius=Et(n,o,s)}if(S(s.areaName)){const n=s.areaName;a.areaName=Et(n,o,s)}s.getRefRelativeSeries&&(a.getRefRelativeSeries=s.getRefRelativeSeries),i.push(a)}),i}const Rc={min:Lc,max:Pc,sum:Bc,average:Dc,variance:Oc,standardDeviation:Ec,median:Ic};function Et(o,t,e){const i=e.getRelativeSeries(),s=e.getStartRelativeSeries(),a=e.getEndRelativeSeries(),n=i.getData().getLatestData(),r=s.getData().getLatestData(),l=a.getData().getLatestData();if(E(o))return o(n,r,l,i,s,a);if(dl(o)){const{aggrType:h,field:d}=o;return Rc[h](t,{field:d})}return o}class zs extends Ee{constructor(){super(...arguments),this.layoutType="none",this._layoutOffsetX=0,this._layoutOffsetY=0}getRelativeSeries(){return this._relativeSeries}getMarkerData(){return this._markerData}static _getMarkerCoordinateType(t){return"cartesian"}static getSpecInfo(t){const e=t[this.specKey];if(W(e))return;if(!U(e)&&e.visible!==!1&&this._getMarkerCoordinateType(e)===this.coordinateType)return[{spec:e,specPath:[this.specKey],specInfoPath:["component",this.specKey,0],type:this.type}];const i=[];return L(e).forEach((s,a)=>{s.visible!==!1&&this._getMarkerCoordinateType(s)===this.coordinateType&&i.push({spec:s,specPath:[this.specKey,a],specInfoPath:["component",this.specKey,a],type:this.type})}),i}created(){super.created(),this._bindSeries(),this._initDataView(),this.initEvent()}_getAllRelativeSeries(){return{getRelativeSeries:()=>this._relativeSeries,getStartRelativeSeries:()=>this._startRelativeSeries,getEndRelativeSeries:()=>this._endRelativeSeries}}_getFieldInfoFromSpec(t,e,i){const s={x:"xField",y:"yField",radius:"valueField",angle:"categoryField",areaName:"nameField"};return X(e)&&ze(e)?{field:i.getSpec()[s[t]],aggrType:e}:e}_processSpecByDims(t){const e=this._relativeSeries,i={};return t.forEach(s=>i[s.dim]=this._getFieldInfoFromSpec(s.dim,s.specValue,e)),Object.assign(Object.assign({},i),this._getAllRelativeSeries())}_processSpecCoo(t){return Object.assign(Object.assign({coordinates:t.coordinates||t.coordinate},this._getAllRelativeSeries()),{getSeriesByIdOrIndex:(e,i)=>this._getSeriesByIdOrIndex(e,i),coordinateType:this.coordinateType})}_getRelativeDataView(){if(this._specifiedDataSeries){let t=[];L(this._specifiedDataSeries).forEach(i=>{t=t.concat(i.getViewData().latestData)});const e=new yl;return e.registerParser("array",bl),new St(e).parse(t,{type:"array"})}return this._relativeSeries.getViewData()}updateLayoutAttribute(){var t,e,i;if((t=this._spec.visible)===null||t===void 0||t){if(!this._markerComponent){const s=this._createMarkerComponent();s.name=(e=this._spec.name)!==null&&e!==void 0?e:this.type,s.id=(i=this._spec.id)!==null&&i!==void 0?i:`${this.type}-${this.id}`,this._markerComponent=s,this.getContainer().add(this._markerComponent),this._markerComponent.on("*",(a,n)=>{this._delegateEvent(this._markerComponent,a,n,null,this.getMarkerData.bind(this))})}this._markerLayout()}super.updateLayoutAttribute()}_getSeriesByIdOrIndex(t,e){var i,s;let a;return a=(i=this._option.getSeriesInUserIdOrIndex(S(t)?[t]:[],[e]))===null||i===void 0?void 0:i[0],a||(a=(s=this._relativeSeries)!==null&&s!==void 0?s:this._getFirstSeries()),a}_bindSeries(){const t=this._spec;this._relativeSeries=this._getSeriesByIdOrIndex(t.relativeSeriesId,t.relativeSeriesIndex),this._startRelativeSeries=this._getSeriesByIdOrIndex(t.startRelativeSeriesId,t.startRelativeSeriesIndex),this._endRelativeSeries=this._getSeriesByIdOrIndex(t.endRelativeSeriesId,t.endRelativeSeriesIndex),t.specifiedDataSeriesIndex&&t.specifiedDataSeriesIndex==="all"||t.specifiedDataSeriesId&&t.specifiedDataSeriesId==="all"?this._specifiedDataSeries=this._option.getAllSeries():(t.specifiedDataSeriesIndex||t.specifiedDataSeriesId)&&(this._specifiedDataSeries=this._getSeriesByIdOrIndex(t.specifiedDataSeriesId,t.specifiedDataSeriesIndex))}initEvent(){this._relativeSeries.coordinate!=="cartesian"&&(this._relativeSeries.event.on("zoom",this._markerLayout.bind(this)),this._relativeSeries.event.on("panmove",this._markerLayout.bind(this)),this._relativeSeries.event.on("scroll",this._markerLayout.bind(this)))}onRender(t){}changeRegions(t){}clear(){super.clear(),this._firstSeries=null}_getFirstSeries(){var t;if(this._firstSeries)return this._firstSeries;const e=En(this._regions);return e?(this._firstSeries=e,e):((t=this._option)===null||t===void 0||t.onError("need at least one series"),null)}_getNeedClearVRenderComponents(){return[this._markerComponent]}onLayoutStart(t,e,i){C(this._spec.offsetX)||(this._layoutOffsetX=yi(this._spec.offsetX,e.width,e)),C(this._spec.offsetY)||(this._layoutOffsetY=yi(this._spec.offsetY,e.height,e)),super.onLayoutStart(t,e,i)}_compareSpec(t,e){const i=super._compareSpec(t,e);return ge(e,t)||(i.reRender=!0,i.reMake=!0,i.change=!0),i}}function wc(o,t){const e=o[0].latestData;return fl(e,t.fieldX,t.fieldY)}function Hs(o,t){if(t&&t.getRelativeSeries){const e=t.getRelativeSeries();if(e){const i=e.getViewData();return i&&i.latestData&&i.latestData.length?o:[]}}return o}class wr extends zs{constructor(){super(...arguments),this.specKey="markLine",this.layoutZIndex=ft.MarkLine}static _getMarkerCoordinateType(t){const{doAngleProcess:e,doRadiusProcess:i,doAngRadRad1Process:s,doRadAngAng1Process:a,doRadAngProcess:n}=Pi(t);return t.coordinateType==="polar"||e||i||s||a||n?"polar":"cartesian"}_createMarkerComponent(){var t,e,i,s,a,n,r,l,h,d,c,u,g,p,_,m,v,b,y;const{label:f={},startSymbol:x={},endSymbol:M={}}=this._spec,k={zIndex:this.layoutZIndex,interactive:(t=this._spec.interactive)===null||t===void 0||t,hover:(e=this._spec.interactive)===null||e===void 0||e,select:(i=this._spec.interactive)===null||i===void 0||i,points:[{x:0,y:0},{x:0,y:0}],center:{x:0,y:0},radius:0,startAngle:0,endAngle:0,lineStyle:Zt(F((s=this._spec.line)===null||s===void 0?void 0:s.style),this._markerData),clipInRange:(a=this._spec.clip)!==null&&a!==void 0&&a,label:ws(f,this._markerData),state:{line:at((r=(n=this._spec.line)===null||n===void 0?void 0:n.state)!==null&&r!==void 0?r:{},this._markerData),lineStartSymbol:at((h=(l=this._spec.startSymbol)===null||l===void 0?void 0:l.state)!==null&&h!==void 0?h:{},this._markerData),lineEndSymbol:at((c=(d=this._spec.endSymbol)===null||d===void 0?void 0:d.state)!==null&&c!==void 0?c:{},this._markerData),label:at((p=(g=(u=this._spec)===null||u===void 0?void 0:u.label)===null||g===void 0?void 0:g.state)!==null&&p!==void 0?p:{},this._markerData),labelBackground:at((b=(v=(m=(_=this._spec)===null||_===void 0?void 0:_.label)===null||m===void 0?void 0:m.labelBackground)===null||v===void 0?void 0:v.state)!==null&&b!==void 0?b:{},this._markerData)},animation:(y=this._spec.animation)!==null&&y!==void 0&&y,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};return x.visible?k.startSymbol=Object.assign(Object.assign({},x),{visible:!0,style:F(x.style)}):k.startSymbol={visible:!1},M.visible?k.endSymbol=Object.assign(Object.assign({},M),{visible:!0,style:F(M.style)}):k.endSymbol={visible:!1},this._newMarkLineComponent(k)}_getUpdateMarkerAttrs(){var t,e,i,s;const a=this._spec,n=this._markerData,r=this._startRelativeSeries,l=this._endRelativeSeries,h=this._relativeSeries,d=this._computePointsAttr(),c=h.getViewData().latestData,u=n.latestData[0]&&n.latestData[0].latestData?n.latestData[0].latestData:n.latestData;let g;if(a.clip||!((t=a.label)===null||t===void 0)&&t.confine){const{minX:m,maxX:v,minY:b,maxY:y}=Rs([r.getRegion(),l.getRegion(),h.getRegion()]);g={x:m,y:b,width:v-m,height:y-b}}const p=(i=(e=this._markerComponent)===null||e===void 0?void 0:e.attribute)!==null&&i!==void 0?i:{},_=Object.assign(Object.assign({},p.label),{text:this._spec.label.formatMethod?this._spec.label.formatMethod(u,c):(s=p.label)===null||s===void 0?void 0:s.text});return Object.assign(Object.assign({},d),{label:_,limitRect:g,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}_markerLayout(){var t;const e=this._getUpdateMarkerAttrs();(t=this._markerComponent)===null||t===void 0||t.setAttributes(e)}_initDataView(){const t=this._spec,e="coordinates"in t,{doXProcess:i,doYProcess:s,doXYY1Process:a,doYXX1Process:n,doXYProcess:r,doAngleProcess:l,doRadiusProcess:h,doAngRadRad1Process:d,doRadAngAng1Process:c,doRadAngProcess:u}=Pi(t);if(this._markerData=this._getRelativeDataView(),!(i||s||a||n||r||l||h||d||c||u||e))return;st(this._option.dataSet,"markerAggregation",Fs),st(this._option.dataSet,"markerRegression",wc),st(this._option.dataSet,"markerFilter",Hs);const{options:g,needAggr:p,needRegr:_,processData:m}=this._computeOptions(),v=new St(this._option.dataSet);v.parse([m],{type:"dataview"}),p&&v.transform({type:"markerAggregation",options:g}),_&&v.transform({type:"markerRegression",options:g}),v.transform({type:"markerFilter",options:this._getAllRelativeSeries()}),v.target.on("change",()=>{this._markerLayout()}),this._markerData=v}}wr.specKey="markLine";class Di extends wr{constructor(){super(...arguments),this.type=P.markLine,this.name=P.markLine,this.coordinateType="cartesian"}_newMarkLineComponent(t){return new le(t)}_computePointsAttr(){var t;const e=this._spec,i=this._markerData,s=this._startRelativeSeries,a=this._endRelativeSeries,n=this._relativeSeries,r=S(e.coordinates),l=S(e.process),h=l&&S(e.process.x),d=l&&S(e.process.y),c=S(e.positions),u=(t=e.autoRange)!==null&&t!==void 0&&t,{doXProcess:g,doYProcess:p,doXYY1Process:_,doYXX1Process:m,doXYProcess:v,doCoordinatesProcess:b}=Pi(e);let y=[];if(g||_||p||m||v||r&&h||r&&d){const f=Li(i,s,a,n,u);y=f.length===1?f[0]:f.map(x=>x[0])}else b?y=Es(i,n,u,e.coordinatesOffset):c&&(y=Is(e.positions,n,e.regionRelative));return{points:y}}_markerLayout(){var t,e,i,s,a,n,r,l;const h=this._getUpdateMarkerAttrs();if(this._spec.type==="type-step"){const d=this._startRelativeSeries,c=this._endRelativeSeries,{multiSegment:u,mainSegmentIndex:g}=this._spec.line||{},{connectDirection:p,expandDistance:_=0}=this._spec;let m;if(ue(_)){const k=d.getRegion(),D=k.getLayoutStartPoint(),O=c.getRegion(),T=O.getLayoutStartPoint();if(p==="bottom"||p==="top"){const B=Math.abs(Math.min(D.y,T.y)-Math.max(D.y+k.getLayoutRect().height,T.y+O.getLayoutRect().height));m=Number(_.substring(0,_.length-1))*B/100}else{const B=Math.abs(Math.min(D.x,T.x)-Math.max(D.x+k.getLayoutRect().width,T.x+O.getLayoutRect().width));m=Number(_.substring(0,_.length-1))*B/100}}else m=_;const{points:v,label:b,limitRect:y}=h,f=Mc(v[0],v[1],p,m);let x;x=u&&S(g)?{position:"middle",autoRotate:!1,refX:0,refY:0}:Object.assign(Object.assign({position:"start",autoRotate:!1},Tc(v[0],v[1],p,m)),{refX:0,refY:0}),w((t=this._spec.label)===null||t===void 0?void 0:t.refX)&&(x.refX+=this._spec.label.refX),w((e=this._spec.label)===null||e===void 0?void 0:e.refY)&&(x.refY+=this._spec.label.refY),w((i=this._spec.label)===null||i===void 0?void 0:i.dx)&&(x.dx=(x.dx||0)+this._spec.label.dx),w((s=this._spec.label)===null||s===void 0?void 0:s.dy)&&(x.dy=(x.dy||0)+this._spec.label.dy);const M=(n=(a=this._markerComponent)===null||a===void 0?void 0:a.attribute)!==null&&n!==void 0?n:{};(r=this._markerComponent)===null||r===void 0||r.setAttributes({points:u?[[f[0],f[1]],[f[1],f[2]],[f[2],f[3]]]:f,label:Object.assign(Object.assign(Object.assign({},b),x),{textStyle:Object.assign(Object.assign({},M.label.textStyle),{textAlign:"center",textBaseline:"middle"})}),limitRect:y,multiSegment:u,mainSegmentIndex:g,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}else(l=this._markerComponent)===null||l===void 0||l.setAttributes(h)}_computeOptions(){let t,e=this._getRelativeDataView(),i=!0,s=!1;const a=this._spec,n=this._relativeSeries,{doXProcess:r,doYProcess:l,doXYY1Process:h,doYXX1Process:d,doXYProcess:c,doCoordinatesProcess:u}=Pi(a);if(c)t=[this._processSpecByDims([{dim:"x",specValue:a.x},{dim:"y",specValue:a.y}]),this._processSpecByDims([{dim:"x",specValue:a.x1},{dim:"y",specValue:a.y1}])];else if(r)t=[this._processSpecByDims([{dim:"x",specValue:a.x}])];else if(l)t=[this._processSpecByDims([{dim:"y",specValue:a.y}])];else if(h)t=[this._processSpecByDims([{dim:"x",specValue:a.x},{dim:"y",specValue:a.y}]),this._processSpecByDims([{dim:"x",specValue:a.x},{dim:"y",specValue:a.y1}])];else if(d)t=[this._processSpecByDims([{dim:"x",specValue:a.x},{dim:"y",specValue:a.y}]),this._processSpecByDims([{dim:"x",specValue:a.x1},{dim:"y",specValue:a.y}])];else if(u){if(t=this._processSpecCoo(a),i=!1,e=new St(this._option.dataSet,{name:`${this.type}_${this.id}_data`}).parse([n.getViewData()],{type:"dataview"}).transform({type:"markerAggregation",options:t}),a.process&&"x"in a.process&&(t=[this._processSpecByDims([{dim:"x",specValue:a.process.x}])],i=!0),a.process&&"y"in a.process&&(t=t=[this._processSpecByDims([{dim:"y",specValue:a.process.y}])],i=!0),a.process&&"xy"in a.process){const{xField:g,yField:p}=n.getSpec();t={fieldX:g,fieldY:p},s=!0}}else i=!1;return{options:t,needAggr:i,needRegr:s,processData:e}}}Di.type=P.markLine,Di.coordinateType="cartesian";const Fc=()=>{V.registerComponent(Di.type,Di),Vh()};class Fr extends zs{constructor(){super(...arguments),this.specKey="markArea",this.layoutZIndex=ft.MarkArea}static _getMarkerCoordinateType(t){const{doAngleProcess:e,doRadiusProcess:i,doRadAngProcess:s}=Bi(t);return t.coordinateType==="polar"||e||i||s?"polar":"cartesian"}_createMarkerComponent(){var t,e,i,s,a,n,r,l,h,d,c,u;const g=(t=this._spec.label)!==null&&t!==void 0?t:{},p={zIndex:this.layoutZIndex,interactive:(e=this._spec.interactive)===null||e===void 0||e,hover:(i=this._spec.interactive)===null||i===void 0||i,select:(s=this._spec.interactive)===null||s===void 0||s,points:[{x:0,y:0}],center:{x:0,y:0},innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,areaStyle:Zt(F((a=this._spec.area)===null||a===void 0?void 0:a.style),this._markerData),clipInRange:(n=this._spec.clip)!==null&&n!==void 0&&n,label:ws(g,this._markerData),state:{area:at((r=this._spec.area)===null||r===void 0?void 0:r.state,this._markerData),label:at((l=this._spec.label)===null||l===void 0?void 0:l.state,this._markerData),labelBackground:at((c=(d=(h=this._spec)===null||h===void 0?void 0:h.label)===null||d===void 0?void 0:d.labelBackground)===null||c===void 0?void 0:c.state,this._markerData)},animation:(u=this._spec.animation)!==null&&u!==void 0&&u,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};return this._newMarkAreaComponent(p)}_markerLayout(){var t,e,i,s;const a=this._spec,n=this._markerData,r=this._startRelativeSeries,l=this._endRelativeSeries,h=this._relativeSeries,d=this._computePointsAttr(),c=this._getRelativeDataView().latestData,u=n?n.latestData[0]&&n.latestData[0].latestData?n.latestData[0].latestData:n.latestData:c;let g;if(a.clip||!((t=a.label)===null||t===void 0)&&t.confine){const{minX:p,maxX:_,minY:m,maxY:v}=Rs([r.getRegion(),l.getRegion(),h.getRegion()]);g={x:p,y:m,width:_-p,height:v-m}}this._markerComponent&&this._markerComponent.setAttributes(Object.assign(Object.assign({},d),{label:Object.assign(Object.assign({},(e=this._markerComponent.attribute)===null||e===void 0?void 0:e.label),{text:this._spec.label.formatMethod?this._spec.label.formatMethod(u,c):(s=(i=this._markerComponent.attribute)===null||i===void 0?void 0:i.label)===null||s===void 0?void 0:s.text}),limitRect:g,dx:this._layoutOffsetX,dy:this._layoutOffsetY}))}_initDataView(){const t=this._spec,{doXProcess:e,doYProcess:i,doXYProcess:s,doAngleProcess:a,doRadiusProcess:n,doRadAngProcess:r,doCoordinatesProcess:l}=Bi(t);if(!(e||i||s||a||n||r||l))return null;const{options:h}=this._computeOptions(),d=this._getRelativeDataView();st(this._option.dataSet,"markerAggregation",Fs),st(this._option.dataSet,"markerFilter",Hs);const c=new St(this._option.dataSet,{name:`${this.type}_${this.id}_data`});c.parse([d],{type:"dataview"}),c.transform({type:"markerAggregation",options:h}),c.transform({type:"markerFilter",options:this._getAllRelativeSeries()}),c.target.on("change",()=>{this._markerLayout()}),this._markerData=c}}Fr.specKey="markArea";class Oi extends Fr{constructor(){super(...arguments),this.type=P.markArea,this.name=P.markArea,this.coordinateType="cartesian"}_newMarkAreaComponent(t){return new he(t)}_computePointsAttr(){var t;const e=this._spec,i=this._markerData,s=this._startRelativeSeries,a=this._endRelativeSeries,n=this._relativeSeries,{doXProcess:r,doYProcess:l,doXYProcess:h,doCoordinatesProcess:d}=Bi(e),c=S(e.positions),u=(t=e.autoRange)!==null&&t!==void 0&&t;let g=[],p=[];if(h){p=Li(i,s,a,n,u);const[_,m]=p;_&&_.length&&m&&m.length&&(g=[{x:_[0].x,y:m[0].y},_[0],{x:m[0].x,y:_[0].y},m[0]])}else if(r||l){p=Li(i,s,a,n,u);const[_,m]=p;_&&_.length&&m&&m.length&&(g=[..._,m[1],m[0]])}else d?g=Es(i,n,u,e.coordinatesOffset):c&&(g=Is(e.positions,n,e.regionRelative));return{points:g}}_computeOptions(){const t=this._spec,{doXProcess:e,doYProcess:i,doXYProcess:s,doCoordinatesProcess:a}=Bi(t);let n;return s?n=[this._processSpecByDims([{dim:"x",specValue:t.x},{dim:"y",specValue:t.y}]),this._processSpecByDims([{dim:"x",specValue:t.x1},{dim:"y",specValue:t.y1}])]:e?n=[this._processSpecByDims([{dim:"x",specValue:t.x}]),this._processSpecByDims([{dim:"x",specValue:t.x1}])]:i?n=[this._processSpecByDims([{dim:"y",specValue:t.y}]),this._processSpecByDims([{dim:"y",specValue:t.y1}])]:a&&(n=this._processSpecCoo(t)),{options:n}}}Oi.type=P.markArea,Oi.coordinateType="cartesian";const zc=()=>{V.registerComponent(Oi.type,Oi),jh()};class Vs extends Ee{constructor(t,e){super(t,e),this.type=P.label,this.name=P.label,this.layoutType="none",this.layoutZIndex=ft.Label,this._regions=e.getRegionsInIndex(e.regionIndexes)}_interactiveConfig(t){const{interactive:e}=t,i={hover:!1,select:!1,state:t.state};if(e!==!0)return i;const{hover:s,select:a}=this._option.getChart().getSpec();return s===!1&&s.enable===!1||(i.hover=!0),a===!1&&a.enable===!1||(i.select=!0),i}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reRender=!0,ge(e,t)||(i.reMake=!0),i}onRender(t){}changeRegions(t){}_getNeedClearVRenderComponents(){return[]}_delegateLabelEvent(t){t.listenerCount("*")===0&&t.addEventListener("*",(e,i)=>this._delegateEvent(t,e,i))}}Vs.type=P.label;class Ei extends Sl{constructor(){super(...arguments),this.skipEncode=!1}getRule(){return this._rule}setRule(t){this._rule=t}getTarget(){return this._target}setTarget(t){this._target=t,this._rule||this.setRule(t.type)}getComponent(){return this._component}setComponent(t){this._component=t}}Ei.type="text",Ei.constructorType="label";const zr=()=>{V.registerMark(Ei.constructorType,Ei),xl()};class Hr extends In{_initTheme(t,e){return{spec:t,theme:this._theme}}}class Ne extends Vs{constructor(t,e){super(t,e),this.type=P.label,this.name=P.label,this.specKey="label",this.transformerConstructor=Hr,this.layoutZIndex=ft.Label,this._layoutRule=t.labelLayout||"series"}static getSpecInfo(t,e){const i=[];return((e==null?void 0:e.region)||[]).forEach((a,n)=>{(a.seriesIndexes||[]).some(r=>{const l=e.series[r],{markLabelSpec:h={}}=l;return Object.values(h).some(d=>Array.isArray(d)&&(c=>c.some(u=>u.visible))(d))})&&i.push({spec:t,type:P.label,specInfoPath:["component",this.specKey,n],regionIndexes:[n]})}),i}init(t){super.init(t),this.initEvent(),this._initTextMark(),this._initLabelComponent(),this._initTextMarkStyle()}reInit(t){super.reInit(t),this._labelInfoMap&&this._labelInfoMap.clear(),this._initTextMark(),this._initTextMarkStyle()}initEvent(){this.event.on(z.dataZoomChange,()=>{this._labelComponentMap.forEach((e,i)=>{const s=i.getProduct().getGroupGraphicItem();s&&s.disableAnimation()}),this.event.on(Ye.AFTER_MARK_RENDER_END,t)});const t=()=>{this._labelComponentMap.forEach((e,i)=>{const s=i.getProduct().getGroupGraphicItem();s&&s.enableAnimation()}),this.event.off(Ye.AFTER_MARK_RENDER_END,t)}}afterCompile(){this._labelComponentMap.forEach((t,e)=>{const i=e.getProduct();i&&i.addEventListener(Ye.AFTER_ELEMENT_ENCODE,()=>{this._isLayout===!1&&this._delegateLabelEvent(i.getGroupGraphicItem())})})}_initTextMark(){this._labelInfoMap||(this._labelInfoMap=new Map),this._labelComponentMap||(this._labelComponentMap=new Map),mt(this._regions,t=>{const{markLabelSpec:e={}}=t.getSpecInfo(),i=Object.keys(e),s=t.getRegion();this._labelInfoMap.get(s)||this._labelInfoMap.set(s,[]);for(let a=0;a<i.length;a++){const n=i[a],r=t.getMarkInName(n);r&&e[n].forEach((l,h)=>{if(l.visible){const d=this._labelInfoMap.get(s),c=this._createMark({type:"label",name:`${n}-label-${h}`},{noSeparateStyle:!0,attributeContext:t.getMarkAttributeContext()});c.setTarget(r),d.push({labelMark:c,baseMark:r,series:t,labelSpec:l})}})}})}_initLabelComponent(){this._labelInfoMap.forEach((t,e)=>{if(this._layoutRule==="region"){const i=this._createMark({type:"component",name:`${e.getGroupMark().name}-label-component`},{componentType:"label",noSeparateStyle:!0,support3d:this._spec.support3d});i&&(i.setSkipBeforeLayouted(!0),this._marks.addMark(i),this._labelComponentMap.set(i,()=>this._labelInfoMap.get(e)))}else t.forEach((i,s)=>{const a=this._createMark({type:"component",name:`${i.labelMark.name}-component`},{componentType:"label",noSeparateStyle:!0,support3d:i.baseMark.getSupport3d()});a&&(a.setSkipBeforeLayouted(!0),this._marks.addMark(a),this._labelComponentMap.set(a,()=>this._labelInfoMap.get(e)[s]),i.labelMark.setComponent(a))})})}_initTextMarkStyle(){this._labelInfoMap.forEach(t=>{t.forEach(e=>{var i,s;const{labelMark:a,labelSpec:n,series:r}=e;if(this.initMarkStyleWithSpec(a,n,void 0),E(n==null?void 0:n.getStyleHandler)){const l=n.getStyleHandler(r);l==null||l.call(r,a,n)}!((s=(i=a.stateStyle)===null||i===void 0?void 0:i.normal)===null||s===void 0)&&s.lineWidth&&a.setAttribute("stroke",r.getColorAttribute(),"normal",I.Base_Series)})})}updateLayoutAttribute(){super.updateLayoutAttribute(),this._labelComponentMap.forEach((t,e)=>{const i=t();U(i)?this._updateMultiLabelAttribute(i,e):this._updateSingleLabelAttribute(i,e)})}_updateMultiLabelAttribute(t,e){this._updateLabelComponentAttribute(e.getProduct(),t.map(({baseMark:i})=>i.getProduct()),t)}_updateSingleLabelAttribute(t,e){const{baseMark:i}=t;this._updateLabelComponentAttribute(e.getProduct(),i.getProduct(),[t])}_updateLabelComponentAttribute(t,e,i){const s=this._option.getComponentsByType("totalLabel");t.target(e).configure({interactive:!1}).depend(s.map(a=>a.getMarks()[0].getProduct())).labelStyle((a,n)=>{var r,l;const h=i[n.labelIndex];if(h){const{labelSpec:d,labelMark:c,series:u}=h,g=c.getRule(),p=this._interactiveConfig(d),_=(l=(r=this._spec)===null||r===void 0?void 0:r.centerOffset)!==null&&l!==void 0?l:0;let m=q({textStyle:Object.assign({pickable:d.interactive===!0},d.style),overlap:{avoidMarks:s.map(v=>v.getMarks()[0].getProductId())}},Ud(g,h),Object.assign(Object.assign(Object.assign({},mn(d,["position","style","state","type","stackDataFilterType","getStyleHandler"])),p),{centerOffset:_}),d.stackDataFilterType?{dataFilter:d.stackDataFilterType==="min"?v=>v.filter(b=>b.data[Al]):v=>v.filter(b=>b.data[Rn])}:{});return u&&u.parseLabelStyle&&(m=u.parseLabelStyle(m,d,c)),g!=="line"&&g!=="area"||(m.type=g),m}}).encode((a,n,r)=>{if(i[r.labelIndex]){const{labelSpec:l,labelMark:h}=i[r.labelIndex];return h.skipEncode?{data:a}:Ds(i[r.labelIndex],a,l.formatMethod,l.formatter)}}).size(()=>i[0].series.getRegion().getLayoutRect())}compileMarks(){this.getMarks().forEach(t=>{var e;const i=this._labelComponentMap.get(t)();let s;s=U(i)?i[0].series.getRegion().getGroupMark().getProduct():i.series.getRegion().getGroupMark().getProduct(),t.compile({group:s}),(e=t.getProduct())===null||e===void 0||e.configure({context:{model:this,labelInfo:i}})})}getVRenderComponents(){const t=[];return this._labelComponentMap.forEach((e,i)=>{const s=i.getProduct().getGroupGraphicItem();s&&t.push(s)}),t}}Ne.type=P.label,Ne.specKey="label",Ne.transformerConstructor=Hr;const Vr=()=>{dr(),zr(),vs(),V.registerComponent(Ne.type,Ne,!0)};class Ii extends Vs{constructor(){super(...arguments),this.type=P.totalLabel,this.name=P.totalLabel,this.specKey="totalLabel",this.layoutZIndex=ft.Label}static getSpecInfo(t,e){var i;const s=[];return(i=e==null?void 0:e.region)===null||i===void 0||i.forEach((a,n)=>{var r;(r=a.seriesIndexes)===null||r===void 0||r.forEach(l=>{const{spec:h}=e.series[l],d=h[this.specKey];d!=null&&d.visible&&s.push({spec:d,type:P.totalLabel,specPath:["series",l,this.specKey],specInfoPath:["component",this.specKey,l],regionIndexes:[n],seriesIndexes:[l]})})}),s}init(t){super.init(t),this._initTextMark(),this._initLabelComponent()}_initTextMark(){var t;const e=this._getSeries();if(!((t=e.getSpec().totalLabel)===null||t===void 0)&&t.visible){const i=e.getSeriesMark();if(i){const s=this._createMark({type:"label",name:`${i.name}-total-label`});this._baseMark=i,this._textMark=s,this._initTextMarkStyle()}}}_initTextMarkStyle(){var t;super.initMarkStyleWithSpec(this._textMark,this._spec),this.setMarkStyle(this._textMark,{text:i=>i[kl]},"normal",I.Default);const e=this._getSeries();(t=e.initTotalLabelMarkStyle)===null||t===void 0||t.call(e,this._textMark)}_initLabelComponent(){const t=this._getSeries(),e=this._createMark({type:"component",name:`${t.name}-total-label-component`},{componentType:"label",noSeparateStyle:!0,support3d:this._spec.support3d});e&&this._marks.addMark(e)}afterCompile(){this._marks.forEach((t,e)=>{const i=t.getProduct();i&&i.addEventListener(Ye.AFTER_ELEMENT_ENCODE,()=>{this._isLayout===!1&&this._delegateLabelEvent(i.getGroupGraphicItem())})})}updateLayoutAttribute(){super.updateLayoutAttribute();const t=this._getSeries();this._marks.forEach((e,i)=>{e.getProduct().target(this._baseMark.getProduct()).configure({interactive:!1}).labelStyle(()=>{var s,a;if(this._baseMark){const{offset:n,animation:r,overlap:l}=this._spec,h=this._interactiveConfig(this._spec);return q({textStyle:{pickable:this._spec.interactive===!0},position:Hc(t,this._baseMark.type),x:0,y:0},(a=(s=t.getTotalLabelComponentStyle)===null||s===void 0?void 0:s.call(t,{baseMark:this._baseMark,labelMark:this._textMark}))!==null&&a!==void 0?a:{},Object.assign({offset:n,animation:r,overlap:l,dataFilter:d=>d.filter(c=>c.data[Rn])},h))}}).encode(s=>Ds({baseMark:this._baseMark,labelMark:this._textMark,series:t,labelSpec:t.getSpec().totalLabel},s,this._spec.formatMethod)).size(()=>this._regions[0].getLayoutRect())})}compileMarks(){this.getMarks().forEach(t=>{var e;const i=this._regions[0].getGroupMark().getProduct();t.compile({group:i}),(e=t.getProduct())===null||e===void 0||e.configure({context:{model:this}})})}getVRenderComponents(){const t=[];return this.getMarks().forEach(e=>{const i=e.getProduct().getGroupGraphicItem();i&&t.push(i)}),t}_getSeries(){return this._option.getSeriesInIndex([this.getSpecPath()[1]])[0]}}Ii.type=P.totalLabel,Ii.specKey="totalLabel";function Hc(o,t){var e,i;let s;const{direction:a}=o,n={vertical:["top","bottom"],horizontal:["right","left"]},r=(a==="horizontal"?!((e=o.getXAxisHelper())===null||e===void 0)&&e.isInverse():!((i=o.getYAxisHelper())===null||i===void 0)&&i.isInverse())?1:0;switch(t){case"rect":case"symbol":s=n[a][r];break;default:s="top"}return s}const Vc=()=>{dr(),zr(),vs(),V.registerComponent(Ii.type,Ii,!0)};var an=function(o,t){var e={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&t.indexOf(i)<0&&(e[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(e[i[s]]=o[i[s]])}return e};class jr extends zs{constructor(){super(...arguments),this.specKey="markPoint",this.layoutZIndex=ft.MarkPoint}static _getMarkerCoordinateType(t){const{doPolarProcess:e,doGeoProcess:i}=cs(t);return t.coordinateType==="polar"||e?"polar":t.coordinateType==="geo"||i?"geo":"cartesian"}_createMarkerComponent(){var t,e,i,s,a,n,r,l,h,d,c,u,g,p,_,m,v,b,y,f,x,M,k,D,O,T,B,H;const{itemContent:G={},itemLine:Q={},targetSymbol:Z={}}=this._spec,{text:N={},symbol:K,image:Mt,richText:At}=G,_e=an(G,["text","symbol","image","richText"]),Ot={zIndex:this.layoutZIndex,interactive:(t=this._spec.interactive)===null||t===void 0||t,hover:(e=this._spec.interactive)===null||e===void 0||e,select:(i=this._spec.interactive)===null||i===void 0||i,position:{x:0,y:0},clipInRange:(s=this._spec.clip)!==null&&s!==void 0&&s,itemContent:Object.assign({offsetX:en(G.offsetX,this._relativeSeries.getRegion()),offsetY:en(G.offsetX,this._relativeSeries.getRegion())},_e),targetSymbol:{offset:(a=Z.offset)!==null&&a!==void 0?a:0,visible:(n=Z.visible)!==null&&n!==void 0&&n,size:(r=Z.size)!==null&&r!==void 0?r:20,style:Zt(Z.style,this._markerData)},state:{line:at((h=(l=this._spec.itemLine.line)===null||l===void 0?void 0:l.state)!==null&&h!==void 0?h:{},this._markerData),lineStartSymbol:at((c=(d=this._spec.itemLine.startSymbol)===null||d===void 0?void 0:d.state)!==null&&c!==void 0?c:{},this._markerData),lineEndSymbol:at((g=(u=this._spec.itemLine.endSymbol)===null||u===void 0?void 0:u.state)!==null&&g!==void 0?g:{},this._markerData),symbol:at((_=(p=this._spec.itemContent.symbol)===null||p===void 0?void 0:p.state)!==null&&_!==void 0?_:{},this._markerData),image:at((v=(m=this._spec.itemContent.image)===null||m===void 0?void 0:m.state)!==null&&v!==void 0?v:{},this._markerData),text:at((y=(b=this._spec.itemContent.text)===null||b===void 0?void 0:b.state)!==null&&y!==void 0?y:{},this._markerData),textBackground:at((x=(f=this._spec.itemContent.text)===null||f===void 0?void 0:f.labelBackground)===null||x===void 0?void 0:x.state,this._markerData),richText:at((k=(M=this._spec.itemContent.richText)===null||M===void 0?void 0:M.state)!==null&&k!==void 0?k:{},this._markerData),customMark:at((O=(D=this._spec.itemContent.customMark)===null||D===void 0?void 0:D.state)!==null&&O!==void 0?O:{},this._markerData),targetItem:at((B=(T=this._spec.targetSymbol)===null||T===void 0?void 0:T.state)!==null&&B!==void 0?B:{},this._markerData)},animation:(H=this._spec.animation)!==null&&H!==void 0&&H,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};K!=null&&K.style&&(Ot.itemContent.symbolStyle=F(Zt(K.style,this._markerData))),Mt!=null&&Mt.style&&(Ot.itemContent.imageStyle=Zt(Mt.style,this._markerData)),N&&(Ot.itemContent.textStyle=ws(N,this._markerData)),At!=null&&At.style&&(Ot.itemContent.richTextStyle=Zt(At.style,this._markerData));const{visible:we,line:Fe={}}=Q,ot=an(Q,["visible","line"]);return Ot.itemLine=we!==!1?Object.assign(Object.assign({},ot),{visible:!0,lineStyle:F(Fe.style)}):{visible:!1},new de(Ot)}_markerLayout(){var t,e,i,s,a;const n=this._spec,r=this._markerData,l=this._relativeSeries,{point:h}=this._computePointsAttr(),d=this._getRelativeDataView().latestData,c=r?r.latestData[0]&&r.latestData[0].latestData?r.latestData[0].latestData:r.latestData:d;let u;if(n.clip||!((t=n.itemContent)===null||t===void 0)&&t.confine){const{minX:g,maxX:p,minY:_,maxY:m}=Rs([l.getRegion()]);u={x:g,y:_,width:p-g,height:m-_}}if(this._markerComponent){const g=(e=this._markerComponent.attribute)!==null&&e!==void 0?e:{},p=(s=(i=g.itemContent)===null||i===void 0?void 0:i.textStyle)!==null&&s!==void 0?s:{};this._markerComponent.setAttributes({position:h===void 0?{x:null,y:null}:h,itemContent:Object.assign(Object.assign({},g.itemContent),{textStyle:Object.assign(Object.assign({},p),{text:!((a=this._spec.itemContent.text)===null||a===void 0)&&a.formatMethod?this._spec.itemContent.text.formatMethod(c,d):p.text}),offsetX:sn(h,g.itemContent.offsetX,this._relativeSeries.getRegion()),offsetY:sn(h,g.itemContent.offsetY,this._relativeSeries.getRegion())}),limitRect:u,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}}_initDataView(){const t=this._spec,{doXYProcess:e,doPolarProcess:i,doGeoProcess:s}=cs(t);if(!(S(t.coordinate)||e||i||s))return;st(this._option.dataSet,"markerAggregation",Fs),st(this._option.dataSet,"markerFilter",Hs);const{options:a}=this._computeOptions(),n=new St(this._option.dataSet,{name:`${this.type}_${this.id}_data`});n.parse([this._getRelativeDataView()],{type:"dataview"}),n.transform({type:"markerAggregation",options:a}),n.transform({type:"markerFilter",options:this._getAllRelativeSeries()}),n.target.on("change",()=>{this._markerLayout()}),this._markerData=n}}jr.specKey="markPoint";class Ri extends jr{constructor(){super(...arguments),this.type=P.markPoint,this.name=P.markPoint,this.coordinateType="cartesian"}_computePointsAttr(){var t;const e=this._spec,i=this._markerData,s=this._relativeSeries,a="x"in e&&"y"in e,n="coordinate"in e,r="position"in e,l=(t=e==null?void 0:e.autoRange)!==null&&t!==void 0&&t;let h;return a?h=Li(i,s,s,s,l)[0][0]:n?h=Es(i,s,l,e.coordinatesOffset)[0]:r&&(h=Is(e.position,s,e.regionRelative)[0]),{point:h}}_computeOptions(){const t=this._spec,{doXYProcess:e}=cs(t),i=S(t.coordinate);let s;return e?s=[this._processSpecByDims([{dim:"x",specValue:t.x},{dim:"y",specValue:t.y}])]:i&&(s=this._processSpecCoo(t)),{options:s}}}Ri.type=P.markPoint,Ri.coordinateType="cartesian";const jc=()=>{V.registerComponent(Ri.type,Ri),Yh()};class wi extends Ee{constructor(){super(...arguments),this.layoutType="none",this.type=P.brush,this.name=P.brush,this.specKey="brush",this.layoutZIndex=ft.Brush,this._linkedSeries=[],this._itemMap={},this._linkedItemMap={},this._inBrushElementsMap={},this._outOfBrushElementsMap={},this._linkedInBrushElementsMap={},this._linkedOutOfBrushElementsMap={},this._needInitOutState=!0,this._cacheInteractiveRangeAttrs=[],this._needDisablePickable=!1,this._releatedAxes=[],this._regionAxisMap={},this._axisDataZoomMap={},this._zoomRecord=[]}init(){const t=this._transformBrushedMarkAttr(this._spec.inBrush),e=this._transformBrushedMarkAttr(this._spec.outOfBrush);this._option.getAllSeries().forEach(i=>{i.getActiveMarks().forEach(s=>{s&&(i.setMarkStyle(s,Object.assign({},t),"inBrush",I.Series),i.setMarkStyle(s,Object.assign({},e),"outOfBrush",I.Series))})})}static getSpecInfo(t){const e=t[this.specKey];if(!C(e)&&e.visible!==!1)return[{spec:e,specPath:[this.specKey],specInfoPath:["component",this.specKey,0],type:P.brush}]}created(){super.created(),this.initEvent(),this._bindRegions(),this._bindLinkedSeries(),this._initRegionAxisMap(),this._initAxisDataZoomMap(),this._initNeedOperatedItem()}_extendDataInBrush(t){const e=[];for(const i in t)for(const s in t[i])e.push(Object.assign({},t[i][s].data[0]));return e}_extendDatumOutOfBrush(t){var e;const i=[];for(const s in t)i.push((e=t[s].data)===null||e===void 0?void 0:e[0]);return i}_getBrushInteractiveAttr(t){const e=t.getLayoutStartPoint(),i=t.getLayoutRect(),s=e.x,a=s+i.width,n=e.y,r=n+i.height;return{interactiveRange:{minY:n,maxY:r,minX:s,maxX:a},xRange:[s,a],yRange:[n,r]}}_updateBrushComponent(t,e){const i=this._getBrushInteractiveAttr(t),s=this._brushComponents[e];s.setAttributes(i),this._initMarkBrushState(e,""),s.children[0].removeAllChild(),this._needInitOutState=!0}_createBrushComponent(t,e){var i,s;const a=this._getBrushInteractiveAttr(t),n=new ar(Object.assign(Object.assign(Object.assign({zIndex:this.layoutZIndex,brushStyle:F((i=this._spec)===null||i===void 0?void 0:i.style)},a),this._spec),{disableTriggerEvent:this._option.disableTriggerEvent}));n.id=(s=this._spec.id)!==null&&s!==void 0?s:`brush-${this.id}`,this.getContainer().add(n);const{brushMode:r="single"}=this._spec;this._brushComponents.push(n),this._cacheInteractiveRangeAttrs.push(a),n.addEventListener(dt.drawStart,l=>{this._emitEvent(z.brushStart,t)}),n.addEventListener(dt.moveStart,l=>{this._emitEvent(z.brushStart,t)}),n.addEventListener(dt.drawing,l=>{this._needInitOutState&&r==="single"&&this._initMarkBrushState(e,"outOfBrush"),this._needInitOutState=!1,this._needDisablePickable=!0,this._handleBrushChange(z.brushChange,t,l),this._emitEvent(z.brushChange,t)}),n.addEventListener(dt.moving,l=>{this._handleBrushChange(z.brushChange,t,l),this._emitEvent(z.brushChange,t)}),n.addEventListener(dt.brushClear,l=>{this._initMarkBrushState(e,""),this._needInitOutState=!0,this._needDisablePickable=!1,this._handleBrushChange(z.brushChange,t,l),this._handleBrushChange(z.brushClear,t,l),this._emitEvent(z.brushChange,t),this._emitEvent(z.brushClear,t)}),n.addEventListener(dt.drawEnd,l=>{this._needInitOutState=!0,this._needDisablePickable=!1;const{operateMask:h}=l.detail;this._handleBrushChange(z.brushEnd,t,l),this._setAxisAndDataZoom(h,t),this._emitEvent(z.brushEnd,t)}),n.addEventListener(dt.moveEnd,l=>{const{operateMask:h}=l.detail;this._handleBrushChange(z.brushEnd,t,l),this._setAxisAndDataZoom(h,t),this._emitEvent(z.brushEnd,t)})}_handleBrushChange(t,e,i){const{operateMask:s}=i.detail;this._reconfigItem(s,e),this._reconfigLinkedItem(s,e)}_emitEvent(t,e){this.event.emit(t,{model:this,value:{operateType:t,operateRegion:e,inBrushData:this._extendDataInBrush(this._inBrushElementsMap),outOfBrushData:this._extendDatumOutOfBrush(this._outOfBrushElementsMap),linkInBrushData:this._extendDataInBrush(this._linkedInBrushElementsMap),linkOutOfBrushData:this._extendDatumOutOfBrush(this._linkedOutOfBrushElementsMap),inBrushElementsMap:this._inBrushElementsMap,outOfBrushElementsMap:this._outOfBrushElementsMap,linkedInBrushElementsMap:this._linkedInBrushElementsMap,linkedOutOfBrushElementsMap:this._linkedOutOfBrushElementsMap,zoomRecord:this._zoomRecord}})}_transformBrushedMarkAttr(t){const e={};return t!=null&&t.symbol&&(e.symbolType=t.symbol),t!=null&&t.symbolSize&&(e.size=t.symbolSize),t!=null&&t.color&&(e.fill=t.color),t!=null&&t.colorAlpha&&(e.fillOpacity=t.colorAlpha),Object.assign(Object.assign({},F(t)),e)}_reconfigItem(t,e){this._itemMap[e.id].forEach(i=>{const s=i.getProduct();!s||!s.elements||!s.elements.length||s.elements.forEach(a=>{var n,r,l;const h=a.getGraphicItem(),d=i.id+"_"+a.key;!((n=this._outOfBrushElementsMap)===null||n===void 0)&&n[d]&&this._isBrushContainItem(t,h)?(a.addState("inBrush"),this._inBrushElementsMap[t==null?void 0:t.name]||(this._inBrushElementsMap[t==null?void 0:t.name]={}),this._inBrushElementsMap[t==null?void 0:t.name][d]=a,delete this._outOfBrushElementsMap[d]):!((l=(r=this._inBrushElementsMap)===null||r===void 0?void 0:r[t==null?void 0:t.name])===null||l===void 0)&&l[d]&&!this._isBrushContainItem(t,h)&&(a.removeState("inBrush"),a.addState("outOfBrush"),this._outOfBrushElementsMap[d]=a,delete this._inBrushElementsMap[t.name][d]),h.setAttribute("pickable",!this._needDisablePickable)})})}_reconfigLinkedItem(t,e){const i=e.getLayoutStartPoint(),s=e.getSeries().map(a=>a.id);this._linkedSeries.forEach(a=>{if(!s.includes(a.id)){const n=a.getRegion().getLayoutStartPoint(),r=n.x-i.x,l=n.y-i.y;this._linkedItemMap[a.id].forEach(h=>{const d=h.getProduct();!d||!d.elements||!d.elements.length||d.elements.forEach(c=>{var u,g,p;const _=c.getGraphicItem(),m=h.id+"_"+c.key;!((u=this._linkedOutOfBrushElementsMap)===null||u===void 0)&&u[m]&&this._isBrushContainItem(t,_,{dx:r,dy:l})?(c.addState("inBrush"),this._linkedInBrushElementsMap[t==null?void 0:t.name]||(this._linkedInBrushElementsMap[t==null?void 0:t.name]={}),this._linkedInBrushElementsMap[t==null?void 0:t.name][m]=c,delete this._linkedOutOfBrushElementsMap[m]):!((p=(g=this._linkedInBrushElementsMap)===null||g===void 0?void 0:g[t==null?void 0:t.name])===null||p===void 0)&&p[m]&&!this._isBrushContainItem(t,_,{dx:r,dy:l})&&(c.removeState("inBrush"),c.addState("outOfBrush"),this._linkedOutOfBrushElementsMap[m]=c),_.setAttribute("pickable",!this._needDisablePickable)})})}})}_isBrushContainItem(t,e,i){var s,a,n;if(!(t!=null&&t.globalTransMatrix)||!(!((s=t==null?void 0:t.attribute)===null||s===void 0)&&s.points))return!1;const r=(n=(a=t==null?void 0:t.attribute)===null||a===void 0?void 0:a.points)!==null&&n!==void 0?n:[],{a:l,b:h,c:d,d:c,e:u,f:g}=t.globalTransMatrix,p=(i==null?void 0:i.dx)||0,_=(i==null?void 0:i.dy)||0,m=r.map(f=>({x:l*f.x+d*f.y+u+p,y:h*f.x+c*f.y+g+_}));t.globalAABBBounds.clone().set(t.globalAABBBounds.x1+p,t.globalAABBBounds.y1+_,t.globalAABBBounds.x2+p,t.globalAABBBounds.y2+_);const v=e.globalTransMatrix.e,b=e.globalTransMatrix.f;let y=[];if(e.type==="symbol"){const{size:f=0}=e==null?void 0:e.attribute,x=L(f)[0]/2;return y=[{x:v-x,y:b-x},{x:v+x,y:b-x},{x:v+x,y:b+x},{x:v-x,y:b+x}],ga(m,y)}if(e.type==="rect"){const{x1:f,x2:x,y1:M,y2:k}=e==null?void 0:e.AABBBounds,D=Math.abs(f-x),O=Math.abs(M-k);return y=[{x:v,y:b},{x:v+D,y:b},{x:v+D,y:b+O},{x:v,y:b+O}],ga(m,y)}return t.globalAABBBounds.intersects(e.globalAABBBounds)}_stateClamp(t){return Math.min(Math.max(0,t),1)}_setAxisAndDataZoom(t,e){var i;if(this._zoomRecord=[],this._spec.zoomAfterBrush){const s=t.AABBBounds;(i=this._regionAxisMap["region_"+e.id])===null||i===void 0||i.forEach(a=>{var n,r;const l=a.layoutOrient==="bottom"||a.layoutOrient==="top",h=(n=this._spec.axisRangeExpand)!==null&&n!==void 0?n:0,{x1:d,x2:c,y1:u,y2:g}=s,p=l?"x":"y",_=l?d:u,m=l?c:g;if(this._axisDataZoomMap[a.id]){const v=this._axisDataZoomMap[a.id],b=v.relatedAxisComponent,y=b.getScale().invert(_-e.getLayoutStartPoint()[p]),f=b.getScale().invert(m-e.getLayoutStartPoint()[p]),x=v.dataToStatePoint(y),M=v.dataToStatePoint(f),k=this._stateClamp(x-h),D=this._stateClamp(M+h);v.setStartAndEnd(k,D,["percent","percent"]),this._zoomRecord.push({operateComponent:v,start:k,end:D})}else{const v=a.getScale().range(),b=(r=a.getScale().rangeFactor())!==null&&r!==void 0?r:[0,1],y=v[1]<v[0],f=_-e.getLayoutStartPoint()[p],x=m-e.getLayoutStartPoint()[p],M=y?Math.min(f,x):Math.max(f,x),k=((y?Math.max(f,x):Math.min(f,x))-v[0])/(v[1]-v[0])*(b[1]-b[0])+b[0],D=(M-v[0])/(v[1]-v[0])*(b[1]-b[0])+b[0],O=this._stateClamp(k-h),T=this._stateClamp(D+h);a.getScale().rangeFactor([O,T]),a.effect.scaleUpdate(),this._zoomRecord.push({operateComponent:a,start:O,end:T})}})}}_bindRegions(){S(this._spec.regionId)&&S(this._spec.regionIndex)&&(this._relativeRegions=this._option.getAllRegions()),this._relativeRegions=this._option.getRegionsInUserIdOrIndex(L(this._spec.regionId),L(this._spec.regionIndex))}_bindLinkedSeries(){S(this._spec.brushLinkSeriesId)&&S(this._spec.brushLinkSeriesIndex)||(this._linkedSeries=this._option.getSeriesInUserIdOrIndex(L(this._spec.brushLinkSeriesId),L(this._spec.brushLinkSeriesIndex)))}_initRegionAxisMap(){S(this._spec.axisId)?L(this._spec.axisId).forEach(t=>{this._releatedAxes.push(this._option.getComponentByUserId(t))}):S(this._spec.axisIndex)?L(this._spec.axisIndex).forEach(t=>{this._releatedAxes.push(this._option.getComponentByIndex("axes",t))}):this._releatedAxes=this._option.getComponentsByKey("axes"),this._releatedAxes.forEach(t=>{t==null||t.getRegions().forEach(e=>{this._regionAxisMap["region_"+e.id]?this._regionAxisMap["region_"+e.id].push(t):this._regionAxisMap["region_"+e.id]=[t]})})}_initAxisDataZoomMap(){this._option.getComponentsByKey("dataZoom").forEach(t=>{t.relatedAxisComponent&&(this._axisDataZoomMap[t.relatedAxisComponent.id]=t)})}_initNeedOperatedItem(){const t=this._spec.seriesId,e=this._spec.seriesIndex;this._relativeRegions.forEach(i=>{const s=[];i.getSeries().forEach(a=>{(t&&L(t).includes(a.userId.toString())||e&&L(e).includes(a.getSpecIndex())||!e&&!t)&&s.push(...a.getMarksWithoutRoot()),this._itemMap[i.id]=s})}),this._linkedSeries.forEach(i=>{this._linkedItemMap[i.id]=i.getMarksWithoutRoot()})}_initMarkBrushState(t,e){this._brushComponents.forEach((i,s)=>{s!==t&&i.children[0].removeAllChild()}),this._inBrushElementsMap={},this._outOfBrushElementsMap={},this._linkedInBrushElementsMap={},this._linkedOutOfBrushElementsMap={},this._option.getAllSeries().forEach(i=>{i.getMarksWithoutRoot().forEach(s=>{const a=s.getProduct();!a||!a.elements||!a.elements.length||a.elements.forEach(n=>{const r=s.id+"_"+n.key;n.removeState("inBrush"),n.removeState("outOfBrush"),n.addState(e),this._outOfBrushElementsMap[r]=n,this._linkedOutOfBrushElementsMap[r]=n})})})}initEvent(){}onRender(t){}changeRegions(t){}_getNeedClearVRenderComponents(){return this._brushComponents}_compareSpec(t,e){this._brushComponents&&this._relativeRegions.forEach((s,a)=>{this._updateBrushComponent(s,a)});const i=super._compareSpec(t,e);return ge(e,t)||(i.reRender=!0,i.reMake=!0),i}onLayoutEnd(t){var e;super.onLayoutEnd(t),!this._option.disableTriggerEvent&&((e=this._spec.visible)===null||e===void 0||e)&&(this._brushComponents?this._relativeRegions.forEach((i,s)=>{this._updateBrushComponent(i,s)}):(this._brushComponents=[],this._relativeRegions.forEach((i,s)=>{this._createBrushComponent(i,s)})))}clearGraphic(){this._brushComponents&&this._brushComponents.forEach(t=>{t._container.incrementalClearChild()})}clear(){if(this._brushComponents){const t=this.getContainer();this._brushComponents.forEach(e=>{e.removeAllChild(),e.releaseBrushEvents(),t&&t.removeChild(e)}),this._brushComponents=null}}}wi.type=P.brush,wi.specKey="brush";const Yc=()=>{V.registerComponent(wi.type,wi)},Xc=[Ml,Tl,Cl,Ll,Ie,Re,yr,br,Ir,Yc,Pl,xc,Bl,Dl,Ol,zc,Fc,jc,Sc,El],Gc=wn("CommonChart",{type:"common",vchartConstrouctor:Fn},[mc,Ie,Re,yr,br,Ir,Vr,Vc,Pd,Rd,fr,Xd,_c]),Uc=wn("LineChart",{type:"line",vchartConstrouctor:Fn},[Md,Vr,...Xc]),tu={title:"VChart/Line"};function He(){const t={padding:24,layout:{type:"grid",col:3,row:3,elements:[{modelId:"text",col:0,colSpan:2,row:0},{modelId:"legend",col:2,row:0},{modelId:"humidity",col:1,colSpan:2,row:1},{modelId:"humidity-left",col:0,colSpan:1,row:1},{modelId:"axes-bottom",col:1,colSpan:2,row:2}]},region:[{id:"humidity"}],title:{id:"text",padding:{top:0},text:"自定义标题",textStyle:{lineHeight:24},subtext:"这是副标题这是副标题这是副标题这是副标题这是副标题这是副标题这是副标题",subtextStyle:{lineHeight:24}},legends:{padding:{top:0},visible:!0,orient:"bottom",position:"end",id:"legend",regionId:["humidity"]},series:[{id:"humidity-series",regionId:"humidity",type:"line",seriesField:"type",data:{id:"humidityData"},xField:"date",yField:"value"}],axes:[{id:"humidity-left",regionId:"humidity",orient:"left",...{expand:{max:.2},label:{flush:!0,visible:!0},tick:{visible:!1},forceTickCount:3}},{id:"axes-bottom",regionId:["humidity"],orient:"bottom",label:{firstVisible:!0,lastVisible:!0,visible:!0},tick:{visible:!1},paddingInner:.99,paddingOuter:0}],data:[{id:"humidityData",values:[{date:"周一",value:36,type:"maximum-humidity"},{date:"周二",value:37,type:"maximum-humidity"},{date:"周三",value:38,type:"maximum-humidity"},{date:"周四",value:38,type:"maximum-humidity"},{date:"周五",value:40,type:"maximum-humidity"},{date:"周一",value:21,type:"minimum-humidity"},{date:"周二",value:21,type:"minimum-humidity"},{date:"周三",value:22,type:"minimum-humidity"},{date:"周四",value:23,type:"minimum-humidity"},{date:"周五",value:24,type:"minimum-humidity"}]}]};return cn.createElement(Gc,{...t})}function Ve(){const o={title:{text:"多条折线图",subtext:"这是描述"},xField:"year",yField:"value",seriesField:"category",data:{values:[{year:"2010",value:510,category:"Liquid fuel"},{year:"2010",value:481,category:"Solid fuel"},{year:"2010",value:570,category:"Gas flarinl"},{year:"2011",value:513,category:"Liquid fuel"},{year:"2011",value:405,category:"Solid fuel"},{year:"2011",value:164,category:"Gas flarinl"},{year:"2012",value:320,category:"Liquid fuel"},{year:"2012",value:410,category:"Solid fuel"},{year:"2012",value:250,category:"Gas flarinl"},{year:"2013",value:222,category:"Liquid fuel"},{year:"2013",value:512,category:"Solid fuel"},{year:"2013",value:408,category:"Gas flarinl"},{year:"2014",value:428,category:"Liquid fuel"},{year:"2014",value:111,category:"Solid fuel"},{year:"2014",value:568,category:"Gas flarinl"},{year:"2015",value:428,category:"Liquid fuel"},{year:"2015",value:111,category:"Solid fuel"},{year:"2015",value:568,category:"Gas flarinl"}]},legends:{visible:!0,position:"end",orient:"top"},point:{style:{fill:"white",shape:"circle",strokeWidth:1,stroke:{scale:"color",field:"category"}}}};return cn.createElement(Uc,{...o})}He.__docgenInfo={description:"",methods:[],displayName:"Basic"};Ve.__docgenInfo={description:"",methods:[],displayName:"Middle"};var nn,rn,on;He.parameters={...He.parameters,docs:{...(nn=He.parameters)==null?void 0:nn.docs,source:{originalSource:`function Basic() {
  const leftAxesCommonSpec = {
    expand: {
      max: 0.2
    },
    label: {
      flush: true,
      visible: true
    },
    tick: {
      visible: false
    },
    forceTickCount: 3
  };
  const spec: CommonProps = {
    padding: 24,
    layout: {
      type: 'grid',
      col: 3,
      row: 3,
      elements: [{
        modelId: 'text',
        col: 0,
        colSpan: 2,
        row: 0
      }, {
        modelId: 'legend',
        col: 2,
        row: 0
      }, {
        modelId: 'humidity',
        col: 1,
        colSpan: 2,
        row: 1
      }, {
        modelId: 'humidity-left',
        col: 0,
        colSpan: 1,
        row: 1
      }, {
        modelId: 'axes-bottom',
        col: 1,
        colSpan: 2,
        row: 2
      }]
    },
    region: [{
      id: 'humidity'
    }],
    title: {
      id: 'text',
      padding: {
        top: 0
      },
      text: '自定义标题',
      textStyle: {
        lineHeight: 24
      },
      subtext: '这是副标题这是副标题这是副标题这是副标题这是副标题这是副标题这是副标题',
      subtextStyle: {
        lineHeight: 24
      }
    },
    legends: {
      padding: {
        top: 0
      },
      visible: true,
      orient: 'bottom',
      position: 'end',
      id: 'legend',
      regionId: ['humidity']
    },
    series: [{
      id: 'humidity-series',
      regionId: 'humidity',
      type: 'line',
      seriesField: 'type',
      data: {
        id: 'humidityData'
      },
      xField: 'date',
      yField: 'value'
    }],
    axes: [{
      id: 'humidity-left',
      regionId: 'humidity',
      orient: 'left',
      // title: { visible: true, text: 'ES' },
      ...leftAxesCommonSpec
    }, {
      id: 'axes-bottom',
      regionId: ['humidity'],
      orient: 'bottom',
      label: {
        firstVisible: true,
        lastVisible: true,
        visible: true
      },
      tick: {
        visible: false
      },
      paddingInner: 0.99,
      paddingOuter: 0
    }],
    data: [{
      id: 'humidityData',
      values: [{
        date: '周一',
        value: 36,
        type: 'maximum-humidity'
      }, {
        date: '周二',
        value: 37,
        type: 'maximum-humidity'
      }, {
        date: '周三',
        value: 38,
        type: 'maximum-humidity'
      }, {
        date: '周四',
        value: 38,
        type: 'maximum-humidity'
      }, {
        date: '周五',
        value: 40,
        type: 'maximum-humidity'
      }, {
        date: '周一',
        value: 21,
        type: 'minimum-humidity'
      }, {
        date: '周二',
        value: 21,
        type: 'minimum-humidity'
      }, {
        date: '周三',
        value: 22,
        type: 'minimum-humidity'
      }, {
        date: '周四',
        value: 23,
        type: 'minimum-humidity'
      }, {
        date: '周五',
        value: 24,
        type: 'minimum-humidity'
      }]
    }]
  };
  return <Common {...spec} />;
}`,...(on=(rn=He.parameters)==null?void 0:rn.docs)==null?void 0:on.source}}};var ln,hn,dn;Ve.parameters={...Ve.parameters,docs:{...(ln=Ve.parameters)==null?void 0:ln.docs,source:{originalSource:`function Middle() {
  const config: LineProps = {
    title: {
      text: '多条折线图',
      subtext: '这是描述'
    },
    xField: 'year',
    yField: 'value',
    seriesField: 'category',
    data: {
      values: [{
        year: '2010',
        value: 510,
        category: 'Liquid fuel'
      }, {
        year: '2010',
        value: 481,
        category: 'Solid fuel'
      }, {
        year: '2010',
        value: 570,
        category: 'Gas flarinl'
      }, {
        year: '2011',
        value: 513,
        category: 'Liquid fuel'
      }, {
        year: '2011',
        value: 405,
        category: 'Solid fuel'
      }, {
        year: '2011',
        value: 164,
        category: 'Gas flarinl'
      }, {
        year: '2012',
        value: 320,
        category: 'Liquid fuel'
      }, {
        year: '2012',
        value: 410,
        category: 'Solid fuel'
      }, {
        year: '2012',
        value: 250,
        category: 'Gas flarinl'
      }, {
        year: '2013',
        value: 222,
        category: 'Liquid fuel'
      }, {
        year: '2013',
        value: 512,
        category: 'Solid fuel'
      }, {
        year: '2013',
        value: 408,
        category: 'Gas flarinl'
      }, {
        year: '2014',
        value: 428,
        category: 'Liquid fuel'
      }, {
        year: '2014',
        value: 111,
        category: 'Solid fuel'
      }, {
        year: '2014',
        value: 568,
        category: 'Gas flarinl'
      }, {
        year: '2015',
        value: 428,
        category: 'Liquid fuel'
      }, {
        year: '2015',
        value: 111,
        category: 'Solid fuel'
      }, {
        year: '2015',
        value: 568,
        category: 'Gas flarinl'
      }]
    },
    legends: {
      visible: true,
      position: 'end',
      orient: 'top'
    },
    point: {
      style: {
        fill: 'white',
        shape: 'circle',
        strokeWidth: 1,
        stroke: {
          scale: 'color',
          field: 'category'
        }
      }
    }
  };
  return <Line {...config} />;
}`,...(dn=(hn=Ve.parameters)==null?void 0:hn.docs)==null?void 0:dn.source}}};const eu=["Basic","Middle"];export{He as Basic,Ve as Middle,eu as __namedExportsOrder,tu as default};
